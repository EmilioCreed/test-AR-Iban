(function(g){g.support.touch="ontouchend" in document;if(!g.support.touch){return}var h=g.ui.mouse.prototype,j=h._mouseInit,f;function i(b,c){if(b.originalEvent.touches.length>1){return}b.preventDefault();var d=b.originalEvent.changedTouches[0],a=document.createEvent("MouseEvents");a.initMouseEvent(c,true,true,window,1,d.screenX,d.screenY,d.clientX,d.clientY,false,false,false,false,0,null);b.target.dispatchEvent(a)}h._touchStart=function(b){var a=this;if(f||!a._mouseCapture(b.originalEvent.changedTouches[0])){return}f=true;a._touchMoved=false;i(b,"mouseover");i(b,"mousemove");i(b,"mousedown")};h._touchMove=function(a){if(!f){return}this._touchMoved=true;i(a,"mousemove")};h._touchEnd=function(a){if(!f){return}i(a,"mouseup");i(a,"mouseout");if(!this._touchMoved){i(a,"click")}f=false};h._mouseInit=function(){var a=this;a.element.bind("touchstart",g.proxy(a,"_touchStart")).bind("touchmove",g.proxy(a,"_touchMove")).bind("touchend",g.proxy(a,"_touchEnd"));j.call(a)}})(jQuery);/*
 * modernizr v3.6.0
 * Build https://modernizr.com/download?-arrow-getusermedia-svg-touchevents-webaudio-webworkers-setclasses-dontmin
 *
 * Copyright (c)
 *  Faruk Ates
 *  Paul Irish
 *  Alex Sexton
 *  Ryan Seddon
 *  Patrick Kettner
 *  Stu Cox
 *  Richard Herrera

 * MIT License
 */
(function(window,document,undefined){var classes=[];var tests=[];var ModernizrProto={_version:"3.6.0",_config:{classPrefix:"",enableClasses:true,enableJSClass:true,usePrefixes:true},_q:[],on:function(test,cb){var self=this;setTimeout(function(){cb(self[test])},0)},addTest:function(name,fn,options){tests.push({name:name,fn:fn,options:options})},addAsyncTest:function(fn){tests.push({name:null,fn:fn})}};var Modernizr=function(){};Modernizr.prototype=ModernizrProto;Modernizr=new Modernizr();
/*
{
  "name": "SVG",
  "property": "svg",
  "caniuse": "svg",
  "tags": ["svg"],
  "authors": ["Erik Dahlstrom"],
  "polyfills": [
    "svgweb",
    "raphael",
    "amplesdk",
    "canvg",
    "svg-boilerplate",
    "sie",
    "dojogfx",
    "fabricjs"
  ]
}
!*/
Modernizr.addTest("svg",!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect);
/*
{
  "name": "Web Audio API",
  "property": "webaudio",
  "caniuse": "audio-api",
  "polyfills": ["xaudiojs", "dynamicaudiojs", "audiolibjs"],
  "tags": ["audio", "media"],
  "builderAliases": ["audio_webaudio_api"],
  "authors": ["Addy Osmani"],
  "notes": [{
    "name": "W3 Specification",
    "href": "https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html"
  }]
}
!*/
Modernizr.addTest("webaudio",function(){var prefixed="webkitAudioContext" in window;var unprefixed="AudioContext" in window;if(Modernizr._config.usePrefixes){return prefixed||unprefixed}return unprefixed});
/*
{
  "name": "ES6 Arrow Functions",
  "property": "arrow",
  "authors": ["Vincent Riemer"],
  "tags": ["es6"]
}
!*/
Modernizr.addTest("arrow",function(){try{eval("()=>{}")}catch(e){return false}return true});
/*
{
  "name": "getUserMedia",
  "property": "getusermedia",
  "caniuse": "stream",
  "tags": ["webrtc"],
  "authors": ["Eric Bidelman", "Masataka Yakura"],
  "notes": [{
    "name": "W3C Media Capture and Streams spec",
    "href": "http://w3c.github.io/mediacapture-main/#dom-mediadevices-getusermedia"
  }]
}
!*/
Modernizr.addTest("getUserMedia","mediaDevices" in navigator&&"getUserMedia" in navigator.mediaDevices);
/*
{
  "name": "Web Workers",
  "property": "webworkers",
  "caniuse" : "webworkers",
  "tags": ["performance", "workers"],
  "notes": [{
    "name": "W3C Reference",
    "href": "https://www.w3.org/TR/workers/"
  }, {
    "name": "HTML5 Rocks article",
    "href": "http://www.html5rocks.com/en/tutorials/workers/basics/"
  }, {
    "name": "MDN documentation",
    "href": "https://developer.mozilla.org/en-US/docs/Web/Guide/Performance/Using_web_workers"
  }],
  "polyfills": ["fakeworker", "html5shims"]
}
!*/
Modernizr.addTest("webworkers","Worker" in window);function is(obj,type){return typeof obj===type}function testRunner(){var featureNames;var feature;var aliasIdx;var result;var nameIdx;var featureName;var featureNameSplit;for(var featureIdx in tests){if(tests.hasOwnProperty(featureIdx)){featureNames=[];feature=tests[featureIdx];if(feature.name){featureNames.push(feature.name.toLowerCase());if(feature.options&&feature.options.aliases&&feature.options.aliases.length){for(aliasIdx=0;aliasIdx<feature.options.aliases.length;aliasIdx++){featureNames.push(feature.options.aliases[aliasIdx].toLowerCase())}}}result=is(feature.fn,"function")?feature.fn():feature.fn;for(nameIdx=0;nameIdx<featureNames.length;nameIdx++){featureName=featureNames[nameIdx];featureNameSplit=featureName.split(".");if(featureNameSplit.length===1){Modernizr[featureNameSplit[0]]=result}else{if(Modernizr[featureNameSplit[0]]&&!(Modernizr[featureNameSplit[0]] instanceof Boolean)){Modernizr[featureNameSplit[0]]=new Boolean(Modernizr[featureNameSplit[0]])}Modernizr[featureNameSplit[0]][featureNameSplit[1]]=result}classes.push((result?"":"no-")+featureNameSplit.join("-"))}}}}var docElement=document.documentElement;var isSVG=docElement.nodeName.toLowerCase()==="svg";function setClasses(classes){var className=docElement.className;var classPrefix=Modernizr._config.classPrefix||"";if(isSVG){className=className.baseVal}if(Modernizr._config.enableJSClass){var reJS=new RegExp("(^|\\s)"+classPrefix+"no-js(\\s|$)");className=className.replace(reJS,"$1"+classPrefix+"js$2")}if(Modernizr._config.enableClasses){className+=" "+classPrefix+classes.join(" "+classPrefix);if(isSVG){docElement.className.baseVal=className}else{docElement.className=className}}}var prefixes=(ModernizrProto._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""]);ModernizrProto._prefixes=prefixes;function createElement(){if(typeof document.createElement!=="function"){return document.createElement(arguments[0])}else{if(isSVG){return document.createElementNS.call(document,"http://www.w3.org/2000/svg",arguments[0])}else{return document.createElement.apply(document,arguments)}}}function getBody(){var body=document.body;if(!body){body=createElement(isSVG?"svg":"body");body.fake=true}return body}function injectElementWithStyles(rule,callback,nodes,testnames){var mod="modernizr";var style;var ret;var node;var docOverflow;var div=createElement("div");var body=getBody();if(parseInt(nodes,10)){while(nodes--){node=createElement("div");node.id=testnames?testnames[nodes]:mod+(nodes+1);div.appendChild(node)}}style=createElement("style");style.type="text/css";style.id="s"+mod;(!body.fake?div:body).appendChild(style);body.appendChild(div);if(style.styleSheet){style.styleSheet.cssText=rule}else{style.appendChild(document.createTextNode(rule))}div.id=mod;if(body.fake){body.style.background="";body.style.overflow="hidden";docOverflow=docElement.style.overflow;docElement.style.overflow="hidden";docElement.appendChild(body)}ret=callback(div,rule);if(body.fake){body.parentNode.removeChild(body);docElement.style.overflow=docOverflow;docElement.offsetHeight}else{div.parentNode.removeChild(div)}return !!ret}var testStyles=ModernizrProto.testStyles=injectElementWithStyles;
/*
{
  "name": "Touch Events",
  "property": "touchevents",
  "caniuse" : "touch",
  "tags": ["media", "attribute"],
  "notes": [{
    "name": "Touch Events spec",
    "href": "https://www.w3.org/TR/2013/WD-touch-events-20130124/"
  }],
  "warnings": [
    "Indicates if the browser supports the Touch Events spec, and does not necessarily reflect a touchscreen device"
  ],
  "knownBugs": [
    "False-positive on some configurations of Nokia N900",
    "False-positive on some BlackBerry 6.0 builds â€“ https://github.com/Modernizr/Modernizr/issues/372#issuecomment-3112695"
  ]
}
!*/
Modernizr.addTest("touchevents",function(){var bool;if(("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch){bool=true}else{var query=["@media (",prefixes.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");testStyles(query,function(node){bool=node.offsetTop===9})}return bool});testRunner();setClasses(classes);delete ModernizrProto.addTest;delete ModernizrProto.addAsyncTest;for(var i=0;i<Modernizr._q.length;i++){Modernizr._q[i]()}window.Modernizr=Modernizr})(window,document);/* Hammer.JS - v2.0.8 - 2016-04-23
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
!function(ag,al,aq,aw){function aB(d,e,f){return setTimeout(a0(d,f),e)}function aG(d,e,f){return Array.isArray(d)?(aL(d,f[e],f),!0):!1}function aL(d,f,g){var h;if(d){if(d.forEach){d.forEach(f,g)}else{if(d.length!==aw){for(h=0;h<d.length;){f.call(g,d[h],h,d),h++}}else{for(h in d){d.hasOwnProperty(h)&&f.call(g,d[h],h,d)}}}}}function aQ(a,f,g){var h="DEPRECATED METHOD: "+f+"\n"+g+" AT \n";return function(){var b=new Error("get-stack-trace"),e=b&&b.stack?b.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",i=ag.console&&(ag.console.warn||ag.console.log);return i&&i.call(ag.console,h,e),a.apply(this,arguments)}}function aV(f,g,h){var i,j=g.prototype;i=f.prototype=Object.create(j),i.constructor=f,i._super=j,h&&be(i,h)}function a0(c,d){return function(){return c.apply(d,arguments)}}function a5(c,d){return typeof c==bt?c.apply(d?d[0]||aw:aw,d):c}function bc(c,d){return c===aw?d:c}function bh(d,e,f){aL(bB(e),function(a){d.addEventListener(a,f,!1)})}function bm(d,e,f){aL(bB(e),function(a){d.removeEventListener(a,f,!1)})}function br(c,d){for(;c;){if(c==d){return !0}c=c.parentNode}return !1}function bw(c,d){return c.indexOf(d)>-1}function bB(b){return b.trim().split(/\s+/g)}function bG(e,f,g){if(e.indexOf&&!g){return e.indexOf(f)}for(var h=0;h<e.length;){if(g&&e[h][g]==f||!g&&e[h]===f){return h}h++}return -1}function bL(b){return Array.prototype.slice.call(b,0)}function bQ(h,i,j){for(var k=[],l=[],m=0;m<h.length;){var n=i?h[m][i]:h[m];bG(l,n)<0&&k.push(h[m]),l[m]=n,m++}return j&&(k=i?k.sort(function(b,d){return b[i]>d[i]}):k.sort()),k}function bV(d,h){for(var i,j,k=h[0].toUpperCase()+h.slice(1),l=0;l<bj.length;){if(i=bj[l],j=i?i+k:h,j in d){return j}l++}return aw}function b0(){return bX++}function b5(a){var d=a.ownerDocument||a;return d.defaultView||d.parentWindow||ag}function cc(d,e){var f=this;this.manager=d,this.callback=e,this.element=d.element,this.target=d.options.inputTarget,this.domHandler=function(a){a5(d.options.enable,[d])&&f.handler(a)},this.init()}function cg(d){var e,f=d.options.inputClass;return new (e=f?f:ce?bi:ci?bx:b7?bH:bd)(d,ck)}function ck(h,i,j){var k=j.pointers.length,l=j.changedPointers.length,m=i&aE&&k-l===0,n=i&(aO|aT)&&k-l===0;j.isFirst=!!m,j.isFinal=!!n,m&&(h.session={}),j.eventType=i,ah(h,j),h.emit("hammer.input",j),h.recognize(j),h.session.prevInput=j}function ah(l,m){var n=l.session,o=m.pointers,p=o.length;n.firstInput||(n.firstInput=ax(m)),p>1&&!n.firstMultiple?n.firstMultiple=ax(m):1===p&&(n.firstMultiple=!1);var q=n.firstInput,r=n.firstMultiple,s=r?r.center:q.center,t=m.center=aC(o);m.timeStamp=bI(),m.deltaTime=m.timeStamp-q.timeStamp,m.angle=aW(s,t),m.distance=aR(s,t),am(n,m),m.offsetDirection=aM(m.deltaX,m.deltaY);var u=aH(m.deltaTime,m.deltaX,m.deltaY);m.overallVelocityX=u.x,m.overallVelocityY=u.y,m.overallVelocity=bD(u.x)>bD(u.y)?u.x:u.y,m.scale=r?a6(r.pointers,o):1,m.rotation=r?a1(r.pointers,o):0,m.maxPointers=n.prevInput?m.pointers.length>n.prevInput.maxPointers?m.pointers.length:n.prevInput.maxPointers:m.pointers.length,ar(n,m);var v=l.element;br(m.srcEvent.target,v)&&(v=m.srcEvent.target),m.target=v}function am(g,h){var i=h.center,j=g.offsetDelta||{},k=g.prevDelta||{},l=g.prevInput||{};h.eventType!==aE&&l.eventType!==aO||(k=g.prevDelta={x:l.deltaX||0,y:l.deltaY||0},j=g.offsetDelta={x:i.x,y:i.y}),h.deltaX=k.x+(i.x-j.x),h.deltaY=k.y+(i.y-j.y)}function ar(d,m){var n,o,p,q,r=d.lastInterval||m,s=m.timeStamp-r.timeStamp;if(m.eventType!=aT&&(s>az||r.velocity===aw)){var t=m.deltaX-r.deltaX,u=m.deltaY-r.deltaY,v=aH(s,t,u);o=v.x,p=v.y,n=bD(v.x)>bD(v.y)?v.x:v.y,q=aM(t,u),d.lastInterval=m}else{n=r.velocity,o=r.velocityX,p=r.velocityY,q=r.direction}m.velocity=n,m.velocityX=o,m.velocityY=p,m.direction=q}function ax(d){for(var e=[],f=0;f<d.pointers.length;){e[f]={clientX:by(d.pointers[f].clientX),clientY:by(d.pointers[f].clientY)},f++}return{timeStamp:bI(),pointers:e,center:aC(e),deltaX:d.deltaX,deltaY:d.deltaY}}function aC(f){var g=f.length;if(1===g){return{x:by(f[0].clientX),y:by(f[0].clientY)}}for(var h=0,i=0,j=0;g>j;){h+=f[j].clientX,i+=f[j].clientY,j++}return{x:by(h/g),y:by(i/g)}}function aH(d,e,f){return{x:e/d||0,y:f/d||0}}function aM(c,d){return c===d?aY:bD(c)>=bD(d)?0>c?a3:a8:0>d?bf:bk}function aR(f,g,h){h||(h=bE);var i=g[h[0]]-f[h[0]],j=g[h[1]]-f[h[1]];return Math.sqrt(i*i+j*j)}function aW(f,g,h){h||(h=bE);var i=g[h[0]]-f[h[0]],j=g[h[1]]-f[h[1]];return 180*Math.atan2(j,i)/Math.PI}function a1(c,d){return aW(d[1],d[0],bJ)+aW(c[1],c[0],bJ)}function a6(c,d){return aR(d[0],d[1],bJ)/aR(c[0],c[1],bJ)}function bd(){this.evEl=bT,this.evWin=bY,this.pressed=!1,cc.apply(this,arguments)}function bi(){this.evEl=cf,this.evWin=cj,cc.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function bn(){this.evTarget=ad,this.evWin=af,this.started=!1,cc.apply(this,arguments)}function bs(e,f){var g=bL(e.touches),h=bL(e.changedTouches);return f&(aO|aT)&&(g=bQ(g.concat(h),"identifier",!0)),[g,h]}function bx(){this.evTarget=ap,this.targetIds={},cc.apply(this,arguments)}function bC(j,k){var l=bL(j.touches),m=this.targetIds;if(k&(aE|aJ)&&1===l.length){return m[l[0].identifier]=!0,[l,l]}var n,o,p=bL(j.changedTouches),q=[],r=this.target;if(o=l.filter(function(b){return br(b.target,r)}),k===aE){for(n=0;n<o.length;){m[o[n].identifier]=!0,n++}}for(n=0;n<p.length;){m[p[n].identifier]&&q.push(p[n]),k&(aO|aT)&&delete m[p[n].identifier],n++}return q.length?[bQ(o.concat(q),"identifier",!0),q]:void 0}function bH(){cc.apply(this,arguments);var b=a0(this.handler,this);this.touch=new bx(this.manager,b),this.mouse=new bd(this.manager,b),this.primaryTouch=null,this.lastTouches=[]}function bM(c,d){c&aE?(this.primaryTouch=d.changedPointers[0].identifier,bR.call(this,d)):c&(aO|aT)&&bR.call(this,d)}function bR(f){var g=f.changedPointers[0];if(g.identifier===this.primaryTouch){var h={x:g.clientX,y:g.clientY};this.lastTouches.push(h);var i=this.lastTouches,j=function(){var b=i.indexOf(h);b>-1&&i.splice(b,1)};setTimeout(j,av)}}function bW(h){for(var i=h.srcEvent.clientX,j=h.srcEvent.clientY,k=0;k<this.lastTouches.length;k++){var l=this.lastTouches[k],m=Math.abs(i-l.x),n=Math.abs(j-l.y);if(aA>=m&&aA>=n){return !0}}return !1}function b1(c,d){this.manager=c,this.set(d)}function b6(d){if(bw(d,a4)){return a4}var e=bw(d,a9),f=bw(d,bg);return e&&f?a4:e||f?e?a9:bg:bw(d,aZ)?aZ:aU}function cd(){if(!aK){return !1}var a={},d=ag.CSS&&ag.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(b){a[b]=d?ag.CSS.supports("touch-action",b):!0}),a}function ch(b){this.options=be({},this.defaults,b||{}),this.id=b0(),this.manager=null,this.options.enable=bc(this.options.enable,!0),this.state=bq,this.simultaneous={},this.requireFail=[]}function cl(b){return b&bP?"cancel":b&bF?"end":b&bA?"move":b&bv?"start":""}function ac(b){return b==bk?"down":b==bf?"up":b==a3?"left":b==a8?"right":""}function ae(d,e){var f=e.manager;return f?f.get(d):d}function ai(){ch.apply(this,arguments)}function an(){ai.apply(this,arguments),this.pX=null,this.pY=null}function at(){ai.apply(this,arguments)}function ay(){ch.apply(this,arguments),this._timer=null,this._input=null}function aD(){ai.apply(this,arguments)}function aI(){ai.apply(this,arguments)}function aN(){ch.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function aS(c,d){return d=d||{},d.recognizers=bc(d.recognizers,aS.defaults.preset),new aX(c,d)}function aX(c,d){this.options=be({},aS.defaults,d||{}),this.options.inputTarget=this.options.inputTarget||c,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=c,this.input=cg(this),this.touchAction=new b1(this,this.options.touchAction),a2(this,!0),aL(this.options.recognizers,function(e){var f=this.add(new e[0](e[1]));e[2]&&f.recognizeWith(e[2]),e[3]&&f.requireFailure(e[3])},this)}function a2(e,f){var g=e.element;if(g.style){var h;aL(e.options.cssProps,function(a,b){h=bV(g.style,b),f?(e.oldCssProps[h]=g.style[h],g.style[h]=a):g.style[h]=e.oldCssProps[h]||""}),f||(e.oldCssProps={})}}function a7(b,e){var f=al.createEvent("Event");f.initEvent(b,!0,!0),f.gesture=e,e.target.dispatchEvent(f)}var be,bj=["","webkit","Moz","MS","ms","o"],bo=al.createElement("div"),bt="function",by=Math.round,bD=Math.abs,bI=Date.now;be="function"!=typeof Object.assign?function(d){if(d===aw||null===d){throw new TypeError("Cannot convert undefined or null to object")}for(var g=Object(d),h=1;h<arguments.length;h++){var i=arguments[h];if(i!==aw&&null!==i){for(var j in i){i.hasOwnProperty(j)&&(g[j]=i[j])}}}return g}:Object.assign;var bN=aQ(function(d,g,h){for(var i=Object.keys(g),j=0;j<i.length;){(!h||h&&d[i[j]]===aw)&&(d[i[j]]=g[i[j]]),j++}return d},"extend","Use `assign`."),bS=aQ(function(c,d){return bN(c,d,!0)},"merge","Use `assign`."),bX=1,b2=/mobile|tablet|ip(ad|hone|od)|android/i,b7="ontouchstart" in ag,ce=bV(ag,"PointerEvent")!==aw,ci=b7&&b2.test(navigator.userAgent),cm="touch",aj="pen",ao="mouse",au="kinect",az=25,aE=1,aJ=2,aO=4,aT=8,aY=1,a3=2,a8=4,bf=8,bk=16,bp=a3|a8,bu=bf|bk,bz=bp|bu,bE=["x","y"],bJ=["clientX","clientY"];cc.prototype={handler:function(){},init:function(){this.evEl&&bh(this.element,this.evEl,this.domHandler),this.evTarget&&bh(this.target,this.evTarget,this.domHandler),this.evWin&&bh(b5(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&bm(this.element,this.evEl,this.domHandler),this.evTarget&&bm(this.target,this.evTarget,this.domHandler),this.evWin&&bm(b5(this.element),this.evWin,this.domHandler)}};var bO={mousedown:aE,mousemove:aJ,mouseup:aO},bT="mousedown",bY="mousemove mouseup";aV(bd,cc,{handler:function(c){var d=bO[c.type];d&aE&&0===c.button&&(this.pressed=!0),d&aJ&&1!==c.which&&(d=aO),this.pressed&&(d&aO&&(this.pressed=!1),this.callback(this.manager,d,{pointers:[c],changedPointers:[c],pointerType:ao,srcEvent:c}))}});var b3={pointerdown:aE,pointermove:aJ,pointerup:aO,pointercancel:aT,pointerout:aT},b8={2:cm,3:aj,4:ao,5:au},cf="pointerdown",cj="pointermove pointerup pointercancel";ag.MSPointerEvent&&!ag.PointerEvent&&(cf="MSPointerDown",cj="MSPointerMove MSPointerUp MSPointerCancel"),aV(bi,cc,{handler:function(i){var j=this.store,k=!1,l=i.type.toLowerCase().replace("ms",""),m=b3[l],n=b8[i.pointerType]||i.pointerType,o=n==cm,p=bG(j,i.pointerId,"pointerId");m&aE&&(0===i.button||o)?0>p&&(j.push(i),p=j.length-1):m&(aO|aT)&&(k=!0),0>p||(j[p]=i,this.callback(this.manager,m,{pointers:j,changedPointers:[i],pointerType:n,srcEvent:i}),k&&j.splice(p,1))}});var cn={touchstart:aE,touchmove:aJ,touchend:aO,touchcancel:aT},ad="touchstart",af="touchstart touchmove touchend touchcancel";aV(bn,cc,{handler:function(d){var e=cn[d.type];if(e===aE&&(this.started=!0),this.started){var f=bs.call(this,d,e);e&(aO|aT)&&f[0].length-f[1].length===0&&(this.started=!1),this.callback(this.manager,e,{pointers:f[0],changedPointers:f[1],pointerType:cm,srcEvent:d})}}});var ak={touchstart:aE,touchmove:aJ,touchend:aO,touchcancel:aT},ap="touchstart touchmove touchend touchcancel";aV(bx,cc,{handler:function(d){var e=ak[d.type],f=bC.call(this,d,e);f&&this.callback(this.manager,e,{pointers:f[0],changedPointers:f[1],pointerType:cm,srcEvent:d})}});var av=2500,aA=25;aV(bH,cc,{handler:function(f,g,h){var i=h.pointerType==cm,j=h.pointerType==ao;if(!(j&&h.sourceCapabilities&&h.sourceCapabilities.firesTouchEvents)){if(i){bM.call(this,g,h)}else{if(j&&bW.call(this,h)){return}}this.callback(f,g,h)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var aF=bV(bo.style,"touchAction"),aK=aF!==aw,aP="compute",aU="auto",aZ="manipulation",a4="none",a9="pan-x",bg="pan-y",bl=cd();b1.prototype={set:function(b){b==aP&&(b=this.compute()),aK&&this.manager.element.style&&bl[b]&&(this.manager.element.style[aF]=b),this.actions=b.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var b=[];return aL(this.manager.recognizers,function(a){a5(a.options.enable,[a])&&(b=b.concat(a.getTouchAction()))}),b6(b.join(" "))},preventDefaults:function(k){var l=k.srcEvent,m=k.offsetDirection;if(this.manager.session.prevented){return void l.preventDefault()}var n=this.actions,o=bw(n,a4)&&!bl[a4],p=bw(n,bg)&&!bl[bg],q=bw(n,a9)&&!bl[a9];if(o){var r=1===k.pointers.length,s=k.distance<2,t=k.deltaTime<250;if(r&&s&&t){return}}return q&&p?void 0:o||p&&m&bp||q&&m&bu?this.preventSrc(l):void 0},preventSrc:function(b){this.manager.session.prevented=!0,b.preventDefault()}};var bq=1,bv=2,bA=4,bF=8,bK=bF,bP=16,bU=32;ch.prototype={defaults:{},set:function(b){return be(this.options,b),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(c){if(aG(c,"recognizeWith",this)){return this}var d=this.simultaneous;return c=ae(c,this),d[c.id]||(d[c.id]=c,c.recognizeWith(this)),this},dropRecognizeWith:function(b){return aG(b,"dropRecognizeWith",this)?this:(b=ae(b,this),delete this.simultaneous[b.id],this)},requireFailure:function(c){if(aG(c,"requireFailure",this)){return this}var d=this.requireFail;return c=ae(c,this),-1===bG(d,c)&&(d.push(c),c.requireFailure(this)),this},dropRequireFailure:function(c){if(aG(c,"dropRequireFailure",this)){return this}c=ae(c,this);var d=bG(this.requireFail,c);return d>-1&&this.requireFail.splice(d,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(b){return !!this.simultaneous[b.id]},emit:function(e){function f(a){g.manager.emit(a,e)}var g=this,h=this.state;bF>h&&f(g.options.event+cl(h)),f(g.options.event),e.additionalEvent&&f(e.additionalEvent),h>=bF&&f(g.options.event+cl(h))},tryEmit:function(b){return this.canEmit()?this.emit(b):void (this.state=bU)},canEmit:function(){for(var b=0;b<this.requireFail.length;){if(!(this.requireFail[b].state&(bU|bq))){return !1}b++}return !0},recognize:function(c){var d=be({},c);return a5(this.options.enable,[this,d])?(this.state&(bK|bP|bU)&&(this.state=bq),this.state=this.process(d),void (this.state&(bv|bA|bF|bP)&&this.tryEmit(d))):(this.reset(),void (this.state=bU))},process:function(b){},getTouchAction:function(){},reset:function(){}},aV(ai,ch,{defaults:{pointers:1},attrTest:function(c){var d=this.options.pointers;return 0===d||c.pointers.length===d},process:function(f){var g=this.state,h=f.eventType,i=g&(bv|bA),j=this.attrTest(f);return i&&(h&aT||!j)?g|bP:i||j?h&aO?g|bF:g&bv?g|bA:bv:bU}}),aV(an,ai,{defaults:{event:"pan",threshold:10,pointers:1,direction:bz},getTouchAction:function(){var c=this.options.direction,d=[];return c&bp&&d.push(bg),c&bu&&d.push(a9),d},directionTest:function(h){var i=this.options,j=!0,k=h.distance,l=h.direction,m=h.deltaX,n=h.deltaY;return l&i.direction||(i.direction&bp?(l=0===m?aY:0>m?a3:a8,j=m!=this.pX,k=Math.abs(h.deltaX)):(l=0===n?aY:0>n?bf:bk,j=n!=this.pY,k=Math.abs(h.deltaY))),h.direction=l,j&&k>i.threshold&&l&i.direction},attrTest:function(b){return ai.prototype.attrTest.call(this,b)&&(this.state&bv||!(this.state&bv)&&this.directionTest(b))},emit:function(c){this.pX=c.deltaX,this.pY=c.deltaY;var d=ac(c.direction);d&&(c.additionalEvent=this.options.event+d),this._super.emit.call(this,c)}}),aV(at,ai,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[a4]},attrTest:function(b){return this._super.attrTest.call(this,b)&&(Math.abs(b.scale-1)>this.options.threshold||this.state&bv)},emit:function(c){if(1!==c.scale){var d=c.scale<1?"in":"out";c.additionalEvent=this.options.event+d}this._super.emit.call(this,c)}}),aV(ay,ch,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[aU]},process:function(e){var g=this.options,h=e.pointers.length===g.pointers,i=e.distance<g.threshold,j=e.deltaTime>g.time;if(this._input=e,!i||!h||e.eventType&(aO|aT)&&!j){this.reset()}else{if(e.eventType&aE){this.reset(),this._timer=aB(function(){this.state=bK,this.tryEmit()},g.time,this)}else{if(e.eventType&aO){return bK}}}return bU},reset:function(){clearTimeout(this._timer)},emit:function(b){this.state===bK&&(b&&b.eventType&aO?this.manager.emit(this.options.event+"up",b):(this._input.timeStamp=bI(),this.manager.emit(this.options.event,this._input)))}}),aV(aD,ai,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[a4]},attrTest:function(b){return this._super.attrTest.call(this,b)&&(Math.abs(b.rotation)>this.options.threshold||this.state&bv)}}),aV(aI,ai,{defaults:{event:"swipe",threshold:10,velocity:0.3,direction:bp|bu,pointers:1},getTouchAction:function(){return an.prototype.getTouchAction.call(this)},attrTest:function(d){var e,f=this.options.direction;return f&(bp|bu)?e=d.overallVelocity:f&bp?e=d.overallVelocityX:f&bu&&(e=d.overallVelocityY),this._super.attrTest.call(this,d)&&f&d.offsetDirection&&d.distance>this.options.threshold&&d.maxPointers==this.options.pointers&&bD(e)>this.options.velocity&&d.eventType&aO},emit:function(c){var d=ac(c.offsetDirection);d&&this.manager.emit(this.options.event+d,c),this.manager.emit(this.options.event,c)}}),aV(aN,ch,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[aZ]},process:function(e){var j=this.options,k=e.pointers.length===j.pointers,l=e.distance<j.threshold,m=e.deltaTime<j.time;if(this.reset(),e.eventType&aE&&0===this.count){return this.failTimeout()}if(l&&m&&k){if(e.eventType!=aO){return this.failTimeout()}var n=this.pTime?e.timeStamp-this.pTime<j.interval:!0,o=!this.pCenter||aR(this.pCenter,e.center)<j.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,o&&n?this.count+=1:this.count=1,this._input=e;var p=this.count%j.taps;if(0===p){return this.hasRequireFailures()?(this._timer=aB(function(){this.state=bK,this.tryEmit()},j.interval,this),bv):bK}}return bU},failTimeout:function(){return this._timer=aB(function(){this.state=bU},this.options.interval,this),bU},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==bK&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),aS.VERSION="2.0.8",aS.defaults={domEvents:!1,touchAction:aP,enable:!0,inputTarget:null,inputClass:null,preset:[[aD,{enable:!1}],[at,{enable:!1},["rotate"]],[aI,{direction:bp}],[an,{direction:bp},["swipe"]],[aN],[aN,{event:"doubletap",taps:2},["tap"]],[ay]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var bZ=1,b4=2;aX.prototype={set:function(b){return be(this.options,b),b.touchAction&&this.touchAction.update(),b.inputTarget&&(this.input.destroy(),this.input.target=b.inputTarget,this.input.init()),this},stop:function(b){this.session.stopped=b?b4:bZ},recognize:function(g){var h=this.session;if(!h.stopped){this.touchAction.preventDefaults(g);var i,j=this.recognizers,k=h.curRecognizer;(!k||k&&k.state&bK)&&(k=h.curRecognizer=null);for(var l=0;l<j.length;){i=j[l],h.stopped===b4||k&&i!=k&&!i.canRecognizeWith(k)?i.reset():i.recognize(g),!k&&i.state&(bv|bA|bF)&&(k=h.curRecognizer=i),l++}}},get:function(d){if(d instanceof ch){return d}for(var e=this.recognizers,f=0;f<e.length;f++){if(e[f].options.event==d){return e[f]}}return null},add:function(c){if(aG(c,"add",this)){return this}var d=this.get(c.options.event);return d&&this.remove(d),this.recognizers.push(c),c.manager=this,this.touchAction.update(),c},remove:function(d){if(aG(d,"remove",this)){return this}if(d=this.get(d)){var e=this.recognizers,f=bG(e,d);-1!==f&&(e.splice(f,1),this.touchAction.update())}return this},on:function(d,e){if(d!==aw&&e!==aw){var f=this.handlers;return aL(bB(d),function(b){f[b]=f[b]||[],f[b].push(e)}),this}},off:function(d,e){if(d!==aw){var f=this.handlers;return aL(bB(d),function(b){e?f[b]&&f[b].splice(bG(f[b],e),1):delete f[b]}),this}},emit:function(e,f){this.options.domEvents&&a7(e,f);var g=this.handlers[e]&&this.handlers[e].slice();if(g&&g.length){f.type=e,f.preventDefault=function(){f.srcEvent.preventDefault()};for(var h=0;h<g.length;){g[h](f),h++}}},destroy:function(){this.element&&a2(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},be(aS,{INPUT_START:aE,INPUT_MOVE:aJ,INPUT_END:aO,INPUT_CANCEL:aT,STATE_POSSIBLE:bq,STATE_BEGAN:bv,STATE_CHANGED:bA,STATE_ENDED:bF,STATE_RECOGNIZED:bK,STATE_CANCELLED:bP,STATE_FAILED:bU,DIRECTION_NONE:aY,DIRECTION_LEFT:a3,DIRECTION_RIGHT:a8,DIRECTION_UP:bf,DIRECTION_DOWN:bk,DIRECTION_HORIZONTAL:bp,DIRECTION_VERTICAL:bu,DIRECTION_ALL:bz,Manager:aX,Input:cc,TouchAction:b1,TouchInput:bx,MouseInput:bd,PointerEventInput:bi,TouchMouseInput:bH,SingleTouchInput:bn,Recognizer:ch,AttrRecognizer:ai,Tap:aN,Pan:an,Swipe:aI,Pinch:at,Rotate:aD,Press:ay,on:bh,off:bm,each:aL,merge:bS,extend:bN,assign:be,inherit:aV,bindFn:a0,prefixed:bV});var b9="undefined"!=typeof ag?ag:"undefined"!=typeof self?self:{};b9.Hammer=aS,"function"==typeof define&&define.amd?define(function(){return aS}):"undefined"!=typeof module&&module.exports?module.exports=aS:ag[aq]=aS}(window,document,"Hammer");(function(a){if(typeof define==="function"&&define.amd){define(["jquery","hammerjs"],a)}else{if(typeof exports==="object"){a(require("jquery"),require("hammerjs"))}else{a(jQuery,Hammer)}}}(function(a,b){function c(e,f){var d=a(e);if(!d.data("hammer")){d.data("hammer",new b(d[0],f))}}a.fn.hammer=function(d){return this.each(function(){c(this,d)})};b.Manager.prototype.emit=(function(d){return function(f,e){d.call(this,f,e);a(this.element).trigger({type:f,gesture:e})}})(b.Manager.prototype.emit)}));(function(a){a.touchyOptions={useDelegation:false,longpress:{preventDefault:{start:true,move:true,end:true},requiredTouches:1,msThresh:800,triggerStartPhase:false,data:{startDate:null},proxyEvents:["TouchStart","TouchEnd"]},drag:{preventDefault:{start:true,move:true,end:true},requiredTouches:1,msHoldThresh:100,data:{startPoint:null,startDate:null,movePoint:null,moveDate:null,held:false},proxyEvents:["TouchStart","TouchMove","TouchEnd"]},pinch:{preventDefault:{start:true,move:true,end:true},requiredTouches:2,pxThresh:0,data:{startPoint:null,startDate:null,movePoint:null,moveDate:null},proxyEvents:["TouchStart","TouchMove","GestureChange","TouchEnd"]},rotate:{preventDefault:{start:true,move:true,end:true},requiredTouches:1,data:{},proxyEvents:["TouchStart","TouchMove","GestureChange","TouchEnd"]},swipe:{preventDefault:{start:true,move:true,end:true},requiredTouches:1,velocityThresh:1,triggerOn:"touchmove",data:{startPoint:null,startDate:null,movePoint:null,moveDate:null},proxyEvents:["TouchStart","TouchMove","TouchEnd"]}};var d={handleTouchStart:function(k){var m=this.context,h=getTarget(k,m);if(h){var l=k.originalEvent,q=l.targetTouches,i="touchy"+m.charAt(0).toUpperCase()+m.slice(1),j=h.data(i),o=j.settings;if(o.preventDefault.start){l.preventDefault()}if(l.touches.length===o.requiredTouches){switch(m){case"drag":f(j,q,k.timeStamp);var p=j.startPoint;h.trigger("touchy-drag",["start",h,{movePoint:p,lastMovePoint:p,startPoint:p,velocity:0}]);break;case"swipe":g(j,q,k.timeStamp);break;case"pinch":var n=getTwoTouchPointData(k);if(n){j.startPoint={x:n.centerX,y:n.centerY};j.startDistance=Math.sqrt(Math.pow((n.x2-n.x1),2)+Math.pow((n.y2-n.y1),2));j.startXOffset=n.x2-n.x1;j.startYOffset=n.y2-n.y1;h.trigger("touchy-pinch",["start",h,{scale:1,previousScale:1,currentPoint:j.startPoint,startPoint:j.startPoint,startDistance:j.startDistance,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2,startXOffset:j.startXOffset,startYOffset:j.startYOffset,currentXOffset:j.startXOffset,currentYOffset:j.startYOffset}])}break;case"longpress":j.startPoint={x:q[0].pageX,y:q[0].pageY};j.startDate=k.timeStamp;if(o.triggerStartPhase){h.trigger("touchy-longpress",["start",h])}j.timer=setTimeout(a.proxy(function(){h.trigger("touchy-longpress",["end",h])},this),o.msThresh);break;case"rotate":if(q.length===1){b(j,q,k.timeStamp)}else{var n=getTwoTouchPointData(k);j.startPoint={x:n.centerX,y:n.centerY};j.startDate=k.timeStamp}var p=j.startPoint;h.trigger("touchy-rotate",["start",h,{startPoint:p,movePoint:p,lastMovePoint:p,velocity:0,degrees:0}]);break}}}},handleTouchMove:function(p){var r=this.context,h=getTarget(p,r);if(h){var q=p.originalEvent,G=q.targetTouches,i="touchy"+r.charAt(0).toUpperCase()+r.slice(1),l=h.data(i),D=l.settings;if(D.preventDefault.move){q.preventDefault()}if(q.touches.length===D.requiredTouches){switch(r){case"drag":if(q.touches.length===l.settings.requiredTouches){f(l,G,p.timeStamp);var x=l.movePoint,u=l.lastMovePoint,o=x.x===u.x&&x.y===u.y?0:Math.sqrt(Math.pow((x.x-u.x),2)+Math.pow((x.y-u.y),2)),y=l.moveDate-l.lastMoveDate,H=y===0?0:o/y;if(l.held){h.trigger("touchy-drag",["move",h,{movePoint:x,lastMovePoint:u,startPoint:l.startPoint,velocity:H}])}}break;case"swipe":g(l,G,p.timeStamp);if(!l.swipeExecuted&&l.swiped&&D.triggerOn==="touchmove"){l.swipeExecuted=true;e(l,h)}break;case"pinch":var z=getTwoTouchPointData(p);if(z){l.currentPoint={x:z.centerX,y:z.centerY};l.previousXOffset=l.currentXOffset||l.startXOffset;l.previousYOffset=l.currentYOffset||l.startYOffset;l.currentXOffset=z.x2-z.x1;l.currentYOffset=z.y2-z.y1;if(c()){var w=Math.sqrt(Math.pow((z.x2-z.x1),2)+Math.pow((z.y2-z.y1),2)),A=l.previousScale=l.scale||1,E=l.startDistance,C=l.scale=w/E,k=C*E;if(k>D.pxThresh){h.trigger("touchy-pinch",["move",h,{scale:C,previousScale:A,currentPoint:l.currentPoint,startPoint:l.startPoint,startDistance:E,x1:z.x1,x2:z.x2,y1:z.y1,y2:z.y2,startXOffset:l.startXOffset,startYOffset:l.startYOffset,currentXOffset:l.currentXOffset,currentYOffset:l.currentYOffset}])}}}break;case"rotate":var u,t,x,v,t,o,y,H,F,j,B,n,s,m;u=l.lastMovePoint=l.movePoint||l.startPoint;t=l.lastMoveDate=l.moveDate||l.startDate;x=l.movePoint={x:G[0].pageX,y:G[0].pageY};v=l.moveDate=p.timeStamp;if(G.length===1){F=l.targetPageCoords=l.targetPageCoords||getViewOffset(p.target);j=l.centerCoords=l.centerCoords||{x:F.x+(h.width()*0.5),y:F.y+(h.height()*0.5)}}else{var z=getTwoTouchPointData(p);j=l.centerCoords={x:z.centerX,y:z.centerY};if(hasGestureChange()){break}}B=Math.atan2(x.y-j.y,x.x-j.x);s=l.lastDegrees=l.degrees;n=l.degrees=B*(180/Math.PI);m=s?n-s:0;y=v-t;H=l.velocity=y===0?0:m/y;h.trigger("touchy-rotate",["move",h,{startPoint:l.startPoint,startDate:l.startDate,movePoint:x,lastMovePoint:u,centerCoords:j,degrees:n,degreeDelta:m,velocity:H}]);break}}}},handleGestureChange:function(o){var q=this.context,h=getTarget(o,q);if(h){var h=a(o.target),p=o.originalEvent,x=p.touches,i="touchy"+q.charAt(0).toUpperCase()+q.slice(1),l=h.data(i);if(l===void 0){return}if(l.preventDefault.move&&p!=null){p.preventDefault()}switch(q){case"pinch":var t=l.previousScale=l.scale||1,u=l.scale=p.scale,w=l.startPoint,k=l.currentPoint||w,v=l.startDistance,j=u*v;if(j>l.settings.pxThresh){h.trigger("touchy-pinch",[h,{scale:u,previousScale:t,currentPoint:k,startPoint:w,startDistance:v}])}break;case"rotate":var r=l.lastDegrees=l.degrees,n=l.degrees=p.rotation,m=r?n-r:0,s=l.moveDate-l.lastMoveDate,y=l.velocity=s===0?0:m/s;h.trigger("touchy-rotate",["move",h,{startPoint:l.startPoint,startDate:l.startDate,movePoint:l.movePoint,lastMovePoint:l.lastMovePoint,centerCoords:l.centerCoords,degrees:n,degreeDelta:m,velocity:y}]);break}}},handleTouchEnd:function(m){var o=this.context,h=getTarget(m,o);if(h){var n=m.originalEvent,i="touchy"+o.charAt(0).toUpperCase()+o.slice(1),j=h.data(i),s=j.settings;if(s.preventDefault.end){n.preventDefault()}switch(o){case"drag":if(j.held){var q=j.movePoint||j.startPoint,p=j.lastMovePoint||j.startPoint,l=q.x===p.x&&q.y===p.y?0:Math.sqrt(Math.pow((q.x-p.x),2)+Math.pow((q.y-p.y),2)),r=j.moveDate-j.lastMoveDate,t=r===0?0:l/r;h.trigger("touchy-drag",["end",h,{movePoint:q,lastMovePoint:p,startPoint:j.startPoint,velocity:t}])}a.extend(j,{startPoint:null,startDate:null,movePoint:null,moveDate:null,lastMovePoint:null,lastMoveDate:null,held:false});break;case"swipe":if(j.swiped&&s.triggerOn==="touchend"){e(j,h)}a.extend(j,{startPoint:null,startDate:null,movePoint:null,moveDate:null,lastMovePoint:null,lastMoveDate:null,swiped:false,swipeExecuted:false});break;case"pinch":a.extend(j,{startPoint:null,startDistance:0,currentPoint:null,pinched:false,scale:1,previousScale:null});h.trigger("touchy-pinch",["end",h,{}]);break;case"longpress":clearTimeout(j.timer);a.extend(j,{startDate:null});break;case"rotate":var k=j.lastDegrees?j.degrees-j.lastDegrees:0;h.trigger("touchy-rotate",["end",h,{startPoint:j.startPoint,startDate:j.startDate,movePoint:j.movePoint,lastMovePoint:j.lastMovePoint,degrees:j.degrees,degreeDelta:k,velocity:j.velocity}]);a.extend(j,{startPoint:null,startDate:null,movePoint:null,moveDate:null,lastMovePoint:null,lastMoveDate:null,targetPageCoords:null,centerCoords:null,degrees:null,lastDegrees:null,velocity:null});break}}}},f=function(h,l,k){b(h,l,k);var i=h.moveDate||h.startDate,j=k;if(h.held||(j-i)>h.settings.msHoldThresh){a.extend(h,{held:true,lastMoveDate:i,lastMovePoint:h.movePoint&&h.movePoint.x?h.movePoint:h.startPoint,moveDate:j,movePoint:{x:l[0].pageX,y:l[0].pageY}})}else{a.extend(h,{held:false,lastMoveDate:0,lastMovePoint:h.startPoint,moveDate:0,movePoint:h.startPoint})}},g=function(h,r,q){b(h,r,q);var n=h.settings,o=h.startDate,p=h.startPoint,j=h.moveDate||h.startDate,k=q,l={x:r[0].pageX,y:r[0].pageY},i=l.x-p.x,s=l.y-p.y,m=k-j;a.extend(h,{lastMoveDate:j,lastMovePoint:h.movePoint&&h.movePoint.x?h.movePoint:h.startPoint,moveDate:k,movePoint:l,hDistance:i,vDistance:s});if(!h.swiped&&(Math.abs(i)/m>n.velocityThresh||Math.abs(s)/m>n.velocityThresh)){h.swiped=true}},e=function(i,h){var n=i.movePoint,m=i.lastMovePoint,k=n.x===m.x&&n.y===m.y?0:Math.sqrt(Math.pow((n.x-m.x),2)+Math.pow((n.y-m.y),2)),o=i.moveDate-i.lastMoveDate,q=o===0?0:k/o,l=i.hDistance,p=i.vDistance,j;if(q>i.settings.velocityThresh){if(Math.abs(l)>Math.abs(p)){j=l>0?"right":"left"}else{j=p>0?"down":"up"}h.trigger("touchy-swipe",[h,{direction:j,movePoint:n,lastMovePoint:m,startPoint:i.startPoint,velocity:q}])}},b=function(h,j,i){if(!h.startPoint){h.startPoint={x:j[0].pageX,y:j[0].pageY}}if(!h.startDate){h.startDate=i}},c=function(){if(window.ongesturechange==null){return true}if(window.ongesturechange==undefined){return true}return false};hasGestureChange=function(){return(typeof window.ongesturechange=="object")},getTwoTouchPointData=function(h){var i=false,j=h.originalEvent.touches;if(j.length===2){i={x1:j[0].pageX,y1:j[0].pageY,x2:j[1].pageX,y2:j[1].pageY};i.centerX=(i.x1+i.x2)/2;i.centerY=(i.y1+i.y2)/2;return i}return i},getTarget=function(k,l){var h,j=false,m=0,n=boundElems[l].length;if(a.touchyOptions.useDelegation){for(;m<n;m+=1){h=a(boundElems[l][m]).has(k.target);if(h.length>0){j=h;break}}}else{if(boundElems[l]&&boundElems[l].index(k.target)!=-1){j=a(k.target)}}return j},getViewOffset=function(j,k){function h(n,l,t){var o=n.offsetParent;l.x+=n.offsetLeft-(o?o.scrollLeft:0);l.y+=n.offsetTop-(o?o.scrollTop:0);if(o){if(o.nodeType==1){var r=t.getComputedStyle(o,"");if(r.position!="static"){l.x+=parseInt(r.borderLeftWidth);l.y+=parseInt(r.borderTopWidth);if(o.localName=="TABLE"){l.x+=parseInt(r.paddingLeft);l.y+=parseInt(r.paddingTop)}else{if(o.localName=="BODY"){var s=t.getComputedStyle(n,"");l.x+=parseInt(s.marginLeft);l.y+=parseInt(s.marginTop)}}}else{if(o.localName=="BODY"){l.x+=parseInt(r.borderLeftWidth);l.y+=parseInt(r.borderTopWidth)}}var q=n.parentNode;while(o!=q){l.x-=q.scrollLeft;l.y-=q.scrollTop;q=q.parentNode}h(o,l,t)}}else{if(n.localName=="BODY"){var s=t.getComputedStyle(n,"");l.x+=parseInt(s.borderLeftWidth);l.y+=parseInt(s.borderTopWidth);var m=t.getComputedStyle(n.parentNode,"");l.x-=parseInt(m.paddingLeft);l.y-=parseInt(m.paddingTop)}if(n.scrollLeft){l.x+=n.scrollLeft}if(n.scrollTop){l.y+=n.scrollTop}var u=n.ownerDocument.defaultView;if(u&&(!k&&u.frameElement)){h(u.frameElement,l,u)}}}var i={x:0,y:0};if(j){h(j,i,j.ownerDocument.defaultView)}return i},boundElems={},contexts={};a.each(a.touchyOptions,function(i,j){if(i!=="useDelegation"){var h=i.charAt(0).toUpperCase()+i.slice(1);boundElems[i]=a([]);contexts[i]=new (function(){this.context=i})();a.event.special["touchy-"+i]={setup:function(k,m,l){boundElems[i]=boundElems[i].add(this);a(this).data("touchy"+h,a.extend({},a.touchyOptions[i].data));a(this).data("touchy"+h).settings=a.extend({},a.touchyOptions[i]);delete a(this).data("touchy"+h).settings.data;if(boundElems[i].length===1){a.each(a.touchyOptions[i].proxyEvents,function(n,o){a(document).bind(o.toLowerCase()+".touchy."+i,a.proxy(d["handle"+o],contexts[i]))})}},teardown:function(k){boundElems[i]=boundElems[i].not(this);a(this).removeData("touchy"+h);if(boundElems[i].length===0){a.each(a.touchyOptions[i].proxyEvents,function(l,m){a(document).unbind(m.toLowerCase()+".touchy."+i)})}},add:function(k){a.extend(a(this).data("touchy"+h).settings,k.data);var l=k.handler;k.handler=function(m){return l.apply(this,arguments)}}}}})})(jQuery);function TouchyInputAdapter(){if(!(this instanceof TouchyInputAdapter)){return new TouchyInputAdapter()}var a=function(b){switch(b){case"start":return MovePhaseEnum.Start;case"move":return MovePhaseEnum.Move;case"end":return MovePhaseEnum.END;default:throw"Unknown Phase"}};this.EnableScale=function(b,c){b.off("touchy-pinch").on("touchy-pinch",function(f,g,d,e){var h=a(g);c(h,e.startXOffset,e.startYOffset,e.currentXOffset,e.currentYOffset,e.scale)})};this.DisableScale=function(b){b.off("touchy-pinch")};this.EnableMove=function(b,c){b.off("touchy-drag").on("touchy-drag",function(h,i,d,e){var j=a(i);var f=e.movePoint.x-e.lastMovePoint.x;var g=e.movePoint.y-e.lastMovePoint.y;c(j,f,g)})};this.DisableMove=function(b){b.off("touchy-drag")};this.EnableRotate=function(b,c){b.on("touchy-rotate",function(f,g,d,e){var h=a(g);c(h,e.movePoint.x,e.movePoint.y)})};this.DisableRotate=function(b){};this.useDelegation=function(b){$.touchyOptions.useDelegation=b};this.coresvgClick=function(){};this.svgContainerClick=function(){};this.leaveSvg=function(){};this.ObjectDrop=function(){};this.HandleDrop=function(){};this.OnScrollSvgContainer=function(){}};function HammerInputAdapter(){if(!(this instanceof HammerInputAdapter)){return new HammerInputAdapter()}var b=0;var c=0;var d=0;var e=0;var a=function(f){if(f.endsWith("start")){return MovePhaseEnum.Start}if(f.endsWith("move")){return MovePhaseEnum.Move}if(f.endsWith("end")){return MovePhaseEnum.End}throw"Unknown Phase"};this.EnableScale=function(f,g){f.hammer().data("hammer").get("pinch").set({enable:true});f.hammer().off("pinch").on("pinchstart pinchmove pinchend",function(h){if(h.gesture.pointerType!=="touch"){return}var i=a(h.type);var k=h.gesture.pointers[0].clientX-h.gesture.pointers[1].clientX;var j=h.gesture.pointers[0].clientY-h.gesture.pointers[1].clientY;if(i===MovePhaseEnum.Start){d=k;e=j}g(i,d,e,k,j,h.gesture.scale)})};this.DisableScale=function(f){f.hammer().off("pinch")};this.EnableMove=function(f,g){f.hammer().off("pan").on("panstart panmove panend",function(j){if(j.gesture.pointerType!=="touch"){return}var k=a(j.type);var h=j.gesture.deltaX-b;var i=j.gesture.deltaY-c;if(k===MovePhaseEnum.End){b=0;c=0}else{b=j.gesture.deltaX;c=j.gesture.deltaY}g(k,h,i)})};this.DisableMove=function(f){f.hammer().off("pan")};this.EnableRotate=function(f,g){f.hammer().off("rotate").on("panstart panmove panend",function(h){if(h.gesture.pointerType!=="touch"){return}var i=a(h.type);var j=h.gesture.pointers[0].clientX;var k=h.gesture.pointers[0].clientY;g(i,j,k)})};this.DisableRotate=function(f){f.hammer().off("rotate")};this.useDelegation=function(f){};this.coresvgClick=function(){};this.svgContainerClick=function(){};this.leaveSvg=function(){};this.ObjectDrop=function(){};this.HandleDrop=function(){};this.OnScrollSvgContainer=function(){}};var UndoManager=function(){if(!(this instanceof UndoManager)){return new UndoManager()}var b=[];var e=-1;var f=false;var a;var d=function(g){if(!g){return}f=true;g.f.apply(g.o,g.p);f=false};var c=function(m,k,n,l,i,g,j,h){return{undo:{o:m,f:k,p:n,m:l},redo:{o:i,f:g,p:j,m:h}}};this.register=function(m,k,n,l,i,g,j,h){if(f){return}b.splice(e+1,b.length-e);b.push(c(m,k,n,l,i,g,j,h));e=b.length-1;if(a){a()}};this.setCallback=function(g){a=g};this.undo=function(){var g=b[e];if(!g){return}d(g.undo);e-=1;if(a){a()}};this.redo=function(){var g=b[e+1];if(!g){return}d(g.redo);e+=1;if(a){a()}};this.clear=function(){var g=b.length;b=[];e=-1;if(a&&(g>0)){a()}},this.hasUndo=function(){return e!==-1},this.hasRedo=function(){return e<(b.length-1)}};/*
 * jQuery blockUI plugin
 * Version 2.61.0-2013.06.06
 * @requires jQuery v1.7 or later
 *
 * Examples at: http://malsup.com/jquery/block/
 * Copyright (c) 2007-2013 M. Alsup
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * Thanks to Amir-Hossein Sobhi for some excellent contributions!
 */
(function(){function a(b){b.fn._fadeIn=b.fn.fadeIn;var k=b.noop||function(){};var j=/MSIE/.test(navigator.userAgent);var g=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent);var i=document.documentMode||0;var p=b.isFunction(document.createElement("div").style.setExpression);b.blockUI=function(r){h(window,r)};b.unblockUI=function(r){n(window,r)};b.growlUI=function(x,t,w,v){var r=b('<div class="growlUI"></div>');if(x){r.append("<h1>"+x+"</h1>")}if(t){r.append("<h2>"+t+"</h2>")}if(w===undefined){w=3000}var s=function(y){y=y||{};b.blockUI({message:r,fadeIn:typeof y.fadeIn!=="undefined"?y.fadeIn:700,fadeOut:typeof y.fadeOut!=="undefined"?y.fadeOut:1000,timeout:typeof y.timeout!=="undefined"?y.timeout:w,centerY:false,showOverlay:false,onUnblock:v,css:b.blockUI.defaults.growlCSS})};s();var u=r.css("opacity");r.mouseover(function(){s({fadeIn:0,timeout:30000});var y=b(".blockMsg");y.stop();y.fadeTo(300,1)}).mouseout(function(){b(".blockMsg").fadeOut(1000)})};b.fn.block=function(s){if(this[0]===window){b.blockUI(s);return this}var r=b.extend({},b.blockUI.defaults,s||{});this.each(function(){var t=b(this);if(r.ignoreIfBlocked&&t.data("blockUI.isBlocked")){return}t.unblock({fadeOut:0})});return this.each(function(){if(b.css(this,"position")=="static"){this.style.position="relative";b(this).data("blockUI.static",true)}this.style.zoom=1;h(this,s)})};b.fn.unblock=function(r){if(this[0]===window){b.unblockUI(r);return this}return this.each(function(){n(this,r)})};b.blockUI.version=2.6;b.blockUI.defaults={message:"<h1>"+pleaseWaitMessage+"</h1>",title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:0.6,cursor:"wait"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:0.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:false,baseZ:1000,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,focusableElements:":input:enabled:visible",onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg",ignoreIfBlocked:false};var l=null;var m=[];function h(A,M){var x,P;var E=(A==window);var K=(M&&M.message!==undefined?M.message:undefined);M=b.extend({},b.blockUI.defaults,M||{});if(M.ignoreIfBlocked&&b(A).data("blockUI.isBlocked")){return}M.overlayCSS=b.extend({},b.blockUI.defaults.overlayCSS,M.overlayCSS||{});x=b.extend({},b.blockUI.defaults.css,M.css||{});if(M.onOverlayClick){M.overlayCSS.cursor="pointer"}P=b.extend({},b.blockUI.defaults.themedCSS,M.themedCSS||{});K=K===undefined?M.message:K;if(E&&l){n(window,{fadeOut:0})}if(K&&typeof K!="string"&&(K.parentNode||K.jquery)){var L=K.jquery?K[0]:K;var y={};b(A).data("blockUI.history",y);y.el=L;y.parent=L.parentNode;y.display=L.style.display;y.position=L.style.position;if(y.parent){y.parent.removeChild(L)}}b(A).data("blockUI.onUnblock",M.onUnblock);var R=M.baseZ;var H,I,J,N;if(j||M.forceIframe){H=b('<iframe class="blockUI" style="z-index:'+(R++)+';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+M.iframeSrc+'"></iframe>')}else{H=b('<div class="blockUI" style="display:none"></div>')}if(M.theme){I=b('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+(R++)+';display:none"></div>')}else{I=b('<div class="blockUI blockOverlay" style="z-index:'+(R++)+';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>')}if(M.theme&&E){N='<div class="blockUI '+M.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(R+10)+';display:none;position:fixed">';if(M.title){N+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(M.title||"&nbsp;")+"</div>"}N+='<div class="ui-widget-content ui-dialog-content"></div>';N+="</div>"}else{if(M.theme){N='<div class="blockUI '+M.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(R+10)+';display:none;position:absolute">';if(M.title){N+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(M.title||"&nbsp;")+"</div>"}N+='<div class="ui-widget-content ui-dialog-content"></div>';N+="</div>"}else{if(E){N='<div class="blockUI '+M.blockMsgClass+' blockPage" style="z-index:'+(R+10)+';display:none;position:fixed"></div>'}else{N='<div class="blockUI '+M.blockMsgClass+' blockElement" style="z-index:'+(R+10)+';display:none;position:absolute"></div>'}}}J=b(N);if(K){if(M.theme){J.css(P);J.addClass("ui-widget-content")}else{J.css(x)}}if(!M.theme){I.css(M.overlayCSS)}I.css("position",E?"fixed":"absolute");if(j||M.forceIframe){H.css("opacity",0)}var G=[H,I,J],r=E?b("body"):b(A);b.each(G,function(){this.appendTo(r)});if(M.theme&&M.draggable&&b.fn.draggable){J.draggable({handle:".ui-dialog-titlebar",cancel:"li"})}var B=p&&(!b.support.boxModel||b("object,embed",E?null:A).length>0);if(g||B){if(E&&M.allowBodyStretch&&b.support.boxModel){b("html,body").css("height","100%")}if((g||!b.support.boxModel)&&!E){var O=q(A,"borderTopWidth"),F=q(A,"borderLeftWidth");var D=O?"(0 - "+O+")":0;var C=F?"(0 - "+F+")":0}b.each(G,function(z,S){var T=S[0].style;T.position="absolute";if(z<2){if(E){T.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:"+M.quirksmodeOffsetHack+') + "px"')}else{T.setExpression("height",'this.parentNode.offsetHeight + "px"')}if(E){T.setExpression("width",'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"')}else{T.setExpression("width",'this.parentNode.offsetWidth + "px"')}if(C){T.setExpression("left",C)}if(D){T.setExpression("top",D)}}else{if(M.centerY){if(E){T.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"')}T.marginTop=0}else{if(!M.centerY&&E){var U=(M.css&&M.css.top)?parseInt(M.css.top,10):0;var t="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+U+') + "px"';T.setExpression("top",t)}}}})}if(K){if(M.theme){J.find(".ui-widget-content").append(K)}else{J.append(K)}if(K.jquery||K.nodeType){b(K).show()}}if((j||M.forceIframe)&&M.showOverlay){H.show()}if(M.fadeIn){var u=M.onBlock?M.onBlock:k;var v=(M.showOverlay&&!K)?u:k;var w=K?u:k;if(M.showOverlay){I._fadeIn(M.fadeIn,v)}if(K){J._fadeIn(M.fadeIn,w)}}else{if(M.showOverlay){I.show()}if(K){J.show()}if(M.onBlock){M.onBlock()}}c(1,A,M);if(E){l=J[0];m=b(M.focusableElements,l);if(M.focusInput){setTimeout(e,20)}}else{d(J[0],M.centerX,M.centerY)}if(M.timeout){var Q=setTimeout(function(){if(E){b.unblockUI(M)}else{b(A).unblock(M)}},M.timeout);b(A).data("blockUI.timeout",Q)}}function n(u,x){var s;var w=(u==window);var r=b(u);var t=r.data("blockUI.history");var y=r.data("blockUI.timeout");if(y){clearTimeout(y);r.removeData("blockUI.timeout")}x=b.extend({},b.blockUI.defaults,x||{});c(0,u,x);if(x.onUnblock===null){x.onUnblock=r.data("blockUI.onUnblock");r.removeData("blockUI.onUnblock")}var v;if(w){v=b("body").children().filter(".blockUI").add("body > .blockUI")}else{v=r.find(">.blockUI")}if(x.cursorReset){if(v.length>1){v[1].style.cursor=x.cursorReset}if(v.length>2){v[2].style.cursor=x.cursorReset}}if(w){l=m=null}if(x.fadeOut){s=v.length;v.fadeOut(x.fadeOut,function(){if(--s===0){o(v,t,x,u)}})}else{o(v,t,x,u)}}function o(x,u,y,v){var r=b(v);x.each(function(w,A){if(this.parentNode){this.parentNode.removeChild(this)}});if(u&&u.el){u.el.style.display=u.display;u.el.style.position=u.position;if(u.parent){u.parent.appendChild(u.el)}r.removeData("blockUI.history")}if(r.data("blockUI.static")){r.css("position","static")}if(typeof y.onUnblock=="function"){y.onUnblock(v,y)}var s=b(document.body),z=s.width(),t=s[0].style.width;s.width(z-1).width(z);s[0].style.width=t}function c(s,t,w){var v=t==window,r=b(t);if(!s&&(v&&!l||!v&&!r.data("blockUI.isBlocked"))){return}r.data("blockUI.isBlocked",s);if(!v||!w.bindEvents||(s&&!w.showOverlay)){return}var u="mousedown mouseup keydown keypress keyup touchstart touchend touchmove";if(s){b(document).bind(u,w,f)}else{b(document).unbind(u,f)}}function f(s){if(s.keyCode&&s.keyCode==9){if(l&&s.data.constrainTabKey){var t=m;var u=!s.shiftKey&&s.target===t[t.length-1];var r=s.shiftKey&&s.target===t[0];if(u||r){setTimeout(function(){e(r)},10);return false}}}var v=s.data;var w=b(s.target);if(w.hasClass("blockOverlay")&&v.onOverlayClick){v.onOverlayClick()}if(w.parents("div."+v.blockMsgClass).length>0){return true}return w.parents().children().filter("div.blockUI").length===0}function e(r){if(!m){return}var s=m[r===true?m.length-1:0];if(s){s.focus()}}function d(r,A,B){var v=r.parentNode,w=r.style;var u=((v.offsetWidth-r.offsetWidth)/2)-q(v,"borderLeftWidth");var z=((v.offsetHeight-r.offsetHeight)/2)-q(v,"borderTopWidth");if(A){w.left=u>0?(u+"px"):"0"}if(B){w.top=z>0?(z+"px"):"0"}}function q(r,s){return parseInt(b.css(r,s),10)||0}}if(typeof define==="function"&&define.amd&&define.amd.jQuery){define(["jquery"],a)}else{a(jQuery)}})();var qq=function(a){return{hide:function(){a.style.display="none";return this},attach:function(c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}return function(){qq(a).detach(c,b)}},detach:function(c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}return this},contains:function(b){if(a===b){return true}if(a.contains){return a.contains(b)}else{return !!(b.compareDocumentPosition(a)&8)}},insertBefore:function(b){b.parentNode.insertBefore(a,b);return this},remove:function(){a.parentNode.removeChild(a);return this},css:function(b){if(b.opacity!==null){if(typeof a.style.opacity!=="string"&&typeof(a.filters)!=="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"}}qq.extend(a.style,b);return this},hasClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");return c.test(a.className)},addClass:function(b){if(!qq(a).hasClass(b)){a.className+=" "+b}return this},removeClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");a.className=a.className.replace(c," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(c){var b,d=[];if(a.querySelectorAll){return a.querySelectorAll("."+c)}b=a.getElementsByTagName("*");qq.each(b,function(e,f){if(qq(f).hasClass(c)){d.push(f)}});return d},children:function(){var c=[],b=a.firstChild;while(b){if(b.nodeType===1){c.push(b)}b=b.nextSibling}return c},setText:function(b){a.innerText=b;a.textContent=b;return this},clearText:function(){return qq(a).setText("")}}};qq.log=function(b,a){if(window.console){if(!a||a==="info"){window.console.log(b)}else{if(window.console[a]){window.console[a](b)}else{window.console.log("<"+a+"> "+b)}}}};qq.isObject=function(a){return a!==null&&a&&typeof(a)==="object"&&a.constructor===Object};qq.isFunction=function(a){return typeof(a)==="function"};qq.isString=function(a){return Object.prototype.toString.call(a)==="[object String]"};qq.trimStr=function(a){if(String.prototype.trim){return a.trim()}return a.replace(/^\s+|\s+$/g,"")};qq.isFileOrInput=function(a){if(window.File&&a instanceof File){return true}else{if(window.HTMLInputElement){if(a instanceof HTMLInputElement){if(a.type&&a.type.toLowerCase()==="file"){return true}}}else{if(a.tagName){if(a.tagName.toLowerCase()==="input"){if(a.type&&a.type.toLowerCase()==="file"){return true}}}}}return false};qq.isBlob=function(a){return window.Blob&&Object.prototype.toString.call(a)==="[object Blob]"};qq.isXhrUploadSupported=function(){var a=document.createElement("input");a.type="file";return(a.multiple!==undefined&&typeof File!=="undefined"&&typeof FormData!=="undefined"&&typeof(new XMLHttpRequest()).upload!=="undefined")};qq.isFolderDropSupported=function(a){return(a.items&&a.items[0].webkitGetAsEntry)};qq.isFileChunkingSupported=function(){return !qq.android()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==undefined||File.prototype.webkitSlice!==undefined||File.prototype.mozSlice!==undefined)};qq.extend=function(b,c,a){qq.each(c,function(d,e){if(a&&qq.isObject(e)){if(b[d]===undefined){b[d]={}}qq.extend(b[d],e,true)}else{b[d]=e}})};qq.indexOf=function(a,b,c){if(a.indexOf){return a.indexOf(b,c)}c=c||0;var d=a.length;if(c<0){c+=d}for(;c<d;c+=1){if(a.hasOwnProperty(c)&&a[c]===b){return c}}return -1};qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,d=a=="x"?b:(b&3|8);return d.toString(16)})};qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.safari=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1};qq.chrome=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Google")!==-1};qq.firefox=function(){return(navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==undefined&&navigator.vendor==="")};qq.windows=function(){return navigator.platform==="Win32"};qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}}());qq.each=function(c,a){var b,d;if(c){for(b in c){if(Object.prototype.hasOwnProperty.call(c,b)){d=a(b,c[b]);if(d===false){break}}}}};qq.obj2url=function(d,g,f){var b,c,h=[],e="&",a=function(k,j){var l=g?(/\[\]$/.test(g))?g:g+"["+j+"]":j;if((l!=="undefined")&&(j!=="undefined")){h.push((typeof k==="object")?qq.obj2url(k,l,true):(Object.prototype.toString.call(k)==="[object Function]")?encodeURIComponent(l)+"="+encodeURIComponent(k()):encodeURIComponent(l)+"="+encodeURIComponent(k))}};if(!f&&g){e=(/\?/.test(g))?(/\?$/.test(g))?"":"&":"?";h.push(g);h.push(qq.obj2url(d))}else{if((Object.prototype.toString.call(d)==="[object Array]")&&(typeof d!=="undefined")){for(b=-1,c=d.length;b<c;b+=1){a(d[b],b)}}else{if((typeof d!=="undefined")&&(d!==null)&&(typeof d==="object")){for(b in d){if(d.hasOwnProperty(b)){a(d[b],b)}}}else{h.push(encodeURIComponent(g)+"="+encodeURIComponent(d))}}}if(g){return h.join(e)}else{return h.join(e).replace(/^&/,"").replace(/%20/g,"+")}};qq.obj2FormData=function(c,b,a){if(!b){b=new FormData()}qq.each(c,function(d,e){d=a?a+"["+d+"]":d;if(qq.isObject(e)){qq.obj2FormData(e,b,d)}else{if(qq.isFunction(e)){b.append(d,e())}else{b.append(d,e)}}});return b};qq.obj2Inputs=function(c,a){var b;if(!a){a=document.createElement("form")}qq.obj2FormData(c,{append:function(d,e){b=document.createElement("input");b.setAttribute("name",d);b.setAttribute("value",e);a.appendChild(b)}});return a};qq.setCookie=function(d,e,b){var a=new Date(),c="";if(b){a.setTime(a.getTime()+(b*24*60*60*1000));c="; expires="+a.toGMTString()}document.cookie=d+"="+e+c+"; path=/"};qq.getCookie=function(e){var f=e+"=",b=document.cookie.split(";"),a;for(var d=0;d<b.length;d++){a=b[d];while(a.charAt(0)==" "){a=a.substring(1,a.length)}if(a.indexOf(f)===0){return a.substring(f.length,a.length)}}};qq.getCookieNames=function(c){var b=document.cookie.split(";"),a=[];qq.each(b,function(f,d){d=qq.trimStr(d);var e=d.indexOf("=");if(d.match(c)){a.push(d.substr(0,e))}});return a};qq.deleteCookie=function(a){qq.setCookie(a,"",-1)};qq.areCookiesEnabled=function(){var b=Math.random()*100000,a="qqCookieTest:"+b;qq.setCookie(a,1);if(qq.getCookie(a)){qq.deleteCookie(a);return true}return false};qq.parseJson=function(json){if(window.JSON&&qq.isFunction(JSON.parse)){return JSON.parse(json)}else{return eval("("+json+")")}};qq.DisposeSupport=function(){var a=[];return{dispose:function(){var b;do{b=a.shift();if(b){b()}}while(b)},attach:function(){var b=arguments;this.addDisposer(qq(b[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(b){a.push(b)}}};qq.supportedFeatures=(function(){var i,c,f,d,g,j,h,e;function k(){var m=true,n;try{n=document.createElement("input");n.type="file";qq(n).hide();if(n.disabled){m=false}}catch(l){m=false}return m}function b(){return qq.chrome()&&navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)!==undefined}function a(){return qq.chrome()&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==undefined}i=k();c=i&&qq.isXhrUploadSupported();f=c&&b();d=c&&qq.isFileChunkingSupported();g=c&&d&&qq.areCookiesEnabled();j=c&&a();h=i&&(window.postMessage!==undefined||c);e=c;return{uploading:i,ajaxUploading:c,fileDrop:c,folderDrop:f,chunking:d,resume:g,uploadCustomHeaders:c,uploadNonMultipart:c,itemSizeValidation:c,uploadViaPaste:j,progressBar:c,uploadCors:h,deleteFileCors:e}}());qq.Promise=function(){var f,c,e,b,a,d=0;return{then:function(h,g){if(d===0){e=h;b=g}else{if(d===-1&&g){g(c)}else{if(h){h(f)}}}return this},done:function(g){if(d===0){a=g}else{g()}return this},success:function(g){d=1;f=g;if(e){e(g)}if(a){a()}return this},failure:function(g){d=-1;c=g;if(b){b(g)}if(a){a()}return this}}};qq.UploadButton=function(d){var c,b=new qq.DisposeSupport(),e={element:null,multiple:false,acceptFiles:null,name:"file",onChange:function(f){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};function a(){var f=document.createElement("input");if(e.multiple){f.setAttribute("multiple","multiple")}if(e.acceptFiles){f.setAttribute("accept",e.acceptFiles)}f.setAttribute("type","file");f.setAttribute("name",e.name);qq(f).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});e.element.appendChild(f);b.attach(f,"change",function(){e.onChange(f)});b.attach(f,"mouseover",function(){qq(e.element).addClass(e.hoverClass)});b.attach(f,"mouseout",function(){qq(e.element).removeClass(e.hoverClass)});b.attach(f,"focus",function(){qq(e.element).addClass(e.focusClass)});b.attach(f,"blur",function(){qq(e.element).removeClass(e.focusClass)});if(window.attachEvent){f.setAttribute("tabIndex","-1")}return f}qq.extend(e,d);qq(e.element).css({position:"relative",overflow:"hidden",direction:"ltr"});c=a();return{getInput:function(){return c},reset:function(){if(c.parentNode){qq(c).remove()}qq(e.element).removeClass(e.focusClass);c=a()}}};qq.PasteSupport=function(c){var d,a;d={targetElement:null,callbacks:{log:function(h,g){},pasteReceived:function(g){}}};function b(g){return g.type&&g.type.indexOf("image/")===0}function e(){qq(d.targetElement).attach("paste",function(h){var g=h.clipboardData;if(g){qq.each(g.items,function(j,k){if(b(k)){var i=k.getAsFile();d.callbacks.pasteReceived(i)}})}})}function f(){if(a){a()}}qq.extend(d,c);e();return{reset:function(){f()}}};qq.FineUploaderBasic=function(a){var b=this;this._options={debug:false,button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:false,autoUpload:true,request:{endpoint:"/server/upload",params:{},paramsInBody:true,customHeaders:{},forceMultipart:true,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:true},callbacks:{onSubmit:function(c,d){},onSubmitted:function(c,d){},onComplete:function(c,e,f,d){},onCancel:function(c,d){},onUpload:function(c,d){},onUploadChunk:function(d,e,c){},onResume:function(e,d,c){},onProgress:function(c,e,d,f){},onError:function(c,e,f,d){},onAutoRetry:function(d,e,c){},onManualRetry:function(c,d){},onValidateBatch:function(c){},onValidate:function(c){},onSubmitDelete:function(c){},onDelete:function(c){},onDeleteComplete:function(c,e,d){},onPasteReceived:function(c){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:false,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:false,partSize:2000000,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(c){if(c.length>33){c=c.slice(0,19)+"..."+c.slice(-14)}return c},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:false,endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:false,sendCredentials:false},blobs:{defaultName:"misc_data",paramNames:{name:"qqblobname"}},paste:{targetElement:null,defaultName:"pasted_image"}};qq.extend(this._options,a,true);this._wrapCallbacks();this._disposeSupport=new qq.DisposeSupport();this._filesInProgress=[];this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._netUploadedOrQueued=0;this._netUploaded=0;this._paramsStore=this._createParamsStore("request");this._deleteFileParamsStore=this._createParamsStore("deleteFile");this._endpointStore=this._createEndpointStore("request");this._deleteFileEndpointStore=this._createEndpointStore("deleteFile");this._handler=this._createUploadHandler();this._deleteHandler=this._createDeleteHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}if(this._options.paste.targetElement){this._pasteHandler=this._createPasteHandler()}this._preventLeaveInProgress()};qq.FineUploaderBasic.prototype={log:function(b,a){if(this._options.debug&&(!a||a==="info")){qq.log("[FineUploader] "+b)}else{if(a&&a!=="info"){qq.log("[FineUploader] "+b,a)}}},setParams:function(b,a){if(a==null){this._options.request.params=b}else{this._paramsStore.setParams(b,a)}},setDeleteFileParams:function(b,a){if(a==null){this._options.deleteFile.params=b}else{this._deleteFileParamsStore.setParams(b,a)}},setEndpoint:function(a,b){if(b==null){this._options.request.endpoint=a}else{this._endpointStore.setEndpoint(a,b)}},getInProgress:function(){return this._filesInProgress.length},getNetUploads:function(){return this._netUploaded},uploadStoredFiles:function(){var a;while(this._storedIds.length){a=this._storedIds.shift();this._filesInProgress.push(a);this._handler.upload(a)}},clearStoredFiles:function(){this._storedIds=[]},retry:function(a){if(this._onBeforeManualRetry(a)){this._netUploadedOrQueued++;this._handler.retry(a);return true}else{return false}},cancel:function(a){this._handler.cancel(a)},cancelAll:function(){var b=[],a=this;qq.extend(b,this._storedIds);qq.each(b,function(c,d){a.cancel(d)});this._handler.cancelAll()},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._filesInProgress=[];this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._button.reset();this._paramsStore.reset();this._endpointStore.reset();this._netUploadedOrQueued=0;this._netUploaded=0;if(this._pasteHandler){this._pasteHandler.reset()}},addFiles:function(c,e,a){var f=this,g=[],d,b;if(c){if(!window.FileList||!(c instanceof FileList)){c=[].concat(c)}for(d=0;d<c.length;d+=1){b=c[d];if(qq.isFileOrInput(b)){g.push(b)}else{f.log(b+" is not a File or INPUT element!  Ignoring!","warn")}}this.log("Processing "+g.length+" files or inputs...");this._uploadFileOrBlobDataList(g,e,a)}},addBlobs:function(b,d,c){if(b){var a=[].concat(b),f=[],e=this;qq.each(a,function(h,g){if(qq.isBlob(g)&&!qq.isFileOrInput(g)){f.push({blob:g,name:e._options.blobs.defaultName})}else{if(qq.isObject(g)&&g.blob&&g.name){f.push(g)}else{e.log("addBlobs: entry at index "+h+" is not a Blob or a BlobData object","error")}}});this._uploadFileOrBlobDataList(f,d,c)}else{this.log("undefined or non-array parameter passed into addBlobs","error")}},getUuid:function(a){return this._handler.getUuid(a)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(a){return this._handler.getSize(a)},getName:function(a){return this._handler.getName(a)},getFile:function(a){return this._handler.getFile(a)},deleteFile:function(a){this._onSubmitDelete(a)},setDeleteFileEndpoint:function(a,b){if(b==null){this._options.deleteFile.endpoint=a}else{this._deleteFileEndpointStore.setEndpoint(a,b)}},_createUploadButton:function(b){var c=this;var a=new qq.UploadButton({element:b,multiple:this._options.multiple&&qq.supportedFeatures.ajaxUploading,acceptFiles:this._options.validation.acceptFiles,onChange:function(d){c._onInputChange(d)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});this._disposeSupport.addDisposer(function(){a.dispose()});return a},_createUploadHandler:function(){var a=this;return new qq.UploadHandler({debug:this._options.debug,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,uuidParamName:this._options.request.uuidName,totalFileSizeParamName:this._options.request.totalFileSizeName,cors:this._options.cors,demoMode:this._options.demoMode,paramsInBody:this._options.request.paramsInBody,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:function(c,b){a.log(c,b)},onProgress:function(b,d,c,e){a._onProgress(b,d,c,e);a._options.callbacks.onProgress(b,d,c,e)},onComplete:function(b,c,d,e){a._onComplete(b,c,d,e);a._options.callbacks.onComplete(b,c,d,e)},onCancel:function(b,c){a._onCancel(b,c);a._options.callbacks.onCancel(b,c)},onUpload:function(b,c){a._onUpload(b,c);a._options.callbacks.onUpload(b,c)},onUploadChunk:function(c,d,b){a._options.callbacks.onUploadChunk(c,d,b)},onResume:function(c,d,b){return a._options.callbacks.onResume(c,d,b)},onAutoRetry:function(b,c,d,e){a._preventRetries[b]=d[a._options.retry.preventRetryResponseProperty];if(a._shouldAutoRetry(b,c,d)){a._maybeParseAndSendUploadError(b,c,d,e);a._options.callbacks.onAutoRetry(b,c,a._autoRetries[b]+1);a._onBeforeAutoRetry(b,c);a._retryTimeouts[b]=setTimeout(function(){a._onAutoRetry(b,c,d)},a._options.retry.autoAttemptDelay*1000);return true}else{return false}}})},_createDeleteHandler:function(){var a=this;return new qq.DeleteFileAjaxRequestor({maxConnections:this._options.maxConnections,customHeaders:this._options.deleteFile.customHeaders,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:function(c,b){a.log(c,b)},onDelete:function(b){a._onDelete(b);a._options.callbacks.onDelete(b)},onDeleteComplete:function(b,d,c){a._onDeleteComplete(b,d,c);a._options.callbacks.onDeleteComplete(b,d,c)}})},_createPasteHandler:function(){var a=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:function(c,b){a.log(c,b)},pasteReceived:function(b){var c=a._options.callbacks.onPasteReceived,d=c(b);if(d&&d.then){d.then(function(e){a._handlePasteSuccess(b,e)},function(e){a.log("Ignoring pasted image per paste received callback.  Reason = '"+e+"'")})}else{a._handlePasteSuccess(b)}}}})},_handlePasteSuccess:function(a,c){var b=a.type.split("/")[1],d=c;if(d==null){d=this._options.paste.defaultName}d+="."+b;this.addBlobs({name:d,blob:a})},_preventLeaveInProgress:function(){var a=this;this._disposeSupport.attach(window,"beforeunload",function(b){if(!a._filesInProgress.length){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(a,b){this._netUploadedOrQueued++;if(this._options.autoUpload){this._filesInProgress.push(a)}},_onProgress:function(a,c,b,d){},_onComplete:function(a,b,c,d){if(!c.success){this._netUploadedOrQueued--}else{this._netUploaded++}this._removeFromFilesInProgress(a);this._maybeParseAndSendUploadError(a,b,c,d)},_onCancel:function(a,b){this._netUploadedOrQueued--;this._removeFromFilesInProgress(a);clearTimeout(this._retryTimeouts[a]);var c=qq.indexOf(this._storedIds,a);if(!this._options.autoUpload&&c>=0){this._storedIds.splice(c,1)}},_isDeletePossible:function(){return(this._options.deleteFile.enabled&&(!this._options.cors.expected||qq.supportedFeatures.deleteFileCors))},_onSubmitDelete:function(a){if(this._isDeletePossible()){if(this._options.callbacks.onSubmitDelete(a)!==false){this._deleteHandler.sendDelete(a,this.getUuid(a))}}else{this.log("Delete request ignored for ID "+a+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn");return false}},_onDelete:function(a){},_onDeleteComplete:function(a,d,b){var c=this._handler.getName(a);if(b){this.log("Delete request for '"+c+"' has failed.","error");this._options.callbacks.onError(a,c,"Delete request failed with response code "+d.status,d)}else{this._netUploadedOrQueued--;this._netUploaded--;this.log("Delete request for '"+c+"' has succeeded.")}},_removeFromFilesInProgress:function(a){var b=qq.indexOf(this._filesInProgress,a);if(b>=0){this._filesInProgress.splice(b,1)}},_onUpload:function(a,b){},_onInputChange:function(a){if(qq.supportedFeatures.ajaxUploading){this.addFiles(a.files)}else{this.addFiles(a)}this._button.reset()},_onBeforeAutoRetry:function(a,b){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+b+"...")},_onAutoRetry:function(a,b,c){this.log("Retrying "+b+"...");this._autoRetries[a]++;this._handler.retry(a)},_shouldAutoRetry:function(a,b,c){if(!this._preventRetries[a]&&this._options.retry.enableAuto){if(this._autoRetries[a]===undefined){this._autoRetries[a]=0}return this._autoRetries[a]<this._options.retry.maxAutoAttempts}return false},_onBeforeManualRetry:function(b){var c=this._options.validation.itemLimit;if(this._preventRetries[b]){this.log("Retries are forbidden for id "+b,"warn");return false}else{if(this._handler.isValid(b)){var a=this._handler.getName(b);if(this._options.callbacks.onManualRetry(b,a)===false){return false}if(c>0&&this._netUploadedOrQueued+1>c){this._itemError("retryFailTooManyItems","");return false}this.log("Retrying upload for '"+a+"' (id: "+b+")...");this._filesInProgress.push(b);return true}else{this.log("'"+b+"' is not a valid file ID","error");return false}}},_maybeParseAndSendUploadError:function(b,c,d,e){if(!d.success){if(e&&e.status!==200&&!d.error){this._options.callbacks.onError(b,c,"XHR returned response code "+e.status,e)}else{var a=d.error?d.error:this._options.text.defaultResponseError;this._options.callbacks.onError(b,c,a,e)}}},_uploadFileOrBlobDataList:function(c,e,b){var d,f=this._getValidationDescriptors(c),a=this._isBatchValid(f);if(a){if(c.length>0){for(d=0;d<c.length;d++){if(this._validateFileOrBlobData(c[d])){this._upload(c[d],e,b)}else{if(this._options.validation.stopOnFirstInvalidFile){return}}}}else{this._itemError("noFilesError","")}}},_upload:function(a,e,b){var c=this._handler.add(a);var d=this._handler.getName(c);if(e){this.setParams(e,c)}if(b){this.setEndpoint(b,c)}if(this._options.callbacks.onSubmit(c,d)!==false){this._onSubmit(c,d);this._options.callbacks.onSubmitted(c,d);if(this._options.autoUpload){this._handler.upload(c)}else{this._storeForLater(c)}}},_storeForLater:function(a){this._storedIds.push(a)},_isBatchValid:function(e){var b,c=this._options.validation.itemLimit,d=this._netUploadedOrQueued+e.length,a=this._options.callbacks.onValidateBatch(e)!==false;if(a){if(c===0||d<=c){a=true}else{a=false;b=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,d).replace(/\{itemLimit\}/g,c);this._batchError(b)}}return a},_validateFileOrBlobData:function(a){var d,b,c;d=this._getValidationDescriptor(a);b=d.name;c=d.size;if(this._options.callbacks.onValidate(d)===false){return false}if(qq.isFileOrInput(a)&&!this._isAllowedExtension(b)){this._itemError("typeError",b);return false}else{if(c===0){this._itemError("emptyError",b);return false}else{if(c&&this._options.validation.sizeLimit&&c>this._options.validation.sizeLimit){this._itemError("sizeError",b);return false}else{if(c&&c<this._options.validation.minSizeLimit){this._itemError("minSizeError",b);return false}}}}return true},_itemError:function(b,f){var d=this._options.messages[b],a=[],g=[].concat(f),e=g[0],c,h;function i(j,k){d=d.replace(j,k)}qq.each(this._options.validation.allowedExtensions,function(k,j){if(qq.isString(j)){a.push(j)}});c=a.join(", ").toLowerCase();i("{file}",this._options.formatFileName(e));i("{extensions}",c);i("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit));i("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit));h=d.match(/(\{\w+\})/g);if(h!==null){qq.each(h,function(j,k){i(k,g[j])})}this._options.callbacks.onError(null,e,d);return d},_batchError:function(a){this._options.callbacks.onError(null,null,a)},_isAllowedExtension:function(b){var a=this._options.validation.allowedExtensions,c=false;if(!a.length){return true}qq.each(a,function(f,d){if(qq.isString(d)){var e=new RegExp("\\."+d+"$","i");if(b.match(e)!=null){c=true;return false}}});return c},_formatSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.1).toFixed(1)+this._options.text.sizeSymbols[b]},_wrapCallbacks:function(){var c,b;c=this;b=function(g,e,d){try{return e.apply(c,d)}catch(f){c.log("Caught exception in '"+g+"' callback - "+f.message,"error")}};for(var a in this._options.callbacks){(function(){var e,d;e=a;d=c._options.callbacks[e];c._options.callbacks[e]=function(){return b(e,d,arguments)}}())}},_parseFileOrBlobDataName:function(a){var b;if(qq.isFileOrInput(a)){if(a.value){b=a.value.replace(/.*(\/|\\)/,"")}else{b=(a.fileName!==null&&a.fileName!==undefined)?a.fileName:a.name}}else{b=a.name}return b},_parseFileOrBlobDataSize:function(a){var b;if(qq.isFileOrInput(a)){if(!a.value){b=(a.fileSize!==null&&a.fileSize!==undefined)?a.fileSize:a.size}}else{b=a.blob.size}return b},_getValidationDescriptor:function(b){var c,d,a;a={};c=this._parseFileOrBlobDataName(b);d=this._parseFileOrBlobDataSize(b);a.name=c;if(d!==undefined){a.size=d}return a},_getValidationDescriptors:function(b){var c=this,a=[];qq.each(b,function(e,d){a.push(c._getValidationDescriptor(d))});return a},_createParamsStore:function(c){var a={},b=this;return{setParams:function(e,d){var f={};qq.extend(f,e);a[d]=f},getParams:function(d){var e={};if(d!=null&&a[d]){qq.extend(e,a[d])}else{qq.extend(e,b._options[c].params)}return e},remove:function(d){return delete a[d]},reset:function(){a={}}}},_createEndpointStore:function(c){var a={},b=this;return{setEndpoint:function(d,e){a[e]=d},getEndpoint:function(d){if(d!=null&&a[d]){return a[d]}return b._options[c].endpoint},remove:function(d){return delete a[d]},reset:function(){a={}}}}};qq.DragAndDrop=function(f){var g,c,b=[],a=new qq.DisposeSupport();g={dropZoneElements:[],hideDropZonesBeforeEnter:false,allowMultipleItems:true,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks()};qq.extend(g,f,true);h();function k(l){g.callbacks.dropLog("Grabbed "+l.length+" dropped files.");c.dropDisabled(false);g.callbacks.processingDroppedFilesComplete(l)}function j(m){var l,n,o=new qq.Promise();if(m.isFile){m.file(function(p){b.push(p);o.success()},function(p){g.callbacks.dropLog("Problem parsing '"+m.fullPath+"'.  FileError code "+p.code+".","error");o.failure()})}else{if(m.isDirectory){l=m.createReader();l.readEntries(function(p){var q=p.length;for(n=0;n<p.length;n+=1){j(p[n]).done(function(){q-=1;if(q===0){o.success()}})}if(!p.length){o.success()}},function(p){g.callbacks.dropLog("Problem parsing '"+m.fullPath+"'.  FileError code "+p.code+".","error");o.failure()})}}return o}function d(l){var o,p,m,q=[],n=new qq.Promise();g.callbacks.processingDroppedFiles();c.dropDisabled(true);if(l.files.length>1&&!g.allowMultipleItems){g.callbacks.processingDroppedFilesComplete([]);g.callbacks.dropError("tooManyFilesError","");c.dropDisabled(false);n.failure()}else{b=[];if(qq.isFolderDropSupported(l)){p=l.items;for(o=0;o<p.length;o+=1){m=p[o].webkitGetAsEntry();if(m){if(m.isFile){b.push(p[o].getAsFile())}else{q.push(j(m).done(function(){q.pop();if(q.length===0){n.success()}}))}}}}else{b=l.files}if(q.length===0){n.success()}}return n}function i(l){c=new qq.UploadDropZone({element:l,onEnter:function(m){qq(l).addClass(g.classes.dropActive);m.stopPropagation()},onLeaveNotDescendants:function(m){qq(l).removeClass(g.classes.dropActive)},onDrop:function(m){if(g.hideDropZonesBeforeEnter){qq(l).hide()}qq(l).removeClass(g.classes.dropActive);d(m.dataTransfer).done(function(){k(b)})}});a.addDisposer(function(){c.dispose()});if(g.hideDropZonesBeforeEnter){qq(l).hide()}}function e(l){var m;qq.each(l.dataTransfer.types,function(n,o){if(o==="Files"){m=true;return false}});return m}function h(){var l=g.dropZoneElements;qq.each(l,function(n,m){i(m)});if(l.length&&(!qq.ie()||qq.ie10())){a.attach(document,"dragenter",function(m){if(!c.dropDisabled()&&e(m)){qq.each(l,function(o,n){qq(n).css({display:"block"})})}})}a.attach(document,"dragleave",function(m){if(g.hideDropZonesBeforeEnter&&qq.FineUploader.prototype._leaving_document_out(m)){qq.each(l,function(o,n){qq(n).hide()})}});a.attach(document,"drop",function(m){if(g.hideDropZonesBeforeEnter){qq.each(l,function(o,n){qq(n).hide()})}m.preventDefault()})}return{setupExtraDropzone:function(l){g.dropZoneElements.push(l);i(l)},removeDropzone:function(m){var n,l=g.dropZoneElements;for(n in l){if(l[n]===m){return l.splice(n,1)}}},dispose:function(){a.dispose();c.dispose()}}};qq.DragAndDrop.callbacks=function(){return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(a){},dropError:function(a,b){qq.log("Drag & drop error code '"+a+" with these specifics: '"+b+"'","error")},dropLog:function(b,a){qq.log(b,a)}}};qq.UploadDropZone=function(i){var j,f,k,e,c=new qq.DisposeSupport();j={element:null,onEnter:function(l){},onLeave:function(l){},onLeaveNotDescendants:function(l){},onDrop:function(l){}};qq.extend(j,i);f=j.element;function d(){return qq.safari()||(qq.firefox()&&qq.windows())}function b(l){if(!e){if(d){c.attach(document,"dragover",function(m){m.preventDefault()})}else{c.attach(document,"dragover",function(m){if(m.dataTransfer){m.dataTransfer.dropEffect="none";m.preventDefault()}})}e=true}}function h(m){if(qq.ie()&&!qq.ie10()){return false}var n,l=m.dataTransfer,o=qq.safari();n=qq.ie10()?true:l.effectAllowed!=="none";return l&&n&&(l.files||(!o&&l.types.contains&&l.types.contains("Files")))}function g(l){if(l!==undefined){k=l}return k}function a(){c.attach(f,"dragover",function(l){if(!h(l)){return}var m=qq.ie()?null:l.dataTransfer.effectAllowed;if(m==="move"||m==="linkMove"){l.dataTransfer.dropEffect="move"}else{l.dataTransfer.dropEffect="copy"}l.stopPropagation();l.preventDefault()});c.attach(f,"dragenter",function(l){if(!g()){if(!h(l)){return}j.onEnter(l)}});c.attach(f,"dragleave",function(l){if(!h(l)){return}j.onLeave(l);var m=document.elementFromPoint(l.clientX,l.clientY);if(qq(this).contains(m)){return}j.onLeaveNotDescendants(l)});c.attach(f,"drop",function(l){if(!g()){if(!h(l)){return}l.preventDefault();j.onDrop(l)}})}b();a();return{dropDisabled:function(l){return g(l)},dispose:function(){c.dispose()}}};qq.FineUploader=function(a){qq.FineUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:true,disableDefaultDropzone:false},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",deleteButton:"Delete",failUpload:"Upload failed",dragZone:"Drop files here to upload",dropProcessing:"Processing dropped files...",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="qq-uploader">'+((!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone)?'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>':"")+(!this._options.button?'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>':"")+'<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>'+(!this._options.listElement?'<ul class="qq-upload-list"></ul>':"")+"</div>",fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><a class="qq-upload-delete" href="#">{deleteButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",deleteButton:"qq-upload-delete",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null,dropProcessing:"qq-drop-processing",dropProcessingSpinner:"qq-drop-processing-spinner"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:true},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:true,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:false},deleteFile:{forceConfirm:false,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:false},paste:{promptForName:false,namePromptMessage:"Please name this image"},showMessage:function(b){setTimeout(function(){window.alert(b)},0)},showConfirm:function(c,d,b){setTimeout(function(){var e=window.confirm(c);if(e){d()}else{if(b){b()}}},0)},showPrompt:function(c,b){var d=new qq.Promise(),e=window.prompt(c,b);if(e!=null&&qq.trimStr(e).length>0){d.success(e)}else{d.failure("Undefined or invalid user-supplied value.")}return d}},true);qq.extend(this._options,a,true);if(!qq.supportedFeatures.uploading||(this._options.cors.expected&&!qq.supportedFeatures.uploadCors)){this._options.element.innerHTML="<div>"+this._options.messages.unsupportedBrowser+"</div>"}else{this._wrapCallbacks();this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton);this._options.template=this._options.template.replace(/\{dropProcessingText\}/g,this._options.text.dropProcessing);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{deleteButtonText\}/g,this._options.text.deleteButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,"");this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;if(!this._button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._dnd=this._setupDragAndDrop();if(this._options.paste.targetElement&&this._options.paste.promptForName){this._setupPastePrompt()}}};qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype);qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments);this._listElement.innerHTML=""},addExtraDropzone:function(a){this._dnd.setupExtraDropzone(a)},removeExtraDropzone:function(a){return this._dnd.removeDropzone(a)},getItemByFileId:function(a){var b=this._listElement.firstChild;while(b){if(b.qqFileId==a){return b}b=b.nextSibling}},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments);this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");if(!this._options.button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._dnd.dispose();this._dnd=this._setupDragAndDrop()},_removeFileItem:function(a){var b=this.getItemByFileId(a);qq(b).remove()},_setupDragAndDrop:function(){var d=this,a=this._find(this._element,"dropProcessing"),b=this._options.dragAndDrop.extraDropzones,c;c=function(e){e.preventDefault()};if(!this._options.dragAndDrop.disableDefaultDropzone){b.push(this._find(this._options.element,"drop"))}return new qq.DragAndDrop({dropZoneElements:b,hideDropZonesBeforeEnter:this._options.dragAndDrop.hideDropzones,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){var e=d._button.getInput();qq(a).css({display:"block"});qq(e).attach("click",c)},processingDroppedFilesComplete:function(e){var f=d._button.getInput();qq(a).hide();qq(f).detach("click",c);if(e){d.addFiles(e)}},dropError:function(e,f){d._itemError(e,f)},dropLog:function(f,e){d.log(f,e)}}})},_leaving_document_out:function(a){return((qq.chrome()||(qq.safari()&&qq.windows()))&&a.clientX==0&&a.clientY==0)||(qq.firefox()&&!a.relatedTarget)},_storeForLater:function(a){qq.FineUploaderBasic.prototype._storeForLater.apply(this,arguments);var b=this.getItemByFileId(a);qq(this._find(b,"spinner")).hide()},_find:function(b,c){var a=qq(b).getByClass(this._options.classes[c])[0];if(!a){throw new Error("element not found "+c)}return a},_onSubmit:function(a,b){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(a,b)},_onProgress:function(b,e,d,h){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var c,g,f,a;c=this.getItemByFileId(b);g=this._find(c,"progressBar");f=Math.round(d/h*100);if(d===h){a=this._find(c,"cancel");qq(a).hide();qq(g).hide();qq(this._find(c,"statusText")).setText(this._options.text.waitingForResponse);this._displayFileSize(b)}else{this._displayFileSize(b,d,h);qq(g).css({display:"block"})}qq(g).css({width:f+"%"})},_onComplete:function(a,c,d,e){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var b=this.getItemByFileId(a);qq(this._find(b,"statusText")).clearText();qq(b).removeClass(this._classes.retrying);qq(this._find(b,"progressBar")).hide();if(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading){qq(this._find(b,"cancel")).hide()}qq(this._find(b,"spinner")).hide();if(d.success){if(this._isDeletePossible()){this._showDeleteLink(a)}qq(b).addClass(this._classes.success);if(this._classes.successIcon){this._find(b,"finished").style.display="inline-block";qq(b).addClass(this._classes.successIcon)}}else{qq(b).addClass(this._classes.fail);if(this._classes.failIcon){this._find(b,"finished").style.display="inline-block";qq(b).addClass(this._classes.failIcon)}if(this._options.retry.showButton&&!this._preventRetries[a]){qq(b).addClass(this._classes.retryable)}this._controlFailureTextDisplay(b,d)}},_onUpload:function(a,b){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);this._showSpinner(a)},_onCancel:function(a,b){qq.FineUploaderBasic.prototype._onCancel.apply(this,arguments);this._removeFileItem(a)},_onBeforeAutoRetry:function(b){var c,e,a,g,d,f;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments);c=this.getItemByFileId(b);e=this._find(c,"progressBar");this._showCancelLink(c);e.style.width=0;qq(e).hide();if(this._options.retry.showAutoRetryNote){a=this._find(c,"statusText");g=this._autoRetries[b]+1;d=this._options.retry.maxAutoAttempts;f=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,g);f=f.replace(/\{maxAuto\}/g,d);qq(a).setText(f);if(g===1){qq(c).addClass(this._classes.retrying)}}},_onBeforeManualRetry:function(a){var b=this.getItemByFileId(a);if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){this._find(b,"progressBar").style.width=0;qq(b).removeClass(this._classes.fail);qq(this._find(b,"statusText")).clearText();this._showSpinner(a);this._showCancelLink(b);return true}else{qq(b).addClass(this._classes.retryable);return false}},_onSubmitDelete:function(a){if(this._isDeletePossible()){if(this._options.callbacks.onSubmitDelete(a)!==false){if(this._options.deleteFile.forceConfirm){this._showDeleteConfirm(a)}else{this._sendDeleteRequest(a)}}}else{this.log("Delete request ignored for file ID "+a+", delete feature is disabled.","warn");return false}},_onDeleteComplete:function(a,f,b){qq.FineUploaderBasic.prototype._onDeleteComplete.apply(this,arguments);var c=this.getItemByFileId(a),d=this._find(c,"spinner"),e=this._find(c,"statusText");qq(d).hide();if(b){qq(e).setText(this._options.deleteFile.deletingFailedText);this._showDeleteLink(a)}else{this._removeFileItem(a)}},_sendDeleteRequest:function(b){var c=this.getItemByFileId(b),a=this._find(c,"deleteButton"),d=this._find(c,"statusText");qq(a).hide();this._showSpinner(b);qq(d).setText(this._options.deleteFile.deletingStatusText);this._deleteHandler.sendDelete(b,this.getUuid(b))},_showDeleteConfirm:function(c){var b=this._handler.getName(c),a=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,b),e=this.getUuid(c),d=this;this._options.showConfirm(a,function(){d._sendDeleteRequest(c)})},_addToList:function(c,e){var d=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading){var a=this._find(d,"cancel");qq(a).remove()}d.qqFileId=c;var b=this._find(d,"file");qq(b).setText(this._options.formatFileName(e));qq(this._find(d,"size")).hide();if(!this._options.multiple){this._handler.cancelAll();this._clearList()}this._listElement.appendChild(d);if(this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading){this._displayFileSize(c)}},_clearList:function(){this._listElement.innerHTML="";this.clearStoredFiles()},_displayFileSize:function(a,c,g){var b=this.getItemByFileId(a),d=this.getSize(a),f=this._formatSize(d),e=this._find(b,"size");if(c!==undefined&&g!==undefined){f=this._formatProgress(c,g)}qq(e).css({display:"inline"});qq(e).setText(f)},_bindCancelAndRetryEvents:function(){var b=this,a=this._listElement;this._disposeSupport.attach(a,"click",function(c){c=c||window.event;var f=c.target||c.srcElement;if(qq(f).hasClass(b._classes.cancel)||qq(f).hasClass(b._classes.retry)||qq(f).hasClass(b._classes.deleteButton)){qq.preventDefault(c);var d=f.parentNode;while(d.qqFileId===undefined){d=d.parentNode}if(qq(f).hasClass(b._classes.deleteButton)){b.deleteFile(d.qqFileId)}else{if(qq(f).hasClass(b._classes.cancel)){b.cancel(d.qqFileId)}else{qq(d).removeClass(b._classes.retryable);b.retry(d.qqFileId)}}}})},_formatProgress:function(d,c){var a=this._options.text.formatProgress;function b(e,f){a=a.replace(e,f)}b("{percent}",Math.round(d/c*100));b("{total_size}",this._formatSize(c));return a},_controlFailureTextDisplay:function(b,e){var d,c,f,a,g;d=this._options.failedUploadTextDisplay.mode;c=this._options.failedUploadTextDisplay.maxChars;f=this._options.failedUploadTextDisplay.responseProperty;if(d==="custom"){a=e[f];if(a){if(a.length>c){g=a.substring(0,c)+"..."}}else{a=this._options.text.failUpload;this.log("'"+f+"' is not a valid property on the server response.","warn")}qq(this._find(b,"statusText")).setText(g||a);if(this._options.failedUploadTextDisplay.enableTooltip){this._showTooltip(b,a)}}else{if(d==="default"){qq(this._find(b,"statusText")).setText(this._options.text.failUpload)}else{if(d!=="none"){this.log("failedUploadTextDisplay.mode value of '"+d+"' is not valid","warn")}}}},_showTooltip:function(a,b){a.title=b},_showSpinner:function(a){var b=this.getItemByFileId(a),c=this._find(b,"spinner");c.style.display="inline-block"},_showCancelLink:function(b){if(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading){var a=this._find(b,"cancel");qq(a).css({display:"inline"})}},_showDeleteLink:function(b){var c=this.getItemByFileId(b),a=this._find(c,"deleteButton");qq(a).css({display:"inline"})},_itemError:function(a,c){var b=qq.FineUploaderBasic.prototype._itemError.apply(this,arguments);this._options.showMessage(b)},_batchError:function(a){qq.FineUploaderBasic.prototype._batchError.apply(this,arguments);this._options.showMessage(a)},_setupPastePrompt:function(){var a=this;this._options.callbacks.onPasteReceived=function(){var c=a._options.paste.namePromptMessage,b=a._options.paste.defaultName;return a._options.showPrompt(c,b)}}});qq.AjaxRequestor=function(h){var g,p,k=[],l=[],j={method:"POST",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},successfulResponseCodes:[200],demoMode:false,cors:{expected:false,sendCredentials:false},log:function(q,o){},onSend:function(o){},onComplete:function(o,r,q){},onCancel:function(o){}};qq.extend(j,h);g=j.log;p=d()==="GET"||d()==="DELETE";function c(q){var o=qq.indexOf(k,q),r=j.maxConnections,s;delete l[q];k.splice(o,1);if(k.length>=r&&o<r){s=k[r-1];m(s)}}function i(o){var s=l[o].xhr,r=d(),q=false;c(o);if(!f(s.status)){q=true;g(r+" request for "+o+" has failed - response code "+s.status,"error")}j.onComplete(o,s,q)}function m(o){var t=new XMLHttpRequest(),q=d(),r={},s;j.onSend(o);if(j.paramsStore.getParams){r=j.paramsStore.getParams(o)}s=b(o,r);l[o].xhr=t;t.onreadystatechange=e(o);t.open(q,s,true);if(j.cors.expected&&j.cors.sendCredentials){t.withCredentials=true}n(o);g("Sending "+q+" request for "+o);if(!p&&r){t.send(qq.obj2url(r,""))}else{t.send()}}function b(r,s){var q=j.endpointStore.getEndpoint(r),o=l[r].addToPath;if(o!==undefined){q+="/"+o}if(p&&s){return qq.obj2url(s,q)}else{return q}}function e(o){var q=l[o].xhr;return function(){if(q.readyState===4){i(o,q)}}}function n(q){var r=l[q].xhr,o=j.customHeaders;r.setRequestHeader("X-Requested-With","XMLHttpRequest");r.setRequestHeader("Cache-Control","no-cache");qq.each(o,function(s,t){r.setRequestHeader(s,t)})}function a(o){var r=l[o].xhr,q=d();if(r){r.onreadystatechange=null;r.abort();c(o);g("Cancelled "+q+" for "+o);j.onCancel(o);return true}return false}function f(o){return qq.indexOf(j.successfulResponseCodes,o)>=0}function d(){if(j.demoMode){return"GET"}return j.method}return{send:function(q,o){l[q]={addToPath:o};var r=k.push(q);if(r<=j.maxConnections){m(q)}},cancel:function(o){return a(o)}}};qq.DeleteFileAjaxRequestor=function(a){var c,b={endpointStore:{},maxConnections:3,customHeaders:{},paramsStore:{},demoMode:false,cors:{expected:false,sendCredentials:false},log:function(e,d){},onDelete:function(d){},onDeleteComplete:function(d,f,e){}};qq.extend(b,a);c=new qq.AjaxRequestor({method:"DELETE",endpointStore:b.endpointStore,paramsStore:b.paramsStore,maxConnections:b.maxConnections,customHeaders:b.customHeaders,successfulResponseCodes:[200,202,204],demoMode:b.demoMode,log:b.log,onSend:b.onDelete,onComplete:b.onDeleteComplete});return{sendDelete:function(d,e){c.send(d,e);b.log("Submitted delete file request for "+d)}}};qq.WindowReceiveMessage=function(b){var c={log:function(e,d){}},a={};qq.extend(c,b);return{receiveMessage:function(e,d){var f=function(g){d(g.data)};if(window.postMessage){a[e]=qq(window).attach("message",f)}else{log("iframe message passing not supported in this browser!","error")}},stopReceivingMessages:function(e){if(window.postMessage){var d=a[e];if(d){d()}}}}};qq.UploadHandler=function(d){var f=[],e,c,a,b;e={debug:false,forceMultipart:true,paramsInBody:false,paramsStore:{},endpointStore:{},cors:{expected:false,sendCredentials:false},maxConnections:3,uuidParamName:"qquuid",totalFileSizeParamName:"qqtotalfilesize",chunking:{enabled:false,partSize:2000000,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},blobs:{paramNames:{name:"qqblobname"}},log:function(h,g){},onProgress:function(h,g,i,j){},onComplete:function(h,g,i,j){},onCancel:function(h,g){},onUpload:function(h,g){},onUploadChunk:function(i,h,g){},onAutoRetry:function(h,g,i,j){},onResume:function(i,h,g){}};qq.extend(e,d);c=e.log;a=function(h){var g=qq.indexOf(f,h),j=e.maxConnections,k;if(g>=0){f.splice(g,1);if(f.length>=j&&g<j){k=f[j-1];b.upload(k)}}};if(qq.supportedFeatures.ajaxUploading){b=new qq.UploadHandlerXhr(e,a,c)}else{b=new qq.UploadHandlerForm(e,a,c)}return{add:function(g){return b.add(g)},upload:function(g){var h=f.push(g);if(h<=e.maxConnections){return b.upload(g)}},retry:function(h){var g=qq.indexOf(f,h);if(g>=0){return b.upload(h,true)}else{return this.upload(h)}},cancel:function(g){c("Cancelling "+g);e.paramsStore.remove(g);b.cancel(g);a(g)},cancelAll:function(){var h=this,g=[];qq.extend(g,f);qq.each(g,function(j,i){h.cancel(i)});f=[]},getName:function(g){return b.getName(g)},getSize:function(g){if(b.getSize){return b.getSize(g)}},getFile:function(g){if(b.getFile){return b.getFile(g)}},getQueue:function(){return f},reset:function(){c("Resetting upload handler");f=[];b.reset()},getUuid:function(g){return b.getUuid(g)},isValid:function(g){return b.isValid(g)},getResumableFilesData:function(){if(b.getResumableFilesData){return b.getResumableFilesData()}return[]}}};qq.UploadHandlerForm=function(l,s,k){var n=l,i=[],t=[],g={},p={},r=s,j=k,c=new qq.WindowReceiveMessage({log:j}),m={},a;function f(o){if(g[o]!==undefined){g[o]();delete g[o]}}function q(v,o){var u=v.id;m[t[u]]=o;g[u]=qq(v).attach("load",function(){if(i[u]){j("Received iframe load event for CORS upload request (file id "+u+")");p[u]=setTimeout(function(){var w="No valid message received from loaded iframe for file id "+u;j(w,"error");o({error:w})},1000)}});c.receiveMessage(u,function(w){j("Received the following window message: '"+w+"'");var y=qq.parseJson(w),z=y.uuid,x;if(z&&m[z]){clearTimeout(p[u]);delete p[u];f(u);x=m[z];delete m[z];c.stopReceivingMessages(u);x(y)}else{if(!z){j("'"+w+"' does not contain a UUID - ignoring.")}}})}function b(u,o){if(n.cors.expected){q(u,o)}else{g[u.id]=qq(u).attach("load",function(){j("Received response for "+u.id);if(!u.parentNode){return}try{if(u.contentDocument&&u.contentDocument.body&&u.contentDocument.body.innerHTML=="false"){return}}catch(v){j("Error when attempting to access iframe during handling of upload response ("+v+")","error")}o()})}}function h(v){var x;try{var o=v.contentDocument||v.contentWindow.document,w=o.body.innerHTML;j("converting iframe's innerHTML to JSON");j("innerHTML = "+w);if(w&&w.match(/^<pre/i)){w=o.body.firstChild.firstChild.nodeValue}x=qq.parseJson(w)}catch(u){j("Error when attempting to parse form upload response ("+u+")","error");x={success:false}}return x}function e(o){var u=qq.toElement('<iframe src="javascript:false;" name="'+o+'" />');u.setAttribute("id",o);u.style.display="none";document.body.appendChild(u);return u}function d(v,w){var x=n.paramsStore.getParams(v),y=n.demoMode?"GET":"POST",u=qq.toElement('<form method="'+y+'" enctype="multipart/form-data"></form>'),o=n.endpointStore.getEndpoint(v),z=o;x[n.uuidParamName]=t[v];if(!n.paramsInBody){z=qq.obj2url(x,o)}else{qq.obj2Inputs(x,u)}u.setAttribute("action",z);u.setAttribute("target",w.name);u.style.display="none";document.body.appendChild(u);return u}a={add:function(o){o.setAttribute("name",n.inputName);var u=i.push(o)-1;t[u]=qq.getUniqueId();if(o.parentNode){qq(o).remove()}return u},getName:function(o){if(a.isValid(o)){return i[o].value.replace(/.*(\/|\\)/,"")}else{j(o+" is not a valid item ID.","error")}},isValid:function(o){return i[o]!==undefined},reset:function(){i=[];t=[];g={}},getUuid:function(o){return t[o]},cancel:function(o){n.onCancel(o,this.getName(o));delete i[o];delete t[o];delete g[o];if(n.cors.expected){clearTimeout(p[o]);delete p[o];c.stopReceivingMessages(o)}var u=GetGlobalById(o);if(u){u.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;");qq(u).remove()}},upload:function(v){var x=i[v],o=a.getName(v),w=e(v),u;if(!x){throw new Error("file with passed id was not added, or already uploaded or cancelled")}n.onUpload(v,this.getName(v));u=d(v,w);u.appendChild(x);b(w,function(z){j("iframe loaded");var y=z?z:h(w);f(v);if(!n.cors.expected){qq(w).remove()}if(!y.success){if(n.onAutoRetry(v,o,y)){return}}n.onComplete(v,o,y);r(v)});j("Sending upload request for "+v);u.submit();qq(u).remove();return v}};return a};qq.UploadHandlerXhr=function(E,O,C){var G=E,N=O,B=C,i=[],f="|",e=G.chunking.enabled&&qq.supportedFeatures.chunking,J=G.resume.enabled&&e&&qq.supportedFeatures.resume,K=r(),D=G.forceMultipart||G.paramsInBody,c;function a(Q,S,o){var T=c.getSize(Q),R=c.getName(Q);S[G.chunking.paramNames.partIndex]=o.part;S[G.chunking.paramNames.partByteOffset]=o.start;S[G.chunking.paramNames.chunkSize]=o.size;S[G.chunking.paramNames.totalParts]=o.count;S[G.totalFileSizeParamName]=T;if(D){S[G.chunking.paramNames.filename]=R}}function b(o){o[G.resume.paramNames.resuming]=true}function j(Q,R,o){if(Q.slice){return Q.slice(R,o)}else{if(Q.mozSlice){return Q.mozSlice(R,o)}else{if(Q.webkitSlice){return Q.webkitSlice(R,o)}}}}function k(U,o){var Q=G.chunking.partSize,T=c.getSize(U),S=i[U].file||i[U].blobData.blob,V=Q*o,R=V+Q>=T?T:V+Q,W=s(U);return{part:o,start:V,end:R,count:W,blob:j(S,V,R),size:R-V}}function s(R){var Q=c.getSize(R),o=G.chunking.partSize;return Math.ceil(Q/o)}function g(o){var Q=new XMLHttpRequest();i[o].xhr=Q;return Q}function M(W,Z,R,T){var S=new FormData(),U=G.demoMode?"GET":"POST",Q=G.endpointStore.getEndpoint(T),Y=Q,V=c.getName(T),X=c.getSize(T),o=i[T].blobData;W[G.uuidParamName]=i[T].uuid;if(D){W[G.totalFileSizeParamName]=X;if(o){W[G.blobs.paramNames.name]=o.name}}if(!G.paramsInBody){if(!D){W[G.inputName]=V}Y=qq.obj2url(W,Q)}Z.open(U,Y,true);if(G.cors.expected&&G.cors.sendCredentials){Z.withCredentials=true}if(D){if(G.paramsInBody){qq.obj2FormData(W,S)}S.append(G.inputName,R);return S}return R}function L(R,S){var o=G.customHeaders,Q=i[R].file||i[R].blobData.blob;S.setRequestHeader("X-Requested-With","XMLHttpRequest");S.setRequestHeader("Cache-Control","no-cache");if(!D){S.setRequestHeader("Content-Type","application/octet-stream");S.setRequestHeader("X-Mime-Type",Q.type)}qq.each(o,function(T,U){S.setRequestHeader(T,U)})}function t(o,R,T){var Q=c.getName(o),S=c.getSize(o);i[o].attemptingResume=false;G.onProgress(o,Q,S,S);G.onComplete(o,Q,R,T);delete i[o].xhr;N(o)}function P(R){var Q=i[R].remainingChunkIdxs[0],o=k(R,Q),W=g(R),U=c.getSize(R),S=c.getName(R),V,T;if(i[R].loaded===undefined){i[R].loaded=0}if(J&&i[R].file){I(R,o)}W.onreadystatechange=q(R,W);W.upload.onprogress=function(X){if(X.lengthComputable){var Z=X.loaded+i[R].loaded,Y=d(R,Q,X.total);G.onProgress(R,S,Z,Y)}};G.onUploadChunk(R,S,m(o));T=G.paramsStore.getParams(R);a(R,T,o);if(i[R].attemptingResume){b(T)}V=M(T,W,o.blob,R);L(R,W);B("Sending chunked upload request for item "+R+": bytes "+(o.start+1)+"-"+o.end+" of "+U);W.send(V)}function d(T,S,X){var R=k(T,S),o=R.size,V=X-o,Y=c.getSize(T),Q=R.count,U=i[T].initialRequestOverhead,W=V-U;i[T].lastRequestOverhead=V;if(S===0){i[T].lastChunkIdxProgress=0;i[T].initialRequestOverhead=V;i[T].estTotalRequestsSize=Y+(Q*V)}else{if(i[T].lastChunkIdxProgress!==S){i[T].lastChunkIdxProgress=S;i[T].estTotalRequestsSize+=W}}return i[T].estTotalRequestsSize}function n(o){if(D){return i[o].lastRequestOverhead}else{return 0}}function z(R,S,T){var Q=i[R].remainingChunkIdxs.shift(),o=k(R,Q);i[R].attemptingResume=false;i[R].loaded+=o.size+n(R);if(i[R].remainingChunkIdxs.length>0){P(R)}else{if(J){h(R)}t(R,S,T)}}function A(Q,o){return Q.status!==200||!o.success||o.reset}function H(R){var Q;try{Q=qq.parseJson(R.responseText)}catch(o){B("Error when attempting to parse xhr response text ("+o+")","error");Q={}}return Q}function w(o){B("Server has ordered chunking effort to be restarted on next attempt for item ID "+o,"error");if(J){h(o);i[o].attemptingResume=false}i[o].remainingChunkIdxs=[];delete i[o].loaded;delete i[o].estTotalRequestsSize;delete i[o].initialRequestOverhead}function x(o){i[o].attemptingResume=false;B("Server has declared that it cannot handle resume for item ID "+o+" - starting from the first chunk","error");w(o);c.upload(o,true)}function v(o,R,S){var Q=c.getName(o);if(G.onAutoRetry(o,Q,R,S)){return}else{t(o,R,S)}}function F(o,R){var Q;if(!i[o]){return}B("xhr - server response received for "+o);B("responseText = "+R.responseText);Q=H(R);if(A(R,Q)){if(Q.reset){w(o)}if(i[o].attemptingResume&&Q.reset){x(o)}else{v(o,Q,R)}}else{if(e){z(o,Q,R)}else{t(o,Q,R)}}}function m(o){return{partIndex:o.part,startByte:o.start+1,endByte:o.end,totalParts:o.count}}function q(o,Q){return function(){if(Q.readyState===4){F(o,Q)}}}function I(V,o){var U=c.getUuid(V),X=i[V].loaded,W=i[V].initialRequestOverhead,T=i[V].estTotalRequestsSize,R=l(V),S=U+f+o.part+f+X+f+W+f+T,Q=G.resume.cookiesExpireIn;qq.setCookie(R,S,Q)}function h(Q){if(i[Q].file){var o=l(Q);qq.deleteCookie(o)}}function p(S){var o=qq.getCookie(l(S)),R=c.getName(S),W,X,V,U,T,Q;if(o){W=o.split(f);if(W.length===5){X=W[0];V=parseInt(W[1],10);U=parseInt(W[2],10);T=parseInt(W[3],10);Q=parseInt(W[4],10);return{uuid:X,part:V,lastByteSent:U,initialRequestOverhead:T,estTotalRequestsSize:Q}}else{B("Ignoring previously stored resume/chunk cookie for "+R+" - old cookie format","warn")}}}function l(S){var Q=c.getName(S),R=c.getSize(S),T=G.chunking.partSize,o;o="qqfilechunk"+f+encodeURIComponent(Q)+f+R+f+T;if(K!==undefined){o+=f+K}return o}function r(){if(G.resume.id!==null&&G.resume.id!==undefined&&!qq.isFunction(G.resume.id)&&!qq.isObject(G.resume.id)){return G.resume.id}}function u(S,V){var T=c.getName(S),R=0,U,Q,o;if(!i[S].remainingChunkIdxs||i[S].remainingChunkIdxs.length===0){i[S].remainingChunkIdxs=[];if(J&&!V&&i[S].file){U=p(S);if(U){Q=k(S,U.part);if(G.onResume(S,T,m(Q))!==false){R=U.part;i[S].uuid=U.uuid;i[S].loaded=U.lastByteSent;i[S].estTotalRequestsSize=U.estTotalRequestsSize;i[S].initialRequestOverhead=U.initialRequestOverhead;i[S].attemptingResume=true;B("Resuming "+T+" at partition index "+R)}}}for(o=s(S)-1;o>=R;o-=1){i[S].remainingChunkIdxs.unshift(o)}}P(S)}function y(Q){var o=i[Q].file||i[Q].blobData.blob,R=c.getName(Q),U,S,T;i[Q].loaded=0;U=g(Q);U.upload.onprogress=function(V){if(V.lengthComputable){i[Q].loaded=V.loaded;G.onProgress(Q,R,V.loaded,V.total)}};U.onreadystatechange=q(Q,U);S=G.paramsStore.getParams(Q);T=M(S,U,o,Q);L(Q,U);B("Sending upload request for "+Q);U.send(T)}c={add:function(o){var Q;if(o instanceof File){Q=i.push({file:o})-1}else{if(qq.isBlob(o.blob)){Q=i.push({blobData:o})-1}else{throw new Error("Passed obj in not a File or BlobData (in qq.UploadHandlerXhr)")}}i[Q].uuid=qq.getUniqueId();return Q},getName:function(R){if(c.isValid(R)){var Q=i[R].file,o=i[R].blobData;if(Q){return(Q.fileName!==null&&Q.fileName!==undefined)?Q.fileName:Q.name}else{return o.name}}else{B(R+" is not a valid item ID.","error")}},getSize:function(Q){var o=i[Q].file||i[Q].blobData.blob;if(qq.isFileOrInput(o)){return o.fileSize!=null?o.fileSize:o.size}else{return o.size}},getFile:function(o){if(i[o]){return i[o].file||i[o].blobData.blob}},getLoaded:function(o){return i[o].loaded||0},isValid:function(o){return i[o]!==undefined},reset:function(){i=[]},getUuid:function(o){return i[o].uuid},upload:function(o,R){var Q=this.getName(o);G.onUpload(o,Q);if(e){u(o,R)}else{y(o)}},cancel:function(o){var Q=i[o].xhr;G.onCancel(o,this.getName(o));if(Q){Q.onreadystatechange=null;Q.abort()}if(J){h(o)}delete i[o]},getResumableFilesData:function(){var o=[],Q=[];if(e&&J){if(K===undefined){o=qq.getCookieNames(new RegExp("^qqfilechunk\\"+f+".+\\"+f+"\\d+\\"+f+G.chunking.partSize+"="))}else{o=qq.getCookieNames(new RegExp("^qqfilechunk\\"+f+".+\\"+f+"\\d+\\"+f+G.chunking.partSize+"\\"+f+K+"="))}qq.each(o,function(U,R){var S=R.split(f);var T=qq.getCookie(R).split(f);Q.push({name:decodeURIComponent(S[1]),size:S[2],uuid:T[0],partIdx:T[1]})});return Q}return[]}};return c};(function(a){var k,b,f,d,h,i,c,j,g,e;i=["uploaderType"];f=function(l){if(l){var m=j(l);c(m);if(h("uploaderType")==="basic"){k(new qq.FineUploaderBasic(m))}else{k(new qq.FineUploader(m))}}return b};d=function(m,n){var l=b.data("fineuploader");if(n){if(l===undefined){l={}}l[m]=n;b.data("fineuploader",l)}else{if(l===undefined){return null}return l[m]}};k=function(l){return d("uploader",l)};h=function(l,m){return d(l,m)};c=function(m){var l=m.callbacks={},n=new qq.FineUploaderBasic();a.each(n._options.callbacks,function(r,p){var q,o;q=/^on(\w+)/.exec(r)[1];q=q.substring(0,1).toLowerCase()+q.substring(1);o=b;l[r]=function(){var s=Array.prototype.slice.call(arguments);return o.triggerHandler(q,s)}})};j=function(n,m){var o,l;if(m===undefined){if(n.uploaderType!=="basic"){o={element:b[0]}}else{o={}}}else{o=m}a.each(n,function(p,q){if(a.inArray(p,i)>=0){h(p,q)}else{if(q instanceof a){o[p]=q[0]}else{if(a.isPlainObject(q)){o[p]={};j(q,o[p])}else{if(a.isArray(q)){l=[];a.each(q,function(s,r){if(r instanceof a){a.merge(l,r)}else{l.push(r)}});o[p]=l}else{o[p]=q}}}}});if(m===undefined){return o}};g=function(l){return a.type(l)==="string"&&!l.match(/^_/)&&k()[l]!==undefined};e=function(l){var n=[],m=Array.prototype.slice.call(arguments,1);j(m,n);return k()[l].apply(k(),n)};a.fn.fineUploader=function(l){var n=this,o=arguments,m=[];this.each(function(q,p){b=a(p);if(k()&&g(l)){m.push(e.apply(n,o));if(n.length===1){return false}}else{if(typeof l==="object"||!l){f.apply(n,o)}else{a.error("Method "+l+" does not exist on jQuery.fineUploader")}}});if(m.length===1){return m[0]}else{if(m.length>1){return m}}return this}}(jQuery));(function(a){var i="fineUploaderDnd",b;function g(k){if(!k){k={}}k.dropZoneElements=[b];var l=j(k);c(l);f(new qq.DragAndDrop(l));return b}function d(l,m){var k=b.data(i);if(m){if(k===undefined){k={}}k[l]=m;b.data(i,k)}else{if(k===undefined){return null}return k[l]}}function f(k){return d("dndInstance",k)}function c(m){var k=m.callbacks={},l=new qq.FineUploaderBasic();a.each(new qq.DragAndDrop.callbacks(),function(q,o){var p=q,n;n=b;k[q]=function(){var r=Array.prototype.slice.call(arguments),s=n.triggerHandler(p,r);return s}})}function j(m,l){var n,k;if(l===undefined){n={}}else{n=l}a.each(m,function(o,p){if(p instanceof a){n[o]=p[0]}else{if(a.isPlainObject(p)){n[o]={};j(p,n[o])}else{if(a.isArray(p)){k=[];a.each(p,function(r,q){if(q instanceof a){a.merge(k,q)}else{k.push(q)}});n[o]=k}else{n[o]=p}}}});if(l===undefined){return n}}function h(k){return a.type(k)==="string"&&k==="dispose"&&f()[k]!==undefined}function e(k){var m=[],l=Array.prototype.slice.call(arguments,1);j(l,m);return f()[k].apply(f(),m)}a.fn.fineUploaderDnd=function(k){var m=this,n=arguments,l=[];this.each(function(p,o){b=a(o);if(f()&&h(k)){l.push(e.apply(m,n));if(m.length===1){return false}}else{if(typeof k==="object"||!k){g.apply(m,n)}else{a.error("Method "+k+" does not exist in Fine Uploader's DnD module.")}}});if(l.length===1){return l[0]}else{if(l.length>1){return l}}return this}}(jQuery));(function(u,a,t){var d={beforeShow:l,move:l,change:l,show:l,hide:l,color:false,flat:false,showInput:false,showButtons:true,clickoutFiresChange:false,showInitial:false,showPalette:false,showPaletteOnly:false,showSelectionPalette:true,localStorageKey:false,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:false,className:"",showAlpha:false,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:false},q=[],h=!!/msie/i.exec(u.navigator.userAgent),o=(function(){function v(y,z){return !!~(""+y).indexOf(z)}var w=document.createElement("div");var x=w.style;x.cssText="background-color:rgba(0,0,0,.5)";return v(x.backgroundColor,"rgba")||v(x.backgroundColor,"hsla")})(),n=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),k=(function(){var v="";if(h){for(var w=1;w<=6;w++){v+="<div class='sp-"+w+"'></div>"}}return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",v,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")})();function m(A,x,w){var y=[];for(var z=0;z<A.length;z++){var C=tinycolor(A[z]);var v=C.toHsl().l<0.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";v+=(tinycolor.equals(x,A[z]))?" sp-thumb-active":"";var B=o?("background-color:"+C.toRgbString()):"filter:"+C.toFilter();y.push('<span title="'+C.toRgbString()+'" data-color="'+C.toRgbString()+'" class="'+v+'"><span class="sp-thumb-inner" style="'+B+';" /></span>')}return"<div class='sp-cf "+w+"'>"+y.join("")+"</div>"}function g(){for(var v=0;v<q.length;v++){if(q[v]){q[v].hide()}}}function i(w,v){var x=a.extend({},d,w);x.callbacks={move:b(x.move,v),change:b(x.change,v),show:b(x.show,v),hide:b(x.hide,v),beforeShow:b(x.beforeShow,v)};return x}function p(ad,ar){var av=i(ar,ad),af=av.flat,aL=av.showSelectionPalette,ao=av.localStorageKey,aT=av.theme,E=av.callbacks,aD=s(aB,10),aY=false,aa=0,V=0,X=0,aM=0,aQ=0,A=0,x=0,aO=0,L=0,N=0,O=0,K=1,aw=av.palette.slice(0),ax=a.isArray(aw[0])?aw:[aw],aF=av.selectionPalette.slice(0),ap=av.maxSelectionSize,U="sp-dragging",aI=null;var S=ad.ownerDocument,C=S.body,D=a(ad),R=false,J=a(k,S).addClass(aT),T=J.find(".sp-color"),W=J.find(".sp-dragger"),aP=J.find(".sp-hue"),aN=J.find(".sp-slider"),z=J.find(".sp-alpha-inner"),y=J.find(".sp-alpha"),w=J.find(".sp-alpha-handle"),aS=J.find(".sp-input"),ay=J.find(".sp-palette"),ak=J.find(".sp-initial"),F=J.find(".sp-cancel"),G=J.find(".sp-choose"),am=D.is("input"),aJ=am&&!af,aC=(aJ)?a(n).addClass(aT).addClass(av.className):a([]),at=(aJ)?aC:D,aA=aC.find(".sp-preview-inner"),aj=av.color||(am&&D.val()),I=false,az=av.preferredFormat,M=az,H=!av.showButtons||av.clickoutFiresChange;function B(){if(av.showPaletteOnly){av.showPalette=true}J.toggleClass("sp-flat",af);J.toggleClass("sp-input-disabled",!av.showInput);J.toggleClass("sp-alpha-enabled",av.showAlpha);J.toggleClass("sp-buttons-disabled",!av.showButtons);J.toggleClass("sp-palette-disabled",!av.showPalette);J.toggleClass("sp-palette-only",av.showPaletteOnly);J.toggleClass("sp-initial-disabled",!av.showInitial);J.addClass(av.className);aB()}function al(){if(h){J.find("*:not(input)").attr("unselectable","on")}B();if(aJ){D.after(aC).hide()}if(af){D.after(J).hide()}else{var aZ=av.appendTo==="parent"?D.parent():a(av.appendTo);if(aZ.length!==1){aZ=a("body")}aZ.append(J)}try{if(ao&&u.localStorage){try{var a1=u.localStorage[ao].split(",#");if(a1.length>1){delete u.localStorage[ao];a.each(a1,function(a5,a4){v(a4)})}}catch(a0){}try{aF=u.localStorage[ao].split(";")}catch(a0){}}}catch(a0){}at.bind("click.spectrum touchstart.spectrum",function(a4){if(!R){aU()}a4.stopPropagation();if(!a(a4.target).is("input")){a4.preventDefault()}});if(D.is(":disabled")||(av.disabled===true)){Q()}J.click(r);aS.change(aH);aS.bind("paste",function(){setTimeout(aH,1)});aS.keydown(function(a4){if(a4.keyCode==13){aH()}});F.text(av.cancelText);F.bind("click.spectrum",function(a4){a4.stopPropagation();a4.preventDefault();ai("cancel")});G.text(av.chooseText);G.bind("click.spectrum",function(a4){a4.stopPropagation();a4.preventDefault();if(an()){aW(true);ai()}});e(y,function(a4,a5,a6){K=(a4/A);if(a6.shiftKey){K=Math.round(K*10)/10}aq()});e(aP,function(a4,a5){L=parseFloat(a5/aM);aq()},Y,Z);e(T,function(a4,a5,a6){if(!a6.shiftKey){aI=null}else{if(!aI){var a8=N*aa;var a9=V-(O*V);var a7=Math.abs(a4-a8)>Math.abs(a5-a9);aI=a7?"x":"y"}}var ba=!aI||aI==="x";var bb=!aI||aI==="y";if(ba){N=parseFloat(a4/aa)}if(bb){O=parseFloat((V-a5)/V)}aq()},Y,Z);if(!!aj){aG(aj);aX();M=az||tinycolor(aj).format;v(aj)}else{aX()}if(af){aK()}function a3(a4){if(a4.data&&a4.data.ignore){aG(a(this).data("color"));aq()}else{aG(a(this).data("color"));aW(true);aq();ai()}return false}var a2=h?"mousedown.spectrum":"click.spectrum touchstart.spectrum";ay.delegate(".sp-thumb-el",a2,a3);ak.delegate(".sp-thumb-el:nth-child(1)",a2,{ignore:true},a3)}function v(aZ){if(aL){var a0=tinycolor(aZ).toRgbString();if(a.inArray(a0,aF)===-1){aF.push(a0);while(aF.length>ap){aF.shift()}}try{if(ao&&u.localStorage){u.localStorage[ao]=aF.join(";")}}catch(a1){}}}function ah(){var a4=[];var a1=aF;var a2={};var a3;if(av.showPalette){for(var aZ=0;aZ<ax.length;aZ++){for(var a0=0;a0<ax[aZ].length;a0++){a3=tinycolor(ax[aZ][a0]).toRgbString();a2[a3]=true}}for(aZ=0;aZ<a1.length;aZ++){a3=tinycolor(a1[aZ]).toRgbString();if(!a2.hasOwnProperty(a3)){a4.push(a1[aZ]);a2[a3]=true}}}return a4.reverse().slice(0,av.maxSelectionSize)}function ac(){var aZ=ag();var a0=a.map(ax,function(a2,a1){return m(a2,aZ,"sp-palette-row sp-palette-row-"+a1)});if(aF){a0.push(m(ah(),aZ,"sp-palette-row sp-palette-row-selection"))}ay.html(a0.join(""))}function ab(){if(av.showInitial){var a0=I;var aZ=ag();ak.html(m([a0,aZ],aZ,"sp-palette-row-initial"))}}function Y(){if(V<=0||aa<=0||aM<=0){aB()}J.addClass(U);aI=null}function Z(){J.removeClass(U)}function aH(){var aZ=tinycolor(aS.val());if(aZ.ok){aG(aZ)}else{aS.addClass("sp-validation-error")}}function aU(){if(aY){ai()}else{aK()}}function aK(){var aZ=a.Event("beforeShow.spectrum");if(aY){aB();return}D.trigger(aZ,[ag()]);if(E.beforeShow(ag())===false||aZ.isDefaultPrevented()){return}g();aY=true;a(S).bind("click.spectrum",ai);a(u).bind("resize.spectrum",aD);aC.addClass("sp-active");J.removeClass("sp-hidden");if(av.showPalette){ac()}aB();aX();I=ag();ab();E.show(I);D.trigger("show.spectrum",[I])}function ai(a0){if(a0&&a0.type=="click"&&a0.button==2){return}if(!aY||af){return}aY=false;a(S).unbind("click.spectrum",ai);a(u).unbind("resize.spectrum",aD);aC.removeClass("sp-active");J.addClass("sp-hidden");var aZ=!tinycolor.equals(ag(),I);if(aZ){if(H&&a0!=="cancel"){aW(true)}else{aE()}}E.hide(ag());D.trigger("hide.spectrum",[ag()])}function aE(){aG(I,true)}function aG(aZ,a0){if(tinycolor.equals(aZ,ag())){return}var a1=tinycolor(aZ);var a2=a1.toHsv();L=(a2.h%360)/360;N=a2.s;O=a2.v;K=a2.a;aX();if(a1.ok&&!a0){M=az||a1.format}}function ag(aZ){aZ=aZ||{};return tinycolor.fromRatio({h:L,s:N,v:O,a:Math.round(K*100)/100},{format:aZ.format||M})}function an(){return !aS.hasClass("sp-validation-error")}function aq(){aX();E.move(ag());D.trigger("move.spectrum",[ag()])}function aX(){aS.removeClass("sp-validation-error");aV();var aZ=tinycolor.fromRatio({h:L,s:1,v:1});T.css("background-color",aZ.toHexString());var a0=M;if(K<1){if(a0==="hex"||a0==="hex3"||a0==="hex6"||a0==="name"){a0="rgb"}}var a3=ag({format:a0}),a4=a3.toHexString(),a5=a3.toRgbString();if(o||a3.alpha===1){aA.css("background-color",a5)}else{aA.css("background-color","transparent");aA.css("filter",a3.toFilter())}if(av.showAlpha){var a6=a3.toRgb();a6.a=0;var a2=tinycolor(a6).toRgbString();var a1="linear-gradient(left, "+a2+", "+a4+")";if(h){z.css("filter",tinycolor(a2).toFilter({gradientType:1},a4))}else{z.css("background","-webkit-"+a1);z.css("background","-moz-"+a1);z.css("background","-ms-"+a1);z.css("background",a1)}}if(av.showInput){aS.val(a3.toString(a0))}if(av.showPalette){ac()}ab()}function aV(){var a2=N;var a4=O;var a0=a2*aa;var a1=V-(a4*V);a0=Math.max(-X,Math.min(aa-X,a0-X));a1=Math.max(-X,Math.min(V-X,a1-X));W.css({top:a1,left:a0});var aZ=K*A;w.css({left:aZ-(x/2)});var a3=(L)*aM;aN.css({top:a3-aO})}function aW(a0){var aZ=ag();if(am){D.val(aZ.toString(M))}var a1=!tinycolor.equals(aZ,I);I=aZ;v(aZ);if(a0&&a1){E.change(aZ);D.trigger("change",[aZ])}}function aB(){aa=T.width();V=T.height();X=W.height();aQ=aP.width();aM=aP.height();aO=aN.height();A=y.width();x=w.width();if(!af){J.css("position","absolute");J.offset(f(J,at))}aV()}function P(){D.show();at.unbind("click.spectrum touchstart.spectrum");J.remove();aC.remove();q[aR.id]=null}function au(aZ,a0){if(aZ===t){return a.extend({},av)}if(a0===t){return av[aZ]}av[aZ]=a0;B()}function ae(){R=false;D.attr("disabled",false);at.removeClass("sp-disabled")}function Q(){ai();R=true;D.attr("disabled",true);at.addClass("sp-disabled")}al();var aR={show:aK,hide:ai,toggle:aU,reflow:aB,option:au,enable:ae,disable:Q,set:function(aZ){aG(aZ);aW()},get:ag,destroy:P,container:J};aR.id=q.push(aR)-1;return aR}function f(D,A){var z=0;var y=D.outerWidth();var x=D.outerHeight();var B=A.outerHeight();var v=D[0].ownerDocument;var w=v.documentElement;var F=w.clientWidth+a(v).scrollLeft();var E=w.clientHeight+a(v).scrollTop();var C=A.offset();C.top+=B;C.left-=Math.min(C.left,(C.left+y>F&&F>y)?Math.abs(C.left+y-F):0);C.top-=Math.min(C.top,((C.top+x>E&&E>x)?Math.abs(x+B-z):z));return C}function l(){}function r(v){v.stopPropagation()}function b(w,x){var y=Array.prototype.slice;var v=y.call(arguments,2);return function(){return w.apply(x,v.concat(y.call(arguments)))}}function e(y,E,F,G){E=E||function(){};F=F||function(){};G=G||function(){};var v=y.ownerDocument||document;var w=false;var D={};var A=0;var B=0;var z=("ontouchstart" in u);var x={};x.selectstart=H;x.dragstart=H;x["touchmove mousemove"]=C;x["touchend mouseup"]=J;function H(K){if(K.stopPropagation){K.stopPropagation()}if(K.preventDefault){K.preventDefault()}K.returnValue=false}function C(M){if(w){if(h&&document.documentMode<9&&!M.button){return J()}var P=M.originalEvent.touches;var N=P?P[0].pageX:M.pageX;var O=P?P[0].pageY:M.pageY;var K=Math.max(0,Math.min(N-D.left,B));var L=Math.max(0,Math.min(O-D.top,A));if(z){H(M)}E.apply(y,[K,L,M])}}function I(K){var L=(K.which)?(K.which==3):(K.button==2);var M=K.originalEvent.touches;if(!L&&!w){if(F.apply(y,arguments)!==false){w=true;A=a(y).height();B=a(y).width();D=a(y).offset();a(v).bind(x);a(v.body).addClass("sp-dragging");if(!z){C(K)}H(K)}}}function J(){if(w){a(v).unbind(x);a(v.body).removeClass("sp-dragging");G.apply(y,arguments)}w=false}a(y).bind("touchstart mousedown",I)}function s(w,y,v){var x;return function(){var A=this,z=arguments;var B=function(){x=null;w.apply(A,z)};if(v){clearTimeout(x)}if(v||!x){x=setTimeout(B,y)}}}function j(){if(u.console){if(Function.prototype.bind){j=Function.prototype.bind.call(console.log,console)}else{j=function(){Function.prototype.apply.call(console.log,console,arguments)}}j.apply(this,arguments)}}var c="spectrum.id";a.fn.spectrum=function(x,w){if(typeof x=="string"){var y=this;var v=Array.prototype.slice.call(arguments,1);this.each(function(){var A=q[a(this).data(c)];if(A){var z=A[x];if(!z){throw new Error("Spectrum: no such method: '"+x+"'")}if(x=="get"){y=A.get()}else{if(x=="container"){y=A.container}else{if(x=="option"){y=A.option.apply(A,v)}else{if(x=="destroy"){A.destroy();a(this).removeData(c)}else{z.apply(A,v)}}}}}});return y}return this.spectrum("destroy").each(function(){var z=p(this,x);a(this).data(c,z.id)})};a.fn.spectrum.load=true;a.fn.spectrum.loadOpts={};a.fn.spectrum.draggable=e;a.fn.spectrum.defaults=d;a.spectrum={};a.spectrum.localization={};a.spectrum.palettes={};a.fn.spectrum.processNativeColorInputs=function(){var v=a("<input type='color' value='#ffffff' />")[0];var w=v.type==="color"&&v.value!="!";if(!w){a("input[type=color]").spectrum({preferredFormat:"hex6"})}};(function(){var W=/^[\s,#]+/,X=/\s+$/,V=0,H=Math,L=H.round,J=H.min,I=H.max,K=H.random;function U(aa,ad){aa=(aa)?aa:"";ad=ad||{};if(typeof aa=="object"&&aa.hasOwnProperty("_tc_id")){return aa}var af=D(aa);var ae=af.r,ac=af.g,Z=af.b,Y=af.a,ag=L(100*Y)/100,ab=ad.format||af.format;if(ae<1){ae=L(ae)}if(ac<1){ac=L(ac)}if(Z<1){Z=L(Z)}return{ok:af.ok,format:ab,_tc_id:V++,alpha:Y,getAlpha:function(){return Y},setAlpha:function(ah){Y=w(ah);ag=L(100*Y)/100},toHsv:function(){var ah=R(ae,ac,Z);return{h:ah.h*360,s:ah.s,v:ah.v,a:Y}},toHsvString:function(){var ai=R(ae,ac,Z);var ah=L(ai.h*360),aj=L(ai.s*100),ak=L(ai.v*100);return(Y==1)?"hsv("+ah+", "+aj+"%, "+ak+"%)":"hsva("+ah+", "+aj+"%, "+ak+"%, "+ag+")"},toHsl:function(){var ah=Q(ae,ac,Z);return{h:ah.h*360,s:ah.s,l:ah.l,a:Y}},toHslString:function(){var ai=Q(ae,ac,Z);var ah=L(ai.h*360),ak=L(ai.s*100),aj=L(ai.l*100);return(Y==1)?"hsl("+ah+", "+ak+"%, "+aj+"%)":"hsla("+ah+", "+ak+"%, "+aj+"%, "+ag+")"},toHex:function(ah){return P(ae,ac,Z,ah)},toHexString:function(ah){return"#"+P(ae,ac,Z,ah)},toRgb:function(){return{r:L(ae),g:L(ac),b:L(Z),a:Y}},toRgbString:function(){return(Y==1)?"rgb("+L(ae)+", "+L(ac)+", "+L(Z)+")":"rgba("+L(ae)+", "+L(ac)+", "+L(Z)+", "+ag+")"},toPercentageRgb:function(){return{r:L(v(ae,255)*100)+"%",g:L(v(ac,255)*100)+"%",b:L(v(Z,255)*100)+"%",a:Y}},toPercentageRgbString:function(){return(Y==1)?"rgb("+L(v(ae,255)*100)+"%, "+L(v(ac,255)*100)+"%, "+L(v(Z,255)*100)+"%)":"rgba("+L(v(ae,255)*100)+"%, "+L(v(ac,255)*100)+"%, "+L(v(Z,255)*100)+"%, "+ag+")"},toName:function(){if(Y===0){return"transparent"}return A[P(ae,ac,Z,true)]||false},toFilter:function(am){var aj=P(ae,ac,Z);var an=aj;var ah=Math.round(parseFloat(Y)*255).toString(16);var al=ah;var ai=ad&&ad.gradientType?"GradientType = 1, ":"";if(am){var ak=U(am);an=ak.toHex();al=Math.round(parseFloat(ak.alpha)*255).toString(16)}return"progid:DXImageTransform.Microsoft.gradient("+ai+"startColorstr=#"+N(ah)+aj+",endColorstr=#"+N(al)+an+")"},toString:function(ah){var ai=!!ah;ah=ah||this.format;var aj=false;var al=!ai&&Y<1&&Y>0;var ak=al&&(ah==="hex"||ah==="hex6"||ah==="hex3"||ah==="name");if(ah==="rgb"){aj=this.toRgbString()}if(ah==="prgb"){aj=this.toPercentageRgbString()}if(ah==="hex"||ah==="hex6"){aj=this.toHexString()}if(ah==="hex3"){aj=this.toHexString(true)}if(ah==="name"){aj=this.toName()}if(ah==="hsl"){aj=this.toHslString()}if(ah==="hsv"){aj=this.toHsvString()}if(ak){return this.toRgbString()}return aj||this.toHexString()}}}U.fromRatio=function(Y,ab){if(typeof Y=="object"){var aa={};for(var Z in Y){if(Y.hasOwnProperty(Z)){if(Z==="a"){aa[Z]=Y[Z]}else{aa[Z]=y(Y[Z])}}}Y=aa}return U(Y,ab)};function D(Z){var ac={r:0,g:0,b:0};var Y=1;var ab=false;var aa=false;if(typeof Z=="string"){Z=T(Z)}if(typeof Z=="object"){if(Z.hasOwnProperty("r")&&Z.hasOwnProperty("g")&&Z.hasOwnProperty("b")){ac=S(Z.r,Z.g,Z.b);ab=true;aa=String(Z.r).substr(-1)==="%"?"prgb":"rgb"}else{if(Z.hasOwnProperty("h")&&Z.hasOwnProperty("s")&&Z.hasOwnProperty("v")){Z.s=y(Z.s);Z.v=y(Z.v);ac=C(Z.h,Z.s,Z.v);ab=true;aa="hsv"}else{if(Z.hasOwnProperty("h")&&Z.hasOwnProperty("s")&&Z.hasOwnProperty("l")){Z.s=y(Z.s);Z.l=y(Z.l);ac=B(Z.h,Z.s,Z.l);ab=true;aa="hsl"}}}if(Z.hasOwnProperty("a")){Y=Z.a}}Y=w(Y);return{ok:ab,format:Z.format||aa,r:J(255,I(ac.r,0)),g:J(255,I(ac.g,0)),b:J(255,I(ac.b,0)),a:Y}}function S(aa,Z,Y){return{r:v(aa,255)*255,g:v(Z,255)*255,b:v(Y,255)*255}}function Q(af,aa,Y){af=v(af,255);aa=v(aa,255);Y=v(Y,255);var ad=I(af,aa,Y),ae=J(af,aa,Y);var ab,ag,ac=(ad+ae)/2;if(ad==ae){ab=ag=0}else{var Z=ad-ae;ag=ac>0.5?Z/(2-ad-ae):Z/(ad+ae);switch(ad){case af:ab=(aa-Y)/Z+(aa<Y?6:0);break;case aa:ab=(Y-af)/Z+2;break;case Y:ab=(af-aa)/Z+4;break}ab/=6}return{h:ab,s:ag,l:ac}}function B(aa,ag,ac){var af,Z,Y;aa=v(aa,360);ag=v(ag,100);ac=v(ac,100);function ab(ah,ai,aj){if(aj<0){aj+=1}if(aj>1){aj-=1}if(aj<1/6){return ah+(ai-ah)*6*aj}if(aj<1/2){return ai}if(aj<2/3){return ah+(ai-ah)*(2/3-aj)*6}return ah}if(ag===0){af=Z=Y=ac}else{var ae=ac<0.5?ac*(1+ag):ac+ag-ac*ag;var ad=2*ac-ae;af=ab(ad,ae,aa+1/3);Z=ab(ad,ae,aa);Y=ab(ad,ae,aa-1/3)}return{r:af*255,g:Z*255,b:Y*255}}function R(ae,aa,Y){ae=v(ae,255);aa=v(aa,255);Y=v(Y,255);var ac=I(ae,aa,Y),ad=J(ae,aa,Y);var ab,af,ag=ac;var Z=ac-ad;af=ac===0?0:Z/ac;if(ac==ad){ab=0}else{switch(ac){case ae:ab=(aa-Y)/Z+(aa<Y?6:0);break;case aa:ab=(Y-ae)/Z+2;break;case Y:ab=(ae-aa)/Z+4;break}ab/=6}return{h:ab,s:af,v:ag}}function C(ab,ah,aj){ab=v(ab,360)*6;ah=v(ah,100);aj=v(aj,100);var ac=H.floor(ab),Z=ab-ac,ae=aj*(1-ah),af=aj*(1-Z*ah),ai=aj*(1-(1-Z)*ah),ad=ac%6,ag=[aj,af,ae,ae,ai,aj][ad],aa=[ai,aj,aj,af,ae,ae][ad],Y=[ae,ae,ai,aj,aj,af][ad];return{r:ag*255,g:aa*255,b:Y*255}}function P(ac,aa,Z,Y){var ab=[N(L(ac).toString(16)),N(L(aa).toString(16)),N(L(Z).toString(16))];if(Y&&ab[0].charAt(0)==ab[0].charAt(1)&&ab[1].charAt(0)==ab[1].charAt(1)&&ab[2].charAt(0)==ab[2].charAt(1)){return ab[0].charAt(0)+ab[1].charAt(0)+ab[2].charAt(0)}return ab.join("")}U.equals=function(Y,Z){if(!Y||!Z){return false}return U(Y).toRgbString()==U(Z).toRgbString()};U.random=function(){return U.fromRatio({r:K(),g:K(),b:K()})};U.desaturate=function(Z,Y){Y=(Y===0)?0:(Y||10);var aa=U(Z).toHsl();aa.s-=Y/100;aa.s=x(aa.s);return U(aa)};U.saturate=function(Z,Y){Y=(Y===0)?0:(Y||10);var aa=U(Z).toHsl();aa.s+=Y/100;aa.s=x(aa.s);return U(aa)};U.greyscale=function(Y){return U.desaturate(Y,100)};U.lighten=function(Z,Y){Y=(Y===0)?0:(Y||10);var aa=U(Z).toHsl();aa.l+=Y/100;aa.l=x(aa.l);return U(aa)};U.darken=function(Z,Y){Y=(Y===0)?0:(Y||10);var aa=U(Z).toHsl();aa.l-=Y/100;aa.l=x(aa.l);return U(aa)};U.complement=function(Y){var Z=U(Y).toHsl();Z.h=(Z.h+180)%360;return U(Z)};U.triad=function(Y){var aa=U(Y).toHsl();var Z=aa.h;return[U(Y),U({h:(Z+120)%360,s:aa.s,l:aa.l}),U({h:(Z+240)%360,s:aa.s,l:aa.l})]};U.tetrad=function(Y){var aa=U(Y).toHsl();var Z=aa.h;return[U(Y),U({h:(Z+90)%360,s:aa.s,l:aa.l}),U({h:(Z+180)%360,s:aa.s,l:aa.l}),U({h:(Z+270)%360,s:aa.s,l:aa.l})]};U.splitcomplement=function(Y){var aa=U(Y).toHsl();var Z=aa.h;return[U(Y),U({h:(Z+72)%360,s:aa.s,l:aa.l}),U({h:(Z+216)%360,s:aa.s,l:aa.l})]};U.analogous=function(Y,ab,ad){ab=ab||6;ad=ad||30;var Z=U(Y).toHsl();var aa=360/ad;var ac=[U(Y)];for(Z.h=((Z.h-(aa*ab>>1))+720)%360;--ab;){Z.h=(Z.h+aa)%360;ac.push(U(Z))}return ac};U.monochromatic=function(Y,ac){ac=ac||6;var aa=U(Y).toHsv();var Z=aa.h,ae=aa.s,af=aa.v;var ad=[];var ab=1/ac;while(ac--){ad.push(U({h:Z,s:ae,v:af}));af=(af+ab)%1}return ad};U.readability=function(ac,ad){var Y=U(ac).toRgb();var Z=U(ad).toRgb();var aa=(Y.r*299+Y.g*587+Y.b*114)/1000;var ab=(Z.r*299+Z.g*587+Z.b*114)/1000;var ae=(Math.max(Y.r,Z.r)-Math.min(Y.r,Z.r)+Math.max(Y.g,Z.g)-Math.min(Y.g,Z.g)+Math.max(Y.b,Z.b)-Math.min(Y.b,Z.b));return{brightness:Math.abs(aa-ab),color:ae}};U.readable=function(Y,Z){var aa=U.readability(Y,Z);return aa.brightness>125&&aa.color>500};U.mostReadable=function(Y,ac){var Z=null;var ab=0;var aa=false;for(var ad=0;ad<ac.length;ad++){var ae=U.readability(Y,ac[ad]);var af=ae.brightness>125&&ae.color>500;var ag=3*(ae.brightness/125)+(ae.color/500);if((af&&!aa)||(af&&aa&&ag>ab)||((!af)&&(!aa)&&ag>ab)){aa=af;ab=ag;Z=U(ac[ad])}}return Z};var M=U.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var A=U.hexNames=z(M);function z(aa){var Y={};for(var Z in aa){if(aa.hasOwnProperty(Z)){Y[aa[Z]]=Z}}return Y}function w(Y){Y=parseFloat(Y);if(isNaN(Y)||Y<0||Y>1){Y=1}return Y}function v(Z,Y){if(E(Z)){Z="100%"}var aa=F(Z);Z=J(Y,I(0,parseFloat(Z)));if(aa){Z=parseInt(Z*Y,10)/100}if((H.abs(Z-Y)<1e-06)){return 1}return(Z%Y)/parseFloat(Y)}function x(Y){return J(1,I(0,Y))}function O(Y){return parseInt(Y,16)}function E(Y){return typeof Y=="string"&&Y.indexOf(".")!=-1&&parseFloat(Y)===1}function F(Y){return typeof Y==="string"&&Y.indexOf("%")!=-1}function N(Y){return Y.length==1?"0"+Y:""+Y}function y(Y){if(Y<=1){Y=(Y*100)+"%"}return Y}var G=(function(){var Y="[-\\+]?\\d+%?";var Z="[-\\+]?\\d*\\.\\d+%?";var aa="(?:"+Z+")|(?:"+Y+")";var ab="[\\s|\\(]+("+aa+")[,|\\s]+("+aa+")[,|\\s]+("+aa+")\\s*\\)?";var ac="[\\s|\\(]+("+aa+")[,|\\s]+("+aa+")[,|\\s]+("+aa+")[,|\\s]+("+aa+")\\s*\\)?";return{rgb:new RegExp("rgb"+ab),rgba:new RegExp("rgba"+ac),hsl:new RegExp("hsl"+ab),hsla:new RegExp("hsla"+ac),hsv:new RegExp("hsv"+ab),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}})();function T(Y){Y=Y.replace(W,"").replace(X,"").toLowerCase();var aa=false;if(M[Y]){Y=M[Y];aa=true}else{if(Y=="transparent"){return{r:0,g:0,b:0,a:0,format:"name"}}}var Z;if((Z=G.rgb.exec(Y))){return{r:Z[1],g:Z[2],b:Z[3]}}if((Z=G.rgba.exec(Y))){return{r:Z[1],g:Z[2],b:Z[3],a:Z[4]}}if((Z=G.hsl.exec(Y))){return{h:Z[1],s:Z[2],l:Z[3]}}if((Z=G.hsla.exec(Y))){return{h:Z[1],s:Z[2],l:Z[3],a:Z[4]}}if((Z=G.hsv.exec(Y))){return{h:Z[1],s:Z[2],v:Z[3]}}if((Z=G.hex6.exec(Y))){return{r:O(Z[1]),g:O(Z[2]),b:O(Z[3]),format:aa?"name":"hex"}}if((Z=G.hex3.exec(Y))){return{r:O(Z[1]+""+Z[1]),g:O(Z[2]+""+Z[2]),b:O(Z[3]+""+Z[3]),format:aa?"name":"hex"}}return false}u.tinycolor=U})();a(function(){if(a.fn.spectrum.load){a.fn.spectrum.processNativeColorInputs()}})})(window,jQuery);(function(a){var c;var b={init:function(f){c=a.extend({hide_fallbacks:false,selected:function(i){},initial:"",fonts:[],PrettyFonts:[]},f);c.Id=a(this).attr("id");c.SpanId=a(this).attr("id")+"_span";var h=this;h.callback=c.selected;var m=false;var k=false;var j=function(i){b.UpdateDisplayName(i);k=i;h.callback(k)};var g=function(){var i,n;i=a(h).offset().left;n=a(h).offset().top+a(h).outerHeight();a(l).css({position:"absolute",left:i+"px",top:n+"px"})};a(this).prepend('<span id="'+c.SpanId+'">'+c.initial.replace(/'/g,"&#039;")+"</span>");var l=a('<ul class="fontSelectUl"></ul>').appendTo("body");l.hide();g();for(var d=0;d<c.fonts.length;d++){var e=a("<li>"+b.displayName(c.fonts[d])+"</li>").appendTo(l);a(e).css("font-family",c.fonts[d])}if(c.initial!=""){j(c.initial)}l.find("li").click(function(){if(!m){return}g();l.slideUp("fast",function(){m=false});j(a(this).css("font-family"))});a(this).click(function(i){if(m){return}i.stopPropagation();g();l.slideDown("fast",function(){m=true})});a("html").click(function(){if(m){l.slideUp("fast",function(){m=false})}})},selected:function(){return this.css("font-family")},displayName:function(d){if(c.PrettyFonts.length>0){d=d.replace(/["']{1}/gi,"");var e=c.fonts.indexOf(d);if(e>=0){return c.PrettyFonts[e]}}if(c.hide_fallbacks){var f=d.indexOf(",");if(f<0){f=d.length}return d.substr(0,f)}return d},UpdateDisplayName:function(d){var e=b.displayName(d).replace(/["']{1}/gi,"");if(e.indexOf(")")!==-1&&e.indexOf(")")!==-1){var g=(e.indexOf(")")+1);e=e.substring(g)}a("#"+c.SpanId).html(e);var f="14px";if(e.length>12){f="12px"}a("#"+c.Id).css("font-family",d);a("#"+c.Id).css("font-size",f)},};a.fn.fontSelector=function(d){if(b[d]){return b[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return b.init.apply(this,arguments)}else{a.error("Method "+d+" does not exist on jQuery.fontSelector")}}}})(jQuery);(function(f){function g(i,k){var h=typeof i[k];return h==="function"||!!(h=="object"&&i[k])||h=="unknown"}function j(i,k,h){if(k<0){k+=i.value.length}if(typeof h=="undefined"){h=k}if(h<0){h+=i.value.length}return{start:k,end:h}}function c(){return typeof document.body=="object"&&document.body?document.body:document.getElementsByTagName("body")[0]}var b,a,v,d,w,x,y,z,e;f(document).ready(function(){function h(k,l){return function(){var m=this.jquery?this[0]:this,n=m.nodeName.toLowerCase();if(m.nodeType==1&&(n=="textarea"||n=="input"&&m.type=="text")){m=[m].concat(Array.prototype.slice.call(arguments));m=k.apply(this,m);if(!l){return m}}if(l){return this}}}var i=document.createElement("textarea");c().appendChild(i);if(typeof i.selectionStart!="undefined"&&typeof i.selectionEnd!="undefined"){b=function(k){return{start:k.selectionStart,end:k.selectionEnd,length:k.selectionEnd-k.selectionStart,text:k.value.slice(k.selectionStart,k.selectionEnd)}};a=function(k,l,m){l=j(k,l,m);k.selectionStart=l.start;k.selectionEnd=l.end};e=function(k,l){if(l){k.selectionEnd=k.selectionStart}else{k.selectionStart=k.selectionEnd}}}else{if(g(i,"createTextRange")&&typeof document.selection=="object"&&document.selection&&g(document.selection,"createRange")){b=function(k){var l=0,m=0,n,o,p;if((p=document.selection.createRange())&&p.parentElement()==k){o=k.value.length;n=k.value.replace(/\r\n/g,"\n");m=k.createTextRange();m.moveToBookmark(p.getBookmark());p=k.createTextRange();p.collapse(false);if(m.compareEndPoints("StartToEnd",p)>-1){l=m=o}else{l=-m.moveStart("character",-o);l+=n.slice(0,l).split("\n").length-1;if(m.compareEndPoints("EndToEnd",p)>-1){m=o}else{m=-m.moveEnd("character",-o);m+=n.slice(0,m).split("\n").length-1}}}return{start:l,end:m,length:m-l,text:k.value.slice(l,m)}};a=function(k,l,m){l=j(k,l,m);m=k.createTextRange();var n=l.start-(k.value.slice(0,l.start).split("\r\n").length-1);m.collapse(true);if(l.start==l.end){m.move("character",n)}else{m.moveEnd("character",l.end-(k.value.slice(0,l.end).split("\r\n").length-1));m.moveStart("character",n)}m.select()};e=function(k,l){var m=document.selection.createRange();m.collapse(l);m.select()}}else{c().removeChild(i);window.console&&window.console.log&&window.console.log("TextInputs module for Rangy not supported in your browser. Reason: No means of finding text input caret position");return}}c().removeChild(i);d=function(k,l,m,n){var o;if(l!=m){o=k.value;k.value=o.slice(0,l)+o.slice(m)}n&&a(k,l,l)};v=function(k){var l=b(k);d(k,l.start,l.end,true)};z=function(k){var l=b(k),m;if(l.start!=l.end){m=k.value;k.value=m.slice(0,l.start)+m.slice(l.end)}a(k,l.start,l.start);return l.text};w=function(k,l,m,n){var o=k.value;k.value=o.slice(0,m)+l+o.slice(m);if(n){l=m+l.length;a(k,l,l)}};x=function(k,l){var m=b(k),n=k.value;k.value=n.slice(0,m.start)+l+n.slice(m.end);m=m.start+l.length;a(k,m,m)};y=function(k,l,m){var n=b(k),o=k.value;k.value=o.slice(0,n.start)+l+n.text+m+o.slice(n.end);l=n.start+l.length;a(k,l,l+n.length)};f.fn.extend({getSelection:h(b,false),setSelection:h(a,true),collapseSelection:h(e,true),deleteSelectedText:h(v,true),deleteText:h(d,true),extractSelectedText:h(z,false),insertText:h(w,true),replaceSelectedText:h(x,true),surroundSelectedText:h(y,true)})})})(jQuery);(function(f,g){var d=f.jQuery||f.Cowboy||(f.Cowboy={}),e;d.throttle=e=function(b,c,n,m){var l,a=0;if(typeof c!=="boolean"){m=n;n=c;c=g}function k(){var q=this,j=+new Date()-a,p=arguments;function i(){a=+new Date();n.apply(q,p)}function h(){l=g}if(m&&!l){i()}l&&clearTimeout(l);if(m===g&&j>b){i()}else{if(c!==true){l=setTimeout(m?h:i,m===g?b-j:b)}}}if(d.guid){k.guid=n.guid=n.guid||d.guid++}return k};d.debounce=function(a,b,c){return c===g?e(a,b,false):e(a,c,b!==false)}})(this);(function(a){var c={formatInvalidInputErrorMsg:function(h){return"Invalid input value '"+h+"' passed in"},callingContextNotSliderInstance:"Calling context element does not have instance of Slider bound to it. Check your code to make sure the JQuery object returned from the call to the slider() initializer is calling the method"};var g=function(j,k){var i=this.element=a(j).hide();var l=a(j)[0].style.width;var p=false;var m=this.element.parent();if(m.hasClass("slider")===true){p=true;this.picker=m}else{this.picker=a('<div class="slider"><div class="slider-track"><div class="slider-selection"></div><div class="slider-handle min-slider-handle"></div><div class="slider-handle max-slider-handle"></div></div><div id="tooltip" class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div><div id="tooltip_min" class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div><div id="tooltip_max" class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div></div>').insertBefore(this.element).append(this.element)}this.id=this.element.data("slider-id")||k.id;if(this.id){this.picker[0].id=this.id}if(("ontouchstart" in window)||window.DocumentTouch&&document instanceof window.DocumentTouch){this.touchCapable=true}var o=this.element.data("slider-tooltip")||k.tooltip;this.tooltip=this.picker.find("#tooltip");this.tooltipInner=this.tooltip.find("div.tooltip-inner");this.tooltip_min=this.picker.find("#tooltip_min");this.tooltipInner_min=this.tooltip_min.find("div.tooltip-inner");this.tooltip_max=this.picker.find("#tooltip_max");this.tooltipInner_max=this.tooltip_max.find("div.tooltip-inner");if(p===true){this.picker.removeClass("slider-horizontal");this.picker.removeClass("slider-vertical");this.tooltip.removeClass("hide");this.tooltip_min.removeClass("hide");this.tooltip_max.removeClass("hide")}this.orientation=this.element.data("slider-orientation")||k.orientation;switch(this.orientation){case"vertical":this.picker.addClass("slider-vertical");this.stylePos="top";this.mousePos="pageY";this.sizePos="offsetHeight";this.tooltip.addClass("right")[0].style.left="100%";this.tooltip_min.addClass("right")[0].style.left="100%";this.tooltip_max.addClass("right")[0].style.left="100%";break;default:this.picker.addClass("slider-horizontal").css("width",l);this.orientation="horizontal";this.stylePos="left";this.mousePos="pageX";this.sizePos="offsetWidth";this.tooltip.addClass("top")[0].style.top=-this.tooltip.outerHeight()-14+"px";this.tooltip_min.addClass("top")[0].style.top=-this.tooltip_min.outerHeight()-14+"px";this.tooltip_max.addClass("top")[0].style.top=-this.tooltip_max.outerHeight()-14+"px";break}var n=this;a.each(["min","max","step","precision","value","reversed","handle"],function(r,q){if(typeof i.data("slider-"+q)!=="undefined"){n[q]=i.data("slider-"+q)}else{if(typeof k[q]!=="undefined"){n[q]=k[q]}else{if(typeof i.prop(q)!=="undefined"){n[q]=i.prop(q)}else{n[q]=0}}}});if(this.value instanceof Array){if(p&&!this.range){this.value=this.value[0]}else{this.range=true}}else{if(this.range){this.value=[this.value,this.max]}}this.selection=this.element.data("slider-selection")||k.selection;this.selectionEl=this.picker.find(".slider-selection");if(this.selection==="none"){this.selectionEl.addClass("hide")}this.selectionElStyle=this.selectionEl[0].style;this.handle1=this.picker.find(".slider-handle:first");this.handle1Stype=this.handle1[0].style;this.handle2=this.picker.find(".slider-handle:last");this.handle2Stype=this.handle2[0].style;if(p===true){this.handle1.removeClass("round triangle");this.handle2.removeClass("round triangle hide")}var h=["round","triangle","custom"];if(h.indexOf(this.handle)!==-1){this.handle1.addClass(this.handle);this.handle2.addClass(this.handle)}this.offset=this.picker.offset();this.size=this.picker[0][this.sizePos];this.formater=k.formater;this.tooltip_separator=k.tooltip_separator;this.tooltip_split=k.tooltip_split;this.setValue(this.value);this.handle1.on({keydown:a.proxy(this.keydown,this,0)});this.handle2.on({keydown:a.proxy(this.keydown,this,1)});if(this.touchCapable){this.picker.on({touchstart:a.proxy(this.mousedown,this)})}this.picker.on({mousedown:a.proxy(this.mousedown,this)});if(o==="hide"){this.tooltip.addClass("hide");this.tooltip_min.addClass("hide");this.tooltip_max.addClass("hide")}else{if(o==="always"){this.showTooltip();this.alwaysShowTooltip=true}else{this.picker.on({mouseenter:a.proxy(this.showTooltip,this),mouseleave:a.proxy(this.hideTooltip,this)});this.handle1.on({focus:a.proxy(this.showTooltip,this),blur:a.proxy(this.hideTooltip,this)});this.handle2.on({focus:a.proxy(this.showTooltip,this),blur:a.proxy(this.hideTooltip,this)})}}this.enabled=k.enabled&&(this.element.data("slider-enabled")===undefined||this.element.data("slider-enabled")===true);if(this.enabled){this.enable()}else{this.disable()}this.natural_arrow_keys=this.element.data("slider-natural_arrow_keys")||k.natural_arrow_keys};g.prototype={constructor:g,over:false,inDrag:false,showTooltip:function(){if(this.tooltip_split===false){this.tooltip.addClass("in")}else{this.tooltip_min.addClass("in");this.tooltip_max.addClass("in")}this.over=true},hideTooltip:function(){if(this.inDrag===false&&this.alwaysShowTooltip!==true){this.tooltip.removeClass("in");this.tooltip_min.removeClass("in");this.tooltip_max.removeClass("in")}this.over=false},layout:function(){var j;if(this.reversed){j=[100-this.percentage[0],this.percentage[1]]}else{j=[this.percentage[0],this.percentage[1]]}this.handle1Stype[this.stylePos]=j[0]+"%";this.handle2Stype[this.stylePos]=j[1]+"%";if(this.orientation==="vertical"){this.selectionElStyle.top=Math.min(j[0],j[1])+"%";this.selectionElStyle.height=Math.abs(j[0]-j[1])+"%"}else{this.selectionElStyle.left=Math.min(j[0],j[1])+"%";this.selectionElStyle.width=Math.abs(j[0]-j[1])+"%";var i=this.tooltip_min[0].getBoundingClientRect();var h=this.tooltip_max[0].getBoundingClientRect();if(i.right>h.left){this.tooltip_max.removeClass("top");this.tooltip_max.addClass("bottom")[0].style.top=18+"px"}else{this.tooltip_max.removeClass("bottom");this.tooltip_max.addClass("top")[0].style.top=-30+"px"}}if(this.range){this.tooltipInner.text(this.formater(this.value[0])+this.tooltip_separator+this.formater(this.value[1]));this.tooltip[0].style[this.stylePos]=(j[1]+j[0])/2+"%";if(this.orientation==="vertical"){this.tooltip.css("margin-top",-this.tooltip.outerHeight()/2+"px")}else{this.tooltip.css("margin-left",-this.tooltip.outerWidth()/2+"px")}if(this.orientation==="vertical"){this.tooltip.css("margin-top",-this.tooltip.outerHeight()/2+"px")}else{this.tooltip.css("margin-left",-this.tooltip.outerWidth()/2+"px")}this.tooltipInner_min.text(this.formater(this.value[0]));this.tooltipInner_max.text(this.formater(this.value[1]));this.tooltip_min[0].style[this.stylePos]=j[0]+"%";if(this.orientation==="vertical"){this.tooltip_min.css("margin-top",-this.tooltip_min.outerHeight()/2+"px")}else{this.tooltip_min.css("margin-left",-this.tooltip_min.outerWidth()/2+"px")}this.tooltip_max[0].style[this.stylePos]=j[1]+"%";if(this.orientation==="vertical"){this.tooltip_max.css("margin-top",-this.tooltip_max.outerHeight()/2+"px")}else{this.tooltip_max.css("margin-left",-this.tooltip_max.outerWidth()/2+"px")}}else{this.tooltipInner.text(this.formater(this.value[0]));this.tooltip[0].style[this.stylePos]=j[0]+"%";if(this.orientation==="vertical"){this.tooltip.css("margin-top",-this.tooltip.outerHeight()/2+"px")}else{this.tooltip.css("margin-left",-this.tooltip.outerWidth()/2+"px")}}},mousedown:function(j){if(!this.isEnabled()){return false}if(this.touchCapable&&j.type==="touchstart"){j=j.originalEvent}this.triggerFocusOnHandle();this.offset=this.picker.offset();this.size=this.picker[0][this.sizePos];var k=this.getPercentage(j);if(this.range){var h=Math.abs(this.percentage[0]-k);var i=Math.abs(this.percentage[1]-k);this.dragged=(h<i)?0:1}else{this.dragged=0}this.percentage[this.dragged]=this.reversed?100-k:k;this.layout();if(this.touchCapable){a(document).on({touchmove:a.proxy(this.mousemove,this),touchend:a.proxy(this.mouseup,this)})}a(document).on({mousemove:a.proxy(this.mousemove,this),mouseup:a.proxy(this.mouseup,this)});this.inDrag=true;var l=this.calculateValue();this.element.trigger({type:"slideStart",value:l}).data("value",l).prop("value",l);this.setValue(l);return true},triggerFocusOnHandle:function(h){if(h===0){this.handle1.focus()}if(h===1){this.handle2.focus()}},keydown:function(j,i){if(!this.isEnabled()){return false}var h;switch(i.which){case 37:case 40:h=-1;break;case 39:case 38:h=1;break}if(!h){return}if(this.natural_arrow_keys){if((this.orientation==="vertical"&&!this.reversed)||(this.orientation==="horizontal"&&this.reversed)){h=h*-1}}var k=h*this.percentage[2];var l=this.percentage[j]+k;if(l>100){l=100}else{if(l<0){l=0}}this.dragged=j;this.adjustPercentageForRangeSliders(l);this.percentage[this.dragged]=l;this.layout();var m=this.calculateValue();this.element.trigger({type:"slideStart",value:m}).data("value",m).prop("value",m);this.setValue(m,true);this.element.trigger({type:"slideStop",value:m}).data("value",m).prop("value",m);return false},mousemove:function(h){if(!this.isEnabled()){return false}if(this.touchCapable&&h.type==="touchmove"){h=h.originalEvent}var i=this.getPercentage(h);this.adjustPercentageForRangeSliders(i);this.percentage[this.dragged]=this.reversed?100-i:i;this.layout();var j=this.calculateValue();this.setValue(j,true);return false},adjustPercentageForRangeSliders:function(h){if(this.range){if(this.dragged===0&&this.percentage[1]<h){this.percentage[0]=this.percentage[1];this.dragged=1}else{if(this.dragged===1&&this.percentage[0]>h){this.percentage[1]=this.percentage[0];this.dragged=0}}}},mouseup:function(){if(!this.isEnabled()){return false}if(this.touchCapable){a(document).off({touchmove:this.mousemove,touchend:this.mouseup})}a(document).off({mousemove:this.mousemove,mouseup:this.mouseup});this.inDrag=false;if(this.over===false){this.hideTooltip()}var h=this.calculateValue();this.layout();this.element.data("value",h).prop("value",h).trigger({type:"slideStop",value:h});return false},calculateValue:function(){var h;if(this.range){h=[this.min,this.max];if(this.percentage[0]!==0){h[0]=(Math.max(this.min,this.min+Math.round((this.diff*this.percentage[0]/100)/this.step)*this.step));h[0]=this.applyPrecision(h[0])}if(this.percentage[1]!==100){h[1]=(Math.min(this.max,this.min+Math.round((this.diff*this.percentage[1]/100)/this.step)*this.step));h[1]=this.applyPrecision(h[1])}this.value=h}else{h=(this.min+Math.round((this.diff*this.percentage[0]/100)/this.step)*this.step);if(h<this.min){h=this.min}else{if(h>this.max){h=this.max}}h=parseFloat(h);h=this.applyPrecision(h);this.value=[h,this.value[1]]}return h},applyPrecision:function(i){var h=this.precision||this.getNumDigitsAfterDecimalPlace(this.step);return this.applyToFixedAndParseFloat(i,h)},getNumDigitsAfterDecimalPlace:function(i){var h=(""+i).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!h){return 0}return Math.max(0,(h[1]?h[1].length:0)-(h[2]?+h[2]:0))},applyToFixedAndParseFloat:function(h,i){var j=h.toFixed(i);return parseFloat(j)},getPercentage:function(h){if(this.touchCapable&&(h.type==="touchstart"||h.type==="touchmove")){h=h.touches[0]}var i=(h[this.mousePos]-this.offset[this.stylePos])*100/this.size;i=Math.round(i/this.percentage[2])*this.percentage[2];return Math.max(0,Math.min(100,i))},getValue:function(){if(this.range){return this.value}return this.value[0]},setValue:function(j,i){if(!j){j=0}this.value=this.validateInputValue(j);if(this.range){this.value[0]=this.applyPrecision(this.value[0]);this.value[1]=this.applyPrecision(this.value[1]);this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0]));this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))}else{this.value=this.applyPrecision(this.value);this.value=[Math.max(this.min,Math.min(this.max,this.value))];this.handle2.addClass("hide");if(this.selection==="after"){this.value[1]=this.max}else{this.value[1]=this.min}}this.diff=this.max-this.min;if(this.diff>0){this.percentage=[(this.value[0]-this.min)*100/this.diff,(this.value[1]-this.min)*100/this.diff,this.step*100/this.diff]}else{this.percentage=[0,0,100]}this.layout();if(i===true){var h=this.range?this.value:this.value[0];this.element.trigger({type:"slide",value:h}).data("value",h).prop("value",h)}},validateInputValue:function(h){if(typeof h==="number"){return h}else{if(h instanceof Array){a.each(h,function(j,k){if(typeof k!=="number"){throw new Error(c.formatInvalidInputErrorMsg(k))}});return h}else{throw new Error(c.formatInvalidInputErrorMsg(h))}}},destroy:function(){this.handle1.off();this.handle2.off();this.element.off().show().insertBefore(this.picker);this.picker.off().remove();a(this.element).removeData("slider")},disable:function(){this.enabled=false;this.handle1.removeAttr("tabindex");this.handle2.removeAttr("tabindex");this.picker.addClass("slider-disabled");this.element.trigger("slideDisabled")},enable:function(){this.enabled=true;this.handle1.attr("tabindex",0);this.handle2.attr("tabindex",0);this.picker.removeClass("slider-disabled");this.element.trigger("slideEnabled")},toggle:function(){if(this.enabled){this.disable()}else{this.enable()}},isEnabled:function(){return this.enabled},setAttribute:function(h,i){this[h]=i},getAttribute:function(h){return this[h]}};var e={getValue:g.prototype.getValue,setValue:g.prototype.setValue,setAttribute:g.prototype.setAttribute,getAttribute:g.prototype.getAttribute,destroy:g.prototype.destroy,disable:g.prototype.disable,enable:g.prototype.enable,toggle:g.prototype.toggle,isEnabled:g.prototype.isEnabled};a.fn.slider=function(i){if(typeof i==="string"&&i!=="refresh"){var h=Array.prototype.slice.call(arguments,1);return d.call(this,i,h)}else{return b.call(this,i)}};function d(i,h){if(e[i]){var k=f(this);var j=e[i].apply(k,h);if(typeof j==="undefined"){return a(this)}else{return j}}else{throw new Error("method '"+i+"()' does not exist for slider.")}}function f(h){var i=a(h).data("slider");if(i&&i instanceof g){return i}else{throw new Error(c.callingContextNotSliderInstance)}}function b(i){var h=a(this);h.each(function(){var j=a(this),l=j.data("slider"),k=typeof i==="object"&&i;if(l&&!k){k={};l.handle1.off();l.handle2.off();l.picker.off();a.each(a.fn.slider.defaults,function(m){k[m]=l[m]})}j.data("slider",(new g(this,a.extend({},a.fn.slider.defaults,k))))});return h}a.fn.slider.defaults={min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:false,selection:"before",tooltip:"show",tooltip_separator:":",tooltip_split:false,natural_arrow_keys:false,handle:"round",reversed:false,enabled:true,formater:function(h){return h}};a.fn.slider.Constructor=g})(window.jQuery);if(typeof Iuppiter==="undefined"){Iuppiter={version:"$Revision: 3026 $".substring(11).replace(" $",""),}}Iuppiter.toByteArray=function(d){var a=[],c,e;for(c=0;c<d.length;c++){e=d.charCodeAt(c);if(e<=127){a.push(e)}else{if(e<=2047){a.push((e>>6)|192);a.push((e&63)|128)}else{if(e<=65535){a.push((e>>12)|224);a.push(((e>>6)&63)|128);a.push((e&63)|128)}else{a.push((e>>18)|240);a.push(((e>>12)&63)|128);a.push(((e>>6)&63)|128);a.push((e&63)|128)}}}}return a};Iuppiter.Base64={CA:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",CAS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",IA:new Array(256),IAS:new Array(256),init:function(){var a;for(a=0;a<256;a++){Iuppiter.Base64.IA[a]=-1;Iuppiter.Base64.IAS[a]=-1}for(a=0,iS=Iuppiter.Base64.CA.length;a<iS;a++){Iuppiter.Base64.IA[Iuppiter.Base64.CA.charCodeAt(a)]=a;Iuppiter.Base64.IAS[Iuppiter.Base64.CAS.charCodeAt(a)]=a}Iuppiter.Base64.IA["="]=Iuppiter.Base64.IAS["="]=0},encode:function(h,n){var a,c,l,m,f,e,k,b,j,g;if(n){a=Iuppiter.Base64.CAS}else{a=Iuppiter.Base64.CA}if(h.constructor==Array){l=h}else{l=Iuppiter.toByteArray(h)}m=l.length;f=(m/3)*3;e=((m-1)/3+1)<<2;c=new Array(e);for(k=0,b=0;k<f;){g=(l[k++]&255)<<16|(l[k++]&255)<<8|(l[k++]&255);c[b++]=a.charAt((g>>18)&63);c[b++]=a.charAt((g>>12)&63);c[b++]=a.charAt((g>>6)&63);c[b++]=a.charAt(g&63)}j=m-f;if(j>0){g=((l[f]&255)<<10)|(j==2?((l[m-1]&255)<<2):0);c[e-4]=a.charAt(g>>12);c[e-3]=a.charAt((g>>6)&63);c[e-2]=j==2?a.charAt(g&63):"=";c[e-1]="="}return c.join("")},decode:function(l,w){var k,f,s,v,a,u,g,p,c,t,o,e,b,n,h,m,q;if(w){k=Iuppiter.Base64.IAS}else{k=Iuppiter.Base64.IA}if(l.constructor==Array){s=l;a=true}else{s=Iuppiter.toByteArray(l);a=false}v=s.length;u=0;g=v-1;while(u<g&&k[s[u]]<0){u++}while(g>0&&k[s[g]]<0){g--}p=s[g]=="="?(s[g-1]=="="?2:1):0;c=g-u+1;t=v>76?(s[76]=="\r"?c/78:0)<<1:0;o=((c-t)*6>>3)-p;f=new Array(o);e=0;for(b=0,eLen=(o/3)*3;e<eLen;){h=k[s[u++]]<<18|k[s[u++]]<<12|k[s[u++]]<<6|k[s[u++]];f[e++]=(h>>16)&255;f[e++]=(h>>8)&255;f[e++]=h&255;if(t>0&&++b==19){u+=2;b=0}}if(e<o){h=0;for(m=0;u<=g-p;m++){h|=k[s[u++]]<<(18-m*6)}for(q=16;e<o;q-=8){f[e++]=(h>>q)&255}}if(a){return f}else{for(h=0;h<f.length;h++){f[h]=String.fromCharCode(f[h])}return f.join("")}}};Iuppiter.Base64.init();(function(){NBBY=8,MATCH_BITS=6,MATCH_MIN=3,MATCH_MAX=((1<<MATCH_BITS)+(MATCH_MIN-1)),OFFSET_MASK=((1<<(16-MATCH_BITS))-1),LEMPEL_SIZE=256;Iuppiter.compress=function(j){var p,f=[],n,o=0,e=0,d,b,c=1<<(NBBY-1),l,m,g,k=new Array(LEMPEL_SIZE),h,a;for(h=0;h<LEMPEL_SIZE;h++){k[h]=3435973836}if(j.constructor==Array){p=j;a=true}else{p=Iuppiter.toByteArray(j);a=false}n=p.length;while(o<n){if((c<<=1)==(1<<NBBY)){if(e>=n-1-2*NBBY){l=n;for(o=0,e=0;l;l--){f[e++]=p[o++]}return f}c=1;b=e;f[e++]=0}if(o>n-MATCH_MAX){f[e++]=p[o++];continue}g=((p[o]+13)^(p[o+1]-13)^p[o+2])&(LEMPEL_SIZE-1);m=(o-k[g])&OFFSET_MASK;k[g]=o;d=o-m;if(d>=0&&d!=o&&p[o]==p[d]&&p[o+1]==p[d+1]&&p[o+2]==p[d+2]){f[b]|=c;for(l=MATCH_MIN;l<MATCH_MAX;l++){if(p[o+l]!=p[d+l]){break}}f[e++]=((l-MATCH_MIN)<<(NBBY-MATCH_BITS))|(m>>NBBY);f[e++]=m;o+=l}else{f[e++]=p[o++]}}return f};Iuppiter.decompress=function(k,a){var p,g=[],n,o=0,f=0,e,c,d=1<<(NBBY-1),l,m,j,b,h;if(k.constructor==Array){p=k;b=true}else{p=Iuppiter.toByteArray(k);b=false}if(typeof(a)=="undefined"){b=false}else{b=a}n=p.length;h=function(){if(b){return g}else{for(j=0;j<f;j++){g[j]=String.fromCharCode(g[j])}return g.join("")}};while(o<n){if((d<<=1)==(1<<NBBY)){d=1;c=p[o++]}if(c&d){l=(p[o]>>(NBBY-MATCH_BITS))+MATCH_MIN;m=((p[o]<<NBBY)|p[o+1])&OFFSET_MASK;o+=2;if((e=f-m)>=0){while(--l>=0){g[f++]=g[e++]}}else{return h()}}else{g[f++]=p[o++]}}return h()}})();if(!Worker||(location&&location.protocol==="file:")){
/*@cc_on
        var onmessage   = function () {};
        var postMessage = function () {};
    @*/
var Worker=function(c){var a,b={};if(typeof window!=="undefined"){a=window}else{if(global){a=global}}if(a.document&&!a.require){a.require=function(d){var e=document.createElement("script");e.type="text/javascript";e.src=d;document.getElementsByTagName("head")[0].appendChild(e)}}b.onmessage=function(){};b.postMessage=function(d){if(a.onmessage){a.onmessage({data:d})}else{setTimeout(function(){b.postMessage(d)},50)}};a.postMessage=function(d){b.onmessage({data:d,type:"message"})};require(c);return b}}this.LZMA=function(e){var a=1,b=2,c=3,d={},f=new Worker((typeof e==="undefined"?"./lzma_worker.js":e));f.onmessage=function(g){if(g.data.action===c){if(d[g.data.callback_num]&&typeof d[g.data.callback_num].on_progress==="function"){d[g.data.callback_num].on_progress(g.data.result)}}else{if(d[g.data.callback_num]&&typeof d[g.data.callback_num].on_finish==="function"){d[g.data.callback_num].on_finish(g.data.result);delete d[g.data.callback_num]}}};f.onerror=function(g){throw new Error(g.message+" ("+g.filename+":"+g.lineno+")")};return(function(){function g(h,j,k,l,m){var i;do{i=Math.floor(Math.random()*(10000000))}while(typeof d[i]!=="undefined");d[i]={on_finish:l,on_progress:m};f.postMessage({action:h,callback_num:i,data:j,mode:k})}return{compress:function(k,h,i,j){g(a,String(k),h,i,j)},decompress:function(h,i,j){g(b,h,false,i,j)}}}())};/* A fix for the iOS orientationchange zoom bug.
Script by @scottjehl, rebound by @wilto.
MIT License.
*/
(function(k){if(!(/iPhone|iPad|iPod/.test(navigator.platform)&&navigator.userAgent.indexOf("AppleWebKit")>-1)){return}var e=k.document;if(!e.querySelector){return}var i=e.querySelector("meta[name=viewport]"),h=i&&i.getAttribute("content"),c=h+",maximum-scale=1",g=h+",maximum-scale=10",f=true,l,m,n,a;if(!i){return}var j=function(){i.setAttribute("content",g);f=true};var d=function(){i.setAttribute("content",c);f=false};var b=function(o){a=o.accelerationIncludingGravity;l=Math.abs(a.x);m=Math.abs(a.y);n=Math.abs(a.z);if(!k.orientation&&(l>7||(((n>6&&m<8)||(n<8&&m>6))&&l>5))){if(f){d()}}else{if(!f){j()}}};k.addEventListener("orientationchange",j,false);k.addEventListener("devicemotion",b,false)}(this));(function(a){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=a()}else{if(typeof define==="function"&&define.amd){define([],a)}else{var b;if(typeof window!=="undefined"){b=window}else{if(typeof global!=="undefined"){b=global}else{if(typeof self!=="undefined"){b=self}else{b=this}}}b.pako=a()}}})(function(){var a,d,c;return(function b(k,f,h){function j(p,q){if(!f[p]){if(!k[p]){var i=typeof require=="function"&&require;if(!q&&i){return i(p,!0)}if(e){return e(p,!0)}var m=new Error("Cannot find module '"+p+"'");throw m.code="MODULE_NOT_FOUND",m}var n=f[p]={exports:{}};k[p][0].call(n.exports,function(l){var o=k[p][1][l];return j(o?o:l)},n,n.exports,b,k,f,h)}return f[p].exports}var e=typeof require=="function"&&require;for(var g=0;g<h.length;g++){j(h[g])}return j})({1:[function(j,i,f){var k=(typeof Uint8Array!=="undefined")&&(typeof Uint16Array!=="undefined")&&(typeof Int32Array!=="undefined");function e(m,l){return Object.prototype.hasOwnProperty.call(m,l)}f.assign=function(l){var o=Array.prototype.slice.call(arguments,1);while(o.length){var n=o.shift();if(!n){continue}if(typeof n!=="object"){throw new TypeError(n+"must be non-object")}for(var m in n){if(e(n,m)){l[m]=n[m]}}}return l};f.shrinkBuf=function(l,m){if(l.length===m){return l}if(l.subarray){return l.subarray(0,m)}l.length=m;return l};var g={arraySet:function(l,p,q,o,m){if(p.subarray&&l.subarray){l.set(p.subarray(q,q+o),m);return}for(var n=0;n<o;n++){l[m+n]=p[q+n]}},flattenChunks:function(n){var o,p,q,r,m,s;q=0;for(o=0,p=n.length;o<p;o++){q+=n[o].length}s=new Uint8Array(q);r=0;for(o=0,p=n.length;o<p;o++){m=n[o];s.set(m,r);r+=m.length}return s}};var h={arraySet:function(l,p,q,o,m){for(var n=0;n<o;n++){l[m+n]=p[q+n]}},flattenChunks:function(l){return[].concat.apply([],l)}};f.setTyped=function(l){if(l){f.Buf8=Uint8Array;f.Buf16=Uint16Array;f.Buf32=Int32Array;f.assign(f,g)}else{f.Buf8=Array;f.Buf16=Array;f.Buf32=Array;f.assign(f,h)}};f.setTyped(k)},{}],2:[function(k,i,h){var n=k("./common");var l=true;var m=true;try{String.fromCharCode.apply(null,[0])}catch(e){l=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){m=false}var f=new n.Buf8(256);for(var j=0;j<256;j++){f[j]=(j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1)}f[254]=f[254]=1;h.string2buf=function(u){var o,q,r,t,s,v=u.length,p=0;for(t=0;t<v;t++){q=u.charCodeAt(t);if((q&64512)===55296&&(t+1<v)){r=u.charCodeAt(t+1);if((r&64512)===56320){q=65536+((q-55296)<<10)+(r-56320);t++}}p+=q<128?1:q<2048?2:q<65536?3:4}o=new n.Buf8(p);for(s=0,t=0;s<p;t++){q=u.charCodeAt(t);if((q&64512)===55296&&(t+1<v)){r=u.charCodeAt(t+1);if((r&64512)===56320){q=65536+((q-55296)<<10)+(r-56320);t++}}if(q<128){o[s++]=q}else{if(q<2048){o[s++]=192|(q>>>6);o[s++]=128|(q&63)}else{if(q<65536){o[s++]=224|(q>>>12);o[s++]=128|(q>>>6&63);o[s++]=128|(q&63)}else{o[s++]=240|(q>>>18);o[s++]=128|(q>>>12&63);o[s++]=128|(q>>>6&63);o[s++]=128|(q&63)}}}}return o};function g(o,q){if(q<65537){if((o.subarray&&m)||(!o.subarray&&l)){return String.fromCharCode.apply(null,n.shrinkBuf(o,q))}}var r="";for(var p=0;p<q;p++){r+=String.fromCharCode(o[p])}return r}h.buf2binstring=function(o){return g(o,o.length)};h.binstring2buf=function(r){var o=new n.Buf8(r.length);for(var p=0,q=o.length;p<q;p++){o[p]=r.charCodeAt(p)}return o};h.buf2string=function(o,t){var r,u,p,q;var s=t||o.length;var v=new Array(s*2);for(u=0,r=0;r<s;){p=o[r++];if(p<128){v[u++]=p;continue}q=f[p];if(q>4){v[u++]=65533;r+=q-1;continue}p&=q===2?31:q===3?15:7;while(q>1&&r<s){p=(p<<6)|(o[r++]&63);q--}if(q>1){v[u++]=65533;continue}if(p<65536){v[u++]=p}else{p-=65536;v[u++]=55296|((p>>10)&1023);v[u++]=56320|(p&1023)}}return g(v,u)};h.utf8border=function(o,p){var q;p=p||o.length;if(p>o.length){p=o.length}q=p-1;while(q>=0&&(o[q]&192)===128){q--}if(q<0){return p}if(q===0){return p}return(q+f[o[q]]>p)?q:p}},{"./common":1}],3:[function(h,g,f){function e(i,j,k,m){var o=(i&65535)|0,p=((i>>>16)&65535)|0,l=0;while(k!==0){l=k>2000?2000:k;k-=l;do{o=(o+j[m++])|0;p=(p+o)|0}while(--l);o%=65521;p%=65521}return(o|(p<<16))|0}g.exports=e},{}],4:[function(j,i,g){function h(){var l,p=[];for(var o=0;o<256;o++){l=o;for(var m=0;m<8;m++){l=((l&1)?(3988292384^(l>>>1)):(l>>>1))}p[o]=l}return p}var f=h();function e(l,k,o,p){var q=f,m=p+o;l^=-1;for(var n=p;n<m;n++){l=(l>>>8)^q[(l^k[n])&255]}return(l^(-1))}i.exports=e},{}],5:[function(aj,aa,G){var al=aj("../utils/common");var ak=aj("./trees");var e=aj("./adler32");var o=aj("./crc32");var ab=aj("./messages");var ay=0;var aA=1;var aw=3;var au=4;var am=5;var az=0;var aC=1;var aD=-2;var ao=-3;var an=-5;var ap=-1;var at=1;var ax=2;var aB=3;var av=4;var aq=0;var aE=2;var ar=8;var W=9;var X=15;var q=8;var Q=29;var R=256;var P=R+1+Q;var p=30;var f=19;var N=2*P+1;var U=15;var Z=3;var V=258;var Y=(V+Z+1);var ae=32;var O=42;var H=69;var ac=73;var l=91;var M=103;var k=113;var J=666;var j=1;var g=2;var i=3;var h=4;var ad=3;function F(aH,aG){aH.msg=ab[aG];return aG}function ah(aG){return((aG)<<1)-((aG)>4?9:0)}function aF(aG){var aH=aG.length;while(--aH>=0){aG[aH]=0}}function L(aI){var aH=aI.state;var aG=aH.pending;if(aG>aI.avail_out){aG=aI.avail_out}if(aG===0){return}al.arraySet(aI.output,aH.pending_buf,aH.pending_out,aG,aI.next_out);aI.next_out+=aG;aH.pending_out+=aG;aI.total_out+=aG;aI.avail_out-=aG;aH.pending-=aG;if(aH.pending===0){aH.pending_out=0}}function K(aH,aG){ak._tr_flush_block(aH,(aH.block_start>=0?aH.block_start:-1),aH.strstart-aH.block_start,aG);aH.block_start=aH.strstart;L(aH.strm)}function af(aH,aG){aH.pending_buf[aH.pending++]=aG}function ag(aH,aG){aH.pending_buf[aH.pending++]=(aG>>>8)&255;aH.pending_buf[aH.pending++]=aG&255}function ai(aK,aG,aJ,aI){var aH=aK.avail_in;if(aH>aI){aH=aI}if(aH===0){return 0}aK.avail_in-=aH;al.arraySet(aG,aK.input,aK.next_in,aH,aJ);if(aK.state.wrap===1){aK.adler=e(aK.adler,aG,aH,aJ)}else{if(aK.state.wrap===2){aK.adler=o(aK.adler,aG,aH,aJ)}}aK.next_in+=aH;aK.total_in+=aH;return aH}function T(aP,aJ){var aI=aP.max_chain_length;var aQ=aP.strstart;var aM;var aK;var aH=aP.prev_length;var aN=aP.nice_match;var aL=(aP.strstart>(aP.w_size-Y))?aP.strstart-(aP.w_size-Y):0;var aG=aP.window;var aU=aP.w_mask;var aO=aP.prev;var aT=aP.strstart+V;var aS=aG[aQ+aH-1];var aR=aG[aQ+aH];if(aP.prev_length>=aP.good_match){aI>>=2}if(aN>aP.lookahead){aN=aP.lookahead}do{aM=aJ;if(aG[aM+aH]!==aR||aG[aM+aH-1]!==aS||aG[aM]!==aG[aQ]||aG[++aM]!==aG[aQ+1]){continue}aQ+=2;aM++;do{}while(aG[++aQ]===aG[++aM]&&aG[++aQ]===aG[++aM]&&aG[++aQ]===aG[++aM]&&aG[++aQ]===aG[++aM]&&aG[++aQ]===aG[++aM]&&aG[++aQ]===aG[++aM]&&aG[++aQ]===aG[++aM]&&aG[++aQ]===aG[++aM]&&aQ<aT);aK=V-(aT-aQ);aQ=aT-V;if(aK>aH){aP.match_start=aJ;aH=aK;if(aK>=aN){break}aS=aG[aQ+aH-1];aR=aG[aQ+aH]}}while((aJ=aO[aJ&aU])>aL&&--aI!==0);if(aH<=aP.lookahead){return aH}return aP.lookahead}function I(aL){var aG=aL.w_size;var aK,aJ,aH,aI,aM;do{aI=aL.window_size-aL.lookahead-aL.strstart;if(aL.strstart>=aG+(aG-Y)){al.arraySet(aL.window,aL.window,aG,aG,0);aL.match_start-=aG;aL.strstart-=aG;aL.block_start-=aG;aJ=aL.hash_size;aK=aJ;do{aH=aL.head[--aK];aL.head[aK]=(aH>=aG?aH-aG:0)}while(--aJ);aJ=aG;aK=aJ;do{aH=aL.prev[--aK];aL.prev[aK]=(aH>=aG?aH-aG:0)}while(--aJ);aI+=aG}if(aL.strm.avail_in===0){break}aJ=ai(aL.strm,aL.window,aL.strstart+aL.lookahead,aI);aL.lookahead+=aJ;if(aL.lookahead+aL.insert>=Z){aM=aL.strstart-aL.insert;aL.ins_h=aL.window[aM];aL.ins_h=((aL.ins_h<<aL.hash_shift)^aL.window[aM+1])&aL.hash_mask;while(aL.insert){aL.ins_h=((aL.ins_h<<aL.hash_shift)^aL.window[aM+Z-1])&aL.hash_mask;aL.prev[aM&aL.w_mask]=aL.head[aL.ins_h];aL.head[aL.ins_h]=aM;aM++;aL.insert--;if(aL.lookahead+aL.insert<Z){break}}}}while(aL.lookahead<Y&&aL.strm.avail_in!==0)}function w(aJ,aG){var aH=65535;if(aH>aJ.pending_buf_size-5){aH=aJ.pending_buf_size-5}for(;;){if(aJ.lookahead<=1){I(aJ);if(aJ.lookahead===0&&aG===ay){return j}if(aJ.lookahead===0){break}}aJ.strstart+=aJ.lookahead;aJ.lookahead=0;var aI=aJ.block_start+aH;if(aJ.strstart===0||aJ.strstart>=aI){aJ.lookahead=aJ.strstart-aI;aJ.strstart=aI;K(aJ,false);if(aJ.strm.avail_out===0){return j}}if(aJ.strstart-aJ.block_start>=(aJ.w_size-Y)){K(aJ,false);if(aJ.strm.avail_out===0){return j}}}aJ.insert=0;if(aG===au){K(aJ,true);if(aJ.strm.avail_out===0){return i}return h}if(aJ.strstart>aJ.block_start){K(aJ,false);if(aJ.strm.avail_out===0){return j}}return j}function s(aJ,aH){var aI;var aG;for(;;){if(aJ.lookahead<Y){I(aJ);if(aJ.lookahead<Y&&aH===ay){return j}if(aJ.lookahead===0){break}}aI=0;if(aJ.lookahead>=Z){aJ.ins_h=((aJ.ins_h<<aJ.hash_shift)^aJ.window[aJ.strstart+Z-1])&aJ.hash_mask;aI=aJ.prev[aJ.strstart&aJ.w_mask]=aJ.head[aJ.ins_h];aJ.head[aJ.ins_h]=aJ.strstart}if(aI!==0&&((aJ.strstart-aI)<=(aJ.w_size-Y))){aJ.match_length=T(aJ,aI)}if(aJ.match_length>=Z){aG=ak._tr_tally(aJ,aJ.strstart-aJ.match_start,aJ.match_length-Z);aJ.lookahead-=aJ.match_length;if(aJ.match_length<=aJ.max_lazy_match&&aJ.lookahead>=Z){aJ.match_length--;do{aJ.strstart++;aJ.ins_h=((aJ.ins_h<<aJ.hash_shift)^aJ.window[aJ.strstart+Z-1])&aJ.hash_mask;aI=aJ.prev[aJ.strstart&aJ.w_mask]=aJ.head[aJ.ins_h];aJ.head[aJ.ins_h]=aJ.strstart}while(--aJ.match_length!==0);aJ.strstart++}else{aJ.strstart+=aJ.match_length;aJ.match_length=0;aJ.ins_h=aJ.window[aJ.strstart];aJ.ins_h=((aJ.ins_h<<aJ.hash_shift)^aJ.window[aJ.strstart+1])&aJ.hash_mask}}else{aG=ak._tr_tally(aJ,0,aJ.window[aJ.strstart]);aJ.lookahead--;aJ.strstart++}if(aG){K(aJ,false);if(aJ.strm.avail_out===0){return j}}}aJ.insert=((aJ.strstart<(Z-1))?aJ.strstart:Z-1);if(aH===au){K(aJ,true);if(aJ.strm.avail_out===0){return i}return h}if(aJ.last_lit){K(aJ,false);if(aJ.strm.avail_out===0){return j}}return g}function v(aK,aH){var aI;var aG;var aJ;for(;;){if(aK.lookahead<Y){I(aK);if(aK.lookahead<Y&&aH===ay){return j}if(aK.lookahead===0){break}}aI=0;if(aK.lookahead>=Z){aK.ins_h=((aK.ins_h<<aK.hash_shift)^aK.window[aK.strstart+Z-1])&aK.hash_mask;aI=aK.prev[aK.strstart&aK.w_mask]=aK.head[aK.ins_h];aK.head[aK.ins_h]=aK.strstart}aK.prev_length=aK.match_length;aK.prev_match=aK.match_start;aK.match_length=Z-1;if(aI!==0&&aK.prev_length<aK.max_lazy_match&&aK.strstart-aI<=(aK.w_size-Y)){aK.match_length=T(aK,aI);if(aK.match_length<=5&&(aK.strategy===at||(aK.match_length===Z&&aK.strstart-aK.match_start>4096))){aK.match_length=Z-1}}if(aK.prev_length>=Z&&aK.match_length<=aK.prev_length){aJ=aK.strstart+aK.lookahead-Z;aG=ak._tr_tally(aK,aK.strstart-1-aK.prev_match,aK.prev_length-Z);aK.lookahead-=aK.prev_length-1;aK.prev_length-=2;do{if(++aK.strstart<=aJ){aK.ins_h=((aK.ins_h<<aK.hash_shift)^aK.window[aK.strstart+Z-1])&aK.hash_mask;aI=aK.prev[aK.strstart&aK.w_mask]=aK.head[aK.ins_h];aK.head[aK.ins_h]=aK.strstart}}while(--aK.prev_length!==0);aK.match_available=0;aK.match_length=Z-1;aK.strstart++;if(aG){K(aK,false);if(aK.strm.avail_out===0){return j}}}else{if(aK.match_available){aG=ak._tr_tally(aK,0,aK.window[aK.strstart-1]);if(aG){K(aK,false)}aK.strstart++;aK.lookahead--;if(aK.strm.avail_out===0){return j}}else{aK.match_available=1;aK.strstart++;aK.lookahead--}}}if(aK.match_available){aG=ak._tr_tally(aK,0,aK.window[aK.strstart-1]);aK.match_available=0}aK.insert=aK.strstart<Z-1?aK.strstart:Z-1;if(aH===au){K(aK,true);if(aK.strm.avail_out===0){return i}return h}if(aK.last_lit){K(aK,false);if(aK.strm.avail_out===0){return j}}return g}function u(aK,aI){var aH;var aJ;var aL,aM;var aG=aK.window;for(;;){if(aK.lookahead<=V){I(aK);if(aK.lookahead<=V&&aI===ay){return j}if(aK.lookahead===0){break}}aK.match_length=0;if(aK.lookahead>=Z&&aK.strstart>0){aL=aK.strstart-1;aJ=aG[aL];if(aJ===aG[++aL]&&aJ===aG[++aL]&&aJ===aG[++aL]){aM=aK.strstart+V;do{}while(aJ===aG[++aL]&&aJ===aG[++aL]&&aJ===aG[++aL]&&aJ===aG[++aL]&&aJ===aG[++aL]&&aJ===aG[++aL]&&aJ===aG[++aL]&&aJ===aG[++aL]&&aL<aM);aK.match_length=V-(aM-aL);if(aK.match_length>aK.lookahead){aK.match_length=aK.lookahead}}}if(aK.match_length>=Z){aH=ak._tr_tally(aK,1,aK.match_length-Z);aK.lookahead-=aK.match_length;aK.strstart+=aK.match_length;aK.match_length=0}else{aH=ak._tr_tally(aK,0,aK.window[aK.strstart]);aK.lookahead--;aK.strstart++}if(aH){K(aK,false);if(aK.strm.avail_out===0){return j}}}aK.insert=0;if(aI===au){K(aK,true);if(aK.strm.avail_out===0){return i}return h}if(aK.last_lit){K(aK,false);if(aK.strm.avail_out===0){return j}}return g}function t(aI,aH){var aG;for(;;){if(aI.lookahead===0){I(aI);if(aI.lookahead===0){if(aH===ay){return j}break}}aI.match_length=0;aG=ak._tr_tally(aI,0,aI.window[aI.strstart]);aI.lookahead--;aI.strstart++;if(aG){K(aI,false);if(aI.strm.avail_out===0){return j}}}aI.insert=0;if(aH===au){K(aI,true);if(aI.strm.avail_out===0){return i}return h}if(aI.last_lit){K(aI,false);if(aI.strm.avail_out===0){return j}}return g}function m(aH,aJ,aK,aI,aG){this.good_length=aH;this.max_lazy=aJ;this.nice_length=aK;this.max_chain=aI;this.func=aG}var n;n=[new m(0,0,0,0,w),new m(4,4,8,4,s),new m(4,5,16,8,s),new m(4,6,32,32,s),new m(4,4,16,16,v),new m(8,16,32,32,v),new m(8,16,128,128,v),new m(8,32,128,256,v),new m(32,128,258,1024,v),new m(32,258,258,4096,v)];function S(aG){aG.window_size=2*aG.w_size;aF(aG.head);aG.max_lazy_match=n[aG.level].max_lazy;aG.good_match=n[aG.level].good_length;aG.nice_match=n[aG.level].nice_length;aG.max_chain_length=n[aG.level].max_chain;aG.strstart=0;aG.block_start=0;aG.lookahead=0;aG.insert=0;aG.match_length=aG.prev_length=Z-1;aG.match_available=0;aG.ins_h=0}function E(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=ar;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new al.Buf16(N*2);this.dyn_dtree=new al.Buf16((2*p+1)*2);this.bl_tree=new al.Buf16((2*f+1)*2);aF(this.dyn_ltree);aF(this.dyn_dtree);aF(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new al.Buf16(U+1);this.heap=new al.Buf16(2*P+1);aF(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new al.Buf16(2*P+1);aF(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function B(aH){var aG;if(!aH||!aH.state){return F(aH,aD)}aH.total_in=aH.total_out=0;aH.data_type=aE;aG=aH.state;aG.pending=0;aG.pending_out=0;if(aG.wrap<0){aG.wrap=-aG.wrap}aG.status=(aG.wrap?O:k);aH.adler=(aG.wrap===2)?0:1;aG.last_flush=ay;ak._tr_init(aG);return az}function A(aH){var aG=B(aH);if(aG===az){S(aH.state)}return aG}function D(aH,aG){if(!aH||!aH.state){return aD}if(aH.state.wrap!==2){return aD}aH.state.gzhead=aG;return az}function z(aL,aG,aI,aM,aH,aK){if(!aL){return aD}var aN=1;if(aG===ap){aG=6}if(aM<0){aN=0;aM=-aM}else{if(aM>15){aN=2;aM-=16}}if(aH<1||aH>W||aI!==ar||aM<8||aM>15||aG<0||aG>9||aK<0||aK>av){return F(aL,aD)}if(aM===8){aM=9}var aJ=new E();aL.state=aJ;aJ.strm=aL;aJ.wrap=aN;aJ.gzhead=null;aJ.w_bits=aM;aJ.w_size=1<<aJ.w_bits;aJ.w_mask=aJ.w_size-1;aJ.hash_bits=aH+7;aJ.hash_size=1<<aJ.hash_bits;aJ.hash_mask=aJ.hash_size-1;aJ.hash_shift=~~((aJ.hash_bits+Z-1)/Z);aJ.window=new al.Buf8(aJ.w_size*2);aJ.head=new al.Buf16(aJ.hash_size);aJ.prev=new al.Buf16(aJ.w_size);aJ.lit_bufsize=1<<(aH+6);aJ.pending_buf_size=aJ.lit_bufsize*4;aJ.pending_buf=new al.Buf8(aJ.pending_buf_size);aJ.d_buf=1*aJ.lit_bufsize;aJ.l_buf=(1+2)*aJ.lit_bufsize;aJ.level=aG;aJ.strategy=aK;aJ.method=aI;return A(aL)}function y(aH,aG){return z(aH,aG,ar,X,q,aq)}function r(aN,aI){var aL,aM;var aG,aO;if(!aN||!aN.state||aI>am||aI<0){return aN?F(aN,aD):aD}aM=aN.state;if(!aN.output||(!aN.input&&aN.avail_in!==0)||(aM.status===J&&aI!==au)){return F(aN,(aN.avail_out===0)?an:aD)}aM.strm=aN;aL=aM.last_flush;aM.last_flush=aI;if(aM.status===O){if(aM.wrap===2){aN.adler=0;af(aM,31);af(aM,139);af(aM,8);if(!aM.gzhead){af(aM,0);af(aM,0);af(aM,0);af(aM,0);af(aM,0);af(aM,aM.level===9?2:(aM.strategy>=ax||aM.level<2?4:0));af(aM,ad);aM.status=k}else{af(aM,(aM.gzhead.text?1:0)+(aM.gzhead.hcrc?2:0)+(!aM.gzhead.extra?0:4)+(!aM.gzhead.name?0:8)+(!aM.gzhead.comment?0:16));af(aM,aM.gzhead.time&255);af(aM,(aM.gzhead.time>>8)&255);af(aM,(aM.gzhead.time>>16)&255);af(aM,(aM.gzhead.time>>24)&255);af(aM,aM.level===9?2:(aM.strategy>=ax||aM.level<2?4:0));af(aM,aM.gzhead.os&255);if(aM.gzhead.extra&&aM.gzhead.extra.length){af(aM,aM.gzhead.extra.length&255);af(aM,(aM.gzhead.extra.length>>8)&255)}if(aM.gzhead.hcrc){aN.adler=o(aN.adler,aM.pending_buf,aM.pending,0)}aM.gzindex=0;aM.status=H}}else{var aJ=(ar+((aM.w_bits-8)<<4))<<8;var aK=-1;if(aM.strategy>=ax||aM.level<2){aK=0}else{if(aM.level<6){aK=1}else{if(aM.level===6){aK=2}else{aK=3}}}aJ|=(aK<<6);if(aM.strstart!==0){aJ|=ae}aJ+=31-(aJ%31);aM.status=k;ag(aM,aJ);if(aM.strstart!==0){ag(aM,aN.adler>>>16);ag(aM,aN.adler&65535)}aN.adler=1}}if(aM.status===H){if(aM.gzhead.extra){aG=aM.pending;while(aM.gzindex<(aM.gzhead.extra.length&65535)){if(aM.pending===aM.pending_buf_size){if(aM.gzhead.hcrc&&aM.pending>aG){aN.adler=o(aN.adler,aM.pending_buf,aM.pending-aG,aG)}L(aN);aG=aM.pending;if(aM.pending===aM.pending_buf_size){break}}af(aM,aM.gzhead.extra[aM.gzindex]&255);aM.gzindex++}if(aM.gzhead.hcrc&&aM.pending>aG){aN.adler=o(aN.adler,aM.pending_buf,aM.pending-aG,aG)}if(aM.gzindex===aM.gzhead.extra.length){aM.gzindex=0;aM.status=ac}}else{aM.status=ac}}if(aM.status===ac){if(aM.gzhead.name){aG=aM.pending;do{if(aM.pending===aM.pending_buf_size){if(aM.gzhead.hcrc&&aM.pending>aG){aN.adler=o(aN.adler,aM.pending_buf,aM.pending-aG,aG)}L(aN);aG=aM.pending;if(aM.pending===aM.pending_buf_size){aO=1;break}}if(aM.gzindex<aM.gzhead.name.length){aO=aM.gzhead.name.charCodeAt(aM.gzindex++)&255}else{aO=0}af(aM,aO)}while(aO!==0);if(aM.gzhead.hcrc&&aM.pending>aG){aN.adler=o(aN.adler,aM.pending_buf,aM.pending-aG,aG)}if(aO===0){aM.gzindex=0;aM.status=l}}else{aM.status=l}}if(aM.status===l){if(aM.gzhead.comment){aG=aM.pending;do{if(aM.pending===aM.pending_buf_size){if(aM.gzhead.hcrc&&aM.pending>aG){aN.adler=o(aN.adler,aM.pending_buf,aM.pending-aG,aG)}L(aN);aG=aM.pending;if(aM.pending===aM.pending_buf_size){aO=1;break}}if(aM.gzindex<aM.gzhead.comment.length){aO=aM.gzhead.comment.charCodeAt(aM.gzindex++)&255}else{aO=0}af(aM,aO)}while(aO!==0);if(aM.gzhead.hcrc&&aM.pending>aG){aN.adler=o(aN.adler,aM.pending_buf,aM.pending-aG,aG)}if(aO===0){aM.status=M}}else{aM.status=M}}if(aM.status===M){if(aM.gzhead.hcrc){if(aM.pending+2>aM.pending_buf_size){L(aN)}if(aM.pending+2<=aM.pending_buf_size){af(aM,aN.adler&255);af(aM,(aN.adler>>8)&255);aN.adler=0;aM.status=k}}else{aM.status=k}}if(aM.pending!==0){L(aN);if(aN.avail_out===0){aM.last_flush=-1;return az}}else{if(aN.avail_in===0&&ah(aI)<=ah(aL)&&aI!==au){return F(aN,an)}}if(aM.status===J&&aN.avail_in!==0){return F(aN,an)}if(aN.avail_in!==0||aM.lookahead!==0||(aI!==ay&&aM.status!==J)){var aH=(aM.strategy===ax)?t(aM,aI):(aM.strategy===aB?u(aM,aI):n[aM.level].func(aM,aI));if(aH===i||aH===h){aM.status=J}if(aH===j||aH===i){if(aN.avail_out===0){aM.last_flush=-1}return az}if(aH===g){if(aI===aA){ak._tr_align(aM)}else{if(aI!==am){ak._tr_stored_block(aM,0,0,false);if(aI===aw){aF(aM.head);if(aM.lookahead===0){aM.strstart=0;aM.block_start=0;aM.insert=0}}}}L(aN);if(aN.avail_out===0){aM.last_flush=-1;return az}}}if(aI!==au){return az}if(aM.wrap<=0){return aC}if(aM.wrap===2){af(aM,aN.adler&255);af(aM,(aN.adler>>8)&255);af(aM,(aN.adler>>16)&255);af(aM,(aN.adler>>24)&255);af(aM,aN.total_in&255);af(aM,(aN.total_in>>8)&255);af(aM,(aN.total_in>>16)&255);af(aM,(aN.total_in>>24)&255)}else{ag(aM,aN.adler>>>16);ag(aM,aN.adler&65535)}L(aN);if(aM.wrap>0){aM.wrap=-aM.wrap}return aM.pending!==0?az:aC}function x(aH){var aG;if(!aH||!aH.state){return aD}aG=aH.state.status;if(aG!==O&&aG!==H&&aG!==ac&&aG!==l&&aG!==M&&aG!==k&&aG!==J){return F(aH,aD)}aH.state=null;return aG===k?F(aH,ao):az}function C(aO,aH){var aI=aH.length;var aM;var aN,aK;var aQ;var aG;var aL;var aJ;var aP;if(!aO||!aO.state){return aD}aM=aO.state;aQ=aM.wrap;if(aQ===2||(aQ===1&&aM.status!==O)||aM.lookahead){return aD}if(aQ===1){aO.adler=e(aO.adler,aH,aI,0)}aM.wrap=0;if(aI>=aM.w_size){if(aQ===0){aF(aM.head);aM.strstart=0;aM.block_start=0;aM.insert=0}aP=new al.Buf8(aM.w_size);al.arraySet(aP,aH,aI-aM.w_size,aM.w_size,0);aH=aP;aI=aM.w_size}aG=aO.avail_in;aL=aO.next_in;aJ=aO.input;aO.avail_in=aI;aO.next_in=0;aO.input=aH;I(aM);while(aM.lookahead>=Z){aN=aM.strstart;aK=aM.lookahead-(Z-1);do{aM.ins_h=((aM.ins_h<<aM.hash_shift)^aM.window[aN+Z-1])&aM.hash_mask;aM.prev[aN&aM.w_mask]=aM.head[aM.ins_h];aM.head[aM.ins_h]=aN;aN++}while(--aK);aM.strstart=aN;aM.lookahead=Z-1;I(aM)}aM.strstart+=aM.lookahead;aM.block_start=aM.strstart;aM.insert=aM.lookahead;aM.lookahead=0;aM.match_length=aM.prev_length=Z-1;aM.match_available=0;aO.next_in=aL;aO.input=aJ;aO.avail_in=aG;aM.wrap=aQ;return az}G.deflateInit=y;G.deflateInit2=z;G.deflateReset=A;G.deflateResetKeep=B;G.deflateSetHeader=D;G.deflate=r;G.deflateEnd=x;G.deflateSetDictionary=C;G.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":4,"./messages":6,"./trees":7}],6:[function(g,f,e){f.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],7:[function(Y,S,D){var aq=Y("../utils/common");var at=4;var ar=0;var au=1;var av=2;function aw(ax){var ay=ax.length;while(--ay>=0){ax[ay]=0}}var an=0;var al=1;var B=2;var R=3;var Q=258;var M=29;var N=256;var L=N+1+M;var y=30;var q=19;var J=2*L+1;var O=15;var s=16;var P=7;var C=256;var V=16;var X=17;var W=18;var G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var F=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var r=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var A=512;var ak=new Array((L+2)*2);aw(ak);var ah=new Array(y*2);aw(ah);var e=new Array(A);aw(e);var f=new Array(Q-R+1);aw(f);var m=new Array(M);aw(m);var l=new Array(y);aw(l);function am(aB,az,ay,ax,aA){this.static_tree=aB;this.extra_bits=az;this.extra_base=ay;this.elems=ax;this.max_length=aA;this.has_stree=aB&&aB.length}var aj;var ag;var af;function ap(ax,ay){this.dyn_tree=ax;this.max_code=0;this.stat_desc=ay}function x(ax){return ax<256?e[ax]:e[256+(ax>>>7)]}function U(ax,ay){ax.pending_buf[ax.pending++]=(ay)&255;ax.pending_buf[ax.pending++]=(ay>>>8)&255}function ab(ay,az,ax){if(ay.bi_valid>(s-ax)){ay.bi_buf|=(az<<ay.bi_valid)&65535;U(ay,ay.bi_buf);ay.bi_buf=az>>(s-ay.bi_valid);ay.bi_valid+=ax-s}else{ay.bi_buf|=(az<<ay.bi_valid)&65535;ay.bi_valid+=ax}}function ac(ay,ax,az){ab(ay,az[ax*2],az[ax*2+1])}function o(ax,ay){var az=0;do{az|=ax&1;ax>>>=1;az<<=1}while(--ay>0);return az>>>1}function n(ax){if(ax.bi_valid===16){U(ax,ax.bi_buf);ax.bi_buf=0;ax.bi_valid=0}else{if(ax.bi_valid>=8){ax.pending_buf[ax.pending++]=ax.bi_buf&255;ax.bi_buf>>=8;ax.bi_valid-=8}}}function H(aJ,az){var aL=az.dyn_tree;var aF=az.max_code;var aK=az.stat_desc.static_tree;var aD=az.stat_desc.has_stree;var aA=az.stat_desc.extra_bits;var ax=az.stat_desc.extra_base;var aG=az.stat_desc.max_length;var aC;var aH,aE;var ay;var aM;var aB;var aI=0;for(ay=0;ay<=O;ay++){aJ.bl_count[ay]=0}aL[aJ.heap[aJ.heap_max]*2+1]=0;for(aC=aJ.heap_max+1;aC<J;aC++){aH=aJ.heap[aC];ay=aL[aL[aH*2+1]*2+1]+1;if(ay>aG){ay=aG;aI++}aL[aH*2+1]=ay;if(aH>aF){continue}aJ.bl_count[ay]++;aM=0;if(aH>=ax){aM=aA[aH-ax]}aB=aL[aH*2];aJ.opt_len+=aB*(ay+aM);if(aD){aJ.static_len+=aB*(aK[aH*2+1]+aM)}}if(aI===0){return}do{ay=aG-1;while(aJ.bl_count[ay]===0){ay--}aJ.bl_count[ay]--;aJ.bl_count[ay+1]+=2;aJ.bl_count[aG]--;aI-=2}while(aI>0);for(ay=aG;ay!==0;ay--){aH=aJ.bl_count[ay];while(aH!==0){aE=aJ.heap[--aC];if(aE>aF){continue}if(aL[aE*2+1]!==ay){aJ.opt_len+=(ay-aL[aE*2+1])*aL[aE*2];aL[aE*2+1]=ay}aH--}}}function I(aE,aB,ay){var aD=new Array(O+1);var az=0;var ax;var aC;for(ax=1;ax<=O;ax++){aD[ax]=az=(az+ay[ax-1])<<1}for(aC=0;aC<=aB;aC++){var aA=aE[aC*2+1];if(aA===0){continue}aE[aC*2]=o(aD[aA]++,aA)}}function ao(){var aC;var ax;var aB;var az;var aA;var ay=new Array(O+1);aB=0;for(az=0;az<M-1;az++){m[az]=aB;for(aC=0;aC<(1<<G[az]);aC++){f[aB++]=az}}f[aB-1]=az;aA=0;for(az=0;az<16;az++){l[az]=aA;for(aC=0;aC<(1<<F[az]);aC++){e[aA++]=az}}aA>>=7;for(;az<y;az++){l[az]=aA<<7;for(aC=0;aC<(1<<(F[az]-7));aC++){e[256+aA++]=az}}for(ax=0;ax<=O;ax++){ay[ax]=0}aC=0;while(aC<=143){ak[aC*2+1]=8;aC++;ay[8]++}while(aC<=255){ak[aC*2+1]=9;aC++;ay[9]++}while(aC<=279){ak[aC*2+1]=7;aC++;ay[7]++}while(aC<=287){ak[aC*2+1]=8;aC++;ay[8]++}I(ak,L+1,ay);for(aC=0;aC<y;aC++){ah[aC*2+1]=5;ah[aC*2]=o(aC,5)}aj=new am(ak,G,N+1,L,O);ag=new am(ah,F,0,y,O);af=new am(new Array(0),E,0,q,P)}function K(ay){var ax;for(ax=0;ax<L;ax++){ay.dyn_ltree[ax*2]=0}for(ax=0;ax<y;ax++){ay.dyn_dtree[ax*2]=0}for(ax=0;ax<q;ax++){ay.bl_tree[ax*2]=0}ay.dyn_ltree[C*2]=1;ay.opt_len=ay.static_len=0;ay.last_lit=ay.matches=0}function p(ax){if(ax.bi_valid>8){U(ax,ax.bi_buf)}else{if(ax.bi_valid>0){ax.pending_buf[ax.pending++]=ax.bi_buf}}ax.bi_buf=0;ax.bi_valid=0}function w(aA,ax,az,ay){p(aA);if(ay){U(aA,az);U(aA,~az)}aq.arraySet(aA.pending_buf,aA.window,ax,az,aA.pending);aA.pending+=az}function ae(aC,aB,aA,az){var ay=aB*2;var ax=aA*2;return(aC[ay]<aC[ax]||(aC[ay]===aC[ax]&&az[aB]<=az[aA]))}function T(az,aA,ay){var aB=az.heap[ay];var ax=ay<<1;while(ax<=az.heap_len){if(ax<az.heap_len&&ae(aA,az.heap[ax+1],az.heap[ax],az.depth)){ax++}if(ae(aA,aB,az.heap[ax],az.depth)){break}az.heap[ay]=az.heap[ax];ay=ax;ax<<=1}az.heap[ay]=aB}function v(aE,aC,az){var ay;var aB;var aD=0;var ax;var aA;if(aE.last_lit!==0){do{ay=(aE.pending_buf[aE.d_buf+aD*2]<<8)|(aE.pending_buf[aE.d_buf+aD*2+1]);aB=aE.pending_buf[aE.l_buf+aD];aD++;if(ay===0){ac(aE,aB,aC)}else{ax=f[aB];ac(aE,ax+N+1,aC);aA=G[ax];if(aA!==0){aB-=m[ax];ab(aE,aB,aA)}ay--;ax=x(ay);ac(aE,ax,az);aA=F[ax];if(aA!==0){ay-=l[ax];ab(aE,ay,aA)}}}while(aD<aE.last_lit)}ac(aE,C,aC)}function u(aE,ax){var aG=ax.dyn_tree;var aF=ax.stat_desc.static_tree;var az=ax.stat_desc.has_stree;var ay=ax.stat_desc.elems;var aC,aA;var aB=-1;var aD;aE.heap_len=0;aE.heap_max=J;for(aC=0;aC<ay;aC++){if(aG[aC*2]!==0){aE.heap[++aE.heap_len]=aB=aC;aE.depth[aC]=0}else{aG[aC*2+1]=0}}while(aE.heap_len<2){aD=aE.heap[++aE.heap_len]=(aB<2?++aB:0);aG[aD*2]=1;aE.depth[aD]=0;aE.opt_len--;if(az){aE.static_len-=aF[aD*2+1]}}ax.max_code=aB;for(aC=(aE.heap_len>>1);aC>=1;aC--){T(aE,aG,aC)}aD=ay;do{aC=aE.heap[1];aE.heap[1]=aE.heap[aE.heap_len--];T(aE,aG,1);aA=aE.heap[1];aE.heap[--aE.heap_max]=aC;aE.heap[--aE.heap_max]=aA;aG[aD*2]=aG[aC*2]+aG[aA*2];aE.depth[aD]=(aE.depth[aC]>=aE.depth[aA]?aE.depth[aC]:aE.depth[aA])+1;aG[aC*2+1]=aG[aA*2+1]=aD;aE.heap[1]=aD++;T(aE,aG,1)}while(aE.heap_len>=2);aE.heap[--aE.heap_max]=aE.heap[1];H(aE,ax);I(aG,aB,aE.bl_count)}function Z(aF,aG,az){var aC;var aE=-1;var ay;var aD=aG[0*2+1];var ax=0;var aA=7;var aB=4;if(aD===0){aA=138;aB=3}aG[(az+1)*2+1]=65535;for(aC=0;aC<=az;aC++){ay=aD;aD=aG[(aC+1)*2+1];if(++ax<aA&&ay===aD){continue}else{if(ax<aB){aF.bl_tree[ay*2]+=ax}else{if(ay!==0){if(ay!==aE){aF.bl_tree[ay*2]++}aF.bl_tree[V*2]++}else{if(ax<=10){aF.bl_tree[X*2]++}else{aF.bl_tree[W*2]++}}}}ax=0;aE=ay;if(aD===0){aA=138;aB=3}else{if(ay===aD){aA=6;aB=3}else{aA=7;aB=4}}}}function ad(aF,aG,az){var aC;var aE=-1;var ay;var aD=aG[0*2+1];var ax=0;var aA=7;var aB=4;if(aD===0){aA=138;aB=3}for(aC=0;aC<=az;aC++){ay=aD;aD=aG[(aC+1)*2+1];if(++ax<aA&&ay===aD){continue}else{if(ax<aB){do{ac(aF,ay,aF.bl_tree)}while(--ax!==0)}else{if(ay!==0){if(ay!==aE){ac(aF,ay,aF.bl_tree);ax--}ac(aF,V,aF.bl_tree);ab(aF,ax-3,2)}else{if(ax<=10){ac(aF,X,aF.bl_tree);ab(aF,ax-3,3)}else{ac(aF,W,aF.bl_tree);ab(aF,ax-11,7)}}}}ax=0;aE=ay;if(aD===0){aA=138;aB=3}else{if(ay===aD){aA=6;aB=3}else{aA=7;aB=4}}}}function t(ay){var ax;Z(ay,ay.dyn_ltree,ay.l_desc.max_code);Z(ay,ay.dyn_dtree,ay.d_desc.max_code);u(ay,ay.bl_desc);for(ax=q-1;ax>=3;ax--){if(ay.bl_tree[r[ax]*2+1]!==0){break}}ay.opt_len+=3*(ax+1)+5+5+4;return ax}function aa(aB,az,ay,ax){var aA;ab(aB,az-257,5);ab(aB,ay-1,5);ab(aB,ax-4,4);for(aA=0;aA<ax;aA++){ab(aB,aB.bl_tree[r[aA]*2+1],3)}ad(aB,aB.dyn_ltree,az-1);ad(aB,aB.dyn_dtree,ay-1)}function z(az){var ax=4093624447;var ay;for(ay=0;ay<=31;ay++,ax>>>=1){if((ax&1)&&(az.dyn_ltree[ay*2]!==0)){return ar}}if(az.dyn_ltree[9*2]!==0||az.dyn_ltree[10*2]!==0||az.dyn_ltree[13*2]!==0){return au}for(ay=32;ay<N;ay++){if(az.dyn_ltree[ay*2]!==0){return au}}return ar}var ai=false;function i(ax){if(!ai){ao();ai=true}ax.l_desc=new ap(ax.dyn_ltree,aj);ax.d_desc=new ap(ax.dyn_dtree,ag);ax.bl_desc=new ap(ax.bl_tree,af);ax.bi_buf=0;ax.bi_valid=0;K(ax)}function j(az,ax,aA,ay){ab(az,(an<<1)+(ay?1:0),3);w(az,ax,aA,true)}function g(ax){ab(ax,al<<1,3);ac(ax,C,ak);n(ax)}function h(aB,ax,aD,ay){var aA,aC;var az=0;if(aB.level>0){if(aB.strm.data_type===av){aB.strm.data_type=z(aB)}u(aB,aB.l_desc);u(aB,aB.d_desc);az=t(aB);aA=(aB.opt_len+3+7)>>>3;aC=(aB.static_len+3+7)>>>3;if(aC<=aA){aA=aC}}else{aA=aC=aD+5}if((aD+4<=aA)&&(ax!==-1)){j(aB,ax,aD,ay)}else{if(aB.strategy===at||aC===aA){ab(aB,(al<<1)+(ay?1:0),3);v(aB,ak,ah)}else{ab(aB,(B<<1)+(ay?1:0),3);aa(aB,aB.l_desc.max_code+1,aB.d_desc.max_code+1,az+1);v(aB,aB.dyn_ltree,aB.dyn_dtree)}}K(aB);if(ay){p(aB)}}function k(az,ax,ay){az.pending_buf[az.d_buf+az.last_lit*2]=(ax>>>8)&255;az.pending_buf[az.d_buf+az.last_lit*2+1]=ax&255;az.pending_buf[az.l_buf+az.last_lit]=ay&255;az.last_lit++;if(ax===0){az.dyn_ltree[ay*2]++}else{az.matches++;ax--;az.dyn_ltree[(f[ay]+N+1)*2]++;az.dyn_dtree[x(ax)*2]++}return(az.last_lit===az.lit_bufsize-1)}D._tr_init=i;D._tr_stored_block=j;D._tr_flush_block=h;D._tr_tally=k;D._tr_align=g},{"../utils/common":1}],8:[function(g,f,e){function h(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}f.exports=h},{}],"/lib/deflate.js":[function(l,j,h){var x=l("./zlib/deflate");var o=l("./utils/common");var m=l("./utils/strings");var k=l("./zlib/messages");var y=l("./zlib/zstream");var n=Object.prototype.toString;var t=0;var s=4;var u=0;var v=1;var w=2;var p=-1;var q=0;var r=8;function f(B){if(!(this instanceof f)){return new f(B)}this.options=o.assign({level:p,method:r,chunkSize:16384,windowBits:15,memLevel:8,strategy:q,to:""},B||{});var A=this.options;if(A.raw&&(A.windowBits>0)){A.windowBits=-A.windowBits}else{if(A.gzip&&(A.windowBits>0)&&(A.windowBits<16)){A.windowBits+=16}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new y();this.strm.avail_out=0;var C=x.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(C!==u){throw new Error(k[C])}if(A.header){x.deflateSetHeader(this.strm,A.header)}if(A.dictionary){var z;if(typeof A.dictionary==="string"){z=m.string2buf(A.dictionary)}else{if(n.call(A.dictionary)==="[object ArrayBuffer]"){z=new Uint8Array(A.dictionary)}else{z=A.dictionary}}C=x.deflateSetDictionary(this.strm,z);if(C!==u){throw new Error(k[C])}this._dict_set=true}}f.prototype.push=function(B,C){var E=this.strm;var A=this.options.chunkSize;var D,z;if(this.ended){return false}z=(C===~~C)?C:((C===true)?s:t);if(typeof B==="string"){E.input=m.string2buf(B)}else{if(n.call(B)==="[object ArrayBuffer]"){E.input=new Uint8Array(B)}else{E.input=B}}E.next_in=0;E.avail_in=E.input.length;do{if(E.avail_out===0){E.output=new o.Buf8(A);E.next_out=0;E.avail_out=A}D=x.deflate(E,z);if(D!==v&&D!==u){this.onEnd(D);this.ended=true;return false}if(E.avail_out===0||(E.avail_in===0&&(z===s||z===w))){if(this.options.to==="string"){this.onData(m.buf2binstring(o.shrinkBuf(E.output,E.next_out)))}else{this.onData(o.shrinkBuf(E.output,E.next_out))}}}while((E.avail_in>0||E.avail_out===0)&&D!==v);if(z===s){D=x.deflateEnd(this.strm);this.onEnd(D);this.ended=true;return D===u}if(z===w){this.onEnd(u);E.avail_out=0;return true}return true};f.prototype.onData=function(z){this.chunks.push(z)};f.prototype.onEnd=function(z){if(z===u){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=o.flattenChunks(this.chunks)}}this.chunks=[];this.err=z;this.msg=this.strm.msg};function e(A,B){var z=new f(B);z.push(A,true);if(z.err){throw z.msg||k[z.err]}return z.result}function g(z,A){A=A||{};A.raw=true;return e(z,A)}function i(z,A){A=A||{};A.gzip=true;return e(z,A)}h.Deflate=f;h.deflate=e;h.deflateRaw=g;h.gzip=i},{"./utils/common":1,"./utils/strings":2,"./zlib/deflate":5,"./zlib/messages":6,"./zlib/zstream":8}]},{},[])("/lib/deflate.js")});(function(){var b=false;window.JQClass=function(){};JQClass.classes={};JQClass.extend=function a(f){var c=this.prototype;b=true;var g=new this();b=false;for(var e in f){g[e]=typeof f[e]=="function"&&typeof c[e]=="function"?(function(i,h){return function(){var j=this._super;this._super=function(l){return c[i].apply(this,l||[])};var k=h.apply(this,arguments);this._super=j;return k}})(e,f[e]):f[e]}function d(){if(!b&&this._init){this._init.apply(this,arguments)}}d.prototype=g;d.prototype.constructor=d;d.extend=a;return d}})();(function($){JQClass.classes.JQPlugin=JQClass.extend({name:"plugin",defaultOptions:{},regionalOptions:{},_getters:[],_getMarker:function(){return"is-"+this.name},_init:function(){$.extend(this.defaultOptions,(this.regionalOptions&&this.regionalOptions[""])||{});var jqName=camelCase(this.name);$[jqName]=this;$.fn[jqName]=function(options){var otherArgs=Array.prototype.slice.call(arguments,1);if($[jqName]._isNotChained(options,otherArgs)){return $[jqName][options].apply($[jqName],[this[0]].concat(otherArgs))}return this.each(function(){if(typeof options==="string"){if(options[0]==="_"||!$[jqName][options]){throw"Unknown method: "+options}$[jqName][options].apply($[jqName],[this].concat(otherArgs))}else{$[jqName]._attach(this,options)}})}},setDefaults:function(options){$.extend(this.defaultOptions,options||{})},_isNotChained:function(name,otherArgs){if(name==="option"&&(otherArgs.length===0||(otherArgs.length===1&&typeof otherArgs[0]==="string"))){return true}return $.inArray(name,this._getters)>-1},_attach:function(elem,options){elem=$(elem);if(elem.hasClass(this._getMarker())){return}elem.addClass(this._getMarker());options=$.extend({},this.defaultOptions,this._getMetadata(elem),options||{});var inst=$.extend({name:this.name,elem:elem,options:options},this._instSettings(elem,options));elem.data(this.name,inst);this._postAttach(elem,inst);this.option(elem,options)},_instSettings:function(elem,options){return{}},_postAttach:function(elem,inst){},_getMetadata:function(elem){try{var data=elem.data(this.name.toLowerCase())||"";data=data.replace(/'/g,'"');data=data.replace(/([a-zA-Z0-9]+):/g,function(match,group,i){var count=data.substring(0,i).match(/"/g);return(!count||count.length%2===0?'"'+group+'":':group+":")});data=$.parseJSON("{"+data+"}");for(var name in data){var value=data[name];if(typeof value==="string"&&value.match(/^new Date\((.*)\)$/)){data[name]=eval(value)}}return data}catch(e){return{}}},_getInst:function(elem){return $(elem).data(this.name)||{}},option:function(elem,name,value){elem=$(elem);var inst=elem.data(this.name);if(!name||(typeof name==="string"&&value==null)){var options=(inst||{}).options;return(options&&name?options[name]:options)}if(!elem.hasClass(this._getMarker())){return}var options=name||{};if(typeof name==="string"){options={};options[name]=value}this._optionsChanged(elem,inst,options);$.extend(inst.options,options)},_optionsChanged:function(elem,inst,options){},destroy:function(elem){elem=$(elem);if(!elem.hasClass(this._getMarker())){return}this._preDestroy(elem,this._getInst(elem));elem.removeData(this.name).removeClass(this._getMarker())},_preDestroy:function(elem,inst){}});function camelCase(name){return name.replace(/-([a-z])/g,function(match,group){return group.toUpperCase()})}$.JQPlugin={createPlugin:function(superClass,overrides){if(typeof superClass==="object"){overrides=superClass;superClass="JQPlugin"}superClass=camelCase(superClass);var className=camelCase(overrides.name);JQClass.classes[className]=JQClass.classes[superClass].extend(overrides);new JQClass.classes[className]()}}})(jQuery);(function(a){var d="keypad";var b=["  BSCECA","_1_2_3_+@X","_4_5_6_-@U","_7_8_9_*@E","_0_._=_/"];a.JQPlugin.createPlugin({name:d,defaultOptions:{showOn:"focus",buttonImage:"",buttonImageOnly:false,showAnim:"show",showOptions:null,duration:"normal",appendText:"",useThemeRoller:false,keypadClass:"",prompt:"",layout:[],separator:"",target:null,keypadOnly:true,randomiseAlphabetic:false,randomiseNumeric:false,randomiseOther:false,randomiseAll:false,beforeShow:null,onKeypress:null,onClose:null},regionalOptions:{"":{buttonText:"...",buttonStatus:"Open the keypad",closeText:"Close",closeStatus:"Close the keypad",clearText:"Clear",clearStatus:"Erase all the text",backText:"Back",backStatus:"Erase the previous character",spacebarText:"&nbsp;",spacebarStatus:"Space",enterText:"Enter",enterStatus:"Carriage return",tabText:"?",tabStatus:"Horizontal tab",shiftText:"Shift",shiftStatus:"Toggle upper/lower case characters",alphabeticLayout:[],fullLayout:[],isAlphabetic:null,isNumeric:null,toUpper:null,isRTL:false}},_getters:["isDisabled"],_curInst:null,_disabledFields:[],_keypadShowing:false,_keyCode:0,_specialKeys:[],_mainDivClass:d+"-popup",_inlineClass:d+"-inline",_appendClass:d+"-append",_triggerClass:d+"-trigger",_disableClass:d+"-disabled",_inlineEntryClass:d+"-keyentry",_rtlClass:d+"-rtl",_rowClass:d+"-row",_promptClass:d+"-prompt",_specialClass:d+"-special",_namePrefixClass:d+"-",_keyClass:d+"-key",_keyDownClass:d+"-key-down",qwertyAlphabetic:["qwertyuiop","asdfghjkl","zxcvbnm"],qwertyLayout:["!@#$%^&*()_="+this.HALF_SPACE+this.SPACE+this.CLOSE,this.HALF_SPACE+"`~[]{}<>\\|/"+this.SPACE+"789","qwertyuiop'\""+this.HALF_SPACE+"456",this.HALF_SPACE+"asdfghjkl;:"+this.SPACE+"123",this.SPACE+"zxcvbnm,.?"+this.SPACE+this.HALF_SPACE+"-0+",""+this.TAB+this.ENTER+this.SPACE_BAR+this.SHIFT+this.HALF_SPACE+this.BACK+this.CLEAR],addKeyDef:function(f,g,e,h){if(this._keyCode==32){throw"Only 32 special keys allowed"}this[f]=String.fromCharCode(this._keyCode++);this._specialKeys.push({code:this[f],id:f,name:g,action:e,noHighlight:h});return this},_init:function(){this.mainDiv=a('<div class="'+this._mainDivClass+'" style="display: none;"></div>');this._super()},_instSettings:function(e,g){var f=!e[0].nodeName.toLowerCase().match(/input|textarea/);return{_inline:f,ucase:false,_mainDiv:(f?a('<div class="'+this._inlineClass+'"></div>'):c.mainDiv)}},_postAttach:function(e,f){if(f._inline){e.append(f._mainDiv).on("click."+f.name,function(){f._input.focus()});this._updateKeypad(f)}else{if(e.is(":disabled")){this.disable(e)}}},_setInput:function(e,f){f._input=a(!f._inline?e:f.options.target||'<input type="text" class="'+this._inlineEntryClass+'" disabled/>');if(f._inline){e.find("input").remove();if(!f.options.target){e.append(f._input)}}},_optionsChanged:function(h,i,j){a.extend(i.options,j);h.off("."+i.name).siblings("."+this._appendClass).remove().end().siblings("."+this._triggerClass).remove();var e=i.options.appendText;if(e){h[i.options.isRTL?"before":"after"]('<span class="'+this._appendClass+'">'+e+"</span>")}if(!i._inline){if(i.options.showOn=="focus"||i.options.showOn=="both"){h.on("focus."+i.name,this.show).on("keydown."+i.name,this._doKeyDown)}if(i.options.showOn=="button"||i.options.showOn=="both"){var g=i.options.buttonStatus;var f=i.options.buttonImage;var k=a(i.options.buttonImageOnly?a('<img src="'+f+'" alt="'+g+'" title="'+g+'"/>'):a('<button type="button" title="'+g+'"></button>').html(f==""?i.options.buttonText:a('<img src="'+f+'" alt="'+g+'" title="'+g+'"/>')));h[i.options.isRTL?"before":"after"](k);k.addClass(this._triggerClass).click(function(){if(c._keypadShowing&&c._lastField==h[0]){c.hide()}else{c.show(h[0])}return false})}}i.saveReadonly=h.attr("readonly");h[i.options.keypadOnly?"attr":"removeAttr"]("readonly",true).on("setData."+i.name,function(l,m,n){i.options[m]=n}).on("getData."+i.name,function(l,m){return i.options[m]});this._setInput(h,i);this._updateKeypad(i)},_preDestroy:function(e,f){if(this._curInst==f){this.hide()}e.siblings("."+this._appendClass).remove().end().siblings("."+this._triggerClass).remove().end().prev("."+this._inlineEntryClass).remove();e.empty().off("."+f.name)[f.saveReadonly?"attr":"removeAttr"]("readonly",true);f._input.removeData(f.name)},enable:function(e){e=a(e);if(!e.hasClass(this._getMarker())){return}var f=e[0].nodeName.toLowerCase();if(f.match(/input|textarea/)){e.prop("disabled",false).siblings("button."+this._triggerClass).prop("disabled",false).end().siblings("img."+this._triggerClass).css({opacity:"1.0",cursor:""})}else{if(f.match(/div|span/)){e.children("."+this._disableClass).remove();this._getInst(e)._mainDiv.find("button").prop("disabled",false)}}this._disabledFields=a.map(this._disabledFields,function(g){return(g==e[0]?null:g)})},disable:function(e){e=a(e);if(!e.hasClass(this._getMarker())){return}var g=e[0].nodeName.toLowerCase();if(g.match(/input|textarea/)){e.prop("disabled",true).siblings("button."+this._triggerClass).prop("disabled",true).end().siblings("img."+this._triggerClass).css({opacity:"0.5",cursor:"default"})}else{if(g.match(/div|span/)){var f=e.children("."+this._inlineClass);var h=f.offset();var i={left:0,top:0};f.parents().each(function(){if(a(this).css("position")=="relative"){i=a(this).offset();return false}});e.prepend('<div class="'+this._disableClass+'" style="width: '+f.outerWidth()+"px; height: "+f.outerHeight()+"px; left: "+(h.left-i.left)+"px; top: "+(h.top-i.top)+'px;"></div>');this._getInst(e)._mainDiv.find("button").prop("disabled",true)}}this._disabledFields=a.map(this._disabledFields,function(j){return(j==e[0]?null:j)});this._disabledFields[this._disabledFields.length]=e[0]},isDisabled:function(e){return(e&&a.inArray(e,this._disabledFields)>-1)},show:function(g){g=g.target||g;if(c.isDisabled(g)||c._lastField==g){return}var h=c._getInst(g);c.hide(null,"");c._lastField=g;c._pos=c._findPos(g);c._pos[1]+=g.offsetHeight;var i=false;a(g).parents().each(function(){i|=a(this).css("position")=="fixed";return !i});var k={left:c._pos[0],top:c._pos[1]};c._pos=null;h._mainDiv.css({position:"absolute",display:"block",top:"-1000px",width:"auto"});c._updateKeypad(h);k=c._checkOffset(h,k,i);h._mainDiv.css({position:(i?"fixed":"absolute"),display:"none",left:k.left+"px",top:k.top+"px"});var f=h.options.duration;var m=h.options.showAnim;var l=function(){c._keypadShowing=true};if(a.effects&&(a.effects[m]||(a.effects.effect&&a.effects.effect[m]))){var e=h._mainDiv.data();for(var j in e){if(j.match(/^ec\.storage\./)){e[j]=h._mainDiv.css(j.replace(/ec\.storage\./,""))}}h._mainDiv.data(e).show(m,h.options.showOptions||{},f,l)}else{h._mainDiv[m||"show"]((m?f:0),l)}if(h._input[0].type!="hidden"){h._input[0].focus()}c._curInst=h},_updateKeypad:function(f){var e=this._getBorders(f._mainDiv);f._mainDiv.empty().append(this._generateHTML(f)).removeClass().addClass(f.options.keypadClass+(f.options.useThemeRoller?" ui-widget ui-widget-content":"")+(f.options.isRTL?" "+this._rtlClass:"")+" "+(f._inline?this._inlineClass:this._mainDivClass));if(a.isFunction(f.options.beforeShow)){f.options.beforeShow.apply((f._input?f._input[0]:null),[f._mainDiv,f])}},_getBorders:function(f){var e=function(g){return{thin:1,medium:3,thick:5}[g]||g};return[parseFloat(e(f.css("border-left-width"))),parseFloat(e(f.css("border-top-width")))]},_checkOffset:function(g,i,h){var j=g._input?this._findPos(g._input[0]):null;var f=window.innerWidth||document.documentElement.clientWidth;var e=window.innerHeight||document.documentElement.clientHeight;var k=document.documentElement.scrollLeft||document.body.scrollLeft;var l=document.documentElement.scrollTop||document.body.scrollTop;var m=0;g._mainDiv.find(":not(div)").each(function(){m=Math.max(m,this.offsetLeft+a(this).outerWidth(true))});g._mainDiv.css("width",m+1);if(g.options.isRTL||(i.left+g._mainDiv.outerWidth()-k)>f){i.left=Math.max((h?0:k),j[0]+(g._input?g._input.outerWidth():0)-(h?k:0)-g._mainDiv.outerWidth())}else{i.left=Math.max((h?0:k),i.left-(h?k:0))}if((i.top+g._mainDiv.outerHeight()-l)>e){i.top=Math.max((h?0:l),j[1]-(h?l:0)-g._mainDiv.outerHeight())}else{i.top=Math.max((h?0:l),i.top-(h?l:0))}return i},_findPos:function(e){while(e&&(e.type=="hidden"||e.nodeType!=1)){e=e.nextSibling}var f=a(e).offset();return[f.left,f.top]},hide:function(f,e){var g=this._curInst;if(!g||(f&&g!=a.data(f,this.propertyName))){return}if(this._keypadShowing){e=(e!=null?e:g.options.duration);var h=g.options.showAnim;if(a.effects&&(a.effects[h]||(a.effects.effect&&a.effects.effect[h]))){g._mainDiv.hide(h,g.options.showOptions||{},e)}else{g._mainDiv[(h=="slideDown"?"slideUp":(h=="fadeIn"?"fadeOut":"hide"))](h?e:0)}}if(a.isFunction(g.options.onClose)){g.options.onClose.apply((g._input?g._input[0]:null),[g._input.val(),g])}if(this._keypadShowing){this._keypadShowing=false;this._lastField=null}if(g._inline){g._input.val("")}this._curInst=null},_doKeyDown:function(e){if(e.keyCode==9){c.mainDiv.stop(true,true);c.hide()}},_checkExternalClick:function(e){if(!c._curInst){return}var f=a(e.target);if(f.closest("."+c._mainDivClass).length===0&&!f.hasClass(c._getMarker())&&f.closest("."+c._triggerClass).length===0&&c._keypadShowing){c.hide()}},_shiftKeypad:function(e){e.ucase=!e.ucase;this._updateKeypad(e);e._input.focus()},_clearValue:function(e){this._setValue(e,"",0);this._notifyKeypress(e,c.DEL)},_backValue:function(f){var e=f._input[0];var h=f._input.val();var g=[h.length,h.length];g=(f._input.prop("readonly")||f._input.prop("disabled")?g:(e.setSelectionRange?[e.selectionStart,e.selectionEnd]:(e.createTextRange?this._getIERange(e):g)));this._setValue(f,(h.length==0?"":h.substr(0,g[0]-1)+h.substr(g[1])),g[0]-1);this._notifyKeypress(f,c.BS)},_selectValue:function(e,f){this.insertValue(e._input[0],f);this._setValue(e,e._input.val());this._notifyKeypress(e,f)},insertValue:function(f,i){f=(f.jquery?f:a(f));var e=f[0];var g=f.val();var h=[g.length,g.length];h=(f.attr("readonly")||f.attr("disabled")?h:(e.setSelectionRange?[e.selectionStart,e.selectionEnd]:(e.createTextRange?this._getIERange(e):h)));f.val(g.substr(0,h[0])+i+g.substr(h[1]));pos=h[0]+i.length;if(f.is(":visible")){f.focus()}if(e.setSelectionRange){if(f.is(":visible")){e.setSelectionRange(pos,pos)}}else{if(e.createTextRange){h=e.createTextRange();h.move("character",pos);h.select()}}},_getIERange:function(h){h.focus();var i=document.selection.createRange().duplicate();var e=this._getIETextRange(h);e.setEndPoint("EndToStart",i);var g=function(m){var l=m.text;var n=l;var k=false;while(true){if(m.compareEndPoints("StartToEnd",m)==0){break}else{m.moveEnd("character",-1);if(m.text==l){n+="\r\n"}else{break}}}return n};var f=g(e);var j=g(i);return[f.length,f.length+j.length]},_getIETextRange:function(e){var f=(e.nodeName.toLowerCase()=="input");var g=(f?e.createTextRange():document.body.createTextRange());if(!f){g.moveToElementText(e)}return g},_setValue:function(e,g){var f=e._input.attr("maxlength");if(f>-1){g=g.substr(0,f)}e._input.val(g);if(!a.isFunction(e.options.onKeypress)){e._input.trigger("change")}},_notifyKeypress:function(e,f){if(a.isFunction(e.options.onKeypress)){e.options.onKeypress.apply((e._input?e._input[0]:null),[f,e._input.val(),e])}},_generateHTML:function(h){var f=(!h.options.prompt?"":'<div class="'+this._promptClass+(h.options.useThemeRoller?" ui-widget-header ui-corner-all":"")+'">'+h.options.prompt+"</div>");var n=this._randomiseLayout(h);for(var g=0;g<n.length;g++){f+='<div class="'+this._rowClass+'">';var m=n[g].split(h.options.separator);for(var k=0;k<m.length;k++){if(h.ucase){m[k]=h.options.toUpper(m[k])}var l=this._specialKeys[m[k].charCodeAt(0)];if(l){f+=(l.action?'<button type="button" class="'+this._specialClass+" "+this._namePrefixClass+l.name+(h.options.useThemeRoller?" ui-corner-all ui-state-default"+(l.noHighlight?"":" ui-state-highlight"):"")+'" title="'+h.options[l.name+"Status"]+'">'+(h.options[l.name+"Text"]||"&nbsp;")+"</button>":'<div class="'+this._namePrefixClass+l.name+'"></div>')}else{f+='<button type="button" class="'+this._keyClass+(h.options.useThemeRoller?" ui-corner-all ui-state-default":"")+'">'+(m[k]==" "?"&nbsp;":m[k])+"</button>"}}f+="</div>"}f=a(f);var o=h;var e=this._keyDownClass+(h.options.useThemeRoller?" ui-state-active":"");f.find("button").mousedown(function(){a(this).addClass(e)}).mouseup(function(){a(this).removeClass(e)}).mouseout(function(){a(this).removeClass(e)}).filter("."+this._keyClass).click(function(){c._selectValue(o,a(this).text())});a.each(this._specialKeys,function(j,p){f.find("."+c._namePrefixClass+p.name).click(function(){p.action.apply(o._input,[o])})});return f},_randomiseLayout:function(h){if(!h.options.randomiseNumeric&&!h.options.randomiseAlphabetic&&!h.options.randomiseOther&&!h.options.randomiseAll){return h.options.layout}var q=[];var f=[];var s=[];var p=[];for(var g=0;g<h.options.layout.length;g++){p[g]="";var l=h.options.layout[g].split(h.options.separator);for(var k=0;k<l.length;k++){if(this._isControl(l[k])){continue}if(h.options.randomiseAll){s.push(l[k])}else{if(h.options.isNumeric(l[k])){q.push(l[k])}else{if(h.options.isAlphabetic(l[k])){f.push(l[k])}else{s.push(l[k])}}}}}if(h.options.randomiseNumeric){this._shuffle(q)}if(h.options.randomiseAlphabetic){this._shuffle(f)}if(h.options.randomiseOther||h.options.randomiseAll){this._shuffle(s)}var m=0;var e=0;var r=0;for(var g=0;g<h.options.layout.length;g++){var l=h.options.layout[g].split(h.options.separator);for(var k=0;k<l.length;k++){p[g]+=(this._isControl(l[k])?l[k]:(h.options.randomiseAll?s[r++]:(h.options.isNumeric(l[k])?q[m++]:(h.options.isAlphabetic(l[k])?f[e++]:s[r++]))))+h.options.separator}}return p},_isControl:function(e){return e<" "},isAlphabetic:function(e){return(e>="A"&&e<="Z")||(e>="a"&&e<="z")},isNumeric:function(e){return(e>="0"&&e<="9")},toUpper:function(e){return e.toUpperCase()},_shuffle:function(h){for(var f=h.length-1;f>0;f--){var g=Math.floor(Math.random()*h.length);var e=h[f];h[f]=h[g];h[g]=e}}});var c=a.keypad;c.addKeyDef("CLOSE","close",function(e){c._curInst=(e._inline?e:c._curInst);c.hide()});c.addKeyDef("CLEAR","clear",function(e){c._clearValue(e)});c.addKeyDef("BACK","back",function(e){c._backValue(e)});c.addKeyDef("SHIFT","shift",function(e){c._shiftKeypad(e)});c.addKeyDef("SPACE_BAR","spacebar",function(e){c._selectValue(e," ")},true);c.addKeyDef("SPACE","space");c.addKeyDef("HALF_SPACE","half-space");c.addKeyDef("ENTER","enter",function(e){c._selectValue(e,"\x0D")},true);c.addKeyDef("TAB","tab",function(e){c._selectValue(e,"\x09")},true);c.numericLayout=["123"+c.CLOSE,"456"+c.CLEAR,"789"+c.BACK,c.SPACE+"0"];c.qwertyLayout=["!@#$%^&*()_="+c.HALF_SPACE+c.SPACE+c.CLOSE,c.HALF_SPACE+"`~[]{}<>\\|/"+c.SPACE+"789","qwertyuiop'\""+c.HALF_SPACE+"456",c.HALF_SPACE+"asdfghjkl;:"+c.SPACE+"123",c.SPACE+"zxcvbnm,.?"+c.SPACE+c.HALF_SPACE+"-0+",""+c.TAB+c.ENTER+c.SPACE_BAR+c.SHIFT+c.HALF_SPACE+c.BACK+c.CLEAR],a.extend(c.regionalOptions[""],{alphabeticLayout:c.qwertyAlphabetic,fullLayout:c.qwertyLayout,isAlphabetic:c.isAlphabetic,isNumeric:c.isNumeric,toUpper:c.toUpper});c.setDefaults(a.extend({layout:c.numericLayout},c.regionalOptions[""]));a(function(){a(document.body).append(c.mainDiv).mousedown(c._checkExternalClick)})})(jQuery);!function(a){var c=(function(){var f=[];var d=false;var h;var g=function(i){clearTimeout(h);h=setTimeout(e,100)};var e=function(){for(var k=0,j=f.length;k<j;k++){f[k].apply()}};return{register:function(i){f.push(i);if(d===false){a(window).bind("resize",g);d=true}},unregister:function(k){for(var l=0,j=f.length;l<j;l++){if(f[l]==k){delete f[l];break}}}}}());var b=function(d,e){this.element=a(d);this.dropdown=a('<li class="dropdown hide pull-right tabdrop"><a class="dropdown-toggle" data-toggle="dropdown" href="#">'+e.text+' <b class="caret"></b></a><ul class="dropdown-menu tab-drop-dropdown-menu"></ul></li>').prependTo(this.element);if(this.element.parent().is(".tabs-below")){this.dropdown.addClass("dropup")}c.register(a.proxy(this.layout,this));this.layout()};b.prototype={constructor:b,layout:function(){var d=[];this.dropdown.removeClass("hide");this.element.append(this.dropdown.find("li")).find(">li").not(".tabdrop").each(function(){if(this.offsetTop>0){d.push(this)}});if(d.length>0){d=a(d);this.dropdown.find("ul").empty().append(d);if(this.dropdown.find(".active").length==1){this.dropdown.addClass("active")}else{this.dropdown.removeClass("active")}}else{this.dropdown.addClass("hide")}}};a.fn.tabdrop=function(d){return this.each(function(){var e=a(this),f=e.data("tabdrop"),g=typeof d==="object"&&d;if(!f){e.data("tabdrop",(f=new b(this,a.extend({},a.fn.tabdrop.defaults,g))))}if(typeof d=="string"){f[d]()}})};a.fn.tabdrop.defaults={text:'<i class="icon-align-justify"></i>'};a.fn.tabdrop.Constructor=b}(window.jQuery);(function(b,a){if(typeof define!=="undefined"&&define.amd){define("canvgModule",["rgbcolor","stackblur"],a)}else{if(typeof module!=="undefined"&&module.exports){module.exports=a(require("rgbcolor"),require("stackblur"))}}b.canvg=a(b.RGBColor,b.stackBlur)}(typeof window!=="undefined"?window:this,function(m,n){var c=function(y,u,t){if(y==null&&u==null&&t==null){var x=document.querySelectorAll("svg");for(var r=0;r<x.length;r++){var w=x[r];var o=document.createElement("canvas");o.width=w.clientWidth;o.height=w.clientHeight;w.parentNode.insertBefore(o,w);w.parentNode.removeChild(w);var q=document.createElement("div");q.appendChild(w);c(o,q.innerHTML)}return}if(typeof y=="string"){y=document.getElementById(y)}if(y.svg!=null){y.svg.stop()}var v=b(t||{});if(!(y.childNodes.length==1&&y.childNodes[0].nodeName=="OBJECT")){y.svg=v}var p=y.getContext("2d");if(typeof u.documentElement!="undefined"){v.loadXmlDoc(p,u)}else{if(u.substr(0,1)=="<"){v.loadXml(p,u)}else{v.load(p,u)}}};var h;if(typeof Element.prototype.matches!="undefined"){h=function(o,p){return o.matches(p)}}else{if(typeof Element.prototype.webkitMatchesSelector!="undefined"){h=function(o,p){return o.webkitMatchesSelector(p)}}else{if(typeof Element.prototype.mozMatchesSelector!="undefined"){h=function(o,p){return o.mozMatchesSelector(p)}}else{if(typeof Element.prototype.msMatchesSelector!="undefined"){h=function(o,p){return o.msMatchesSelector(p)}}else{if(typeof Element.prototype.oMatchesSelector!="undefined"){h=function(o,p){return o.oMatchesSelector(p)}}else{if(typeof jQuery==="function"||typeof Zepto==="function"){h=function(o,p){return $(o).is(p)}}if(typeof h==="undefined"){h=Sizzle.matchesSelector}}}}}}var a=/(\[[^\]]+\])/g;var g=/(#[^\s\+>~\.\[:]+)/g;var d=/(\.[^\s\+>~\.\[:]+)/g;var l=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi;var k=/(:[\w-]+\([^\)]*\))/gi;var j=/(:[^\s\+>~\.\[:]+)/g;var e=/([^\s\+>~\.\[:]+)/g;function f(p){var q=[0,0,0];var o=function(s,t){var r=p.match(s);if(r==null){return}q[t]+=r.length;p=p.replace(s," ")};p=p.replace(/:not\(([^\)]*)\)/g,"     $1 ");p=p.replace(/{[\s\S]*/gm," ");o(a,1);o(g,0);o(d,1);o(l,2);o(k,1);o(j,1);p=p.replace(/[\*\s\+>~]/g," ");p=p.replace(/[#\.]/g," ");o(e,2);return q.join("")}function b(o){var p={opts:o};p.FRAMERATE=30;p.MAX_VIRTUAL_PIXELS=30000;p.log=function(r){};if(p.opts.log==true&&typeof console!="undefined"){p.log=function(r){console.log(r)}}p.init=function(r){var s=0;p.UniqueId=function(){s++;return"canvg"+s};p.Definitions={};p.Styles={};p.StylesSpecificity={};p.Animations=[];p.Images=[];p.ctx=r;p.ViewPort=new (function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[]};this.SetCurrent=function(u,t){this.viewPorts.push({width:u,height:t})};this.RemoveCurrent=function(){this.viewPorts.pop()};this.Current=function(){return this.viewPorts[this.viewPorts.length-1]};this.width=function(){return this.Current().width};this.height=function(){return this.Current().height};this.ComputeSize=function(t){if(t!=null&&typeof t=="number"){return t}if(t=="x"){return this.width()}if(t=="y"){return this.height()}return Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}})};p.init();p.ImagesLoaded=function(){for(var r=0;r<p.Images.length;r++){if(!p.Images[r].loaded){return false}}return true};p.trim=function(r){return r.replace(/^\s+|\s+$/g,"")};p.compressSpaces=function(r){return r.replace(/[\s\r\t\n]+/gm," ")};p.ajax=function(s){var r;if(window.XMLHttpRequest){r=new XMLHttpRequest()}else{r=new ActiveXObject("Microsoft.XMLHTTP")}if(r){r.open("GET",s,false);r.send(null);return r.responseText}return null};p.parseXml=function(u){if(typeof Windows!="undefined"&&typeof Windows.Data!="undefined"&&typeof Windows.Data.Xml!="undefined"){var v=new Windows.Data.Xml.Dom.XmlDocument();var t=new Windows.Data.Xml.Dom.XmlLoadSettings();t.prohibitDtd=false;v.loadXml(u,t);return v}else{if(window.DOMParser){try{var s=new DOMParser();return s.parseFromString(u,"image/svg+xml")}catch(r){s=new DOMParser();return s.parseFromString(u,"text/xml")}}else{u=u.replace(/<!DOCTYPE svg[^>]*>/,"");var v=new ActiveXObject("Microsoft.XMLDOM");v.async="false";v.loadXML(u);return v}}};p.Property=function(r,s){this.name=r;this.value=s};p.Property.prototype.getValue=function(){return this.value};p.Property.prototype.hasValue=function(){return(this.value!=null&&this.value!=="")};p.Property.prototype.numValue=function(){if(!this.hasValue()){return 0}var r=parseFloat(this.value);if((this.value+"").match(/%$/)){r=r/100}return r};p.Property.prototype.valueOrDefault=function(r){if(this.hasValue()){return this.value}return r};p.Property.prototype.numValueOrDefault=function(r){if(this.hasValue()){return this.numValue()}return r};p.Property.prototype.addOpacity=function(t){var s=this.value;if(t.value!=null&&t.value!=""&&typeof this.value=="string"){var r=new m(this.value);if(r.ok){s="rgba("+r.r+", "+r.g+", "+r.b+", "+t.numValue()+")"}}return new p.Property(this.name,s)};p.Property.prototype.getDefinition=function(){var r=this.value.match(/#([^\)'"]+)/);if(r){r=r[1]}if(!r){r=this.value}return p.Definitions[r]};p.Property.prototype.isUrlDefinition=function(){return this.value.indexOf("url(")==0};p.Property.prototype.getFillStyleDefinition=function(s,t){var r=this.getDefinition();if(r!=null&&r.createGradient){return r.createGradient(p.ctx,s,t)}if(r!=null&&r.createPattern){if(r.getHrefAttribute().hasValue()){var u=r.attribute("patternTransform");r=r.getHrefAttribute().getDefinition();if(u.hasValue()){r.attribute("patternTransform",true).value=u.value}}return r.createPattern(p.ctx,s)}return null};p.Property.prototype.getDPI=function(r){return 96};p.Property.prototype.getEM=function(t){var r=12;var s=new p.Property("fontSize",p.Font.Parse(p.ctx.font).fontSize);if(s.hasValue()){r=s.toPixels(t)}return r};p.Property.prototype.getUnits=function(){var r=this.value+"";return r.replace(/[0-9\.\-]/g,"")};p.Property.prototype.toPixels=function(v,t){if(!this.hasValue()){return 0}var u=this.value+"";if(u.match(/em$/)){return this.numValue()*this.getEM(v)}if(u.match(/ex$/)){return this.numValue()*this.getEM(v)/2}if(u.match(/px$/)){return this.numValue()}if(u.match(/pt$/)){return this.numValue()*this.getDPI(v)*(1/72)}if(u.match(/pc$/)){return this.numValue()*15}if(u.match(/cm$/)){return this.numValue()*this.getDPI(v)/2.54}if(u.match(/mm$/)){return this.numValue()*this.getDPI(v)/25.4}if(u.match(/in$/)){return this.numValue()*this.getDPI(v)}if(u.match(/%$/)){return this.numValue()*p.ViewPort.ComputeSize(v)}var r=this.numValue();if(t&&r<1){return r*p.ViewPort.ComputeSize(v)}return r};p.Property.prototype.toMilliseconds=function(){if(!this.hasValue()){return 0}var r=this.value+"";if(r.match(/s$/)){return this.numValue()*1000}if(r.match(/ms$/)){return this.numValue()}return this.numValue()};p.Property.prototype.toRadians=function(){if(!this.hasValue()){return 0}var r=this.value+"";if(r.match(/deg$/)){return this.numValue()*(Math.PI/180)}if(r.match(/grad$/)){return this.numValue()*(Math.PI/200)}if(r.match(/rad$/)){return this.numValue()}return this.numValue()*(Math.PI/180)};var q={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};p.Property.prototype.toTextBaseline=function(){if(!this.hasValue()){return null}return q[this.value]};p.Font=new (function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(v,w,x,u,t,y){var s=y!=null?this.Parse(y):this.CreateFont("","","","","",p.ctx.font);return{fontFamily:t||s.fontFamily,fontSize:u||s.fontSize,fontStyle:v||s.fontStyle,fontWeight:x||s.fontWeight,fontVariant:w||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var r=this;this.Parse=function(x){var u={};var t=p.trim(p.compressSpaces(x||"")).split(" ");var y={fontSize:false,fontStyle:false,fontWeight:false,fontVariant:false};var v="";for(var w=0;w<t.length;w++){if(!y.fontStyle&&r.Styles.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontStyle=t[w]}y.fontStyle=true}else{if(!y.fontVariant&&r.Variants.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontVariant=t[w]}y.fontStyle=y.fontVariant=true}else{if(!y.fontWeight&&r.Weights.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontWeight=t[w]}y.fontStyle=y.fontVariant=y.fontWeight=true}else{if(!y.fontSize){if(t[w]!="inherit"){u.fontSize=t[w].split("/")[0]}y.fontStyle=y.fontVariant=y.fontWeight=y.fontSize=true}else{if(t[w]!="inherit"){v+=t[w]}}}}}}if(v!=""){u.fontFamily=v}return u}});p.ToNumberArray=function(u){var r=p.trim(p.compressSpaces((u||"").replace(/,/g," "))).split(" ");for(var t=0;t<r.length;t++){r[t]=parseFloat(r[t])}return r};p.Point=function(r,s){this.x=r;this.y=s};p.Point.prototype.angleTo=function(r){return Math.atan2(r.y-this.y,r.x-this.x)};p.Point.prototype.applyTransform=function(r){var s=this.x*r[0]+this.y*r[2]+r[4];var t=this.x*r[1]+this.y*r[3]+r[5];this.x=s;this.y=t};p.CreatePoint=function(t){var r=p.ToNumberArray(t);return new p.Point(r[0],r[1])};p.CreatePath=function(v){var r=p.ToNumberArray(v);var u=[];for(var t=0;t<r.length;t+=2){u.push(new p.Point(r[t],r[t+1]))}return u};p.BoundingBox=function(r,t,s,u){this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=function(v,w){if(v!=null){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=v;this.x2=v}if(v<this.x1){this.x1=v}if(v>this.x2){this.x2=v}}if(w!=null){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=w;this.y2=w}if(w<this.y1){this.y1=w}if(w>this.y2){this.y2=w}}};this.addX=function(v){this.addPoint(v,null)};this.addY=function(v){this.addPoint(null,v)};this.addBoundingBox=function(v){this.addPoint(v.x1,v.y1);this.addPoint(v.x2,v.y2)};this.addQuadraticCurve=function(z,A,B,C,D,E){var v=z+2/3*(B-z);var w=A+2/3*(C-A);var x=v+1/3*(D-z);var y=w+1/3*(E-A);this.addBezierCurve(z,A,v,x,w,y,D,E)};this.addBezierCurve=function(B,C,E,F,H,I,K,L){var A=[B,C],D=[E,F],G=[H,I],J=[K,L];this.addPoint(A[0],A[1]);this.addPoint(J[0],J[1]);for(i=0;i<=1;i++){var z=function(P){return Math.pow(1-P,3)*A[i]+3*Math.pow(1-P,2)*P*D[i]+3*(1-P)*Math.pow(P,2)*G[i]+Math.pow(P,3)*J[i]};var w=6*A[i]-12*D[i]+6*G[i];var v=-3*A[i]+9*D[i]-9*G[i]+3*J[i];var y=3*D[i]-3*A[i];if(v==0){if(w==0){continue}var M=-y/w;if(0<M&&M<1){if(i==0){this.addX(z(M))}if(i==1){this.addY(z(M))}}continue}var x=Math.pow(w,2)-4*y*v;if(x<0){continue}var N=(-w+Math.sqrt(x))/(2*v);if(0<N&&N<1){if(i==0){this.addX(z(N))}if(i==1){this.addY(z(N))}}var O=(-w-Math.sqrt(x))/(2*v);if(0<O&&O<1){if(i==0){this.addX(z(O))}if(i==1){this.addY(z(O))}}}};this.isPointInBox=function(v,w){return(this.x1<=v&&v<=this.x2&&this.y1<=w&&w<=this.y2)};this.addPoint(r,t);this.addPoint(s,u)};p.Transform=function(A){var w=this;this.Type={};this.Type.translate=function(v){this.p=p.CreatePoint(v);this.apply=function(s){s.translate(this.p.x||0,this.p.y||0)};this.unapply=function(s){s.translate(-1*this.p.x||0,-1*this.p.y||0)};this.applyToPoint=function(s){s.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}};this.Type.rotate=function(B){var v=p.ToNumberArray(B);this.angle=new p.Property("angle",v[0]);this.cx=v[1]||0;this.cy=v[2]||0;this.apply=function(s){s.translate(this.cx,this.cy);s.rotate(this.angle.toRadians());s.translate(-this.cx,-this.cy)};this.unapply=function(s){s.translate(this.cx,this.cy);s.rotate(-1*this.angle.toRadians());s.translate(-this.cx,-this.cy)};this.applyToPoint=function(C){var s=this.angle.toRadians();C.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);C.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]);C.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}};this.Type.scale=function(v){this.p=p.CreatePoint(v);this.apply=function(s){s.scale(this.p.x||1,this.p.y||this.p.x||1)};this.unapply=function(s){s.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)};this.applyToPoint=function(s){s.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}};this.Type.matrix=function(v){this.m=p.ToNumberArray(v);this.apply=function(s){s.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])};this.unapply=function(D){var s=this.m[0];var B=this.m[2];var C=this.m[4];var E=this.m[1];var G=this.m[3];var H=this.m[5];var I=0;var J=0;var K=1;var F=1/(s*(G*K-H*J)-B*(E*K-H*I)+C*(E*J-G*I));D.transform(F*(G*K-H*J),F*(H*I-E*K),F*(C*J-B*K),F*(s*K-C*I),F*(B*H-C*G),F*(C*E-s*H))};this.applyToPoint=function(s){s.applyTransform(this.m)}};this.Type.SkewBase=function(v){this.base=w.Type.matrix;this.base(v);this.angle=new p.Property("angle",v)};this.Type.SkewBase.prototype=new this.Type.matrix;this.Type.skewX=function(v){this.base=w.Type.SkewBase;this.base(v);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(v){this.base=w.Type.SkewBase;this.base(v);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(s){for(var v=0;v<this.transforms.length;v++){this.transforms[v].apply(s)}};this.unapply=function(s){for(var v=this.transforms.length-1;v>=0;v--){this.transforms[v].unapply(s)}};this.applyToPoint=function(v){for(var s=0;s<this.transforms.length;s++){this.transforms[s].applyToPoint(v)}};var r=p.trim(p.compressSpaces(A)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var t=0;t<r.length;t++){var z=p.trim(r[t].split("(")[0]);var u=r[t].split("(")[1].replace(")","");var y=this.Type[z];if(typeof y!="undefined"){var x=new y(u);x.type=z;this.transforms.push(x)}}};p.AspectRatio=function(t,s,G,v,w,u,y,z,A,B){s=p.compressSpaces(s);s=s.replace(/^defer\s/,"");var r=s.split(" ")[0]||"xMidYMid";var x=s.split(" ")[1]||"meet";var E=G/v;var F=w/u;var D=Math.min(E,F);var C=Math.max(E,F);if(x=="meet"){v*=D;u*=D}if(x=="slice"){v*=C;u*=C}A=new p.Property("refX",A);B=new p.Property("refY",B);if(A.hasValue()&&B.hasValue()){t.translate(-D*A.toPixels("x"),-D*B.toPixels("y"))}else{if(r.match(/^xMid/)&&((x=="meet"&&D==F)||(x=="slice"&&C==F))){t.translate(G/2-v/2,0)}if(r.match(/YMid$/)&&((x=="meet"&&D==E)||(x=="slice"&&C==E))){t.translate(0,w/2-u/2)}if(r.match(/^xMax/)&&((x=="meet"&&D==F)||(x=="slice"&&C==F))){t.translate(G-v,0)}if(r.match(/YMax$/)&&((x=="meet"&&D==E)||(x=="slice"&&C==E))){t.translate(0,w-u)}}if(r=="none"){t.scale(E,F)}else{if(x=="meet"){t.scale(D,D)}else{if(x=="slice"){t.scale(C,C)}}}t.translate(y==null?0:-y,z==null?0:-z)};p.Element={};p.EmptyProperty=new p.Property("EMPTY","");p.Element.ElementBase=function(w){this.attributes={};this.styles={};this.stylesSpecificity={};this.children=[];this.attribute=function(F,E){var D=this.attributes[F];if(D!=null){return D}if(E==true){D=new p.Property(F,"");this.attributes[F]=D}return D||p.EmptyProperty};this.getHrefAttribute=function(){for(var D in this.attributes){if(D=="href"||D.match(/:href$/)){return this.attributes[D]}}return p.EmptyProperty};this.style=function(F,E,J){var I=this.styles[F];if(I!=null){return I}var D=this.attribute(F);if(D!=null&&D.hasValue()){this.styles[F]=D;return D}if(J!=true){var G=this.parent;if(G!=null){var H=G.style(F);if(H!=null&&H.hasValue()){return H}}}if(E==true){I=new p.Property(F,"");this.styles[F]=I}return I||p.EmptyProperty};this.render=function(D){if(this.style("display").value=="none"){return}if(this.style("visibility").value=="hidden"){return}D.save();if(this.style("mask").hasValue()){var F=this.style("mask").getDefinition();if(F!=null){F.apply(D,this)}}else{if(this.style("filter").hasValue()){var E=this.style("filter").getDefinition();if(E!=null){E.apply(D,this)}}else{this.setContext(D);this.renderChildren(D);this.clearContext(D)}}D.restore()};this.setContext=function(D){};this.clearContext=function(D){};this.renderChildren=function(D){for(var E=0;E<this.children.length;E++){this.children[E].render(D)}};this.addChild=function(E,F){var D=E;if(F){D=p.CreateElement(E)}D.parent=this;if(D.type!="title"){this.children.push(D)}};this.addStylesFromStyleDefinition=function(){for(var F in p.Styles){if(F[0]!="@"&&h(w,F)){var H=p.Styles[F];var G=p.StylesSpecificity[F];if(H!=null){for(var E in H){var D=this.stylesSpecificity[E];if(typeof D=="undefined"){D="000"}if(G>D){this.styles[E]=H[E];this.stylesSpecificity[E]=G}}}}}};var r=new RegExp("^[A-Z-]+$");var y=function(D){if(r.test(D)){return D.toLowerCase()}return D};if(w!=null&&w.nodeType==1){for(var u=0;u<w.attributes.length;u++){var s=w.attributes[u];var x=y(s.nodeName);this.attributes[x]=new p.Property(x,s.value)}this.addStylesFromStyleDefinition();if(this.attribute("style").hasValue()){var A=this.attribute("style").value.split(";");for(var u=0;u<A.length;u++){if(p.trim(A[u])!=""){var z=A[u].split(":");var v=p.trim(z[0]);var C=p.trim(z[1]);this.styles[v]=new p.Property(v,C)}}}if(this.attribute("id").hasValue()){if(p.Definitions[this.attribute("id").value]==null){p.Definitions[this.attribute("id").value]=this}}for(var u=0;u<w.childNodes.length;u++){var t=w.childNodes[u];if(t.nodeType==1){this.addChild(t,true)}if(this.captureTextNodes&&(t.nodeType==3||t.nodeType==4)){var B=t.value||t.text||t.textContent||"";if(p.compressSpaces(B)!=""){this.addChild(new p.Element.tspan(t),false)}}}}};p.Element.RenderedElementBase=function(r){this.base=p.Element.ElementBase;this.base(r);this.setContext=function(t){if(this.style("fill").isUrlDefinition()){var v=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));if(v!=null){t.fillStyle=v}}else{if(this.style("fill").hasValue()){var u=this.style("fill");if(u.value=="currentColor"){u.value=this.style("color").value}if(u.value!="inherit"){t.fillStyle=(u.value=="none"?"rgba(0,0,0,0)":u.value)}}}if(this.style("fill-opacity").hasValue()){var u=new p.Property("fill",t.fillStyle);u=u.addOpacity(this.style("fill-opacity"));t.fillStyle=u.value}if(this.style("stroke").isUrlDefinition()){var v=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));if(v!=null){t.strokeStyle=v}}else{if(this.style("stroke").hasValue()){var z=this.style("stroke");if(z.value=="currentColor"){z.value=this.style("color").value}if(z.value!="inherit"){t.strokeStyle=(z.value=="none"?"rgba(0,0,0,0)":z.value)}}}if(this.style("stroke-opacity").hasValue()){var z=new p.Property("stroke",t.strokeStyle);z=z.addOpacity(this.style("stroke-opacity"));t.strokeStyle=z.value}if(this.style("stroke-width").hasValue()){var x=this.style("stroke-width").toPixels();t.lineWidth=x==0?0.001:x}if(this.style("stroke-linecap").hasValue()){t.lineCap=this.style("stroke-linecap").value}if(this.style("stroke-linejoin").hasValue()){t.lineJoin=this.style("stroke-linejoin").value}if(this.style("stroke-miterlimit").hasValue()){t.miterLimit=this.style("stroke-miterlimit").value}if(this.style("stroke-dasharray").hasValue()&&this.style("stroke-dasharray").value!="none"){var w=p.ToNumberArray(this.style("stroke-dasharray").value);if(typeof t.setLineDash!="undefined"){t.setLineDash(w)}else{if(typeof t.webkitLineDash!="undefined"){t.webkitLineDash=w}else{if(typeof t.mozDash!="undefined"&&!(w.length==1&&w[0]==0)){t.mozDash=w}}}var y=this.style("stroke-dashoffset").numValueOrDefault(1);if(typeof t.lineDashOffset!="undefined"){t.lineDashOffset=y}else{if(typeof t.webkitLineDashOffset!="undefined"){t.webkitLineDashOffset=y}else{if(typeof t.mozDashOffset!="undefined"){t.mozDashOffset=y}}}}if(typeof t.font!="undefined"){t.font=p.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()}if(this.style("transform",false,true).hasValue()){var A=new p.Transform(this.style("transform",false,true).value);A.apply(t)}if(this.style("clip-path",false,true).hasValue()){var s=this.style("clip-path",false,true).getDefinition();if(s!=null){s.apply(t)}}if(this.style("opacity").hasValue()){t.globalAlpha=this.style("opacity").numValue()}}};p.Element.RenderedElementBase.prototype=new p.Element.ElementBase;p.Element.PathElementBase=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.path=function(s){if(s!=null){s.beginPath()}return new p.BoundingBox()};this.renderChildren=function(s){this.path(s);p.Mouse.checkPath(this,s);if(s.fillStyle!=""){if(this.style("fill-rule").valueOrDefault("inherit")!="inherit"){s.fill(this.style("fill-rule").value)}else{s.fill()}}if(s.strokeStyle!=""){s.stroke()}var v=this.getMarkers();if(v!=null){if(this.style("marker-start").isUrlDefinition()){var u=this.style("marker-start").getDefinition();u.render(s,v[0][0],v[0][1])}if(this.style("marker-mid").isUrlDefinition()){var u=this.style("marker-mid").getDefinition();for(var t=1;t<v.length-1;t++){u.render(s,v[t][0],v[t][1])}}if(this.style("marker-end").isUrlDefinition()){var u=this.style("marker-end").getDefinition();u.render(s,v[v.length-1][0],v[v.length-1][1])}}};this.getBoundingBox=function(){return this.path()};this.getMarkers=function(){return null}};p.Element.PathElementBase.prototype=new p.Element.RenderedElementBase;p.Element.svg=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.baseClearContext=this.clearContext;this.clearContext=function(s){this.baseClearContext(s);p.ViewPort.RemoveCurrent()};this.baseSetContext=this.setContext;this.setContext=function(s){s.strokeStyle="rgba(0,0,0,0)";s.lineCap="butt";s.lineJoin="miter";s.miterLimit=4;if(typeof s.font!="undefined"&&typeof window.getComputedStyle!="undefined"){s.font=window.getComputedStyle(s.canvas).getPropertyValue("font")}this.baseSetContext(s);if(!this.attribute("x").hasValue()){this.attribute("x",true).value=0}if(!this.attribute("y").hasValue()){this.attribute("y",true).value=0}s.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var z=p.ViewPort.width();var t=p.ViewPort.height();if(!this.attribute("width").hasValue()){this.attribute("width",true).value="100%"}if(!this.attribute("height").hasValue()){this.attribute("height",true).value="100%"}if(typeof this.root=="undefined"){z=this.attribute("width").toPixels("x");t=this.attribute("height").toPixels("y");var A=0;var B=0;if(this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()){A=-this.attribute("refX").toPixels("x");B=-this.attribute("refY").toPixels("y")}if(this.attribute("overflow").valueOrDefault("hidden")!="visible"){s.beginPath();s.moveTo(A,B);s.lineTo(z,B);s.lineTo(z,t);s.lineTo(A,t);s.closePath();s.clip()}}p.ViewPort.SetCurrent(z,t);if(this.attribute("viewBox").hasValue()){var w=p.ToNumberArray(this.attribute("viewBox").value);var u=w[0];var v=w[1];z=w[2];t=w[3];p.AspectRatio(s,this.attribute("preserveAspectRatio").value,p.ViewPort.width(),z,p.ViewPort.height(),t,u,v,this.attribute("refX").value,this.attribute("refY").value);p.ViewPort.RemoveCurrent();p.ViewPort.SetCurrent(w[2],w[3])}}};p.Element.svg.prototype=new p.Element.RenderedElementBase;p.Element.rect=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var z=this.attribute("x").toPixels("x");var A=this.attribute("y").toPixels("y");var w=this.attribute("width").toPixels("x");var t=this.attribute("height").toPixels("y");var u=this.attribute("rx").toPixels("x");var v=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()){v=u}if(this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()){u=v}u=Math.min(u,w/2);v=Math.min(v,t/2);if(s!=null){s.beginPath();s.moveTo(z+u,A);s.lineTo(z+w-u,A);s.quadraticCurveTo(z+w,A,z+w,A+v);s.lineTo(z+w,A+t-v);s.quadraticCurveTo(z+w,A+t,z+w-u,A+t);s.lineTo(z+u,A+t);s.quadraticCurveTo(z,A+t,z,A+t-v);s.lineTo(z,A+v);s.quadraticCurveTo(z,A,z+u,A);s.closePath()}return new p.BoundingBox(z,A,z+w,A+t)}};p.Element.rect.prototype=new p.Element.PathElementBase;p.Element.circle=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var t=this.attribute("cx").toPixels("x");var u=this.attribute("cy").toPixels("y");var v=this.attribute("r").toPixels();if(s!=null){s.beginPath();s.arc(t,u,v,0,Math.PI*2,true);s.closePath()}return new p.BoundingBox(t-v,u-v,t+v,u+v)}};p.Element.circle.prototype=new p.Element.PathElementBase;p.Element.ellipse=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var v=4*((Math.sqrt(2)-1)/3);var w=this.attribute("rx").toPixels("x");var x=this.attribute("ry").toPixels("y");var t=this.attribute("cx").toPixels("x");var u=this.attribute("cy").toPixels("y");if(s!=null){s.beginPath();s.moveTo(t,u-x);s.bezierCurveTo(t+(v*w),u-x,t+w,u-(v*x),t+w,u);s.bezierCurveTo(t+w,u+(v*x),t+(v*w),u+x,t,u+x);s.bezierCurveTo(t-(v*w),u+x,t-w,u+(v*x),t-w,u);s.bezierCurveTo(t-w,u-(v*x),t-(v*w),u-x,t,u-x);s.closePath()}return new p.BoundingBox(t-w,u-x,t+w,u+x)}};p.Element.ellipse.prototype=new p.Element.PathElementBase;p.Element.line=function(r){this.base=p.Element.PathElementBase;this.base(r);this.getPoints=function(){return[new p.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new p.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]};this.path=function(s){var t=this.getPoints();if(s!=null){s.beginPath();s.moveTo(t[0].x,t[0].y);s.lineTo(t[1].x,t[1].y)}return new p.BoundingBox(t[0].x,t[0].y,t[1].x,t[1].y)};this.getMarkers=function(){var t=this.getPoints();var s=t[0].angleTo(t[1]);return[[t[0],s],[t[1],s]]}};p.Element.line.prototype=new p.Element.PathElementBase;p.Element.polyline=function(r){this.base=p.Element.PathElementBase;this.base(r);this.points=p.CreatePath(this.attribute("points").value);this.path=function(t){var s=new p.BoundingBox(this.points[0].x,this.points[0].y);if(t!=null){t.beginPath();t.moveTo(this.points[0].x,this.points[0].y)}for(var u=1;u<this.points.length;u++){s.addPoint(this.points[u].x,this.points[u].y);if(t!=null){t.lineTo(this.points[u].x,this.points[u].y)}}return s};this.getMarkers=function(){var t=[];for(var s=0;s<this.points.length-1;s++){t.push([this.points[s],this.points[s].angleTo(this.points[s+1])])}if(t.length>0){t.push([this.points[this.points.length-1],t[t.length-1][1]])}return t}};p.Element.polyline.prototype=new p.Element.PathElementBase;p.Element.polygon=function(r){this.base=p.Element.polyline;this.base(r);this.basePath=this.path;this.path=function(t){var s=this.basePath(t);if(t!=null){t.lineTo(this.points[0].x,this.points[0].y);t.closePath()}return s}};p.Element.polygon.prototype=new p.Element.polyline;p.Element.path=function(t){this.base=p.Element.PathElementBase;this.base(t);var r=this.attribute("d").value;r=r.replace(/,/gm," ");for(var s=0;s<2;s++){r=r.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2")}r=r.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");r=r.replace(/([0-9])([+\-])/gm,"$1 $2");for(var s=0;s<2;s++){r=r.replace(/(\.[0-9]*)(\.)/gm,"$1 $2")}r=r.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");r=p.compressSpaces(r);r=p.trim(r);this.PathParser=new (function(u){this.tokens=u.split(" ");this.reset=function(){this.i=-1;this.command="";this.previousCommand="";this.start=new p.Point(0,0);this.control=new p.Point(0,0);this.current=new p.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){if(this.isEnd()){return true}return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null};this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break}return false};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var v=new p.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(v)};this.getAsControlPoint=function(){var v=this.getPoint();this.control=v;return v};this.getAsCurrentPoint=function(){var v=this.getPoint();this.current=v;return v};this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"&&this.previousCommand.toLowerCase()!="q"&&this.previousCommand.toLowerCase()!="t"){return this.current}var v=new p.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return v};this.makeAbsolute=function(v){if(this.isRelativeCommand()){v.x+=this.current.x;v.y+=this.current.y}return v};this.addMarker=function(w,v,x){if(x!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(x)}this.addMarkerAngle(w,v==null?null:v.angleTo(w))};this.addMarkerAngle=function(w,v){this.points.push(w);this.angles.push(v)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var v=0;v<this.angles.length;v++){if(this.angles[v]==null){for(var w=v+1;w<this.angles.length;w++){if(this.angles[w]!=null){this.angles[v]=this.angles[w];break}}}}return this.angles}})(r);this.path=function(G){var R=this.PathParser;R.reset();var A=new p.BoundingBox();if(G!=null){G.beginPath()}while(!R.isEnd()){R.nextCommand();switch(R.command){case"M":case"m":var P=R.getAsCurrentPoint();R.addMarker(P);A.addPoint(P.x,P.y);if(G!=null){G.moveTo(P.x,P.y)}R.start=R.current;while(!R.isCommandOrEnd()){var P=R.getAsCurrentPoint();R.addMarker(P,R.start);A.addPoint(P.x,P.y);if(G!=null){G.lineTo(P.x,P.y)}}break;case"L":case"l":while(!R.isCommandOrEnd()){var B=R.current;var P=R.getAsCurrentPoint();R.addMarker(P,B);A.addPoint(P.x,P.y);if(G!=null){G.lineTo(P.x,P.y)}}break;case"H":case"h":while(!R.isCommandOrEnd()){var O=new p.Point((R.isRelativeCommand()?R.current.x:0)+R.getScalar(),R.current.y);R.addMarker(O,R.current);R.current=O;A.addPoint(R.current.x,R.current.y);if(G!=null){G.lineTo(R.current.x,R.current.y)}}break;case"V":case"v":while(!R.isCommandOrEnd()){var O=new p.Point(R.current.x,(R.isRelativeCommand()?R.current.y:0)+R.getScalar());R.addMarker(O,R.current);R.current=O;A.addPoint(R.current.x,R.current.y);if(G!=null){G.lineTo(R.current.x,R.current.y)}}break;case"C":case"c":while(!R.isCommandOrEnd()){var H=R.current;var Q=R.getPoint();var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,Q);A.addBezierCurve(H.x,H.y,Q.x,Q.y,D.x,D.y,E.x,E.y);if(G!=null){G.bezierCurveTo(Q.x,Q.y,D.x,D.y,E.x,E.y)}}break;case"S":case"s":while(!R.isCommandOrEnd()){var H=R.current;var Q=R.getReflectedControlPoint();var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,Q);A.addBezierCurve(H.x,H.y,Q.x,Q.y,D.x,D.y,E.x,E.y);if(G!=null){G.bezierCurveTo(Q.x,Q.y,D.x,D.y,E.x,E.y)}}break;case"Q":case"q":while(!R.isCommandOrEnd()){var H=R.current;var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,D);A.addQuadraticCurve(H.x,H.y,D.x,D.y,E.x,E.y);if(G!=null){G.quadraticCurveTo(D.x,D.y,E.x,E.y)}}break;case"T":case"t":while(!R.isCommandOrEnd()){var H=R.current;var D=R.getReflectedControlPoint();R.control=D;var E=R.getAsCurrentPoint();R.addMarker(E,D,D);A.addQuadraticCurve(H.x,H.y,D.x,D.y,E.x,E.y);if(G!=null){G.quadraticCurveTo(D.x,D.y,E.x,E.y)}}break;case"A":case"a":while(!R.isCommandOrEnd()){var H=R.current;var T=R.getScalar();var U=R.getScalar();var ab=R.getScalar()*(Math.PI/180);var M=R.getScalar();var W=R.getScalar();var E=R.getAsCurrentPoint();var I=new p.Point(Math.cos(ab)*(H.x-E.x)/2+Math.sin(ab)*(H.y-E.y)/2,-Math.sin(ab)*(H.x-E.x)/2+Math.cos(ab)*(H.y-E.y)/2);var L=Math.pow(I.x,2)/Math.pow(T,2)+Math.pow(I.y,2)/Math.pow(U,2);if(L>1){T*=Math.sqrt(L);U*=Math.sqrt(L)}var V=(M==W?-1:1)*Math.sqrt(((Math.pow(T,2)*Math.pow(U,2))-(Math.pow(T,2)*Math.pow(I.y,2))-(Math.pow(U,2)*Math.pow(I.x,2)))/(Math.pow(T,2)*Math.pow(I.y,2)+Math.pow(U,2)*Math.pow(I.x,2)));if(isNaN(V)){V=0}var F=new p.Point(V*T*I.y/U,V*-U*I.x/T);var C=new p.Point((H.x+E.x)/2+Math.cos(ab)*F.x-Math.sin(ab)*F.y,(H.y+E.y)/2+Math.sin(ab)*F.x+Math.cos(ab)*F.y);var N=function(u){return Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2))};var S=function(ac,ad){return(ac[0]*ad[0]+ac[1]*ad[1])/(N(ac)*N(ad))};var w=function(ac,ad){return(ac[0]*ad[1]<ac[1]*ad[0]?-1:1)*Math.acos(S(ac,ad))};var x=w([1,0],[(I.x-F.x)/T,(I.y-F.y)/U]);var Z=[(I.x-F.x)/T,(I.y-F.y)/U];var aa=[(-I.x-F.x)/T,(-I.y-F.y)/U];var y=w(Z,aa);if(S(Z,aa)<=-1){y=Math.PI}if(S(Z,aa)>=1){y=0}var J=1-W?1:-1;var z=x+J*(y/2);var K=new p.Point(C.x+T*Math.cos(z),C.y+U*Math.sin(z));R.addMarkerAngle(K,z-J*Math.PI/2);R.addMarkerAngle(E,z-J*Math.PI);A.addPoint(E.x,E.y);if(G!=null){var S=T>U?T:U;var X=T>U?1:T/U;var Y=T>U?U/T:1;G.translate(C.x,C.y);G.rotate(ab);G.scale(X,Y);G.arc(0,0,S,x,x+y,1-W);G.scale(1/X,1/Y);G.rotate(-ab);G.translate(-C.x,-C.y)}}break;case"Z":case"z":if(G!=null){G.closePath()}R.current=R.start}}return A};this.getMarkers=function(){var x=this.PathParser.getMarkerPoints();var u=this.PathParser.getMarkerAngles();var w=[];for(var v=0;v<x.length;v++){w.push([x[v],u[v]])}return w}};p.Element.path.prototype=new p.Element.PathElementBase;p.Element.pattern=function(r){this.base=p.Element.ElementBase;this.base(r);this.createPattern=function(u,v){var B=this.attribute("width").toPixels("x",true);var w=this.attribute("height").toPixels("y",true);var A=new p.Element.svg();A.attributes.viewBox=new p.Property("viewBox",this.attribute("viewBox").value);A.attributes.width=new p.Property("width",B+"px");A.attributes.height=new p.Property("height",w+"px");A.attributes.transform=new p.Property("transform",this.attribute("patternTransform").value);A.children=this.children;var s=document.createElement("canvas");s.width=B;s.height=w;var t=s.getContext("2d");if(this.attribute("x").hasValue()&&this.attribute("y").hasValue()){t.translate(this.attribute("x").toPixels("x",true),this.attribute("y").toPixels("y",true))}for(var C=-1;C<=1;C++){for(var D=-1;D<=1;D++){t.save();A.attributes.x=new p.Property("x",C*s.width);A.attributes.y=new p.Property("y",D*s.height);A.render(t);t.restore()}}var z=u.createPattern(s,"repeat");return z}};p.Element.pattern.prototype=new p.Element.ElementBase;p.Element.marker=function(r){this.base=p.Element.ElementBase;this.base(r);this.baseRender=this.render;this.render=function(t,u,s){t.translate(u.x,u.y);if(this.attribute("orient").valueOrDefault("auto")=="auto"){t.rotate(s)}if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){t.scale(t.lineWidth,t.lineWidth)}t.save();var v=new p.Element.svg();v.attributes.viewBox=new p.Property("viewBox",this.attribute("viewBox").value);v.attributes.refX=new p.Property("refX",this.attribute("refX").value);v.attributes.refY=new p.Property("refY",this.attribute("refY").value);v.attributes.width=new p.Property("width",this.attribute("markerWidth").value);v.attributes.height=new p.Property("height",this.attribute("markerHeight").value);v.attributes.fill=new p.Property("fill",this.attribute("fill").valueOrDefault("black"));v.attributes.stroke=new p.Property("stroke",this.attribute("stroke").valueOrDefault("none"));v.children=this.children;v.render(t);t.restore();if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){t.scale(1/t.lineWidth,1/t.lineWidth)}if(this.attribute("orient").valueOrDefault("auto")=="auto"){t.rotate(-s)}t.translate(-u.x,-u.y)}};p.Element.marker.prototype=new p.Element.ElementBase;p.Element.defs=function(r){this.base=p.Element.ElementBase;this.base(r);this.render=function(s){}};p.Element.defs.prototype=new p.Element.ElementBase;p.Element.GradientBase=function(t){this.base=p.Element.ElementBase;this.base(t);this.stops=[];for(var s=0;s<this.children.length;s++){var r=this.children[s];if(r.type=="stop"){this.stops.push(r)}}this.getGradient=function(){};this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")};this.attributesToInherit=["gradientUnits"];this.inheritStopContainer=function(w){for(var v=0;v<this.attributesToInherit.length;v++){var u=this.attributesToInherit[v];if(!this.attribute(u).hasValue()&&w.attribute(u).hasValue()){this.attribute(u,true).value=w.attribute(u).value}}};this.createGradient=function(w,x,B){var E=this;if(this.getHrefAttribute().hasValue()){E=this.getHrefAttribute().getDefinition();this.inheritStopContainer(E)}var u=function(H){if(B.hasValue()){var I=new p.Property("color",H);return I.addOpacity(B).value}return H};var y=this.getGradient(w,x);if(y==null){return u(E.stops[E.stops.length-1].color)}for(var A=0;A<E.stops.length;A++){y.addColorStop(E.stops[A].offset,u(E.stops[A].color))}if(this.attribute("gradientTransform").hasValue()){var D=p.ViewPort.viewPorts[0];var C=new p.Element.rect();C.attributes.x=new p.Property("x",-p.MAX_VIRTUAL_PIXELS/3);C.attributes.y=new p.Property("y",-p.MAX_VIRTUAL_PIXELS/3);C.attributes.width=new p.Property("width",p.MAX_VIRTUAL_PIXELS);C.attributes.height=new p.Property("height",p.MAX_VIRTUAL_PIXELS);var z=new p.Element.g();z.attributes.transform=new p.Property("transform",this.attribute("gradientTransform").value);z.children=[C];var G=new p.Element.svg();G.attributes.x=new p.Property("x",0);G.attributes.y=new p.Property("y",0);G.attributes.width=new p.Property("width",D.width);G.attributes.height=new p.Property("height",D.height);G.children=[z];var v=document.createElement("canvas");v.width=D.width;v.height=D.height;var F=v.getContext("2d");F.fillStyle=y;G.render(F);return F.createPattern(v,"no-repeat")}return y}};p.Element.GradientBase.prototype=new p.Element.ElementBase;p.Element.linearGradient=function(r){this.base=p.Element.GradientBase;this.base(r);this.attributesToInherit.push("x1");this.attributesToInherit.push("y1");this.attributesToInherit.push("x2");this.attributesToInherit.push("y2");this.getGradient=function(t,u){var s=this.gradientUnits()=="objectBoundingBox"?u.getBoundingBox():null;if(!this.attribute("x1").hasValue()&&!this.attribute("y1").hasValue()&&!this.attribute("x2").hasValue()&&!this.attribute("y2").hasValue()){this.attribute("x1",true).value=0;this.attribute("y1",true).value=0;this.attribute("x2",true).value=1;this.attribute("y2",true).value=0}var v=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"));var x=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"));var w=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"));var y=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y"));if(v==w&&x==y){return null}return t.createLinearGradient(v,x,w,y)}};p.Element.linearGradient.prototype=new p.Element.GradientBase;p.Element.radialGradient=function(r){this.base=p.Element.GradientBase;this.base(r);this.attributesToInherit.push("cx");this.attributesToInherit.push("cy");this.attributesToInherit.push("r");this.attributesToInherit.push("fx");this.attributesToInherit.push("fy");this.getGradient=function(t,w){var s=w.getBoundingBox();if(!this.attribute("cx").hasValue()){this.attribute("cx",true).value="50%"}if(!this.attribute("cy").hasValue()){this.attribute("cy",true).value="50%"}if(!this.attribute("r").hasValue()){this.attribute("r",true).value="50%"}var u=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"));var v=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"));var x=u;var y=v;if(this.attribute("fx").hasValue()){x=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x"))}if(this.attribute("fy").hasValue()){y=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"))}var z=(this.gradientUnits()=="objectBoundingBox"?(s.width()+s.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels());return t.createRadialGradient(x,y,0,u,v,z)}};p.Element.radialGradient.prototype=new p.Element.GradientBase;p.Element.stop=function(r){this.base=p.Element.ElementBase;this.base(r);this.offset=this.attribute("offset").numValue();if(this.offset<0){this.offset=0}if(this.offset>1){this.offset=1}var s=this.style("stop-color",true);if(s.value===""){s.value="#000"}if(this.style("stop-opacity").hasValue()){s=s.addOpacity(this.style("stop-opacity"))}this.color=s.value};p.Element.stop.prototype=new p.Element.ElementBase;p.Element.AnimateBase=function(r){this.base=p.Element.ElementBase;this.base(r);p.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var t=this.attribute("attributeType").value;var s=this.attribute("attributeName").value;if(t=="CSS"){return this.parent.style(s,true)}return this.parent.attribute(s,true)};this.initialValue=null;this.initialUnits="";this.removed=false;this.calcValue=function(){return""};this.update=function(s){if(this.initialValue==null){this.initialValue=this.getProperty().value;this.initialUnits=this.getProperty().getUnits()}if(this.duration>this.maxDuration){if(this.attribute("repeatCount").value=="indefinite"||this.attribute("repeatDur").value=="indefinite"){this.duration=0}else{if(this.attribute("fill").valueOrDefault("remove")=="freeze"&&!this.frozen){this.frozen=true;this.parent.animationFrozen=true;this.parent.animationFrozenValue=this.getProperty().value}else{if(this.attribute("fill").valueOrDefault("remove")=="remove"&&!this.removed){this.removed=true;this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue;return true}}}return false}this.duration=this.duration+s;var v=false;if(this.begin<this.duration){var t=this.calcValue();if(this.attribute("type").hasValue()){var u=this.attribute("type").value;t=u+"("+t+")"}this.getProperty().value=t;v=true}return v};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");if(this.values.hasValue()){this.values.value=this.values.value.split(";")}this.progress=function(){var u={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var t=u.progress*(this.values.value.length-1);var s=Math.floor(t),v=Math.ceil(t);u.from=new p.Property("from",parseFloat(this.values.value[s]));u.to=new p.Property("to",parseFloat(this.values.value[v]));u.progress=(t-s)/(v-s)}else{u.from=this.from;u.to=this.to}return u}};p.Element.AnimateBase.prototype=new p.Element.ElementBase;p.Element.animate=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var t=this.progress();var s=t.from.numValue()+(t.to.numValue()-t.from.numValue())*t.progress;return s+this.initialUnits}};p.Element.animate.prototype=new p.Element.AnimateBase;p.Element.animateColor=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var v=this.progress();var t=new m(v.from.value);var x=new m(v.to.value);if(t.ok&&x.ok){var w=t.r+(x.r-t.r)*v.progress;var u=t.g+(x.g-t.g)*v.progress;var s=t.b+(x.b-t.b)*v.progress;return"rgb("+parseInt(w,10)+","+parseInt(u,10)+","+parseInt(s,10)+")"}return this.attribute("from").value}};p.Element.animateColor.prototype=new p.Element.AnimateBase;p.Element.animateTransform=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var v=this.progress();var s=p.ToNumberArray(v.from.value);var w=p.ToNumberArray(v.to.value);var u="";for(var t=0;t<s.length;t++){u+=s[t]+(w[t]-s[t])*v.progress+" "}return u}};p.Element.animateTransform.prototype=new p.Element.animate;p.Element.font=function(t){this.base=p.Element.ElementBase;this.base(t);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isRTL=false;this.isArabic=false;this.fontFace=null;this.missingGlyph=null;this.glyphs=[];for(var s=0;s<this.children.length;s++){var r=this.children[s];if(r.type=="font-face"){this.fontFace=r;if(r.style("font-family").hasValue()){p.Definitions[r.style("font-family").value]=this}}else{if(r.type=="missing-glyph"){this.missingGlyph=r}else{if(r.type=="glyph"){if(r.arabicForm!=""){this.isRTL=true;this.isArabic=true;if(typeof this.glyphs[r.unicode]=="undefined"){this.glyphs[r.unicode]=[]}this.glyphs[r.unicode][r.arabicForm]=r}else{this.glyphs[r.unicode]=r}}}}}};p.Element.font.prototype=new p.Element.ElementBase;p.Element.fontface=function(r){this.base=p.Element.ElementBase;this.base(r);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;this.unitsPerEm=this.attribute("units-per-em").numValue()};p.Element.fontface.prototype=new p.Element.ElementBase;p.Element.missingglyph=function(r){this.base=p.Element.path;this.base(r);this.horizAdvX=0};p.Element.missingglyph.prototype=new p.Element.path;p.Element.glyph=function(r){this.base=p.Element.path;this.base(r);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value};p.Element.glyph.prototype=new p.Element.path;p.Element.text=function(r){this.captureTextNodes=true;this.base=p.Element.RenderedElementBase;this.base(r);this.baseSetContext=this.setContext;this.setContext=function(s){this.baseSetContext(s);var t=this.style("dominant-baseline").toTextBaseline();if(t==null){t=this.style("alignment-baseline").toTextBaseline()}if(t!=null){s.textBaseline=t}};this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x");var u=this.attribute("y").toPixels("y");var s=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);return new p.BoundingBox(t,u-s,t+Math.floor(s*2/3)*this.children[0].getText().length,u)};this.renderChildren=function(s){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");if(this.attribute("dx").hasValue()){this.x+=this.attribute("dx").toPixels("x")}if(this.attribute("dy").hasValue()){this.y+=this.attribute("dy").toPixels("y")}this.x+=this.getAnchorDelta(s,this,0);for(var t=0;t<this.children.length;t++){this.renderChild(s,this,this,t)}};this.getAnchorDelta=function(t,v,w){var x=this.style("text-anchor").valueOrDefault("start");if(x!="start"){var y=0;for(var u=w;u<v.children.length;u++){var s=v.children[u];if(u>w&&s.attribute("x").hasValue()){break}y+=s.measureTextRecursive(t)}return -1*(x=="end"?y:y/2)}return 0};this.renderChild=function(t,w,v,u){var s=v.children[u];if(s.attribute("x").hasValue()){s.x=s.attribute("x").toPixels("x")+w.getAnchorDelta(t,v,u);if(s.attribute("dx").hasValue()){s.x+=s.attribute("dx").toPixels("x")}}else{if(s.attribute("dx").hasValue()){w.x+=s.attribute("dx").toPixels("x")}s.x=w.x}w.x=s.x+s.measureText(t);if(s.attribute("y").hasValue()){s.y=s.attribute("y").toPixels("y");if(s.attribute("dy").hasValue()){s.y+=s.attribute("dy").toPixels("y")}}else{if(s.attribute("dy").hasValue()){w.y+=s.attribute("dy").toPixels("y")}s.y=w.y}w.y=s.y;s.render(t);for(var u=0;u<s.children.length;u++){w.renderChild(t,w,s,u)}}};p.Element.text.prototype=new p.Element.RenderedElementBase;p.Element.TextElementBase=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.getGlyph=function(u,x,w){var t=x[w];var v=null;if(u.isArabic){var s="isolated";if((w==0||x[w-1]==" ")&&w<x.length-2&&x[w+1]!=" "){s="terminal"}if(w>0&&x[w-1]!=" "&&w<x.length-2&&x[w+1]!=" "){s="medial"}if(w>0&&x[w-1]!=" "&&(w==x.length-1||x[w+1]==" ")){s="initial"}if(typeof u.glyphs[t]!="undefined"){v=u.glyphs[t][s];if(v==null&&u.glyphs[t].type=="glyph"){v=u.glyphs[t]}}}else{v=u.glyphs[t]}if(v==null){v=u.missingGlyph}return v};this.renderChildren=function(s){var t=this.parent.style("font-family").getDefinition();if(t!=null){var v=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);var w=this.parent.style("font-style").valueOrDefault(p.Font.Parse(p.ctx.font).fontStyle);var B=this.getText();if(t.isRTL){B=B.split("").reverse().join("")}var u=p.ToNumberArray(this.parent.attribute("dx").value);for(var y=0;y<B.length;y++){var x=this.getGlyph(t,B,y);var A=v/t.fontFace.unitsPerEm;s.translate(this.x,this.y);s.scale(A,-A);var z=s.lineWidth;s.lineWidth=s.lineWidth*t.fontFace.unitsPerEm/v;if(w=="italic"){s.transform(1,0,0.4,1,0,0)}x.render(s);if(w=="italic"){s.transform(1,0,-0.4,1,0,0)}s.lineWidth=z;s.scale(1/A,-1/A);s.translate(-this.x,-this.y);this.x+=v*(x.horizAdvX||t.horizAdvX)/t.fontFace.unitsPerEm;if(typeof u[y]!="undefined"&&!isNaN(u[y])){this.x+=u[y]}}return}if(s.fillStyle!=""){s.fillText(p.compressSpaces(this.getText()),this.x,this.y)}if(s.strokeStyle!=""){s.strokeText(p.compressSpaces(this.getText()),this.x,this.y)}};this.getText=function(){};this.measureTextRecursive=function(s){var u=this.measureText(s);for(var t=0;t<this.children.length;t++){u+=this.children[t].measureTextRecursive(s)}return u};this.measureText=function(s){var t=this.parent.style("font-family").getDefinition();if(t!=null){var v=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);var y=0;var z=this.getText();if(t.isRTL){z=z.split("").reverse().join("")}var u=p.ToNumberArray(this.parent.attribute("dx").value);for(var x=0;x<z.length;x++){var w=this.getGlyph(t,z,x);y+=(w.horizAdvX||t.horizAdvX)*v/t.fontFace.unitsPerEm;if(typeof u[x]!="undefined"&&!isNaN(u[x])){y+=u[x]}}return y}var A=p.compressSpaces(this.getText());if(!s.measureText){return A.length*10}s.save();this.setContext(s);var B=s.measureText(A).width;s.restore();return B}};p.Element.TextElementBase.prototype=new p.Element.RenderedElementBase;p.Element.tspan=function(r){this.captureTextNodes=true;this.base=p.Element.TextElementBase;this.base(r);this.text=p.compressSpaces(r.value||r.text||r.textContent||"");this.getText=function(){if(this.children.length>0){return""}return this.text}};p.Element.tspan.prototype=new p.Element.TextElementBase;p.Element.tref=function(r){this.base=p.Element.TextElementBase;this.base(r);this.getText=function(){var s=this.getHrefAttribute().getDefinition();if(s!=null){return s.children[0].getText()}}};p.Element.tref.prototype=new p.Element.TextElementBase;p.Element.a=function(s){this.base=p.Element.TextElementBase;this.base(s);this.hasText=s.childNodes.length>0;for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType!=3){this.hasText=false}}this.text=this.hasText?s.childNodes[0].value:"";this.getText=function(){return this.text};this.baseRenderChildren=this.renderChildren;this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var u=new p.Property("fontSize",p.Font.Parse(p.ctx.font).fontSize);p.Mouse.checkBoundingBox(this,new p.BoundingBox(this.x,this.y-u.toPixels("y"),this.x+this.measureText(t),this.y))}else{if(this.children.length>0){var v=new p.Element.g();v.children=this.children;v.parent=this;v.render(t)}}};this.onclick=function(){window.open(this.getHrefAttribute().value)};this.onmousemove=function(){p.ctx.canvas.style.cursor="pointer"}};p.Element.a.prototype=new p.Element.TextElementBase;p.Element.image=function(t){this.base=p.Element.RenderedElementBase;this.base(t);var r=this.getHrefAttribute().value;if(r==""){return}var s=r.match(/\.svg$/);p.Images.push(this);this.loaded=false;if(!s){this.img=document.createElement("img");if(p.opts.useCORS==true){this.img.crossOrigin="Anonymous"}var u=this;this.img.onload=function(){u.loaded=true};this.img.onerror=function(){p.log('ERROR: image "'+r+'" not found');u.loaded=true};this.img.src=r}else{this.img=p.ajax(r);this.loaded=true}this.renderChildren=function(v){var A=this.attribute("x").toPixels("x");var B=this.attribute("y").toPixels("y");var z=this.attribute("width").toPixels("x");var w=this.attribute("height").toPixels("y");if(z==0||w==0){return}v.save();if(s){v.drawSvg(this.img,A,B,z,w)}else{v.translate(A,B);p.AspectRatio(v,this.attribute("preserveAspectRatio").value,z,this.img.width,w,this.img.height,0,0);v.drawImage(this.img,0,0)}v.restore()};this.getBoundingBox=function(){var z=this.attribute("x").toPixels("x");var A=this.attribute("y").toPixels("y");var w=this.attribute("width").toPixels("x");var v=this.attribute("height").toPixels("y");return new p.BoundingBox(z,A,z+w,A+v)}};p.Element.image.prototype=new p.Element.RenderedElementBase;p.Element.g=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.getBoundingBox=function(){var s=new p.BoundingBox();for(var t=0;t<this.children.length;t++){s.addBoundingBox(this.children[t].getBoundingBox())}return s}};p.Element.g.prototype=new p.Element.RenderedElementBase;p.Element.symbol=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.render=function(s){}};p.Element.symbol.prototype=new p.Element.RenderedElementBase;p.Element.style=function(H){this.base=p.Element.ElementBase;this.base(H);var r="";for(var D=0;D<H.childNodes.length;D++){r+=H.childNodes[D].data}r=r.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");r=p.compressSpaces(r);var w=r.split("}");for(var D=0;D<w.length;D++){if(p.trim(w[D])!=""){var v=w[D].split("{");var u=v[0].split(",");var x=v[1].split(";");for(var E=0;E<u.length;E++){var t=p.trim(u[E]);if(t!=""){var J=p.Styles[t]||{};for(var F=0;F<x.length;F++){var I=x[F].indexOf(":");var G=x[F].substr(0,I);var P=x[F].substr(I+1,x[F].length-I);if(G!=null&&P!=null){J[p.trim(G)]=new p.Property(p.trim(G),p.trim(P))}}p.Styles[t]=J;p.StylesSpecificity[t]=f(t);if(t=="@font-face"){var B=J["font-family"].value.replace(/"/g,"");var L=J.src.value.split(",");for(var K=0;K<L.length;K++){if(L[K].indexOf('format("svg")')>0){var O=L[K].indexOf("url");var N=L[K].indexOf(")",O);var M=L[K].substr(O+5,N-O-6);var y=p.parseXml(p.ajax(M));var C=y.getElementsByTagName("font");for(var z=0;z<C.length;z++){var A=p.CreateElement(C[z]);p.Definitions[B]=A}}}}}}}}};p.Element.style.prototype=new p.Element.ElementBase;p.Element.use=function(s){this.base=p.Element.RenderedElementBase;this.base(s);this.baseSetContext=this.setContext;this.setContext=function(t){this.baseSetContext(t);if(this.attribute("x").hasValue()){t.translate(this.attribute("x").toPixels("x"),0)}if(this.attribute("y").hasValue()){t.translate(0,this.attribute("y").toPixels("y"))}};var r=this.getHrefAttribute().getDefinition();this.path=function(t){if(r!=null){r.path(t)}};this.getBoundingBox=function(){if(r!=null){return r.getBoundingBox()}};this.renderChildren=function(t){if(r!=null){var v=r;if(r.type=="symbol"){v=new p.Element.svg();v.type="svg";v.attributes.viewBox=new p.Property("viewBox",r.attribute("viewBox").value);v.attributes.preserveAspectRatio=new p.Property("preserveAspectRatio",r.attribute("preserveAspectRatio").value);v.attributes.overflow=new p.Property("overflow",r.attribute("overflow").value);v.children=r.children}if(v.type=="svg"){if(this.attribute("width").hasValue()){v.attributes.width=new p.Property("width",this.attribute("width").value)}if(this.attribute("height").hasValue()){v.attributes.height=new p.Property("height",this.attribute("height").value)}}var u=v.parent;v.parent=null;v.render(t);v.parent=u}}};p.Element.use.prototype=new p.Element.RenderedElementBase;p.Element.mask=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(v,w){var F=this.attribute("x").toPixels("x");var G=this.attribute("y").toPixels("y");var E=this.attribute("width").toPixels("x");var z=this.attribute("height").toPixels("y");if(E==0&&z==0){var s=new p.BoundingBox();for(var A=0;A<this.children.length;A++){s.addBoundingBox(this.children[A].getBoundingBox())}var F=Math.floor(s.x1);var G=Math.floor(s.y1);var E=Math.floor(s.width());var z=Math.floor(s.height())}var B=w.attribute("mask").value;w.attribute("mask").value="";var u=document.createElement("canvas");u.width=F+E;u.height=G+z;var C=u.getContext("2d");this.renderChildren(C);var t=document.createElement("canvas");t.width=F+E;t.height=G+z;var D=t.getContext("2d");w.render(D);D.globalCompositeOperation="destination-in";D.fillStyle=C.createPattern(u,"no-repeat");D.fillRect(0,0,F+E,G+z);v.fillStyle=D.createPattern(t,"no-repeat");v.fillRect(0,0,F+E,G+z);w.attribute("mask").value=B};this.render=function(s){}};p.Element.mask.prototype=new p.Element.ElementBase;p.Element.clipPath=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(t){var v=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var w=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){};v.call(t);for(var u=0;u<this.children.length;u++){var s=this.children[u];if(typeof s.path!="undefined"){var x=null;if(s.style("transform",false,true).hasValue()){x=new p.Transform(s.style("transform",false,true).value);x.apply(t)}s.path(t);CanvasRenderingContext2D.prototype.closePath=w;if(x){x.unapply(t)}}}w.call(t);t.clip();CanvasRenderingContext2D.prototype.beginPath=v;CanvasRenderingContext2D.prototype.closePath=w};this.render=function(s){}};p.Element.clipPath.prototype=new p.Element.ElementBase;p.Element.filter=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(u,w){var s=w.getBoundingBox();var G=Math.floor(s.x1);var H=Math.floor(s.y1);var F=Math.floor(s.width());var A=Math.floor(s.height());var z=w.style("filter").value;w.style("filter").value="";var C=0,D=0;for(var B=0;B<this.children.length;B++){var v=this.children[B].extraFilterDistance||0;C=Math.max(C,v);D=Math.max(D,v)}var t=document.createElement("canvas");t.width=F+2*C;t.height=A+2*D;var E=t.getContext("2d");E.translate(-G+C,-H+D);w.render(E);for(var B=0;B<this.children.length;B++){if(typeof this.children[B].apply=="function"){this.children[B].apply(E,0,0,F+2*C,A+2*D)}}u.drawImage(t,0,0,F+2*C,A+2*D,G-C,H-D,F+2*C,A+2*D);w.style("filter",true).value=z};this.render=function(s){}};p.Element.filter.prototype=new p.Element.ElementBase;p.Element.feMorphology=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(s,v,w,u,t){}};p.Element.feMorphology.prototype=new p.Element.ElementBase;p.Element.feComposite=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(s,v,w,u,t){}};p.Element.feComposite.prototype=new p.Element.ElementBase;p.Element.feColorMatrix=function(y){this.base=p.Element.ElementBase;this.base(y);var x=p.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var z=x[0];x=[0.213+0.787*z,0.715-0.715*z,0.072-0.072*z,0,0,0.213-0.213*z,0.715+0.285*z,0.072-0.072*z,0,0,0.213-0.213*z,0.715-0.715*z,0.072+0.9280000000000001*z,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var r=x[0]*Math.PI/180;var t=function(s,A,B){return s+Math.cos(r)*A+Math.sin(r)*B};x=[t(0.213,0.787,-0.213),t(0.715,-0.715,-0.715),t(0.072,-0.072,0.9280000000000001),0,0,t(0.213,-0.213,0.143),t(0.715,0.285,0.14),t(0.072,-0.072,-0.283),0,0,t(0.213,-0.213,-0.787),t(0.715,-0.715,0.715),t(0.072,0.9280000000000001,0.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0,1];break}function u(A,D,E,C,s,B){return A[E*C*4+D*4+B]}function v(A,E,F,D,s,B,C){A[F*D*4+E*4+B]=C}function w(s,B){var A=x[s];return A*(A<0?B-255:B)}this.apply=function(B,H,I,G,D){var F=B.getImageData(0,0,G,D);for(var I=0;I<D;I++){for(var H=0;H<G;H++){var E=u(F.data,H,I,G,D,0);var C=u(F.data,H,I,G,D,1);var A=u(F.data,H,I,G,D,2);var s=u(F.data,H,I,G,D,3);v(F.data,H,I,G,D,0,w(0,E)+w(1,C)+w(2,A)+w(3,s)+w(4,1));v(F.data,H,I,G,D,1,w(5,E)+w(6,C)+w(7,A)+w(8,s)+w(9,1));v(F.data,H,I,G,D,2,w(10,E)+w(11,C)+w(12,A)+w(13,s)+w(14,1));v(F.data,H,I,G,D,3,w(15,E)+w(16,C)+w(17,A)+w(18,s)+w(19,1))}}B.clearRect(0,0,G,D);B.putImageData(F,0,0)}};p.Element.feColorMatrix.prototype=new p.Element.ElementBase;p.Element.feGaussianBlur=function(r){this.base=p.Element.ElementBase;this.base(r);this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.extraFilterDistance=this.blurRadius;this.apply=function(s,v,w,u,t){if(typeof n.canvasRGBA=="undefined"){p.log("ERROR: StackBlur.js must be included for blur to work");return}s.canvas.id=p.UniqueId();s.canvas.style.display="none";document.body.appendChild(s.canvas);n.canvasRGBA(s.canvas.id,v,w,u,t,this.blurRadius);document.body.removeChild(s.canvas)}};p.Element.feGaussianBlur.prototype=new p.Element.ElementBase;p.Element.title=function(r){};p.Element.title.prototype=new p.Element.ElementBase;p.Element.desc=function(r){};p.Element.desc.prototype=new p.Element.ElementBase;p.Element.MISSING=function(r){p.log("ERROR: Element '"+r.nodeName+"' not yet implemented.")};p.Element.MISSING.prototype=new p.Element.ElementBase;p.CreateElement=function(t){var r=t.nodeName.replace(/^[^:]+:/,"");r=r.replace(/\-/g,"");var s=null;if(typeof p.Element[r]!="undefined"){s=new p.Element[r](t)}else{s=new p.Element.MISSING(t)}s.type=t.nodeName;return s};p.load=function(r,s){p.loadXml(r,p.ajax(s))};p.loadXml=function(r,s){p.loadXmlDoc(r,p.parseXml(s))};p.loadXmlDoc=function(r,s){p.init(r);var w=function(z){var y=r.canvas;while(y){z.x-=y.offsetLeft;z.y-=y.offsetTop;y=y.offsetParent}if(window.scrollX){z.x+=window.scrollX}if(window.scrollY){z.y+=window.scrollY}return z};if(p.opts.ignoreMouse!=true){r.canvas.onclick=function(y){var z=w(new p.Point(y!=null?y.clientX:event.clientX,y!=null?y.clientY:event.clientY));p.Mouse.onclick(z.x,z.y)};r.canvas.onmousemove=function(y){var z=w(new p.Point(y!=null?y.clientX:event.clientX,y!=null?y.clientY:event.clientY));p.Mouse.onmousemove(z.x,z.y)}}var u=p.CreateElement(s.documentElement);u.root=true;u.addStylesFromStyleDefinition();var v=true;var t=function(){p.ViewPort.Clear();if(r.canvas.parentNode){p.ViewPort.SetCurrent(r.canvas.parentNode.clientWidth,r.canvas.parentNode.clientHeight)}if(p.opts.ignoreDimensions!=true){if(u.style("width").hasValue()){r.canvas.width=u.style("width").toPixels("x");r.canvas.style.width=r.canvas.width+"px"}if(u.style("height").hasValue()){r.canvas.height=u.style("height").toPixels("y");r.canvas.style.height=r.canvas.height+"px"}}var z=r.canvas.clientWidth||r.canvas.width;var y=r.canvas.clientHeight||r.canvas.height;if(p.opts.ignoreDimensions==true&&u.style("width").hasValue()&&u.style("height").hasValue()){z=u.style("width").toPixels("x");y=u.style("height").toPixels("y")}p.ViewPort.SetCurrent(z,y);if(p.opts.offsetX!=null){u.attribute("x",true).value=p.opts.offsetX}if(p.opts.offsetY!=null){u.attribute("y",true).value=p.opts.offsetY}if(p.opts.scaleWidth!=null||p.opts.scaleHeight!=null){var B=null,C=null,A=p.ToNumberArray(u.attribute("viewBox").value);if(p.opts.scaleWidth!=null){if(u.attribute("width").hasValue()){B=u.attribute("width").toPixels("x")/p.opts.scaleWidth}else{if(!isNaN(A[2])){B=A[2]/p.opts.scaleWidth}}}if(p.opts.scaleHeight!=null){if(u.attribute("height").hasValue()){C=u.attribute("height").toPixels("y")/p.opts.scaleHeight}else{if(!isNaN(A[3])){C=A[3]/p.opts.scaleHeight}}}if(B==null){B=C}if(C==null){C=B}u.attribute("width",true).value=p.opts.scaleWidth;u.attribute("height",true).value=p.opts.scaleHeight;u.style("transform",true,true).value+=" scale("+(1/B)+","+(1/C)+")"}if(p.opts.ignoreClear!=true){r.clearRect(0,0,z,y)}u.render(r);if(v){v=false;if(typeof p.opts.renderCallback=="function"){p.opts.renderCallback(s)}}};var x=true;if(p.ImagesLoaded()){x=false;t()}p.intervalID=setInterval(function(){var z=false;if(x&&p.ImagesLoaded()){x=false;z=true}if(p.opts.ignoreMouse!=true){z=z|p.Mouse.hasEvents()}if(p.opts.ignoreAnimation!=true){for(var y=0;y<p.Animations.length;y++){z=z|p.Animations[y].update(1000/p.FRAMERATE)}}if(typeof p.opts.forceRedraw=="function"){if(p.opts.forceRedraw()==true){z=true}}if(z){t();p.Mouse.runEvents()}},1000/p.FRAMERATE)};p.stop=function(){if(p.intervalID){clearInterval(p.intervalID)}};p.Mouse=new (function(){this.events=[];this.hasEvents=function(){return this.events.length!=0};this.onclick=function(r,s){this.events.push({type:"onclick",x:r,y:s,run:function(t){if(t.onclick){t.onclick()}}})};this.onmousemove=function(r,s){this.events.push({type:"onmousemove",x:r,y:s,run:function(t){if(t.onmousemove){t.onmousemove()}}})};this.eventElements=[];this.checkPath=function(t,r){for(var u=0;u<this.events.length;u++){var s=this.events[u];if(r.isPointInPath&&r.isPointInPath(s.x,s.y)){this.eventElements[u]=t}}};this.checkBoundingBox=function(t,r){for(var u=0;u<this.events.length;u++){var s=this.events[u];if(r.isPointInBox(s.x,s.y)){this.eventElements[u]=t}}};this.runEvents=function(){p.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++){var r=this.events[t];var s=this.eventElements[t];while(s){r.run(s);s=s.parent}}this.events=[];this.eventElements=[]}});return p}if(typeof CanvasRenderingContext2D!="undefined"){CanvasRenderingContext2D.prototype.drawSvg=function(w,r,t,q,p,u){var o={ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,offsetX:r,offsetY:t,scaleWidth:q,scaleHeight:p};for(var v in u){if(u.hasOwnProperty(v)){o[v]=u[v]}}c(this.canvas,w,o)}}return c}));(function(a){function b(e){this.ok=false;if(e.charAt(0)=="#"){e=e.substr(1,6)}e=e.replace(/ /g,"");e=e.toLowerCase();var k={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var g in k){if(e==g){e=k[g]}}var d=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(i){return[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(i){return[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(i){return[parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)]}}];for(var f=0;f<d.length;f++){var j=d[f].re;var h=d[f].process;var c=j.exec(e);if(c){channels=h(c);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var m=this.r.toString(16);var l=this.g.toString(16);var i=this.b.toString(16);if(m.length==1){m="0"+m}if(l.length==1){l="0"+l}if(i.length==1){i="0"+i}return"#"+m+l+i};this.getHelpXML=function(){var o=new Array();for(var p=0;p<d.length;p++){var m=d[p].example;for(var q=0;q<m.length;q++){o[o.length]=m[q]}}for(var u in k){o[o.length]=u}var v=document.createElement("ul");v.setAttribute("id","rgbcolor-examples");for(var p=0;p<o.length;p++){try{var s=document.createElement("li");var r=new b(o[p]);var n=document.createElement("div");n.style.cssText="margin: 3px; border: 1px solid black; background:"+r.toHex()+"; color:"+r.toHex();n.appendChild(document.createTextNode("test"));var t=document.createTextNode(" "+o[p]+" -> "+r.toRGB()+" -> "+r.toHex());s.appendChild(n);s.appendChild(t);v.appendChild(s)}catch(l){}}return v}}if(typeof define!=="undefined"&&define.amd){define(function(){return b})}else{if(typeof module!=="undefined"&&module.exports){module.exports=b}}a.RGBColor=b}(typeof window!=="undefined"?window:this));(function(b){var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function d(m){var n=m.data;var o=m.width*m.height*4;for(var l=0;l<o;l+=4){var k=n[l+3]/255;n[l]*=k;n[l+1]*=k;n[l+2]*=k}}function j(m){var n=m.data;var o=m.width*m.height*4;for(var l=0;l<o;l+=4){var k=n[l+3];if(k!=0){k=255/k;n[l]*=k;n[l+1]*=k;n[l+2]*=k}}}function i(p,m,r,k){var q=document.getElementById(p);var s=q.naturalWidth;var o=q.naturalHeight;var l=document.getElementById(m);l.style.width=s+"px";l.style.height=o+"px";l.width=s;l.height=o;var n=l.getContext("2d");n.clearRect(0,0,s,o);n.drawImage(q,0,0);if(isNaN(r)||r<1){return}if(k){h(m,0,0,s,o,r)}else{g(m,0,0,s,o,r)}}function h(D,Z,aa,ac,A,P){if(isNaN(P)||P<1){return}P|=0;var r=document.getElementById(D);var s=r.getContext("2d");var E;try{try{E=s.getImageData(Z,aa,ac,A)}catch(u){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");E=s.getImageData(Z,aa,ac,A)}catch(u){alert("Cannot access local image");throw new Error("unable to access local image data: "+u);return}}}catch(u){alert("Cannot access image");throw new Error("unable to access image data: "+u)}d(E);var K=E.data;var ae,af,C,G,ah,ag,ai,O,z,q,m,N,w,o,l,M,v,n,k,L,J,I,H,R;var t=P+P+1;var ab=ac<<2;var ad=ac-1;var B=A-1;var Q=P+1;var Y=Q*(Q+1)/2;var X=new a();var T=X;for(C=1;C<t;C++){T=T.next=new a();if(C==Q){var U=T}}T.next=X;var V=null;var W=null;ai=ag=0;var F=c[P];var S=e[P];for(af=0;af<A;af++){M=v=n=k=O=z=q=m=0;N=Q*(L=K[ag]);w=Q*(J=K[ag+1]);o=Q*(I=K[ag+2]);l=Q*(H=K[ag+3]);O+=Y*L;z+=Y*J;q+=Y*I;m+=Y*H;T=X;for(C=0;C<Q;C++){T.r=L;T.g=J;T.b=I;T.a=H;T=T.next}for(C=1;C<Q;C++){G=ag+((ad<C?ad:C)<<2);O+=(T.r=(L=K[G]))*(R=Q-C);z+=(T.g=(J=K[G+1]))*R;q+=(T.b=(I=K[G+2]))*R;m+=(T.a=(H=K[G+3]))*R;M+=L;v+=J;n+=I;k+=H;T=T.next}V=X;W=U;for(ae=0;ae<ac;ae++){K[ag]=(O*F)>>S;K[ag+1]=(z*F)>>S;K[ag+2]=(q*F)>>S;K[ag+3]=(m*F)>>S;O-=N;z-=w;q-=o;m-=l;N-=V.r;w-=V.g;o-=V.b;l-=V.a;G=(ai+((G=ae+P+1)<ad?G:ad))<<2;M+=(V.r=K[G]);v+=(V.g=K[G+1]);n+=(V.b=K[G+2]);k+=(V.a=K[G+3]);O+=M;z+=v;q+=n;m+=k;V=V.next;N+=(L=W.r);w+=(J=W.g);o+=(I=W.b);l+=(H=W.a);M-=L;v-=J;n-=I;k-=H;W=W.next;ag+=4}ai+=ac}for(ae=0;ae<ac;ae++){v=n=k=M=z=q=m=O=0;ag=ae<<2;N=Q*(L=K[ag]);w=Q*(J=K[ag+1]);o=Q*(I=K[ag+2]);l=Q*(H=K[ag+3]);O+=Y*L;z+=Y*J;q+=Y*I;m+=Y*H;T=X;for(C=0;C<Q;C++){T.r=L;T.g=J;T.b=I;T.a=H;T=T.next}ah=ac;for(C=1;C<=P;C++){ag=(ah+ae)<<2;O+=(T.r=(L=K[ag]))*(R=Q-C);z+=(T.g=(J=K[ag+1]))*R;q+=(T.b=(I=K[ag+2]))*R;m+=(T.a=(H=K[ag+3]))*R;M+=L;v+=J;n+=I;k+=H;T=T.next;if(C<B){ah+=ac}}ag=ae;V=X;W=U;for(af=0;af<A;af++){G=ag<<2;K[G]=(O*F)>>S;K[G+1]=(z*F)>>S;K[G+2]=(q*F)>>S;K[G+3]=(m*F)>>S;O-=N;z-=w;q-=o;m-=l;N-=V.r;w-=V.g;o-=V.b;l-=V.a;G=(ae+(((G=af+Q)<B?G:B)*ac))<<2;O+=(M+=(V.r=K[G]));z+=(v+=(V.g=K[G+1]));q+=(n+=(V.b=K[G+2]));m+=(k+=(V.a=K[G+3]));V=V.next;N+=(L=W.r);w+=(J=W.g);o+=(I=W.b);l+=(H=W.a);M-=L;v-=J;n-=I;k-=H;W=W.next;ag+=ac}}j(E);s.putImageData(E,Z,aa)}function g(A,V,W,Y,v,L){if(isNaN(L)||L<1){return}L|=0;var n=document.getElementById(A);var o=n.getContext("2d");var B;try{try{B=o.getImageData(V,W,Y,v)}catch(r){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");B=o.getImageData(V,W,Y,v)}catch(r){alert("Cannot access local image");throw new Error("unable to access local image data: "+r);return}}}catch(r){alert("Cannot access image");throw new Error("unable to access image data: "+r)}var G=B.data;var aa,ab,z,D,ad,ac,ae,K,u,m,J,t,l,I,s,k,H,F,E,N;var q=L+L+1;var X=Y<<2;var Z=Y-1;var w=v-1;var M=L+1;var U=M*(M+1)/2;var T=new a();var P=T;for(z=1;z<q;z++){P=P.next=new a();if(z==M){var Q=P}}P.next=T;var R=null;var S=null;ae=ac=0;var C=c[L];var O=e[L];for(ab=0;ab<v;ab++){I=s=k=K=u=m=0;J=M*(H=G[ac]);t=M*(F=G[ac+1]);l=M*(E=G[ac+2]);K+=U*H;u+=U*F;m+=U*E;P=T;for(z=0;z<M;z++){P.r=H;P.g=F;P.b=E;P=P.next}for(z=1;z<M;z++){D=ac+((Z<z?Z:z)<<2);K+=(P.r=(H=G[D]))*(N=M-z);u+=(P.g=(F=G[D+1]))*N;m+=(P.b=(E=G[D+2]))*N;I+=H;s+=F;k+=E;P=P.next}R=T;S=Q;for(aa=0;aa<Y;aa++){G[ac]=(K*C)>>O;G[ac+1]=(u*C)>>O;G[ac+2]=(m*C)>>O;K-=J;u-=t;m-=l;J-=R.r;t-=R.g;l-=R.b;D=(ae+((D=aa+L+1)<Z?D:Z))<<2;I+=(R.r=G[D]);s+=(R.g=G[D+1]);k+=(R.b=G[D+2]);K+=I;u+=s;m+=k;R=R.next;J+=(H=S.r);t+=(F=S.g);l+=(E=S.b);I-=H;s-=F;k-=E;S=S.next;ac+=4}ae+=Y}for(aa=0;aa<Y;aa++){s=k=I=u=m=K=0;ac=aa<<2;J=M*(H=G[ac]);t=M*(F=G[ac+1]);l=M*(E=G[ac+2]);K+=U*H;u+=U*F;m+=U*E;P=T;for(z=0;z<M;z++){P.r=H;P.g=F;P.b=E;P=P.next}ad=Y;for(z=1;z<=L;z++){ac=(ad+aa)<<2;K+=(P.r=(H=G[ac]))*(N=M-z);u+=(P.g=(F=G[ac+1]))*N;m+=(P.b=(E=G[ac+2]))*N;I+=H;s+=F;k+=E;P=P.next;if(z<w){ad+=Y}}ac=aa;R=T;S=Q;for(ab=0;ab<v;ab++){D=ac<<2;G[D]=(K*C)>>O;G[D+1]=(u*C)>>O;G[D+2]=(m*C)>>O;K-=J;u-=t;m-=l;J-=R.r;t-=R.g;l-=R.b;D=(aa+(((D=ab+M)<w?D:w)*Y))<<2;K+=(I+=(R.r=G[D]));u+=(s+=(R.g=G[D+1]));m+=(k+=(R.b=G[D+2]));R=R.next;J+=(H=S.r);t+=(F=S.g);l+=(E=S.b);I-=H;s-=F;k-=E;S=S.next;ac+=Y}}o.putImageData(B,V,W)}function a(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}var f={image:i,canvasRGBA:h,canvasRGB:g};if(typeof define!=="undefined"&&define.amd){define(function(){return f})}else{if(typeof module!=="undefined"&&module.exports){module.exports=f}}b.stackBlur=f}(typeof window!=="undefined"?window:this));function UpdateIsLoggedOn(){if(IsUserLoggedOn&&IsUserLoggedOn!==true){return}var a=GetCookieParameterByName("loggedIn");if(a===true){UpdateIsLoggedOnButton()}else{if(a===false){IsUserLoggedOn=0}else{IsUserLoggedOn=a}}}function showLogonDialog(){showLogonDialogBS()}function ForgotPasswordBS(){var b=$("#forgot_password_username");var c=b.val();if(c.length==0){swalQueue("Please enter your username or email, and we will email you a new password.");return}$.post("/account/forgotpassword?username="+c,function(a){swalQueue("Change Password",a.Message)})}function HandleLogonPasswordKeyPress(a){if(a.which==13){HandleLogon()}}function HandleRegisterPasswordKeyPress(a){if(a.which==13){HandleRegister()}}function PerformLogonViaFullPage(){CleanupLogonForm();$("#LogonForm").attr("action","/account/handlelogon");$("#LogonForm").attr("method","post");$("#LogonForm").submit()}function PerformLogonViaPopBS(){CleanupLogonForm();$.post("/account/handlelogon",$("#LogonForm").serialize(),function(a){$("#login-content").html(a)})}function CleanupLogonForm(){$("#LogOnModel_LogonReturnUrl").attr("name","LogonReturnUrl");$("#LogOnModel_LogonIsPopup").attr("name","LogonIsPopup");$("#LogOnModel_LogonPassword").attr("name","LogonPassword");$("#LogOnModel_LogonUserName").attr("name","LogonUserName");$("#LogOnModel_LogonRememberMe").attr("name","LogonRememberMe")}function PerformRegisterViaFullPage(){if(CheckTermsAndCondtions()==false){return}CleanupRegisterForm();$("#RegistrationForm").attr("action","/account/handleregister");$("#RegistrationForm").attr("method","post");$("#RegistrationForm").submit()}function PerformRegisterViaPopBS(){if(CheckTermsAndCondtions()==false){return}CleanupRegisterForm();$.post("/account/handleregister",$("#RegistrationForm").serialize(),function(a){$("#login-content").html(a)})}function HandleRegisterSSO(a){if(a){if(CheckTermsAndCondtionsSSO()==false){return false}}return true}function CheckTermsAndCondtions(){if($("#RegisterModel_AcceptsTerms").length>0){if($("#RegisterModel_AcceptsTerms").prop("checked")==false){$("#accept-terms-warning").css("display","block");$("#accept-terms-warning-div").css("background","rgb(255, 226, 226)");return false}}if($("#accept-terms-checkbox").length>0&&$("#accept-terms-checkbox").is(":visible")){if($("#accept-terms-checkbox").prop("checked")==false){HighlightTermsOfUse();return false}}return true}function CheckTermsAndCondtionsSSO(){if($("#accept-terms-social").length>0){if($("#accept-terms-social").prop("checked")==false){$("#accept-terms-warning-social").css("display","block");$("#accept-terms-warning-social-div").css("background","rgb(255, 226, 226)");return false}}if($("#accept-terms-checkbox").length>0&&$("#accept-terms-checkbox").is(":visible")){if($("#accept-terms-checkbox").prop("checked")==false){HighlightTermsOfUse();return false}}return true}function CleanupRegisterForm(){$("#RegisterModel_RegisterUserName").attr("name","RegisterUserName");$("#RegisterModel_RegisterEmail").attr("name","RegisterEmail");$("#RegisterModel_RegisterPassword").attr("name","RegisterPassword");$("#RegisterModel_RegisterConfirmPassword").attr("name","RegisterConfirmPassword");$("#RegisterModel_RegisterSbtEmails").attr("name","RegisterSbtEmails");$("#RegisterModel_RegisterPartnerEmails").attr("name","RegisterPartnerEmails");$("#RegisterModel_RegisterReturnUrl").attr("name","RegisterReturnUrl");$("#RegisterModel_AcceptsTerms").attr("name","AcceptsTerms")}function UpdateIsUserLoggedOn(a){var b="/account/isloggedon?time="+new Date().getTime();jQuery.ajax({type:"POST",url:b,async:false,cache:false,dataType:"json",error:function(f,d,e){},success:function(c,d){if(c.IsLoggedOn){IsUserLoggedOn=c.IsLoggedOn}else{IsUserLoggedOn=0}}})}function UpdateIsLoggedOnButton(b,c,a){var d="/account/isloggedon?time="+new Date().getTime();jQuery.ajax({type:"POST",url:d,async:false,cache:false,dataType:"json",error:function(f,g,e){if(typeof a!=="undefined"||a===null){a(f,g,e)}},success:function(g,h){if(g.IsLoggedOn){IsUserLoggedOn=g.IsLoggedOn;$("#nav-logoff-button").attr("style","");$("#nav-logon-button").attr("style","display: none");try{$("#logon-pop-modal").modal("hide");if(typeof b!=="undefined"||b===null){b()}}catch(f){}try{HandleLoginCloseFunction()}catch(f){}}else{$("#nav-logoff-button").attr("style","display: none");$("#nav-logon-button").attr("style","");if(typeof c!=="undefined"||c===null){c()}}}})}function showLogonDialogBS(){UpdateIsLoggedOnButton(null,LoadLogonPop)}function LoadLogonPop(){$("#divLogon").children().remove();$("#divLogon").load("/account/logonpopbs")}function signOutBS(){var a="/account/LogoffPartialBSAsync?uid="+(new Date).getTime();$.post(a);if(SpecialSignOut!=null){window.location.href=SpecialSignOut}$("#nav-logon-button").attr("style","");$("#nav-logoff-button").attr("style","display: none")}function SignInAndCloseLoginPop(){UpdateIsLoggedOnButton(null,null)}function SsoPopupWindow(a,c){var b=window.open("","ssoPopup","width=600,height=600,resizeable,scrollbars");a.target="ssoPopup";var d=setInterval(function(){if(b.closed){clearInterval(d);if(IsUserLoggedOn>0&&c!==void 0){c()}}},1000)}function ajaxPostForm(a,d,c){var b;if(a.is("form")){b=a.serialize()}return jQuery.ajax({type:a.attr("method"),url:a.attr("action"),data:b,async:true,cache:false,timeout:180*1000,error:function(f,g,e){if(typeof c!=="undefined"){c(f,g,e)}},success:function(e,g,f){if(typeof d!=="undefined"){d(e,g,f)}}})}if(IsUserLoggedOn===true){UpdateIsUserLoggedOn()}else{if(IsUserLoggedOn===false){IsUserLoggedOn=0}};function trackEventWithGA(c,b,e,f){try{ga("send","event",c,b,e,f)}catch(d){}}function LogOrphans(c){try{var d=new Object();d.url_title=$("#UrlTitle").val();d.UserName=$("#EditUserName").val();d.orphans=c;$.ajaxAuth({caller:"sbtlib.LogOrphans",type:"POST",url:SbtApiServer+"/logstoryboardorphans",timeout:180*1000,data:d,userKey:IsUserLoggedOn,});DebugLine("Found Orphans: "+c)}catch(b){DebugLine("Log Orphans:"+b)}}function ThrowError(){try{var c=null;var d=c.dnd+10}catch(f){LogErrorMessage("SbtLib.ThrowError",f)}}String.prototype.replaceAll2=function(c,d,b){return this.replace(new RegExp(c.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),(b?"gi":"g")),(typeof(d)=="string")?d.replace(/\$/g,"$$$$"):d)};String.prototype.replaceAll=function(g,e,d){var f,c=-1,b;if((f=this.toString())&&typeof g==="string"){b=d===true?g.toLowerCase():undefined;while((c=(b!==undefined?f.toLowerCase().indexOf(b,c>=0?c+e.length:0):f.indexOf(g,c>=0?c+e.length:0)))!==-1){f=f.substring(0,c).concat(e).concat(f.substring(c+g.length))}}return f};String.prototype.CapitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)};jQuery.extend(jQuery.fn,{hasParent:function(b){return this.filter(function(){return $(b).find(this).length})}});jQuery.fn.getIdArray=function(){var b=[];$("[id]",this).each(function(){b.push(this.id)});return b};String.prototype.ExtractNumber=function(){return Number(this.replace(/(?!-)[^0-9.]/g,""))};String.prototype.rgbTriplet=function(){var e=this.toString();var b=e.substring(4,e.length-1);var f=b.split(",");var d=[];for(var c=0;c<3;c++){d[c]=parseInt(f[c])}return d};String.prototype.luma=function(){var b=this.toString();var c=b.rgbTriplet();return(0.2126*c[0])+(0.7152*c[1])+(0.0722*c[2])};function SplitParenthesis(b){b=b.replace("(","");b=b.replace(")","");b=b.replace(" ","");return b.split(",")}function SplitParenthesisNumeric(d){d=d.replace("(","");d=d.replace(")","");if(d.indexOf(",")<0&&d.indexOf(" ")>0){d=d.replaceAll(" ",",")}d=d.replaceAll(" ","");var c=d.split(",");for(var b=0;b<c.length;b++){c[b]=Number(c[b])}return c}function RecursivelyFindChildrenIds(e,c){attributes=e[0].attributes;aLength=attributes.length;var f=e.get(0).tagName.toLowerCase();for(a=0;a<aLength;a++){var b=attributes[a].name.toLowerCase();if(b.indexOf("id")==0){c.push(attributes[a].value)}}for(var d=0;d<e.children().length;d++){RecursivelyFindChildrenIds(e.children().eq(d),c)}}var _CheckForTextKillSwitch=true;function RecursivelyFindGradientChildrenIds(h,e){var d=h[0].attributes;var b=d.length;var j=h.get(0).tagName.toLowerCase();if(j.indexOf("gradient")>=0||j.indexOf("pattern")>=0||j.indexOf("filter")>=0){for(a=0;a<b;a++){var c=d[a].name.toLowerCase();if(c.indexOf("id")==0){e.push(d[a].value)}}}if(_CheckForTextKillSwitch){var g=h.html();if(g==null||g==""){}else{if(g.indexOf("gradient")<0&&g.indexOf("pattern")<0&&g.indexOf("filter")<0){return}}}for(var f=0;f<h.children().length;f++){RecursivelyFindGradientChildrenIds(h.children().eq(f),e)}}function RecursivelyUpdateChildrenIds(g,h,e){var b=g[0].attributes;if(b!=null){for(a=0;a<b.length;a++){if(b[a].value.indexOf(h)>=0){var f=b[a].value.replaceAll2(h,e);g.attr(b[a].name,f)}}}if(_CheckForTextKillSwitch){var d=g.html();if(d==null||d==""){}else{if(d.indexOf(h)<0){return}}}for(var c=0;c<g.children().length;c++){RecursivelyUpdateChildrenIds(g.children().eq(c),h,e)}}function FindAndUpdateId(h,b,g){if(b==null||b==""){return}var j=$("#"+h);try{var c=j.find("[id]");for(var f=0;f<c.length;f++){if(c[f].getAttribute("id")==b){c[f].setAttribute("id",g);return}}}catch(d){LogErrorMessage("FindAndUpdateId",d)}var k=j.find("[id="+b+"]");if(k!=null&&k.length>0){k.attr("id",g)}}function RemoveAndGetChild_By_ParentId_ChildId(g,b){try{var h=$("#"+g);var c=h.find("[id]");for(var f=0;f<c.length;f++){if(c[f].getAttribute("id")==b){return $(c[f]).remove()}}}catch(d){LogErrorMessage("RemoveChildBy_ParentId_ChildId",d)}return null}function FindAndUpdateIdWildCard(d,b,c){var e=$("#"+d);var f=e.find("[id*="+b+"]");if(f!=null){f.attr("id",c)}}function fastEmpty(b){var c=b.childNodes.length;while(c--){b.removeChild(b.lastChild)}}function MoveAndScale(){this.MoveToX=0;this.MoveToY=0;this.ScaleX=0;this.ScaleY=0}DetermineResizeDirection=function(b){if(b.indexOf("_ne_")>0){return ResizeEnum.NE}else{if(b.indexOf("_nw_")>0){return ResizeEnum.NW}else{if(b.indexOf("_sw_")>0){return ResizeEnum.SW}else{if(b.indexOf("_n_")>0){return ResizeEnum.N}else{if(b.indexOf("_e_")>0){return ResizeEnum.E}else{if(b.indexOf("_s_")>0){return ResizeEnum.S}else{if(b.indexOf("_w_")>0){return ResizeEnum.W}else{return ResizeEnum.SE}}}}}}}};function DistanceBetweenTwoPoints(e,g,f,h){var b=(f-e);var c=(h-g);var d=(b*b)+(c*c);d=Math.sqrt(d);return d}function checkRectangleInnerPoint(c,b){return b.Left<=c.x&&b.Right>=c.x&&b.Top<=c.y&&b.Bottom>=c.y}function checkPolygonInnerPoint(f,g){var h=f.x,m=f.y;var c=false;for(var b=0,e=g.length-1;b<g.length;e=b++){var k=g[b].x,n=g[b].y;var l=g[e].x,o=g[e].y;var d=((n>m)!=(o>m))&&(h<(l-k)*(m-n)/(o-n)+k);if(d){c=!c}}return c}function checkLineIntersection(b,c,d,e,f,g,h,i){var l,m,n,o;l=d-b;m=e-c;n=h-f;o=i-g;var k,p;k=(-m*(b-f)+l*(c-g))/(-n*m+l*o);p=(n*(c-g)-o*(b-f))/(-n*m+l*o);var j={intersect:false,x:0,y:0};if(k>=0&&k<=1&&p>=0&&p<=1){j.x=b+(p*l);j.y=c+(p*m);j.intersect=true}return j}Number.prototype.Truncate=function(b){if(b==null){b=1}var c=this-Math.pow(10,-b)/2;c+=c/Math.pow(2,53);return c.toFixed(b)};function stringToByteArray(e){var c=[],d,f;for(d=0;d<e.length;d++){f=e.charCodeAt(d);if(f<=127){c.push(String.fromCharCode(f))}else{if(f<=2047){c.push(String.fromCharCode((f>>6)|192));c.push(String.fromCharCode((f&63)|128))}else{if(f<=65535){c.push(String.fromCharCode((f>>12)|224));c.push(String.fromCharCode(((f>>6)&63)|128));c.push(String.fromCharCode((f&63)|128))}else{c.push(String.fromCharCode((f>>18)|240));c.push(String.fromCharCode(((f>>12)&63)|128));c.push(String.fromCharCode(((f>>6)&63)|128));c.push(String.fromCharCode((f&63)|128))}}}}return c}function adler32(f){var h=65521;var c=1,e=0;var g;for(g=0;g>f.length;++g){c=(c+f.charCodeAt(g))%h;e=(e+c)%h}var d=c|(e<<16);return String.fromCharCode(((d>>24)&255),((d>>16)&255),((d>>8)&255),((d>>0)&255))}function hexToR(b){return parseInt((cutHex(b)).substring(0,2),16)}function hexToG(b){return parseInt((cutHex(b)).substring(2,4),16)}function hexToB(b){return parseInt((cutHex(b)).substring(4,6),16)}function cutHex(b){return(b.charAt(0)=="#")?b.substring(1,7):b}function GetRgb(b){R=hexToR(b);G=hexToG(b);B=hexToB(b);DebugLine("rgb("+R+", "+G+", "+B+")")}function LowerCaseCompare(c,d){if(c==null){return false}if(d==null){return false}try{return(c.toLowerCase()==d.toLowerCase())}catch(b){return false}}function GetSafeAttributeNS(d,b){try{var f=d.getAttributeNS("",b);if(f!=null&&f.length>0){return f}b=b.toLowerCase();return d.getAttributeNS("",b)}catch(c){try{var f=d.getAttribute(b);if(f!=null&&f.length>0){return f}b=b.toLowerCase();return d.getAttribute(b)}catch(c){return null}}}function ExtractPositionPoint(e){var b=e.children().first();var c=b.attr("cx");var d=b.attr("cy");var f=new Object();f.X=parseFloat(c);f.Y=parseFloat(d);return f}function ParseRawSVG(f){try{var b=document.createElementNS("http://www.w3.org/1999/xhtml","div");b.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+f+"</svg>";var d=document.createDocumentFragment();while(b.firstChild.firstChild){d.appendChild(b.firstChild.firstChild)}return $(d)}catch(c){LogErrorMessage("SbtLib.ParseRawSVG",c)}return null}function GetIESafeChild(d,b){try{if(d.children!=null){return d.children[b]}}catch(c){}return d.childNodes[b]}var FUNCTION_KEYWORD="function",OBJECT_KEYWORD="object",STRING_KEYWORD="string",PERIOD_STRING=".",EMPTY_STRING="",SPACE_STRING=" ",COMMA_STRING=",",UNDERSCORE_STRING="_",APOSTROPHE_STRING="'";String.prototype.endsWith=function(b){return this.indexOf(b,this.length-b.length)!==-1};String.prototype.startsWith=function(b){return this.indexOf(b)===0};String.prototype.trim=function(){return this.replace(/^\s\s*/,EMPTY_STRING).replace(/\s\s*$/,EMPTY_STRING)};String.prototype.trimLeft=function(){return this.replace(/^\s\s*/,EMPTY_STRING)};String.prototype.trimRight=function(){return this.replace(/\s\s*$/,EMPTY_STRING)};String.prototype.cleanSpace=function(){return this.replace(/\s+/g,SPACE_STRING)};String.prototype.encodeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")};String.prototype.decodeHTML=function(){var b=document.createElement("textarea");b.innerHTML=this;return b.value};if(!Object.prototype.hasOwnProperty){Object.prototype.hasOwnProperty=function(b){var c=obj.__proto__||obj.constructor.prototype;return(b in this)&&(!(b in c)||c[b]!==this[b])}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){for(var b=0;b<this.length;b++){if(this[b]===c){return b}}return -1}}(function(b){b.fn.cleanupInput=function(c){var d=b.extend({trim:true,cleanspace:false,nospace:false,anstart:false,cleancode:false,noquotes:false},c);return this.each(function(){var e=b(this);var g=e.val();var f=g;if(d.trim||d.anstart||d.cleancode){f=f.trim()}if(d.nospace){f=f.replace(/\s/g,EMPTY_STRING)}else{if(d.cleanspace){f=f.cleanSpace()}}if(d.noquotes){f=f.replace(/['"]+/g,EMPTY_STRING)}if(d.anstart||d.cleancode){f=f.replace(/^[^0-9a-zA-Z]+/g,EMPTY_STRING)}if(d.cleancode){f=f.replace(/[^-_0-9a-zA-Z]+/g,EMPTY_STRING)}if(f!==g){e.val(f)}})}}(jQuery));(function(b){b.fn.fixedVal=function(){var c=b(this);var e=c.val();var d=c.attr("placeholder");if(e===d){return EMPTY_STRING}return e}}(jQuery));var isLIHit=function(b,c){while(b.nodeName!=="LI"&&b!==c){b=b.parentNode}if(b.nodeName!=="LI"){return null}return b};var SbtLib=function(){var b=new Object();b.IndexOf=function(c,i,d){var g=c?c.length:0;if(typeof d=="number"){d=d<0?nativeMax(g+d,0):d}else{d=0}var e=(d||0)-1,f=i===i;while(++e<g){var h=c[e];if((f?h===i:h!==h)){return e}}return -1};b.DeepCopy=function(c){return JSON.parse(JSON.stringify(c))};b.DeepCompareEquality=function(d,e){if(d===e){return true}if(!(d instanceof Object)||!(e instanceof Object)){return false}if(d.constructor!==e.constructor){return false}for(var c in d){if(!d.hasOwnProperty(c)){continue}if(!e.hasOwnProperty(c)){return false}if(d[c]===e[c]){continue}if(typeof(d[c])!=="object"){return false}if(!SbtLib.DeepCompareEquality(d[c],e[c])){return false}}for(c in e){if(e.hasOwnProperty(c)&&!d.hasOwnProperty(c)){return false}}return true};return b}();function ConvexHullGrahamScan(){this.anchorPoint=undefined;this.reverse=false;this.points=[]}ConvexHullGrahamScan.prototype={constructor:ConvexHullGrahamScan,Point:function(b,c){this.x=b;this.y=c},_findPolarAngle:function(c,e){var h=57.295779513082;var f,g;if(!c||!e){return 0}f=(e.x-c.x);g=(e.y-c.y);if(f==0&&g==0){return 0}var d=Math.atan2(g,f)*h;if(this.reverse){if(d<=0){d+=360}}else{if(d>=0){d+=360}}return d},addPoint:function(c,d){var b=(this.anchorPoint===undefined)||(this.anchorPoint.y>d)||(this.anchorPoint.y===d&&this.anchorPoint.x>c);if(b){if(this.anchorPoint!==undefined){this.points.push(new this.Point(this.anchorPoint.x,this.anchorPoint.y))}this.anchorPoint=new this.Point(c,d)}else{this.points.push(new this.Point(c,d))}},_sortPoints:function(){var b=this;return this.points.sort(function(c,d){var e=b._findPolarAngle(b.anchorPoint,c);var f=b._findPolarAngle(b.anchorPoint,d);if(e<f){return -1}if(e>f){return 1}return 0})},_checkPoints:function(e,f,g){var d;var c=this._findPolarAngle(e,f);var b=this._findPolarAngle(e,g);if(c>b){d=c-b;return !(d>180)}else{if(c<b){d=b-c;return(d>180)}}return true},getHull:function(){var c=[],g,h;this.reverse=this.points.every(function(i){return(i.x<0&&i.y<0)});g=this._sortPoints();h=g.length;if(h<3){g.unshift(this.anchorPoint);return g}c.push(g.shift(),g.shift());while(true){var d,e,f;c.push(g.shift());d=c[c.length-3];e=c[c.length-2];f=c[c.length-1];if(this._checkPoints(d,e,f)){c.splice(c.length-2,1)}if(g.length==0){if(h==c.length){var b=this.anchorPoint;c=c.filter(function(i){return !!i});if(!c.some(function(i){return(i.x==b.x&&i.y==b.y)})){c.unshift(this.anchorPoint)}return c}g=c;h=g.length;c=[];c.push(g.shift(),g.shift())}}}};this.CommonStylingEnum={ShapeSelector_HotSpot_Corner_Stroke:"#AAA393",ShapeSelector_HotSpot_Corner_Fill:"#6285C7",ShapeSelector_HotSpot_Corner_CircleSize:5,ShapeSelector_HotSpot_Side_Stroke:"#6285C7",ShapeSelector_HotSpot_Side_Fill:"#AAA393",ShapeSelector_HotSpot_Side_CircleSize:5,ShapeSelector_RotateBar_Css:"RotateBar",ShapeSelector_ResizeHotSpot_NW_Css:"ResizeNW",ShapeSelector_ResizeHotSpot_NE_Css:"ResizeNE",ShapeSelector_ResizeHotSpot_V_Css:"ResizeV",ShapeSelector_ResizeHotSpot_H_Css:"ResizeH",};this.CropTypeEnum={Standard:0,Advanced:1,Circle:2,};this.InstaPoseEnum={Angry:1,Speaking:2,Explaining:3,Sad:4,Sleeping:5,Complaining:6,Holding:7,Confusion:8,Upset:9,Sit:10,Determined:11,Happy:12,Walking:13,Shouting:14,Scared:15,};MovePhaseEnum={Start:"start",Move:"Move",End:"End"};PinchResizeEnum={Proportional:1,Vertical:2,Horizontal:3};ResizeEnum={NE:"NE",SE:"SE",NW:"NW",SW:"SW",N:"N",S:"S",E:"E",W:"W",NSEW:"NSEW",};SbtConstants={SelectionAreaStrokeColor:"#526C85",SelectionAreaFillColor:"#D0E8F4",SelectionAreaStrokeDash:"4.4",SelectionAreaOpacity:0.75,};this.SbtDataEnum={Attribute_TiltOption_Title:"Title",Attribute_TiltOption_Degree:"Degree",Attribute_TiltPose_Title:"Title",Attribute_TiltPose_DefaultTilt:"DefaultTilt",Attribute_TiltPose_TiltableId:"TiltableId",Attribute_TiltPose_Tiltable2Id:"Tiltable2Id",Attribute_TiltPose_PivotId:"PivotId",Attribute_TiltPose_ClearId:"ClearId",Attribute_SwapOption_Title:"Title",Attribute_SwapOption_SwapId:"SwapId",Attribute_SwapPose_Title:"Title",Attribute_SwapPose_DefaultId:"DefaultSwapId",Attribute_SwapPose_AppendToId:"AppendToId",Attribute_LibrarySwapOption_Title:"Title",Attribute_LibrarySwapOption_SwapId:"SwapLibraryId",Attribute_LibrarySwapPose_Title:"Title",Attribute_LibrarySwapPose_DefaultId:"DefaultLibrarySwapId",Attribute_LibrarySwapPose_StartPointId:"StartPointId",Attribute_LibrarySwapPose_AppendToId:"AppendToId",Attribute_SmartSceneItemOption_Title:"Title",Attribute_SmartSceneItemOption_TurnOn:"TurnOn",Attribute_SmartSceneItemOption_TurnOff:"TurnOff",Attribute_SmartSceneItemOption_Default:"Default",Attribute_SmartSceneItemOptionColor_Region:"Region",Attribute_SmartSceneItemOptionColor_ReplaceColor:"ReplaceColor",Attribute_Pose_Type:"Type",PoseType_Swap:"Swap",PoseType_Tilt:"Tilt",PoseType_LibrarySwap:"LibrarySwap",Id_SwapOption_Middle:"_poseswap_",Id_Swap_Middle:"_SWAP_",Id_GlobalLibrary_Middle:"_Library_",Id_Storage:"storage",Id_DisplayOption:"DisplayOption",GlobalLibraryId:"gsl",GlobalLibraryFacesFrontId:"gsl_faces_front",GlobalLibraryFacesSideId:"gsl_faces_side",MetaData_Posable:"posable",MetaData_Poses:"pose",MetaData_Position:"position",MetaData_SmartScene:"smartscene",MetaData_SmartSceneItem:"smartsceneitem",MetaData_SmartSceneItemOption:"smartsceneitemoption",MetaData_SmartSceneItemOptionColor:"smartsceneitemoptioncolor",MetaData_Springable_Anchorset:"anchorset",MetaData_Springable_SpringSet:"springset",MetaData_Springable_Attribute_Side:"side",MetaData_Springable_Attribute_Direction:"direction",MetaData_Springable_Attribute_Groups:"groups",AttributeGlobalImageId:"sbt_image_id",};ShapeActionEnum={Nothing:"Nothing",Selected:"Selected",SelectedControlsHidden:"Selected twice",Move:"moving",Resize:"Resizing",Rotating:"Rotating",MultiSelecting:"MultiSelecting"};this.SvgPartsEnum={ShapeId:"sbt_",Natural:"_natural",Defs:"_defs",ClipPath:"_clipPath",ClipRect:"_clipRect",ClipPolygon:"_clipPolygon",ClipEllipse:"_clipEllipse",Scale:"_scale",CropGroup:"_cropGroup",SvgImage:"_svgImage",ImaginaryBox:"_imaginary_box",SelectionBox:"_selection_box",SelectionBoxRectangle:"_selection_box_rect",SelectionBoxRectangleWrapper:"_selection_box_rect_wrap",RotateCircle:"_rotate_circle",RotateCircleBar:"_rotate_circle_bar",RotateCircleGroup:"_rotate_circle_group",Selector_NW:"_nw_circle",Selector_NE:"_ne_circle",Selector_SW:"_sw_circle",Selector_SE:"_se_circle",Selector_W:"_w_circle",Selector_E:"_e_circle",Selector_N:"_n_circle",Selector_S:"_s_circle",Imaginary_NE:"_imaginary_ne",Imaginary_NW:"_imaginary_nw",Imaginary_SE:"_imaginary_se",Imaginary_SW:"_imaginary_sw",};this.StoryboardLayoutType={StoryboardGrid:"StoryboardGrid",TChart:"TChart",Frayer:"Frayer",Spider:"Spider",Timeline:"Timeline",Matrix:"Matrix",Movie:"Movie",ParallelLabelMatrix:"ParallelLabelMatrix",Cycle:"Cycle",PortraitPaper:"PortraitPaper",LandscapePaper:"LandscapePaper",PortraitLegal:"PortraitLegal",LandscapeLegal:"LandscapeLegal",PortraitTabloid:"PortraitTabloid",LandscapeLedger:"LandscapeLedger",FreeSize:"FreeSize",};this.StoryboardPartTypeEnum={StoryboardCell:1,StoryboardCellTitle:2,StoryboardCellDescription:3,StoryboardAreaTitle:4,StoryboardCellOuterBox:5,StoryboardAttributionArea:6};var AlignHelper=function(){var a=new Object();a.AlignLeft=function(){var c=function(f,h,i,d,e){var g=new Object();g.X=f-e.Left;g.Y=0;return g};b(null,c)};a.AlignRight=function(){var c=function(f,h,i,d,e){var g=new Object();g.X=h-e.Right;g.Y=0;return g};b(null,c)};a.AlignCenter=function(){var c=function(h,j,k,d,g){var e=(h+j)/2;var l=g.Right-g.Left;var f=e-l/2;var i=new Object();i.X=f-g.Left;i.Y=0;return i};b(null,c)};a.HorizontalDistribution=function(){var c=function(k,m,o,d,g,q,p,j,e,n){if(j==0||j==e-1){return new Object({X:0,Y:0})}var h=((m-k)-(q))/(e-1);var f=h+n;var l=new Object();l.X=f-g.Left;l.Y=0;return l};b(Sorters.SortShapesByVisibleX,c)};a.AlignTop=function(){var c=function(f,h,i,d,e){var g=new Object();g.X=0;g.Y=i-e.Top;return g};b(null,c)};a.AlignBottom=function(){var c=function(f,h,i,d,e){var g=new Object();g.X=0;g.Y=d-e.Bottom;return g};b(null,c)};a.AlignMiddle=function(){var c=function(i,k,l,d,g){var e=(l+d)/2;var h=g.Bottom-g.Top;var f=e-h/2;var j=new Object();j.X=0;j.Y=f-g.Top;return j};b(null,c)};a.VerticalDistribution=function(){var c=function(k,m,p,d,g,r,q,j,e,o,n){if(j==0||j==e-1){return new Object({X:0,Y:0})}var h=((d-p)-(q))/(e-1);var f=h+n;var l=new Object();l.X=0;l.Y=f-g.Top;return l};b(Sorters.SortShapesByVisibleY,c)};function b(r,j){try{var o=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(o.length===0){return}o=o.filter(function(e){return e.Movable});if(o.length===0){return}var v=new Array();var k=new Array();if(r!=null){o=o.sort(r)}var p=new Object();var g;var l;var s;var c;var u=0;var t=0;for(var f=0;f<o.length;f++){var q=o[f];p[q.Id]=q.Public_GetImaginaryOuterBox();if(f==0){g=p[q.Id].Left;l=p[q.Id].Right;s=p[q.Id].Top;c=p[q.Id].Bottom}g=Math.min(g,p[q.Id].Left);l=Math.max(l,p[q.Id].Right);s=Math.min(s,p[q.Id].Top);c=Math.max(c,p[q.Id].Bottom);u+=p[q.Id].Right-p[q.Id].Left;t+=p[q.Id].Bottom-p[q.Id].Top}g=Math.max(g,0);s=Math.max(s,0);l=Math.min(StoryboardContainer.CoreSvgRight-StoryboardContainer.CoreSvgLeft,l);c=Math.min(StoryboardContainer.CoreSvgBottom-StoryboardContainer.CoreSvgTop,c);var n=0;var m=0;for(var f=0;f<o.length;f++){var h=j(g,l,s,c,p[o[f].Id],u,t,f,o.length,n,m);n=p[o[f].Id].Right+h.X;m=p[o[f].Id].Bottom+h.Y;v.push({Id:o[f].Id,X:h.X*-1,Y:h.Y*-1});k.push({Id:o[f].Id,X:h.X,Y:h.Y});o[f].MoveDistance(h.X,h.Y)}UndoManager.register(undefined,UndoShapeMoveArray,v,"",undefined,UndoShapeMoveArray,k,"");UpdateActiveDrawing()}catch(d){LogErrorMessage("SvgManip.AlignLeft",d)}}return a}();var CellPickerHelper=function(){var c=new Object();var g=new Object();g.SelectedCell=null;g.ActionType="";g.UndoCount=0;g.ActionMethod=null;g.CopyActionType="copy";g.MoveActionType="move";g.WidthRatio=1;g.CoreSVGRegion={width:0,height:0,margin:"",state:false};g.CalcPoint=document.getElementById("CoreSvg").createSVGPoint();c.Props=g;function j(){$("#StoryboardCreatorWrapper").toggle();$(".Upgrade-Bar").toggleClass("hide-in-fullscreen");$("#bottom-toolbar-controls").toggle();$("#bottom-toolbar-advice").toggle();$("#tab-roller").toggle();$("#bt-copy-cell-undo").css("display","none");StoryboardContainer.JiggleSvgSize();StoryboardContainer.SetCoreSvgDimensions()}function i(){if(!g.CoreSVGRegion.state){g.CoreSVGRegion={width:document.getElementById("CoreSvg").getAttributeNS(null,"width"),height:document.getElementById("CoreSvg").getAttributeNS(null,"height"),margin:$("#CoreSvg").css("margin"),state:true}}}function h(){document.getElementById("CoreSvg").setAttributeNS(null,"width",g.CoreSVGRegion.width);document.getElementById("CoreSvg").setAttributeNS(null,"height",g.CoreSVGRegion.height);$("#CoreSvg").css("margin",g.CoreSVGRegion.margin);g.CoreSVGRegion.state=false}c.getScreenPointFromSVG=function(m,n){g.CalcPoint.x=m;g.CalcPoint.y=n;return g.CalcPoint.matrixTransform(document.getElementById("CoreSvg").getScreenCTM())};c.getSVGPointFromScreen=function(m,n){g.CalcPoint.x=m;g.CalcPoint.y=n;return g.CalcPoint.matrixTransform(document.getElementById("CellDefinition").getScreenCTM().inverse())};function d(){i();var w=$(window).width();var t=$(window).height();var q=w-10;var p=t-70-10;document.getElementById("CoreSvg").setAttribute("viewBox",0+" "+0+" "+g.CoreSVGRegion.width+" "+g.CoreSVGRegion.height);document.getElementById("CoreSvg").setAttributeNS(null,"width",q);document.getElementById("CoreSvg").setAttributeNS(null,"height",p);g.WidthRatio=g.CoreSVGRegion.width/q;$("#CoreSvg").css("margin","5 5 5 5");$("#cell-overlay-helper").remove();MyPointers.SvgContainer.css("position","fixed");MyPointers.SvgContainer.append("<div id='cell-overlay-helper' class='cell-overlay-parent-div'></div>");var m=$("#cell-overlay-helper");var x=parseFloat(MyPointers.SvgContainer.css("height"));var y=parseFloat(MyPointers.SvgContainer.css("width"));m.css("height",x+"px");m.css("width",y+"px");m.css("margin","0");for(var o=0;o<StoryboardContainer.Cols;o++){for(var s=0;s<StoryboardContainer.Rows;s++){var n=CellConfiguration.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCell,s,o);var u=CellPickerHelper.getScreenPointFromSVG(n.X,n.Y);var v=CellPickerHelper.getScreenPointFromSVG(n.X+n.Width,n.Y+n.Height);var z=v.x-u.x;var r=v.y-u.y;a(m,u.x,u.y,z,r,s,o,StoryboardPartTypeEnum.StoryboardCell);if(CellConfiguration.HasTitle){b(m,u.x,u.y,z,r,s,o,StoryboardPartTypeEnum.StoryboardCellTitle)}if(CellConfiguration.HasDescription){b(m,u.x,u.y,z,r,s,o,StoryboardPartTypeEnum.StoryboardCellDescription)}}}}function a(o,w,x,v,q,t,p,s){var m=$("#"+MyIdGenerator.GenerateCellId(t,p));if(m.length==0){return}var r=MyIdGenerator.GenerateCellOverlayId(t,p,s);o.append("<div id='"+r+"' class='cell-overlay-cell'></div>");var u=parseFloat(m.attr("stroke-width"))/2;u=isNaN(u)?0:u;var n=$("#"+r);n.css("top",x+"px");n.css("left",w+"px");n.css("width",v+"px");n.css("height",q+"px");n.click(e(t,p))}function b(o,t,s,w,q,u){var v=CellConfiguration.GetCellPartPosition(u,w,q);if(!v||v.length==0){return}var r=MyIdGenerator.GenerateCellOverlayId(w,q,u);o.append("<div id='"+r+"' class='cell-overlay-cell'></div>");var n=$("#"+r);var m=s+v.X;var p=t+v.Y;n.css("top",p+"px");n.css("left",m+"px");n.css("height",v.Height+"px");n.css("width",v.Width+"px");n.click(e(w,q))}function e(n,m){return function(){if(g.SelectedCell==null){$("#"+MyIdGenerator.GenerateCellOverlayId(n,m,StoryboardPartTypeEnum.StoryboardCell)).addClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(n,m,StoryboardPartTypeEnum.StoryboardCellDescription)).addClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(n,m,StoryboardPartTypeEnum.StoryboardCellTitle)).addClass("cell-overlay-cell-selected");g.SelectedCell=new Object({Row:n,Col:m});l(2)}else{$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCell)).removeClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCellDescription)).removeClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCellTitle)).removeClass("cell-overlay-cell-selected");if(g.SelectedCell.Row==n&&g.SelectedCell.Col==m){l(1)}else{g.ActionMethod(g.SelectedCell.Row,g.SelectedCell.Col,n,m);l(3)}g.SelectedCell=null;CellPickerHelper.UpdateIfNeeded()}}}function l(m){$("#bt-copy-part-1").css("display","none");$("#bt-copy-part-2").css("display","none");$("#bt-copy-part-3").css("display","none");$("#bt-move-part-1").css("display","none");$("#bt-move-part-2").css("display","none");$("#bt-move-part-3").css("display","none");$("#bt-"+g.ActionType+"-part-"+m).css("display","");if(m==3){$("#bt-copy-cell-undo").css("display","");g.UndoCount++}}function f(){g.UndoCount=0;g.SelectedCell=null;ClearActiveState();l(1);j();d()}c.UndoHelper=function(){Undo();g.UndoCount--;if(g.UndoCount<1){$("#bt-copy-cell-undo").css("display","none")}};c.UpdateIfNeeded=function(){if(g.ActionType==""){return}if($("#cell-overlay-helper").length==0){return}d();if(g.SelectedCell!=null){$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCell)).addClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCellDescription)).addClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCellTitle)).addClass("cell-overlay-cell-selected")}};function k(){var m=MyShapesState.Public_GetAllShapeStates();var n;for(n=0;n<m.length;n++){m[n].UpdateDrawing(true)}}c.StartCopyCell=function(){g.ActionType=g.CopyActionType;g.ActionMethod=CopyHelper.CopyCell;f();k()};c.StartMoveCell=function(){g.ActionType=g.MoveActionType;g.ActionMethod=MoveCellHelper.SwapCell;f();k()};c.Finish=function(){MyPointers.SvgContainer.css("position","fixed");h();$("#cell-overlay-helper").remove();document.getElementById("CoreSvg").removeAttribute("viewBox");j();g.WidthRatio=1;k();g.ActionType=null};return c}();var CellSorterHelper=function(){var a=new Object();a.ChangeCellOrder=function(e){for(var c=0;c<e.length;c++){var b=e[c];var f=StoryboardContainer.GetShapeStatesForCell(b.oldCol,b.oldRow);for(var d=0;d<f.length;d++){}}};return a}();var ClipboardHelper=function(){var i=new Object();var h="<!--sbt>browserState</<sbt>-->";var n=null;var m=null;var g={x:0,y:0};var k=function(p){g={x:p.pageX,y:p.pageY};if($(p.target).parents("div.note-editor").length>0){return}var q=document.createRange();q.selectNodeContents(document.getElementById("svgContainer"));q.collapse();var r=document.getSelection();r.removeAllRanges();r.addRange(q)};var l=function(){var p=document.getSelection();if(p.rangeCount!==1){return false}if(p.toString()===""){return true}return false};var b=function(p){if(!l()){return}n=MyShapesState.Public_GetAllSelectedShapeStates();var r=MyShapesState.Public_GetAllSelectedShapes();if(r.length>0){m=[];for(var q=0;q<r.length;q++){m.push($(r[q][0]).html())}}p.originalEvent.clipboardData.setData("text/plain","");p.originalEvent.clipboardData.setData("text/html",h);p.preventDefault()};var c=function(p){if(!l()){return}window.seb=p;alert("cut")};var a=function(p){if(h===p){alert("k")}else{alert("crap")}};var j=function(r){if(!l()){return}r.preventDefault();r.stopPropagation();var p=r.originalEvent.clipboardData.items;if(!p){return}for(var s=0;s<p.length;s++){item=p[s];if(/image/.test(item.type)){alert("got image");var q=item.getAsFile();var t=new FileReader();t.onload=function(u){o(u.target.result,function(w,z,x,y){if(y!=="success"){return}var v=e(w,z,x);d(v,u)},3000)};t.readAsDataURL(q)}else{if(/text\/html/.test(item.type)){item.getAsString(a)}else{alert(item.type)}}}};var o=function(u,p,s){s=s||5000;var r=false,t;var q=new Image();q.onerror=q.onabort=function(){if(!r){clearTimeout(t);p(u,0,0,"error")}};q.onload=function(){if(!r){clearTimeout(t);p(u,this.width,this.height,"success")}};q.src=u;t=setTimeout(function(){r=true;p(u,0,0,"timeout")},s)};var f=function(q){try{StoryboardContainer.SetCoreSvgDimensions();var p=GetGlobalById("CoreSvg").getBoundingClientRect();var s=(p.width-2);var r=(p.height-2);var t=g.x;var u=g.y;if(q!=null&&q.pageX!=null&&q.pageY!=null){t=q.pageX;u=q.pageY}t=PageXtoStoryboardX(q.pageX);u=PageYtoStoryboardY(q.pageY);if(isNaN(t)||isNaN(u)){return{x:s/2,y:r/2}}if((t<0||t>s)&&(u<0||u>r)){return{x:s/2,y:r/2}}return{x:Math.min(Math.max(t,0),s-25),y:Math.min(Math.max(u,0),r-50)}}catch(t){return{x:0,y:0}}};var e=function(q,r,p){return $('<g id="clipart_import" transform="scale(1.0)"><sbtdata><attribution title="Pasted Image" author="N/A" imageurl="N/A" license="N/A"></attribution></sbtdata><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+r+'px" height="'+p+'px"><image x="0" y="0" width="'+r+'px" height="'+p+'px" xlink:href="'+q+'"></image></svg></g>')};var d=function(p,s){try{ClearActiveState();warnOnExit=true;var q=f(s);StoryboardContainer.UpdateGradientIds(p);AddSvg.AddSvgToStoryboard(p,q.x,q.y,true,false)}catch(r){LogErrorMessage("ClipboardHelper.dropImage",r)}};return i}();var CopyHelper=function(){var a=new Object();a.CopyCellAction=function(K,J,w,v,D){var L=MyIdGenerator.GenerateCellId(K,J);var A=MyIdGenerator.GenerateCellId(w,v);var p={id:A,undoCellCropRatio:StoryboardContainer.GlobalCellCropRatio[A]?JSON.parse(JSON.stringify(StoryboardContainer.GlobalCellCropRatio[A])):{A1:0,A2:1,A3:0,B1:0,B2:1,B3:0},redoCellCropRatio:StoryboardContainer.GlobalCellCropRatio[L]?JSON.parse(JSON.stringify(StoryboardContainer.GlobalCellCropRatio[L])):{A1:0,A2:1,A3:0,B1:0,B2:1,B3:0}};if(StoryboardContainer.GlobalCellCropRatio[L]){StoryboardContainer.GlobalCellCropRatio[A]=JSON.parse(JSON.stringify(StoryboardContainer.GlobalCellCropRatio[L]))}var I=$("#"+L);var u=$("#"+A);var s=parseFloat(u.attr("x"))-parseFloat(I.attr("x"));var t=parseFloat(u.attr("y"))-parseFloat(I.attr("y"));var H=StoryboardContainer.GetShapeStatesForCell(K,J);var M={undoArray:[],redoArray:[]};if(D){var y=StoryboardContainer.GetShapeStatesForCell(w,v);var x=y[StoryboardPartTypeEnum.StoryboardCell];var O=new Array();var G=new Array();for(var B=0;B<x.length;B++){var g=x[B];var C=g.Id;var f=$("#"+C);var E=f.next();var F=E.attr("id");G.push({Detached:f,NextShapeId:F,Id:C,ShapeState:MyShapesState.Public_GetShapeStateById(C)});O.push({Id:C});MyShapesState.Public_RemoveShapeStateById(C);var z=$("#"+C).detach()}M.undoArray=O;M.redoArray=G}var N=new Array();N=H[StoryboardPartTypeEnum.StoryboardCell].concat(H[StoryboardPartTypeEnum.StoryboardCellTitle],H[StoryboardPartTypeEnum.StoryboardCellDescription]);var n=null;var o=null;var m=null;var j=null;var k=null;var h=null;var r=null;var q=null;if(CellConfiguration.HasTitle||CellConfiguration.HasDescription){if(CellConfiguration.HasTitle){n=MyIdGenerator.GenerateTitleCellId(w,v);r=MyShapesState.Public_GetShapeStateById(n);o=r.TextState.Public_GetFontStyles();m=r.ColorableState.Public_GetColorStyles();q=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateTitleCellId(K,J));c(r,q)}if(CellConfiguration.HasDescription){j=MyIdGenerator.GenerateDescriptionCellId(w,v);r=MyShapesState.Public_GetShapeStateById(j);k=r.TextState.Public_GetFontStyles();h=r.ColorableState.Public_GetColorStyles();q=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateDescriptionCellId(K,J));c(r,q)}}var l=null;if(n||j){l={cell_title_id:n,cell_title_txt:o,cell_title_color:m,cell_description_id:j,cell_description_txt:k,cell_description_color:h}}b(N,s,t,false,true,l,M,true,p);ClearActiveState()};a.CopyShape=function(f){if(MyShapesState.Property_SelectedCount==0){return}var g=MyShapesState.Public_GetAllSelectedMovableShapeStates(false);b(g,30,30,true,false,null,null,false)};a.CopyCell=function(i,h,g,f){$("#CopyReplaceConfirm").show();$("#CopyReplaceConfirm").modal();$("#CopyReplaceConfirm_ReplaceBtn").off("click");$("#CopyReplaceConfirm_CopyBtn").off("click");$("#CopyReplaceConfirm_ReplaceBtn").click(function(j){a.CopyCellAction(i,h,g,f,true);$("#CopyReplaceConfirm").hide()});$("#CopyReplaceConfirm_CopyBtn").click(function(j){a.CopyCellAction(i,h,g,f,false);$("#CopyReplaceConfirm").hide()})};function b(v,E,G,B,k,g,z,p,h){try{var s=new Array();v.sort(Sorters.SortShapeStatesByIndex);for(var n=0;n<v.length;n++){var f=v[n];var o=f.Id+SvgPartsEnum.Natural;var w=$("#"+o).clone();StoryboardContainer.UpdateGradientIds(w);var D=f.X+E;var F=f.Y+G;if(B){var C=CellPickerHelper.Props.CoreSVGRegion.state?CellPickerHelper.Props.CoreSVGRegion.width:$("#CoreSvg").width();var m=CellPickerHelper.Props.CoreSVGRegion.state?CellPickerHelper.Props.CoreSVGRegion.height:$("#CoreSvg").height();if(D+50>C){D=f.X-E}if(F+50>m){F=f.Y-G}}var r=AddSvg.AddSvgToStoryboard(w,D,F,false,f.isSceneItem);s.push(r);var t=MyShapesState.Public_GetShapeStateByShape(r);t.CopyShapeState(f);t.MoveTo(D,F);if(k){t.IsLocked=f.IsLocked}}var A=new Array();var u=new Array();ClearActiveState();for(var q=0;q<s.length;q++){var r=s[q];var o=r.attr("id");A.push({Id:o});u.push({Id:o,Detached:r,NextShapeId:r.next().attr("id"),ShapeState:MyShapesState.Public_GetShapeStateById(o)});MyShapesState.Public_SelectShape(r)}if(g){A.push({Id:null,content:g})}MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);UndoManager.register(undefined,e,[A,z?z.redoArray:u,p,h?h.id:null,h?h.undoCellCropRatio:null],undefined,"",d,[u,z?z.undoArray:A,p,h?h.id:null,h?h.redoCellCropRatio:null],"");UpdateActiveDrawing()}catch(l){LogErrorMessage("SvgManip.CopyShapeHelper",l)}}function e(){var j=arguments[0];var i=arguments[1];var h=arguments[2];var g=arguments[3];var f=arguments[4];UndoShapeAdd.apply(this,j);if(i&&h){UndoDeleteShape.apply(this,i)}if(g){StoryboardContainer.GlobalCellCropRatio[g]=f}}function c(g,f){if(g==null||f==null){return}if(g.TextState.D[g.TextState.CurrentId].Text!=""&&g.TextState.D[g.TextState.CurrentId].Text!=g.TextState.D[g.TextState.CurrentId].DefaultText){return}if(f.TextState.D[f.TextState.CurrentId].Text==""||f.TextState.D[f.TextState.CurrentId].Text==f.TextState.D[f.TextState.CurrentId].DefaultText){return}g.TextState.CopyFontStyles(f.TextState.Public_GetFontStyles());g.ColorableState.Public_CopyColorStyles(f.ColorableState.Public_GetColorStyles());g.UpdateDrawing()}function d(){var i=arguments[0];var j=arguments[1];var h=arguments[2];var g=arguments[3];var f=arguments[4];UndoDeleteShape.apply(this,i);if(j&&h){UndoShapeAdd.apply(this,j)}if(g){StoryboardContainer.GlobalCellCropRatio[g]=f}}return a}();var CropHelper=function(){var e=new Object();var q=new Object();q.CropType=CropTypeEnum.Standard;q.CroppedImageCopyId="CroppedImageCopy";q.OriginalShapeId="";q.CropLeft=0;q.CropTop=0;q.CropHeight=0;q.CropWidth=0;q.CropRatio=1;q.CropViewScale;q.ClipScale;q.ImageWidth=0;q.ImageHeight=0;q.CropAction="";q.ResizePageX=0;q.ResizePageY=0;q.CropResizeDirection="";q.CircleSizeRatio=1;q.move_delta={x:0,y:0};q.rotate_center={x:0,y:0};q.rotate_alpha=0;q.scale={x:1,y:1};q.CellPosition={};q.CropPolygonPoint=[{x:0,x:0},{x:150,y:0},{x:150,y:100},{x:0,y:100}];q.CropPolygonPointSelectedID="";q.EllipseCX=75;q.EllipseCY=50;q.EllipseRX=75;q.EllipseRY=50;function w(){q.EllipseRX=q.CropWidth/2;q.EllipseRY=q.CropHeight/2;q.EllipseCX=q.CropLeft+q.EllipseRX;q.EllipseCY=q.CropTop+q.EllipseRY}function n(y){return function(z){CropHelper.PrepareShapePostModal(y)}}function r(y){StoryboardContainer.UpdateGradientIds(y);y.attr("id",q.CroppedImageCopyId);y.attr("class","");y.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").remove();y.find("[id$='"+SvgPartsEnum.CropGroup+"']").removeAttr("clip-path").attr("id",q.CroppedImageCopyId+SvgPartsEnum.CropGroup);var z=y.find("[id$='"+SvgPartsEnum.Scale+"']").attr("id",q.CroppedImageCopyId+SvgPartsEnum.Scale);y.find("[id$='"+SvgPartsEnum.Natural+"']").attr("id",q.CroppedImageCopyId+SvgPartsEnum.Natural)}function h(y){var B=y.UseClipping;y.UseClipping=false;var A=y.Public_GetImaginaryOuterBox();y.UseClipping=B;var z=e.GetMoveVectorForRotatedObject(y);return{W:A.Right-A.Left,H:A.Bottom-A.Top,X:A.Left-z.x,Y:A.Top-z.y}}e.PrepareShapePostModal=function(z){var E=$("#CropAreaSvg");var D=$("#"+z.Id).clone();StoryboardContainer.UpdateGradientIds(D);q.CropAction="";q.OriginalShapeId=z.Id;r(D);E.children().remove();var F=h(z);var N=StoryboardContainer.GetAllLayoutParts(CellConfiguration);q.CellPosition=StoryboardContainer._GetLayoutPartForShape(N,z);var U=q.CellPosition?StoryboardContainer.GetShapeStatesForCell(q.CellPosition.Row,q.CellPosition.Col):null;var A=z.Public_GetImaginaryOuterBox();var C=GetGlobalById(z.Id).getBBox();q.FlipHorizontal=z.FlipHorizontal;q.FlipVertical=z.FlipVertical;q.move_delta={x:z.X,y:z.Y};q.rotate_center={x:C.width/2,y:C.height/2};q.rotate_alpha=z.Angle;q.scale={x:z.ScaleX,y:z.ScaleY};if(U){for(var M=0;M<U[StoryboardPartTypeEnum.StoryboardCell].length;M++){var y=U[StoryboardPartTypeEnum.StoryboardCell][M];if(y.Id!=z.Id){var V=$("#"+y.Id).clone();V.attr("opacity","0.4");E.append(V)}}}E.append(D);var O=GetGlobalById(q.CroppedImageCopyId+SvgPartsEnum.Scale).getBBox();q.ImageWidth=O.width;q.ImageHeight=O.height;q.CropViewScale=1;q.CropLeft=0;q.CropTop=0;q.CropWidth=O.width;q.CropHeight=O.height;q.CropRatio=q.CropHeight/q.CropWidth;q.CropPolygonPoint=[{x:0,y:0},{x:0,y:O.height},{x:O.width,y:O.height},{x:O.width,y:0}];q.EllipseRX=q.CropWidth/2;q.EllipseRY=q.CropHeight/2;q.EllipseCX=q.CropLeft+q.EllipseRX;q.EllipseCY=q.CropTop+q.EllipseRY;if(z.UseClipping&&z.CropType==q.CropType){switch(z.CropType){case CropTypeEnum.Circle:case CropTypeEnum.Standard:q.CropLeft=z.ClipX;q.CropTop=z.ClipY;q.CropWidth=z.ClipWidth;q.CropHeight=z.ClipHeight;if(z.CropType==CropTypeEnum.Circle){w()}break;case CropTypeEnum.Advanced:if(z.CropPolygonPoint){for(M=0;M<z.CropPolygonPoint.length;M++){q.CropPolygonPoint[M]={x:z.CropPolygonPoint[M].x,y:z.CropPolygonPoint[M].y}}}break}}var K=F.X-10;var L=F.Y-10;var J=F.W+20;var G=F.H+20;document.getElementById("CropAreaSvg").setAttribute("viewBox",K+" "+L+" "+J+" "+G);var I=Math.round($(window).width()*8/10);var H=Math.round($(window).height()*8/10)-65;var P=I>H?H:I;var R=P,Q=P;if(q.CropType==CropTypeEnum.Standard){if(J<G){R=P*J/G}else{Q=P*G/J}}$("#CropArea").css("text-align","center");$("#CropModalDialog").css("display","inline-block");$("#CropModalDialog").css("width","auto");$("#CropModalDialog").css("min-width",550);var W=20;E.attr("width",R-W);E.attr("height",Q-W);var T=E.attr("width")/J;var S=E.attr("height")/G;E.mousemove(j());E.mouseleave(u());E.mouseup(u());E.mousedown(s());E.css("cursor","hand");q.CropViewScale=T<S?T:S;q.CircleSizeRatio=z.ScaleX<z.ScaleY?1/z.ScaleX:1/z.ScaleY;q.CircleSizeRatio/=q.CropViewScale;b()};function b(){var y=$("#croppedImageCopy_ClipArea");if(y!==null||y.length>0){y.detach()}y=SvgCreator.CreateSvgGroup("croppedImageCopy_ClipArea");$("#"+q.CroppedImageCopyId+SvgPartsEnum.Scale).append(y);switch(q.CropType){case CropTypeEnum.Standard:y.appendChild(SvgCreator.AddRect(q.CropLeft,q.CropTop,q.CropWidth,q.CropHeight,"black","red","4,4",".25","CropAreaBox"));break;case CropTypeEnum.Advanced:y.appendChild(SvgCreator.AddPolygon(q.CropPolygonPoint,"black","red","4,4","1",".25","CropAreaBoxAdvanced",null));break;case CropTypeEnum.Circle:y.appendChild(SvgCreator.AddEllipse(q.EllipseCX,q.EllipseCY,q.EllipseRX,q.EllipseRY,"black","red","4,4",".25","CropAreaEllipse"));y.appendChild(SvgCreator.AddRect(q.CropLeft,q.CropTop,q.CropWidth,q.CropHeight,"black","red","4,4",".25","CropAreaBox"));break}if(MyBrowserProperties.IsMobile){c(y,15)}else{c(y,5)}}function f(A,y){var z="";switch(A){case ResizeEnum.NE:y+=45;y%=360;break;case ResizeEnum.SW:y+=225;y%=360;break;case ResizeEnum.SE:y+=135;y%=360;break;case ResizeEnum.NW:y+=315;y%=360;break;case ResizeEnum.W:y+=270;y%=360;break;case ResizeEnum.N:y%=360;break;case ResizeEnum.S:y+=180;y%=360;break;case ResizeEnum.E:y+=90;y%=360;break}if(Math.abs(y-90)<EPS_ANGLE||Math.abs(y-270)<EPS_ANGLE){return"H"}if(Math.abs(y)<EPS_ANGLE||Math.abs(y-180)<EPS_ANGLE){return"V"}z="NE";if(y>=90&&y<180){z="NW"}else{if(y>=180&&y<270){z="NE"}else{if(y>=270){z="NW"}}}return z}function c(C,z){var z=z*q.CircleSizeRatio;var I="#AAA393";var B="#6285C7";if(q.CropType==CropTypeEnum.Standard||q.CropType==CropTypeEnum.Circle){var E=q.CropLeft;var H=q.CropWidth+q.CropLeft;var J=q.CropTop;var A=q.CropHeight+q.CropTop;C.appendChild(SvgCreator.AddCircle(E,J,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_NW,"Resize".concat(f(ResizeEnum.NW,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(H,J,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_NE,"Resize".concat(f(ResizeEnum.NE,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(E,A,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_SW,"Resize".concat(f(ResizeEnum.SW,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(H,A,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_SE,"Resize".concat(f(ResizeEnum.SE,q.rotate_alpha))));var y=B;B=I;I=y;var F=(E+H)/2;var G=(J+A)/2;C.appendChild(SvgCreator.AddCircle(F,J,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_N,"Resize".concat(f(ResizeEnum.N,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(F,A,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_S,"Resize".concat(f(ResizeEnum.S,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(E,G,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_W,"Resize".concat(f(ResizeEnum.W,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(H,G,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_E,"Resize".concat(f(ResizeEnum.E,q.rotate_alpha))));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_N,t(ResizeEnum.N));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_S,t(ResizeEnum.S));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_E,t(ResizeEnum.E));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_W,t(ResizeEnum.W));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_NE,t(ResizeEnum.NE));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_NW,t(ResizeEnum.NW));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_SE,t(ResizeEnum.SE));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_SW,t(ResizeEnum.SW));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_N,l(ResizeEnum.N));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_S,l(ResizeEnum.S));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_E,l(ResizeEnum.E));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_W,l(ResizeEnum.W));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_NE,l(ResizeEnum.NE));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_NW,l(ResizeEnum.NW));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_SE,l(ResizeEnum.SE));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_SW,l(ResizeEnum.SW));p("CropAreaBox",k())}if(q.CropType==CropTypeEnum.Advanced){var D;for(D=0;D<q.CropPolygonPoint.length;D++){C.appendChild(SvgCreator.AddCircle(q.CropPolygonPoint[D].x,q.CropPolygonPoint[D].y,z,I,B,q.CroppedImageCopyId+"_advan_circle"+D,"MoveObject"));o(q.CroppedImageCopyId+"_advan_circle"+D,t(ResizeEnum.NSEW,D));p(q.CroppedImageCopyId+"_advan_circle"+D,l(ResizeEnum.NSEW,D))}p("CropAreaBoxAdvanced",k())}}function o(y,z){$("#"+y).mousedown(z)}function p(y,z){inputAdapter.EnableMove($("#"+y),z)}function x(){if(q.CropType==CropTypeEnum.Standard||q.CropType==CropTypeEnum.Circle){var z=$("#CropAreaBox");var J=$("#"+q.CroppedImageCopyId+SvgPartsEnum.Selector_NW);var I=$("#"+q.CroppedImageCopyId+SvgPartsEnum.Selector_NE);var N=$("#"+q.CroppedImageCopyId+SvgPartsEnum.Selector_SW);var M=$("#"+q.CroppedImageCopyId+SvgPartsEnum.Selector_SE);var H=$("#"+q.CroppedImageCopyId+"_n_circle ");var L=$("#"+q.CroppedImageCopyId+"_s_circle ");var P=$("#"+q.CroppedImageCopyId+"_w_circle ");var D=$("#"+q.CroppedImageCopyId+"_e_circle ");var E=q.CropLeft;var K=q.CropWidth+q.CropLeft;var O=q.CropTop;var y=q.CropHeight+q.CropTop;var F=(E+K)/2;var G=(O+y)/2;SvgCreator.UpdateRectangle(z,q.CropLeft,q.CropTop,q.CropWidth,q.CropHeight);SvgCreator.UpdateCircle(J,E,O);SvgCreator.UpdateCircle(I,K,O);SvgCreator.UpdateCircle(N,E,y);SvgCreator.UpdateCircle(M,K,y);SvgCreator.UpdateCircle(H,F,O);SvgCreator.UpdateCircle(L,F,y);SvgCreator.UpdateCircle(P,E,G);SvgCreator.UpdateCircle(D,K,G);if(q.CropType==CropTypeEnum.Circle){var B=$("#CropAreaEllipse");q.EllipseRX=q.CropWidth/2;q.EllipseRY=q.CropHeight/2;q.EllipseCX=q.CropLeft+q.EllipseRX;q.EllipseCY=q.CropTop+q.EllipseRY;SvgCreator.UpdateEllipse(B,q.EllipseCX,q.EllipseCY,q.EllipseRX,q.EllipseRY)}}if(q.CropType==CropTypeEnum.Advanced){var A=$("#CropAreaBoxAdvanced");SvgCreator.UpdatePolygon(A,q.CropPolygonPoint);for(i=0;i<q.CropPolygonPoint.length;i++){var C=$("#"+q.CroppedImageCopyId+"_advan_circle"+i);SvgCreator.UpdateCircle(C,q.CropPolygonPoint[i].x,q.CropPolygonPoint[i].y)}}}function v(z,A){if(q.CropType==CropTypeEnum.Standard||q.CropType==CropTypeEnum.Circle){switch(q.CropResizeDirection){case ResizeEnum.W:case ResizeEnum.NW:case ResizeEnum.SW:q.CropLeft+=z;q.CropWidth-=z;break;case ResizeEnum.E:case ResizeEnum.NE:case ResizeEnum.SE:q.CropWidth+=z;break}switch(q.CropResizeDirection){case ResizeEnum.N:case ResizeEnum.NW:case ResizeEnum.NE:q.CropTop+=A;q.CropHeight-=A;break;case ResizeEnum.S:case ResizeEnum.SW:case ResizeEnum.SE:q.CropHeight+=A;break}if(q.CropType==CropTypeEnum.Circle){q.EllipseRX=q.CropWidth/2;q.EllipseRY=q.CropHeight/2;q.EllipseCX=q.CropLeft+q.EllipseRX;q.EllipseCY=q.CropTop+q.EllipseRY}}if(q.CropType==CropTypeEnum.Advanced){if(q.CropPolygonPoint.length>=4){var y=(q.CropPolygonPointSelectedID+2)%4;a=q.CropPolygonPointSelectedID;if(Math.abs(q.CropPolygonPoint[a].x-q.CropPolygonPoint[y].x+z)+Math.abs(q.CropPolygonPoint[a].y-q.CropPolygonPoint[y].y+A)<30){return}}q.CropPolygonPoint[q.CropPolygonPointSelectedID].x+=z;q.CropPolygonPoint[q.CropPolygonPointSelectedID].y+=A}x()}function m(y,z){var A;switch(q.CropType){case CropTypeEnum.Standard:case CropTypeEnum.Circle:q.CropTop+=z;q.CropLeft+=y;if(q.CropType==CropTypeEnum.Standard){}if(q.CropType==CropTypeEnum.Circle){q.EllipseRX=q.CropWidth/2;q.EllipseRY=q.CropHeight/2;q.EllipseCX=q.CropLeft+q.EllipseRX;q.EllipseCY=q.CropTop+q.EllipseRY}break;case CropTypeEnum.Advanced:var D=9999;var E=9999;var B=0;var C=0;for(A=0;A<q.CropPolygonPoint.length;A++){D=Math.min(D,q.CropPolygonPoint[A].x);E=Math.min(E,q.CropPolygonPoint[A].y);B=Math.max(B,q.CropPolygonPoint[A].x);C=Math.max(C,q.CropPolygonPoint[A].y)}for(A=0;A<q.CropPolygonPoint.length;A++){q.CropPolygonPoint[A].x+=y;q.CropPolygonPoint[A].y+=z}break}x()}function l(z,y){return function(C,A,B){if(C!==MovePhaseEnum.Move){return}q.CropResizeDirection=z;q.CropPolygonPointSelectedID=y;if(q.CropResizeDirection==null||q.CropResizeDirection==undefined){return}v(A,B)}}function k(y){return function(B,z,A){if(B!==MovePhaseEnum.Move){return}m(z,A)}}function t(z,y){return function(A){var B={x:A.pageX/q.CropViewScale,y:A.pageY/q.CropViewScale};var C=d(B);q.CropAction="Resize";q.ResizePageX=C.x;q.ResizePageY=C.y;q.CropResizeDirection=z;q.CropPolygonPointSelectedID=y;A.stopPropagation()}}function s(){return function(y){q.CropAction="Move";var z={x:y.pageX/q.CropViewScale,y:y.pageY/q.CropViewScale};var A=d(z);q.ResizePageX=A.x;q.ResizePageY=A.y;y.stopPropagation()}}function j(){return function(y){if(q.CropAction==""){return}var z={x:y.pageX/q.CropViewScale,y:y.pageY/q.CropViewScale};var A=d(z);deltaX=A.x-q.ResizePageX;deltaY=A.y-q.ResizePageY;if(q.FlipHorizontal===true){deltaX*=-1}if(q.FlipVertical===true){deltaY*=-1}q.ResizePageX=A.x;q.ResizePageY=A.y;if(q.CropAction=="Resize"){v(deltaX,deltaY)}else{if(q.CropAction=="Move"){m(deltaX,deltaY)}}}}function u(){return function(){q.CropAction=""}}function g(){var y=MyShapesState.Public_GetFirstSelectedShapeState();if(y===null){y=MyShapesState.Public_GetShapeStateById(q.OriginalShapeId)}return y}e.ChangeCropMode=function(y,z){q.CropType=z;this.PrepareShapePostModal(y)};e.ShowCropDialog=function(y,A){MyPointers.Dialog_CropImage.one("shown.bs.modal",n(y));q.CropType=A;var z=$("#CropAreaSvg");z.children().remove();MyPointers.Dialog_CropImage.modal()};e.RemoveCrop=function(){var y=g();var z=y.X;var A=y.Y;e.UpdateRotatedObjectPosition(y,false);y.UseClipping=false;y.UpdateDrawing();MyPointers.Dialog_CropImage.modal("hide");UndoManager.register(undefined,UndoCrop,[y.Id,true,y.ClipX,y.ClipY,y.ClipWidth,y.ClipHeight,JSON.parse(JSON.stringify(y.CropPolygonPoint)),y.CropType,z,A],"",undefined,UndoCrop,[y.Id,y.UseClipping,y.ClipX,y.ClipY,y.ClipWidth,y.ClipHeight,JSON.parse(JSON.stringify(y.CropPolygonPoint)),y.CropType,y.X,y.Y],"")};e.CancelCrop=function(){MyPointers.Dialog_CropImage.modal("hide");var y=g();y.UpdateDrawing()};function d(z){var y={x:z.x-q.move_delta.x,y:z.y-q.move_delta.y};y={x:y.x-q.rotate_center.x,y:y.y-q.rotate_center.y};y={x:y.x*Math.cos(-q.rotate_alpha*Math.PI/180)-y.y*Math.sin(-q.rotate_alpha*Math.PI/180),y:y.x*Math.sin(-q.rotate_alpha*Math.PI/180)+y.y*Math.cos(-q.rotate_alpha*Math.PI/180)};y={x:y.x+q.rotate_center.x,y:y.y+q.rotate_center.y};y={x:y.x/q.scale.x,y:y.y/q.scale.y};return y}e.GetMoveVectorForRotatedObject=function(y){var D=y.GetPivotPoint(true);var E=y.GetPivotPoint();var z=y.Angle*Math.PI/180;var A=SbtMath.RotatePoint(D,z,E);var B=SbtMath.RotatePoint(A,-z,D);return{x:B.x-D.x,y:B.y-D.y}};e.UpdateRotatedObjectPosition=function(y,A){var z=e.GetMoveVectorForRotatedObject(y);if(A){y.X+=z.x;y.Y+=z.y}else{y.X-=z.x;y.Y-=z.y}};e.UpdateCrop=function(){if(MyBrowserProperties.IsMobile){inputAdapter.useDelegation(true)}var y=g();var H=y.UseClipping;var G=y.CropType;var F=JSON.parse(JSON.stringify(y.CropPolygonPoint));var D=y.ClipX;var E=y.ClipY;var C=y.ClipWidth;var B=y.ClipHeight;var I=y.X;var J=y.Y;e.UpdateRotatedObjectPosition(y,false);y.UseClipping=true;y.CropType=q.CropType;var A;var z=y.GetBBox(false);switch(q.CropType){case CropTypeEnum.Standard:y.ClipX=Math.max(0,q.CropLeft);y.ClipY=Math.max(0,q.CropTop);y.ClipWidth=q.CropLeft+q.CropWidth>q.ImageWidth?q.ImageWidth-q.CropLeft:q.CropWidth;y.ClipHeight=q.CropTop+q.CropHeight>q.ImageHeight?q.ImageHeight-q.CropTop:q.CropHeight;break;case CropTypeEnum.Circle:y.ClipX=q.CropLeft;y.ClipY=q.CropTop;y.ClipWidth=q.CropWidth;y.ClipHeight=q.CropHeight;break;case CropTypeEnum.Advanced:y.ClipX=z.width;y.ClipY=z.height;y.ClipWidth=0;y.ClipHeight=0;for(A=0;A<q.CropPolygonPoint.length;A++){y.CropPolygonPoint[A].x=q.CropPolygonPoint[A].x;y.CropPolygonPoint[A].y=q.CropPolygonPoint[A].y}y.Public_update_ClipRegionByAdvancedCrop();break}y.CropPolygonPointJson=JSON.stringify(y.CropPolygonPoint);if(y.ClipWidth<10){y.ClipWidth=10}if(y.ClipHeight<10){y.ClipHeight=10}e.UpdateRotatedObjectPosition(y,true);UpdateActiveDrawing();UpdateActiveDrawing();MyPointers.Dialog_CropImage.modal("hide");UndoManager.register(undefined,UndoCrop,[y.Id,H,D,E,C,B,F,G,I,J],"",undefined,UndoCrop,[y.Id,y.UseClipping,y.ClipX,y.ClipY,y.ClipWidth,y.ClipHeight,JSON.parse(JSON.stringify(y.CropPolygonPoint)),y.CropType,y.X,y.Y],"")};return e}();$(window).resize(function(){if($("#CropArea").is(":visible")){var b=MyShapesState.Public_GetFirstSelectedShapeState();CropHelper.PrepareShapePostModal(b)}});var GestureHelper=function(){var b=new Object();b.TitleEmphasis=function(){if(CellConfiguration.HasTitle==false){return}var c=parseInt($("#advanced-title-text-size").val());a(MyIdGenerator.GenerateTitleCellId,c)};b.DescriptionEmphasis=function(){if(CellConfiguration.HasDescription==false){return}var c=parseInt($("#advanced-description-text-size").val());a(MyIdGenerator.GenerateDescriptionCellId,c)};function a(e,d){var i=new Array();var f=new Array();for(var c=0;c<StoryboardContainer.Cols;c++){for(var g=0;g<StoryboardContainer.Rows;g++){var h=MyShapesState.Public_GetShapeStateById(e(g,c));if(h==null){continue}i.push({Id:h.Id,FontColor:h.TextState.D[h.TextState.CurrentId].FontColor,FontSize:h.TextState.D[h.TextState.CurrentId].FontSize,BackgroundColor:h.Public_GetColorForRegion("Textables")});f.push({Id:h.Id,FontColor:"#FFFFFF",FontSize:d,BackgroundColor:"#000000"});h.Public_SetColorForRegion("Textables","#000000",false,false);if(UseQuill){h.TextState.Public_QuillSetFontColor("#FFFFFF");h.TextState.Public_QuillSetFontSize(d)}else{if(UseSummerNote){h.TextState.Public_SummerNote_SetFontSizeAndColor(d,"rgb(255,255,255)")}else{h.TextState.D[h.TextState.CurrentId].FontColor="#FFFFFF";h.TextState.D[h.TextState.CurrentId].FontSize=d}}h.UpdateDrawing(true)}}UndoManager.register(undefined,UndoHelper.UndoTitleEmphasis,i,"",undefined,UndoHelper.UndoTitleEmphasis,f,"");CloseModal(MyPointers.Dialog_AdvancedButtons)}b.CapitalizeTitles=function(){if(CellConfiguration.HasTitle==false){return}var l=new Array();var h=new Array();for(var c=0;c<StoryboardContainer.Cols;c++){for(var j=0;j<StoryboardContainer.Rows;j++){var k=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateTitleCellId(j,c));if(k==null){continue}if(UseQuill||UseSummerNote){var g=SbtLib.DeepCopy(k.TextState.Public_GetQuillDeltas());if(g==null){continue}for(var d=0;d<g.length;d++){if(g[d]!=null&&g[d].insert!=null){g[d].insert=g[d].insert.toUpperCase()}}l.push({Id:k.Id,QuillDeltas:k.TextState.Public_GetQuillDeltas()});h.push({Id:k.Id,QuillDeltas:g});k.TextState.Public_SetQuillDeltas(g)}else{var f=k.GetText();var e=f.toUpperCase();k.SetText(e);l.push({Id:k.Id,Text:f});h.push({Id:k.Id,Text:e})}k.UpdateDrawing()}}UndoManager.register(undefined,UndoHelper.UndoBulkTextChange,l,"",undefined,UndoHelper.UndoBulkTextChange,h,"");CloseModal(MyPointers.Dialog_AdvancedButtons)};return b}();window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction;window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;function LocalDbHelper(){if(!(this instanceof LocalDbHelper)){return new LocalDbHelper()}var c=function(d){window.indexedDB=void 0;ga("send","event","Storyboard Creator","No LocalDB Support",navigator.userAgent);DebugLine("LocalDB disabled");LogErrorMessage("(self-heal) LocalDbHelper disabled");c=function(){}};var b=function(d,l,i,g){var h=function(o){var e=d(o);if(e==null){i()}else{e.onsuccess=function(p){l(p)};e.onfailure=function(p){i(p)};e.onerror=function(p){g(p)}}};if(!window.indexedDB){c();i();return}try{var k="StoryboardDB";var n=2;var j=window.indexedDB.open(k,n);if(j==null){c();throw true}var m=this;j.onsuccess=function(o){var e=j.result;if(!e.objectStoreNames.contains("Storyboard")){e.createObjectStore("Storyboard",{keyPath:"userId"})}h(e)};j.onupgradeneeded=function(o){var e=o.target.result;if(!e.objectStoreNames.contains("Storyboard")){e.createObjectStore("Storyboard",{keyPath:"userId"})}};j.onerror=function(e){i();if(j.error&&j.error.name==="InvalidStateError"){e.preventDefault()}};j.onblocked=function(e){i()}}catch(f){if(window.indexedDb){LogErrorMessage("Failed to init local db",f);c()}i()}};var a=function(d,g,f,e){b(d,g,f,e)};this.clearDatabase=function(f){f=f||function(){};try{a(function(e){return e.deleteObjectStore("Storyboard")},function(e){f(true)},function(e){f(false)},function(e){f(false)})}catch(d){LogErrorMessage("LocalDbHelper.clearDatabase",d);f(false)}};this.Save=function(i,h,d,g){g=g||function(){};try{a(function(e){return e.transaction(["Storyboard"],"readwrite").objectStore("Storyboard").put({userId:i,storyboard_name:h,content:d})},function(e){g(true)},function(e){g(false)},function(e){g(false)})}catch(f){LogErrorMessage("LocalDbHelper.Save",f);g(false)}};this.CheckUser=function(g,f){f=f||function(){};try{a(function(e){return e.transaction(["Storyboard"]).objectStore("Storyboard").get(g)},function(e){if(e.target.result===void 0){f(false,null)}else{f(true,e.target.result.storyboard_name)}},function(e){f(false,null)},function(e){f(false,null)})}catch(d){LogErrorMessage("LocalDbHelper.CheckUser",d);f(false,null)}};this.Load=function(g,f){f=f||function(){};try{a(function(e){return e.transaction(["Storyboard"]).objectStore("Storyboard").get(g)},function(e){(e.target.result===void 0)?f(null):f(e.target.result.content)},function(e){f(null)},function(e){f(null)})}catch(d){LogErrorMessage("LocalDbHelper.Load",d);f(null)}};this.Delete=function(g,f){f=f||function(){};try{a(function(e){e.transaction(["Storyboard"],"readwrite").objectStore("Storyboard")["delete"](g)},function(e){f(true)},function(e){f(false)},function(e){f(false)})}catch(d){LogErrorMessage("LocalDbHelper.Delete",d);f(false)}}};var MarkerFilter=function(){var c=new Object();function b(h){if(h===""){return}if(h.toLowerCase()==="transparent"){return[0,0,0,0]}if(h[0]==="#"){if(h.length<7){h="#"+h[1]+h[1]+h[2]+h[2]+h[3]+h[3]+(h.length>4?h[4]+h[4]:"")}return[parseInt(h.substr(1,2),16),parseInt(h.substr(3,2),16),parseInt(h.substr(5,2),16),h.length>7?parseInt(h.substr(7,2),16)/255:1]}if(h.indexOf("rgb")===-1){var j=document.body.appendChild(document.createElement("fictum"));var i="rgb(1, 2, 3)";j.style.color=i;if(j.style.color!==i){return}j.style.color=h;if(j.style.color===i||j.style.color===""){return}h=getComputedStyle(j).color;document.body.removeChild(j)}if(h.indexOf("rgb")===0){if(h.indexOf("rgba")===-1){h+=",1"}return h.match(/[\.\d]+/g).map(function(k){return +k})}}var e=0.2126;var f=0.7152;var g=0.0722;function a(h){var i=b(h);if(i!=undefined){return Math.round((i[0]*e+i[1]*f+i[2]*g))}else{return 0}}function d(t,w,r){var u=t.Id;var o=a("#000000");var p=a("#ffffff");try{var h=t.Public_GetColorRegions();for(var l=0;l<h.length;l++){var q=a(t.Public_GetColorForRegion(h[l]));q=Math.round(Math.sqrt(q/255)*255);q="rgb("+q+", "+q+", "+q+")";t.Public_SetColorForRegion(h[l],q,false,false)}}catch(k){LogErrorMessage("ToMarkerFilter",k)}var s=["path","polygon","rect","ellipse"];for(var n=0;n<s.length;n++){var m=$("#"+u)[0].getElementsByTagName(s[n]);for(var l=0;l<m.length;l++){m[l].setAttributeNS(null,"stroke-width",w);m[l].setAttributeNS(null,"stroke","rgb(12,12,12)");if(m[l].getAttributeNS(null,"fill")==null){continue}if(r){if(m[l].getAttributeNS(null,"opacity")!=null){m[l].setAttributeNS(null,"fill","none");m[l].setAttributeNS(null,"stroke-width",0);continue}if(m[l].getAttributeNS(null,"fill")=="none"){m[l].setAttributeNS(null,"stroke-width",0);continue}}var x=a(m[l].getAttributeNS(null,"fill"));y=Math.round(Math.sqrt(x/255)*255);m[l].setAttributeNS(null,"fill","rgb("+y+","+y+","+y+")")}}}c.TestMarker=function(){var m=3.5;var j=true;var k=MyShapesState.Public_GetAllSelectedShapeStates();for(var h=0;h<k.length;h++){var l=k[h];d(l,m,j)}};return c}();var MoveCellHelper=function(){var c=new Object();c.MoveCell=function(l,k,j,i){var m=[];var o=[];for(var n=0;n<StoryboardContainer.Rows;n++){for(var h=0;h<StoryboardContainer.Cols;h++){var e=a(n,h,l,k,j,i);var f=e%StoryboardContainer.Cols;var g=Math.floor(e/StoryboardContainer.Cols);o.push({oldCol:f,oldRow:g,newCol:h,newRow:n});m.push({oldCol:h,oldRow:n,newCol:f,newRow:g})}}UndoManager.register(undefined,MoveCellHelper.UndoRearrangeCells,[o],"",undefined,MoveCellHelper.UndoRearrangeCells,[m],"");MoveCellHelper.RearrangeCells(m)};c.SwapCell=function(h,g,f,e){var i=[];var j=[];j.push({oldCol:g,oldRow:h,newCol:e,newRow:f});j.push({oldCol:e,oldRow:f,newCol:g,newRow:h});i.push({oldCol:e,oldRow:f,newCol:g,newRow:h});i.push({oldCol:g,oldRow:h,newCol:e,newRow:f});UndoManager.register(undefined,MoveCellHelper.UndoRearrangeCells,[j],"",undefined,MoveCellHelper.UndoRearrangeCells,[i],"");MoveCellHelper.RearrangeCells(i)};c.RearrangeCells=function(j){var h=0;StoryboardContainer.Public_ChangeCellOrder(j);if(CellConfiguration.HasTitle||CellConfiguration.HasDescription){var k=null;var f=null;if(CellConfiguration.HasTitle){k=b(MyIdGenerator.GenerateTitleCellId)}if(CellConfiguration.HasDescription){f=b(MyIdGenerator.GenerateDescriptionCellId)}for(h=0;h<j.length;h++){var e=j[h];if(e.newCol!=e.oldCol||e.newRow!=e.oldRow){if(CellConfiguration.HasTitle){var l=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateTitleCellId(e.newRow,e.newCol));d(l,k[e.oldCol][e.oldRow])}if(CellConfiguration.HasDescription){var g=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateDescriptionCellId(e.newRow,e.newCol));d(g,f[e.oldCol][e.oldRow])}}}}};c.UndoRearrangeCells=function(f){try{MoveCellHelper.RearrangeCells(f);UpdateActiveDrawing()}catch(g){LogErrorMessage("SvgManip.UndoRearrangeCells",g)}};function a(l,f,k,j,i,h){var e=(l*StoryboardContainer.Cols)+f;var m=(k*StoryboardContainer.Cols)+j;var g=(i*StoryboardContainer.Cols)+h;if(m==e){return g}if(m<g){if(e<m){return e}if(e>g){return e}return e-1}if(e<g){return e}if(e>m){return e}return e+1}function b(l){var h=new Array();try{for(var f=0;f<StoryboardContainer.Cols;f++){h[f]=new Array();for(var j=0;j<StoryboardContainer.Rows;j++){var i=l(j,f);var k=new Object();k.TextStyles=MyShapesState.Public_GetShapeStateById(i).TextState.Public_GetFontStyles();k.ColorStyles=MyShapesState.Public_GetShapeStateById(i).ColorableState.Public_GetColorStyles();h[f][j]=k}}}catch(g){}return h}function d(f,e){if(f==null||e==null){return}f.TextState.CopyFontStyles(e.TextStyles.Public_GetFontStyles());f.ColorableState.Public_CopyColorStyles(e.ColorStyles.Public_GetColorStyles());f.UpdateDrawing()}return c}();var MultiTextableHelper=function(){var b=new Object();var e=new Object();e.MultiTextImageCopyId="MultiTextableImageCopy";e.OriginalShape;b.Props=e;var a=null;function c(f){e.OriginalShape=f;var p=$("#multiTextableSvg");var g=$("#"+f.Id).clone();StoryboardContainer.UpdateGradientIds(g);g.attr("id",e.MultiTextImageCopyId);g.attr("class","");g.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").remove();g.find("[id^='"+e.OriginalShape.Id+"_text']").remove();g.find("[id$='"+SvgPartsEnum.CropGroup+"']").removeAttr("clip-path").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.CropGroup);var q=g.find("[id$='"+SvgPartsEnum.Scale+"']").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.Scale);g.find("[id$='"+SvgPartsEnum.Natural+"']").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.Natural);p.children().remove();p.append(g);var h=GetGlobalById(e.MultiTextImageCopyId).getBBox();p.attr("width",h.width+24);p.attr("height",h.height+24);if(!a){a=new SvgState(e.MultiTextImageCopyId)}var m=f.TextState.D[f.TextState.CurrentId]._QuillDeltas;a.Id=e.MultiTextImageCopyId;a.NaturalOffsetX=f.NaturalOffsetX;a.NaturalOffsetY=f.NaturalOffsetY;a.X=12;a.Y=12;a.CopyShapeState(f);if(m==null){a.TextState.D[a.TextState.CurrentId]._QuillDeltas=null}a.virtualSelected=true;MyShapesState.Public_SetShapeState(a.Id,a);MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Public_SelectShape($("#"+e.MultiTextImageCopyId));HideControlsMenu();var o="",l;for(l=0;l<a.TextState.D.length;l++){var n=l+1;o+="<li>                    <a id='multitextable_textarea"+l+"' class='multitextable_textareacls' selid='"+l+"'>                        <span class='sprite-sbt sprite-sbt-Bring-Forward'>                        </span>                        <img height='16' width='16' src='/content/menu/blank.gif'>                        Text Area "+n+"                    </a>        </li>"}GetGlobalById("MultiTextable-menu-select-id").innerHTML=o;$(".multitextable_textareacls").click(function(){var u=this.getAttribute("selid")*1+1;var s;$("#MultiTextable-header-title").html("Text Area "+u);for(s=0;s<a.TextState.D.length;s++){var t=e.MultiTextImageCopyId+"_TextBoxArea"+s;if(u-1==s){$("#"+t).attr("style","stroke: black; stroke-width: 5; ")}else{var v="Pink";switch(s){case 0:v="Red";break;case 1:v="Green";break;case 2:v="Blue";break;case 3:v="Orangle";break;case 4:v="Yellow";break;case 4:v="Lavendar";break}$("#"+t).attr("style","stroke-dasharray:5,5; stroke: "+v+"; stroke-width: 3; ")}}a.TextState.CurrentId=this.getAttribute("selid");MainControls.TextControls.PrepTextControls(MyPointers.Controls_TextableControls,a)});var k=(parseInt(a.TextState.CurrentId)+1);$("#textableControls").removeClass("ControlsBox");var r=$("#textableControls").detach();$("#MultiTextable-content").append(r);for(l=0;l<a.TextState.D.length;l++){g.find("#"+e.OriginalShape.Id+"_TextBoxArea"+l).attr("id",e.MultiTextImageCopyId+"_TextBoxArea"+l)}a.UpdateDrawing(true);g.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").hide();MainControls.TextControls.PrepTextControls(MyPointers.Controls_TextableControls,a);$("#MultiTextableModal").on("hidden.bs.modal",function(){MyShapesState.Public_RemoveShapeStateById(e.MultiTextImageCopyId)});$(".multitextable_textareacls").first().click()}function d(f){return function(g){c(f)}}b.ShowMultipleDialog=function(f){MyPointers.Dialog_MultiTextable.one("shown.bs.modal",d(f));var g=$("#multiTextableSvg");g.children().remove();MyPointers.Dialog_MultiTextable.modal()};b.Cancel=function(){MyPointers.Dialog_MultiTextable.modal("hide")};b.Update=function(){e.OriginalShape.CopyTextState(a.TextState);e.OriginalShape.UpdateDrawing(true);MyPointers.Dialog_MultiTextable.modal("hide")};return b}();var OpacitySliderOldValue=null;var OpacityHelper=function(){var d=new Object();d.initControls=function(){var e=$("#opacity-slider").slider({value:1,formater:function(f){return parseInt(f)+"%"}});$("#opacity-slider").on("slide",a);$("#opacity-slider").on("slideStart",b);$("#opacity-slider").on("slideStop",c);$("#opacity-slider").data("previousValue",1)};function b(){OpacitySliderOldValue=$("#opacity-slider").data("previousValue");a()}function a(){var e=MyShapesState.Public_GetFirstSelectedShapeState();var f=$("#opacity-slider").slider("getValue");OpacityHelper.setOpacity(e,f);return f}function c(){var e=MyShapesState.Public_GetFirstSelectedShapeState();var f=a();UndoManager.register(undefined,OpacityHelper.setOpacity,[e,OpacitySliderOldValue],undefined,"",OpacityHelper.setOpacity,[e,f])}d.setOpacity=function(e,f){e.opacity=f/100;UpdateActiveDrawing()};d.setSliderValue=function(e){if($("#opacity-slider").length>0){$("#opacity-slider").slider("setValue",e);$("#opacity-slider").data("previousValue",e)}};return d}();var SaveDataHelper=function(c){var d=new Object();d.NewStoryboard=1;d.EditStoryboard=2;d.AutoSave=3;d.GetSaveData=function(f,e){var g=new Object();g.MagicToken=MyUserPermissions.MagicToken;g.RequestStart=(new Date()).toUTCString();g.SaveTry=1;g.Svg=b(f);g.SvgLength=g.Svg.length;g.ShapeStates=MyShapesState.Public_ShapeStateToJson();g.ShapeStatesLength=g.ShapeStates.length;g.CharacterSwapLibrary=MyCharacterSwapLibrary.Public_GetJSON(MyShapesState);g.CharacterSwapLibraryLength=g.CharacterSwapLibrary.length;g.LayoutConfig=JSON.stringify(CellConfiguration.GetLayoutConfig());g.LayoutConfigLength=g.LayoutConfig.length;if(StoryboardContainer.GlobalCellCropRatio!==void 0){g.GlobalCellCropRatio=JSON.stringify(StoryboardContainer.GlobalCellCropRatio)}g.UseCompression=0;g.SaveDuration=+new Date();if(f==SaveDataHelper.NewStoryboard){g.Title=$("#StoryboardTitle").val();g.Description=$("#StoryboardDescription").val();g.PortalFolderId=$("#portal_folder_id").val()}else{if(f==SaveDataHelper.EditStoryboard||f==SaveDataHelper.AutoSave){g.UrlTitle=$("#UrlTitle").val();g.UserName=$("#EditUserName").val()}}if(!e){g.UsePmc=1;g.Svg=pmc(prePmc(g.Svg));g.SvgLength=g.Svg.length;g.ShapeStates=pmc(prePmc(g.ShapeStates));g.ShapeStatesLength=g.ShapeStates.length;g.CharacterSwapLibrary=pmc(g.CharacterSwapLibrary);g.CharacterSwapLibraryLength=g.CharacterSwapLibrary.length}return g};function b(h){try{if(h==SaveDataHelper.AutoSave){var l=$("#CoreSvg").clone();$(l).find('foreignObject > div[edited="false"]').html("");l.attr("style","");l.find("[id$=selection_box]").remove();l.find("[id$=selection_box_rect_wrap]").remove();l.find("[id=SvgTop]").children().remove();var j=(new XMLSerializer()).serializeToString(l.get()[0]);return j}else{var k=GetGlobalById("CoreSvg");var f={};$(k).find('foreignObject > div[edited="false"]').each(function(e){f[$(this)]=$(this).html();$(this).html("")});var i=k.getAttribute("style");k.setAttribute("style","");var j=(new XMLSerializer()).serializeToString(k);k.setAttribute("style",i);$(k).find('foreignObject > div[edited="false"]').each(function(e){$(this).html(f[$(this)])});return j}}catch(g){LogErrorMessage("SaveDataHelper.GetRawSvg",g)}}function a(e){}return d}();var SaveHelper=function(){var m=new Object();var i=new Object();var g=new LocalDbHelper();i.NewStoryboardUrl={uncompressed:CreatorUrls.GeoServer+"/geosavestoryboard/savenewstoryboard",compressed:CreatorUrls.GeoServer+"/api/v1/storyboard/new"};i.EditStoryboardUrl={uncompressed:CreatorUrls.GeoServer+"/geosavestoryboard/saveeditstoryboard",compressed:CreatorUrls.GeoServer+"/api/v1/storyboard/edit"};i.AutoStoryboardUrl={uncompressed:CreatorUrls.GeoServer+"/geosavestoryboard/autosavestoryboard",compressed:CreatorUrls.GeoServer+"/api/v1/storyboard/auto"};m.ChangesDetected=void 0;m.ChangeObserver=new MutationObserver(function(o){m.MarkAsChanged(true)});m.SaveStoryboard=function(r,q,p){$("#SaveChoicesDialog").modal("hide");saveAndContinue=r;try{var s=MyShapesState.Property_GetShapeStatesCount();if(s<1){swalQueue(MyLangMap.GetTextByToken("warning-add-more"));return}SbtBlockUI();MyUserPermissions.Public_RefreshPermissions(true,n(saveAndContinue,q,p))}catch(o){LogErrorMessage("SaveHelper.SaveStoryboard",o)}};m.SaveStoryboard_PostLogon=function(){try{warnOnExit=false;HideControlsMenu();ClearActiveState();SbtBlockUI();var p=SaveDataHelper.GetSaveData(SaveDataHelper.NewStoryboard);if(SaveAsTemplate!=null&&SaveAsTemplate==true){p.overrideStoryboardPermissionId=16}h(p,i.NewStoryboardUrl)}catch(o){LogErrorMessage("SaveHelper.SaveStoryboard_PostLogon",o)}};m.AutoSave=function(){if(StoryboardSetup.EnableAutoSave==false){return}MyUserPermissions.Public_RefreshPermissions(true,a())};m.LocalSave=function(){if(SaveHelper.ChangesDetected){var o=SaveDataHelper.GetSaveData(SaveDataHelper.AutoSave,true);g.Save(IsUserLoggedOn,o.UrlTitle,JSON.stringify(o));m.MarkAsChanged(false);return true}return false};m.DiscardLocalSave=function(){g.Delete(window.IsUserLoggedOn);m.MarkAsChanged(false)};m.MarkAsChanged=function(o){if(SaveHelper.ChangesDetected!==o){if(o){SaveHelper.ChangesDetected=true;SaveHelper.ChangeObserver.disconnect()}else{SaveHelper.ChangesDetected=false;SaveHelper.ChangeObserver.observe(document.getElementById("CoreSvg"),{attributes:true,childList:true,characterData:true,subtree:true})}}};function k(){try{if(MyUserPermissions.AllowEditSave==false){$("#SaveDialogSorryContent").children().remove();$("#SaveDialogSorryContent").html("");$("#SaveDialogSorryContent").append(MyUserPermissions.SaveMessage);$("#SaveDialogSorry").modal();return}warnOnExit=false;HideControlsMenu();ClearActiveState();SbtBlockUI();var p=SaveDataHelper.GetSaveData(SaveDataHelper.EditStoryboard);h(p,i.EditStoryboardUrl)}catch(o){LogErrorMessage("SaveHelper.SaveAsEdit",o)}}function l(){try{if(MyUserPermissions.AllowNewSave==false){if(MyUserPermissions.ModalPop!=null&&MyUserPermissions.ModalPop!=""){$("#"+MyUserPermissions.ModalPop).modal("show");return}$("#SaveDialogSorryContent").children().remove();$("#SaveDialogSorryContent").html("");$("#SaveDialogSorryContent").append(MyUserPermissions.SaveMessage);$("#SaveDialogSorry").modal();return}var v=$("#save-dialog-message");v.children().remove();v.append(MyUserPermissions.SaveMessage);var p=$("#save-dialog-folders");p.children().remove();p.text("");if(MyUserPermissions.PortalFolders==null){p.append('<input type=hidden id="portal_folder_id" value="0">')}else{if(DestinationFolderId!=null&&DestinationFolderId!=0){for(var u=0;u<MyUserPermissions.PortalFolders.length;u++){if(MyUserPermissions.PortalFolders[u].FolderId==DestinationFolderId){var q=MyUserPermissions.FolderTitle+":<br />";q+='<select id="portal_folder_id" style="margin-bottom:15px; width:95%">';q+="<option "+w+' value="'+MyUserPermissions.PortalFolders[u].FolderId+'">'+MyUserPermissions.PortalFolders[u].FolderName+"</option>";q+="</select>";q+="</br>";q+="</br>";p.append(q);break}}}else{var r=false;var s="";s+=MyUserPermissions.FolderTitle+":<br />";s+='<select id="portal_folder_id" style="margin-bottom:15px; width:95%">';s+='<option value="0">--- '+MyUserPermissions.NoFolderTitle+"  ---</option>";for(var t=0;t<MyUserPermissions.PortalFolders.length;t++){var w="";if(MyUserPermissions.SelectedPortalFolder!=null&&MyUserPermissions.SelectedPortalFolder.FolderId==MyUserPermissions.PortalFolders[t].FolderId){w="selected";r=true}s+="<option "+w+' value="'+MyUserPermissions.PortalFolders[t].FolderId+'">'+MyUserPermissions.PortalFolders[t].FolderName+"</option>"}s+="</select>";s+="</br>";s+="</br>";p.append(s);if(r){document.getElementById("portal_folder_id").disabled=true}}}$("#SaveDialog").modal()}catch(o){LogErrorMessage("SvgManip.SaveAsNew_PrepareDialog",o)}}function b(){try{if(StoryboardContainer.IsFreeLayoutConfiguration(StoryboardContainer.Rows,StoryboardContainer.Cols)){return true}if(MyUserPermissions.EnableAllCellOptions==false){MyPointers.Dialog_PurchasePopForMoreLayouts.modal();return false}return true}catch(o){LogErrorMessage("SvgManip.CheckCellLimitOnSave",o)}}function h(s,u,t,r){try{m.LocalSave();var q=+new Date();s.SaveDuration=q-s.SaveDuration;var o=pako.deflate(JSON.stringify(s),{gzip:true});$.ajax({caller:"SaveHelper.PostStoryboard",type:"POST",url:u.compressed,processData:false,contentType:"application/gzip+json",cache:false,data:o,dataType:"binary",async:true,responseType:"json",timeout:300*1000}).done(function(v){m.DiscardLocalSave();var w=t||f(s,u);w(v)}).fail(function(x,y,v){var w=r||e(s,u);w(x,y,v)});if(Appcues!==void 0){Appcues.track("Storyboard Saved")}}catch(p){LogErrorMessage("SaveHelper.PostStoryboard",p)}}$("#test-save-btn").click(function(){if(m.LocalSave()){swalQueue("Local Save Complete")}else{swalQueue("No changes detected")}});$("#test-autosave-btn").click(function(){m.AutoSave()});function d(p){if(p.Error!=null&&p.Error){return}var o=$("#show-auto-saved");o.toggle();setTimeout(function(){o.toggle()},5000)}function c(o){}function a(){return function(){if((MyUserPermissions.IsLoggedOn==false)||(MyUserPermissions.AllowEditSave==false)){return}var q=SaveDataHelper.GetSaveData(SaveDataHelper.AutoSave);try{var p=+new Date();q.SaveDuration=p-q.SaveDuration;h(q,i.AutoStoryboardUrl,d,c)}catch(o){LogErrorMessage("SaveHelper.AutoSavePostRefreshClosure",o)}}}function n(q,p,o){return function(){try{SbtUnblockUI();if(MyUserPermissions.IsLoggedOn==false){if(p){HandleLoginCloseFunction=function(){SaveHelper.SaveStoryboard(q,false,o)};showLogonDialog();return}swalQueue("You must be logged in to save your storyboard.  Please login and try again.");return}if(b()==false){return}ClearActiveState();if(HasGridLines()){ToggleGridLines()}StoryboardContainer.RemoveFilters();MyShapesState.Public_ClearDefaults();if(o){k()}else{l()}}catch(r){LogErrorMessage("SaveHelper.SaveImagePostRefreshClosure",r)}}}function f(o,p){return function(q){try{if(q.Error!=null){var s="";var t="";if(q.Error=="Timeout"){s=MyLangMap.GetTextLineBreaksByToken("Error-Save-Time-Out")}else{if(q.Error=="NoXml"){s=MyLangMap.GetTextLineBreaksByToken("Error-Save-No-Xml")}else{if(q.ErrorId!=null){s=MyLangMap.GetTextLineBreaksByToken(q.ErrorId)}else{t="Error saving storyboard";s=q.Error}}}LogErrorMessage("SaveHelper.HandleSaveSuccessClosure",{message:"returned "+q.ErrorId,stack:new Error().stack});swalQueue({title:t,text:s,type:"error",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")});SbtUnblockUI();return}if(saveAndContinue){ResetSaveWarning();SbtUnblockUI();return}if(q.RedirectUrl==null||q.RedirectUrl==""||q.RedirectUrl=="undefined"){swalQueue({title:"",text:MyLangMap.GetTextLineBreaksByToken("Error-Save-Failed"),type:"error",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")});SbtUnblockUI();return}window.location.href=q.RedirectUrl}catch(r){SbtUnblockUI();LogErrorMessage("SaveHelper.HandleSaveSuccessClosure",r)}SbtUnblockUI()}}function j(p,r){try{if(p.SaveTry>0){return false}MyUserPermissions.UseCompression=true;var q=new Date()-Date.parse(p.RequestStart);if(q>90*1000){return false}p.SaveTry++;h(p,r);return true}catch(o){LogErrorMessage("SaveHelper.RetrySave",o)}return false}function e(o,p){return function(s,t,r){try{SbtUnblockUI();trackEventWithGA("Storyboard Creator","Save","SAVE FAILED",0);if(t=="Timeout"||t=="Ajax::TIMEOUT"){swalQueue("Your storyboard timed out while saving","If you see this error multiple times please email support@storyboardthat.com and include this message.\r\n\r\n#"+_correlationId)}else{if(data!=null&&data.statusText!=null&&data.statusText=="Internal Server Error"){swalQueue("There was a problem saving your storyboard","If you see this error multiple times please email support@storyboardthat.com and include this message.\r\n\r\n#"+_correlationId)}else{swalQueue("There was a problem saving your storyboard","If you see this error multiple times please email support@storyboardthat.com and include this message.\r\n\r\n#"+_correlationId)}}}catch(q){LogErrorMessage("SaveHelper.HandleSaveFailureClosure",q)}}}return m}();var SbtInlineEditorExtensions=(function(){var a={};return a})();var SbtInlineEditorHelper=function(){var m=new Object();var d="";var e=10;var c=null;var q=false;var p=false;var a=null;var f=null;var g=null;var o=function(r){if($(r.target).parents("foreignobject").length>0){try{if(r.originalEvent.explicitOriginalTarget!=$("div.note-editable")[0]){r.stopPropagation()}}catch(s){}}return true};var j=m.InitSummerNoteIfNeeded=function(){if(p!==true){p=true;InitSummerNote();SbtInlineEditorHelper.ResetToDefaults()}};var k=m.IsEditingNode=function(r){if(a==null||r==null){return false}if(a.length===r.length&&a.length==a.filter(r).length){return true}return false};var h=m.EndEditNode=function(){if(a==null){return}if(!l(a)){try{a.summernote("destroy");a.off("summernote");a.parent().off("mousedown");a.parent().off("mouseup")}catch(w){}a=null;return}var s=a.summernote("code");if(typeof s!=="string"){a=null;return}var t=SbtInlineEditorHelper.GetVerticalAlignment();a.summernote("destroy");a.off("summernote");a.parent().off("mousedown");a.parent().off("mouseup");if(a.text()===""){a.html(m.GetDefaultTextForEditNode(a));a.attr("edited","false");s=""}else{a.attr("edited","true")}if(s!==f||t!==g){var r=a.attr("id");var u=MyShapesState.Public_GetShapeStateById(r.split("_text")[0]);var v=parseInt(r.split("_text")[1]);u.TextState.D[v].Html=s;u.TextState.D[v].VerticalAlignment=t;UndoManager.register(undefined,SbtInlineEditorHelper.UndoRedoSetNodeState,[r,f,g],"Undo Textable Changes",undefined,SbtInlineEditorHelper.UndoRedoSetNodeState,[r,s,t],"Redo Textable Changes")}a=null};m.StartEditNode=function(r){if(k(r)){return}if(!l(r)){return}j();h();a=r;if(a.text()===""){a.html("")}if(a.attr("edited")==="false"){a.html("")}f=a.html();g=a.css("vertical-align");StartInlineEditor(a);a.parent().on("mousedown",o);a.parent().on("mouseup",o)};m.SyncEditorStyleOnInit=function(){if(a==null){return}a.height("auto");a.height(a.height());var t=a.height();var r=$("#"+a.attr("id")+"_wrap .note-editor .note-editing-area .note-editable");r.width(a.width());r.height(t);r.css({"vertical-align":a.css("vertical-align"),"text-align":a.css("text-align"),"font-family":a.css("font-family"),color:a.css("color"),"font-size":a.css("font-size")});var s=$("#"+a.attr("id")+"_wrap .note-editor .note-editing-area .note-placeholder, #"+a.attr("id")+"_wrap .note-editor .note-editing-area .note-inner-placeholder");s.width(a.width());s.height(t);s.css({"vertical-align":a.css("vertical-align"),"text-align":a.css("text-align"),"font-family":a.css("font-family"),"font-size":a.css("font-size"),color:"#CCCCCC"});r.focus();window.setTimeout(function(){var v,u;if(window.getSelection&&document.createRange){u=document.createRange();u.selectNodeContents(r[0]);u.collapse(true);v=window.getSelection();v.removeAllRanges();v.addRange(u)}else{if(document.body.createTextRange){u=document.body.createTextRange();u.moveToElementText(r[0]);u.collapse(true);u.select()}}SbtInlineEditorHelper.SyncContentHeight()},100)};m.SyncContentHeight=function(){if(a==null){return}var r=a.attr("id").split("_text");MyShapesState.Public_GetShapeStateById(r[0]).ForceSize_InlineEditorForSubId(parseInt(r[1]))};var n=m.SetNodeState=function(u,v,w,t){if(t){var y=$("#"+u).html();var z=$("#"+u).css("vertical-align");UndoManager.register(undefined,SbtInlineEditorHelper.UndoRedoSetNodeState,[editedNodeId,y,z],"",undefined,SbtInlineEditorHelper.UndoRedoSetNodeState,[editedNodeId,v,w],"")}var r=$("#"+u);r.html(v);r.css("vertical-align",w);var x=MyShapesState.Public_GetShapeStateById(u.split("_text")[0]);var A=parseInt(u.split("_text")[1]);x.TextState.D[A].Html=v;x.TextState.D[A].VerticalAlignment=w;var s=$("#"+r.parent()[0].id+" .note-editor .note-editing-area .note-editable");if(s.length>0){s.html(v);s.css("vertical-align",w)}};m.UndoRedoSetNodeState=function(r,s,t){n(r,s,t,false);MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);var v=$("#"+r).parent().parent()[0].id;var u=MyShapesState.Public_GetShapeStateById(v);MyShapesState.Public_SelectShape($("#"+v));UpdateActiveDrawing();u.ForceSize_InlineEditor()};m.ResetToDefaults=function(){};m.SetVerticalAlignment=function(r){if(a==null){return}a.css("vertical-align",r);$("#"+a.parent()[0].id+" .note-editor .note-editing-area .note-editable").css("vertical-align",r);m.SyncContentHeight()};m.GetVerticalAlignment=function(){if(a==null){return}return a.css("vertical-align")};m.JamText=function(t){if(a==null){return}var r=a.summernote("currentStyle");var s=$("<span>"+t+"</span>");s.css(r);a.summernote("editor.insertNode",s[0])};m.Deltas_UpdateFontSizeAndColor=function(s,u,r){if(s==null){return s}for(var t=0;t<s.length;t++){if(s[t]["attributes"]!=null){s[t].attributes.size=u;s[t].attributes.color=r}}return s};m.GenerateQuillForOneLiner=function(x,w,y,u,v){if(y=="middle"){y="center"}var s=[];var r=new Object();r.insert="\n";r.attributes=new Object();r.attributes.align=y;var t=new Object();t.insert=x;t.attributes=GetDefaultStyleObject();t.attributes.size=w;t.attributes.font=u;t.attributes.align=y;t.attributes.color=v;s.push(r);s.push(t);return s};var l=function(r){var s=r.attr("id").split("_text");return MyShapesState.Public_GetShapeStateById(s[0])!=null};m.GetDefaultFont=function(){return MyBrowserProperties.Public_GetDefaultFont().replaceAll2("_"," ")};m.GetTextStateForEditNode=function(r){var s=r.attr("id").split("_text");return MyShapesState.Public_GetShapeStateById(s[0]).TextState.D[parseInt(s[1])]};m.GetDefaultTextForEditNode=function(r){var s=m.GetTextStateForEditNode(r).DefaultText||"";if(s===""){s=PlaceHolderClickToEdit}return s};m.GetDefaultStyleCssObject=function(r){return{"text-align":"center","font-family":SbtInlineEditorHelper.SanitizeFont(i(r,"Font",d).replaceAll2('"',"'").replaceAll2("_"," ")),color:i(r,"FontColor","black"),"font-size":i(r,"FontSize",e)+"pt"}};m.GetDefaultStyleCssString=function(r){return"text-align:center;font-family:"+SbtInlineEditorHelper.SanitizeFont(i(r,"Font",d).replaceAll2('"',"'").replaceAll2("_"," "))+";color:"+i(r,"FontColor","black")+";font-size:"+i(r,"FontSize",e)+"pt;"};m.GetDefaultHtmlFromText=function(r){return r.Text.replaceAll2("\r"," ").replaceAll2("\n","")};m.GetDeltasToHtml=function(u){var G="";var z=false;if(u==null){return""}if(u[0]==null){LogErrorMessage("SbtInlineEditorHelper.GetDeltasToHtml: (Self Healing) Initial delta was null or undefined.  Resetting to defaults");SbtInlineEditorHelper.ResetToDefaults()}if(u[0].insert!=="\n"){if(q){G+='<p align="center">'}else{G+='<p style="text-align:center;">'}}for(var x=0;x<u.length;x++){var t=u[x];if(t==null){LogErrorMessage("SbtInlineEditorHelper.GetDeltasToHtml: Delta "+x+" was null or undefined.  Skipping");continue}if(t.insert==="\n"){if(z){G+="</p>"}var r="center";if(t.attributes!=null){r=t.attributes.align}z=true;var A=r==="start"?"left":r;if(q){G+='<p align="'+A+'">'}else{G+='<p style="text-align:'+r+';">'}}else{var F="";var v=i(t.attributes,"font",d).replaceAll2('"',"'").replaceAll2("_"," ");v=SbtInlineEditorHelper.SanitizeFont(v);F+="font-family:"+v+";";F+="color:"+i(t.attributes,"color","black")+";";var H=i(t.attributes,"underline",false);var E=i(t.attributes,"strike",false);var D=i(t.attributes,"script","");var s=i(t.attributes,"bold","");var y=i(t.attributes,"italic","");D=D==="super"?"sup":D;var w=i(t.attributes,"size",e);F+="font-size:"+w+"pt;";if(EnableBold){if(s){F+="font-weight:bold;"}if(y){F+="font-style:italic;"}}if(H){F+="text-decoration:underline;"}if(E){F+="text-decoration:line-through;"}var C="";var B="";if(D!=""){C="<"+D+">";B="</"+D+">"}G+='<span style="'+F+'">'+C+(t.insert?t.insert.replaceAll2("\r"," ").replaceAll2("\n",""):"")+B+"</span>"}}if(z){G+="</p>"}return G};m.SanitizeFont=function(t){try{var r=SbtInlineEditorHelper.GetDefaultFont().replaceAll2('"',"'").replaceAll2("_"," ");if(t==null){return r}for(var u=0;u<SummerNoteSettings.FontNames.length;u++){if(b(t,SummerNoteSettings.FontNames[u].Family)){return SummerNoteSettings.FontNames[u].Family.replaceAll2('"',"'").replaceAll2("_"," ")}}}catch(s){LogErrorMessage("my.SanitizeFont",s)}return r};function b(r,s){r=r.replaceAll2('"',"").replaceAll2("'","").toLowerCase();s=s.replaceAll2('"',"").replaceAll2("'","").toLowerCase();return(r===s)}function i(s,t,r){if(s==null||s[t]==null){return r}return s[t]}return m}();var SbtQuillHelper=function(){var a=new Object();a.ResetToDefaults=function(){var b=MyBrowserProperties.Public_GetDefaultFont().replaceAll2("'","").replaceAll2(" ","_");quill.formatLine(0,2,"align","center");quill.format("font",b);$(".ql-editor").css("background-color","")};a.JamText=function(d){var c=quill.getSelection();var b=c==null?quill.getLength()-1:c.index;quill.insertText(b,d);quill.setSelection(b+d.length)};a.HandleWhiteText=function(){var b=false;var d=quill.getContents().ops;for(var c=0;c<d.length;c++){if(d[c].attributes!=null&&d[c].attributes.color!=null){if(d[c].attributes.color==="#ffffff"){b=true}}}if(b){$(".ql-editor").css("background-color","#555555")}else{$(".ql-editor").css("background-color","")}};return a}();var SbtSummerNoteHelper=function(){var l=new Object();var c="";var d=10;var b=null;var o=false;var n=false;l.InitSummerNoteIfNeeded=function(){if(n===true){return false}n=true;InitSummerNote();SbtSummerNoteHelper.ResetToDefaults();return true};l.ResetToDefaults=function(){try{if(n===false){InitSummerNote();n=true}}catch(s){LogErrorMessage("SbtSummerNoteHelperObject.ResetToDefaults.a",s)}try{ClearSelections();c=MyBrowserProperties.Public_GetDefaultFont().replaceAll2("_"," ");$(".note-editable.panel-body").css("font-family",c);if($(".note-current-fontname").text()!=c.replaceAll2("'","")){$("#summernote-editor").summernote("fontName",c)}var q=[];var p=new Object();p.insert="\n";p.attributes=new Object();p.attributes.align="center";var r=new Object();r.insert="&#65279;";r.attributes=g();q.push(p);q.push(r);SbtSummerNoteHelper.UpdateForDeltas(q);if($(".note-current-fontname").text()!=c.replaceAll2("'","")){$("#summernote-editor").summernote("fontName",c)}if($(".note-current-fontsize").text()!=d){$("#summernote-editor").summernote("fontSize",d)}b=SbtSummerNoteHelper.GetDeltas()}catch(s){LogErrorMessage("SbtSummerNoteHelperObject.ResetToDefaults.b",s)}};l.JamText=function(s){try{var p=$("#summernote-editor").summernote("currentStyle");var r=document.createElement("span");r.textContent=s;$(r).css("font-family",p["font-family"]);$(r).css("font-size",p["font-size"]+"pt");try{$(r).css("color",$(p.ancestors[1]).css("color"));$(r).css("text-decoration",$(p.ancestors[1]).css("text-decoration"))}catch(q){LogErrorMessage(" SbtSummerNoteHelperObject.JamText - Sneaky styles",q)}$("#summernote-editor").summernote("insertNode",r)}catch(q){LogErrorMessage(" SbtSummerNoteHelperObject.JamText",q)}};l.Deltas_UpdateFontSizeAndColor=function(q,s,p){if(q==null){return q}for(var r=0;r<q.length;r++){if(q[r]["attributes"]!=null){q[r].attributes.size=s;q[r].attributes.color=p}}return q};l.GenerateQuillForOneLiner=function(v,u,w,s,t){if(w=="middle"){w="center"}var q=[];var p=new Object();p.insert="\n";p.attributes=new Object();p.attributes.align=w;var r=new Object();r.insert=v;r.attributes=g();r.attributes.size=u;r.attributes.font=s;r.attributes.align=w;r.attributes.color=t;q.push(p);q.push(r);return q};l.GetDefaultFont=function(){return MyBrowserProperties.Public_GetDefaultFont().replaceAll2("_"," ")};l.HandleWhiteText=function(){var q=false;var s=SbtSummerNoteHelper.GetDeltas();if(s===null){$(".note-editable").css("background-color","");return}for(var r=0;r<s.length;r++){if(s[r].attributes!=null&&s[r].attributes.color!=null){var p=s[r].attributes.color.replaceAll2(" ","").toLowerCase();if(p==="#ffffff"||p.indexOf("rgb(255,255,255)")>=0){q=true}}}if(q){$(".note-editable").css("background-color","#555555")}else{$(".note-editable").css("background-color","")}};l.Paste=function(){};l.IsDefault=function(){if(b==null){return false}var p=SbtSummerNoteHelper.GetDeltas();return SbtLib.DeepCompareEquality(p,b)};l.GetDeltas=function(){var q=$("#summernote-editor").summernote("code");if(q===""){return null}q=q.replaceAll2("<div","<p").replaceAll2("</div","</p");var p=SbtSummerNoteHelper.GetSummerNoteDeltas(q);if(p==null){LogErrorMessage("SbtSummerNoteHelper.GetDeltas: Deltas null ")}return p};l.OnChange=function(v,q,p){var u=MyShapesState.Public_GetFirstSelectedShapeState();if(u==null){return}var s=u.TextState.Public_GetQuillDeltas();var r=SbtSummerNoteHelper.GetDeltas();if(r==null){return}if(SbtLib.DeepCompareEquality(r,s)){return}var t=$("#summernote-editor").summernote("code");if(k(t,r)){return}UndoManager.register(undefined,SbtSummerNoteHelper.UndoTextChange,[u.Id,s,u.TextState.CurrentId],"",undefined,SbtSummerNoteHelper.UndoTextChange,[u.Id,r,u.TextState.CurrentId],"");u.TextState.Public_SetQuillDeltas(r);u.SetText(SbtSummerNoteHelper.GetText(r));if(r==null){LogErrorMessage("SbtSummerNoteHelper.OnChange: Deltas null ")}u.UpdateDrawing(true)};l.UndoTextChange=function(s,q,p){try{var t=MyShapesState.Public_GetShapeStateById(s);t.TextState.CurrentId=p;if(t==null){LogErrorMessage("SvgManip.UndoTextChangeSummerNote - ShapeState is Null - ID: "+s);return}t.TextState.Public_SetQuillDeltas(q);t.SetText(SbtSummerNoteHelper.GetText(q));SbtSummerNoteHelper.UpdateForDeltas(q);t.UpdateDrawing();if(q==null){LogErrorMessage("SbtSummerNoteHelper.UndoTextChange: Deltas null ")}}catch(r){LogErrorMessage("SvgManip.UndoTextChangeQuill",r)}};l.GetText=function(p){var r="";if(p==null){return r}for(var q=0;q<p.length;q++){r+=p[q].insert}return r};l.UpdateForHtml=function(p){$("#summernote-editor").summernote("code",p)};l.UpdateForDeltas=function(p){if(p==null){SbtSummerNoteHelper.ResetToDefaults()}else{var q=m(p);$("#summernote-editor").summernote("code",q)}};function k(r,p){try{if(i(r)||j(p)){$("#summernote-editor").summernote("code",m(p));return true}}catch(q){LogErrorMessage("SbtSummerNoteHelper.SanitizeIfNeeded",q)}return false}l.GetSummerNoteDeltas=function(s){var t=$("#summernote-text-parse");t.empty();t.append(s);var q=[];e(t,null,q);try{var p=q.length;if(p>2){if(q[p-1].insert[0].charCodeAt()===65279&&SbtLib.DeepCompareEquality(q[p-1]["attributes"],q[p-2]["attributes"])){q.pop()}}}catch(r){LogErrorMessage("SbtSummerNoteHelperObject.GetSummerNoteDeltas",r)}t.empty();return q};function i(q){var r=["<a","<script","<img","<i>","<b>","<ul","<table","<p class=","<span class="];for(var p=0;p<r.length;p++){if(q.indexOf(r[p])>=0){return true}}return false}function j(p){if(p[0]!=null&&p[0]["attributes"]!=null){if(p[0].attributes.font.toLowerCase().indexOf("open sans")>=0){return false}}for(var q=0;q<p.length;q++){if(a(p[q].attributes.font,SbtSummerNoteHelper.SanitizeFont(p[q].attributes.font))==false){return true}}return false}function e(t,u,r){t=$(t);if(t[0].nodeName==="#text"){var q=new Object();q.insert=t.text();q.attributes=u;r.push(q)}else{if(t[0].nodeName==="#comment"){}else{var u=h(t,u);if(t[0].nodeName.toLowerCase()==="p"){var q=new Object();q.insert="\n";q.attributes=u;r.push(q)}}}var p=$(t).contents();for(var s=0;s<p.length;s++){e(p[s],u,r)}}function g(){var p=new Object();p.font=c;p.size=d;p.color="rgb(0,0,0)";p.bold=false;p.italic=false;p.strike=false;p.underline=false;p.align="center";p.script="";return p}l.UpdateUsePAlign=function(p){o=p};function h(u,w){var v=g();try{if(w!=null){v.script=w.script;v.underline=w.underline;v.strike=w.strike;v.font=w.font;v.bold=w.bold;v.italic=w.italic}}catch(s){LogErrorMessage("SbtSummerNoteHelper.GetTextStyles.a",s)}try{if(u.context.nodeName.toLowerCase()==="sub"){v.script="sub"}if(u.context.nodeName.toLowerCase()==="sup"){v.script="super"}var t=1;if(v.script!=""){t=1.333}var p=$(u).css("font-family");v.font=p||v.font||c;v.font=v.font==null?c:v.font;v.font=SbtSummerNoteHelper.SanitizeFont(v.font);var q=$(u).css("font-size");v.size=q==null?v.size:(parseFloat(q)*t*72/96).toFixed(0);v.size=v.size.replace("pt","").replace("px","");try{v.bold=v.bold?true:$(u).css("font-weight")=="700";v.italic=v.italic?true:$(u).css("font-style").toLowerCase().indexOf("italic")>=0}catch(s){LogErrorMessage("SbtSummerNoteHelper.GetTextStyles",s)}v.color=$(u).css("color");v.underline=v.underline?true:$(u).css("text-decoration").toLowerCase().indexOf("underline")>=0;v.strike=v.strike?true:$(u).css("text-decoration").toLowerCase().indexOf("line-through")>=0;v.align=$(u).css("text-align");if($(u).attr("align")!=null&&$(u).attr("align")!=""&&$(u).attr("align")!=v.align){SbtSummerNoteHelper.UpdateUsePAlign(true);v.align=$(u).attr("align")}}catch(r){LogErrorMessage("SbtSummerNoteHelper.GetTextStyles",r)}return v}function m(s){var E="";var x=false;if(s==null){return""}if(s[0]==null){LogErrorMessage("SbtSummerNoteHelper.SummerDeltasToHtml: (Self Healing) Initial delta was null or undefined.  Resetting to defaults");SbtSummerNoteHelper.ResetToDefaults()}if(s[0].insert!=="\n"){if(o){E+='<p align="center">'}else{E+='<p style="text-align:center;">'}}for(var v=0;v<s.length;v++){var r=s[v];if(r==null){LogErrorMessage("SbtSummerNoteHelper.SummerDeltasToHtml: Delta "+v+" was null or undefined.  Skipping");continue}if(r.insert==="\n"){if(x){E+="</p>"}var p="center";if(r.attributes!=null){p=r.attributes.align}x=true;var y=p==="start"?"left":p;if(o){E+='<p align="'+y+'">'}else{E+='<p style="text-align:'+p+';">'}}else{var D="";var t=f(r.attributes,"font",c).replaceAll2('"',"'").replaceAll2("_"," ");t=SbtSummerNoteHelper.SanitizeFont(t);D+="font-family:"+t+";";D+="color:"+f(r.attributes,"color","black")+";";var F=f(r.attributes,"underline",false);var C=f(r.attributes,"strike",false);var B=f(r.attributes,"script","");var q=f(r.attributes,"bold","");var w=f(r.attributes,"italic","");B=B==="super"?"sup":B;var u=f(r.attributes,"size",d);D+="font-size:"+u+"pt;";if(EnableBold){if(q){D+="font-weight:bold;"}if(w){D+="font-style:italic;"}}if(F){D+="text-decoration:underline;"}if(C){D+="text-decoration:line-through;"}var A="";var z="";if(B!=""){A="<"+B+">";z="</"+B+">"}E+='<span style="'+D+'">'+A+(r.insert?r.insert.replaceAll2("\r"," ").replaceAll2("\n",""):"")+z+"</span>"}}if(x){E+="</p>"}return E}l.SanitizeFont=function(r){try{var p=SbtSummerNoteHelper.GetDefaultFont().replaceAll2('"',"'").replaceAll2("_"," ");if(r==null){return p}for(var s=0;s<SummerNoteSettings.FontNames.length;s++){if(a(r,SummerNoteSettings.FontNames[s].Family)){return SummerNoteSettings.FontNames[s].Family.replaceAll2('"',"'").replaceAll2("_"," ")}}}catch(q){LogErrorMessage("SbtSummerNoteHelperObject.SanitizeFont",q)}return p};function a(p,q){p=p.replaceAll2('"',"").replaceAll2("'","").toLowerCase();q=q.replaceAll2('"',"").replaceAll2("'","").toLowerCase();return(p===q)}function f(q,r,p){if(q==null||q[r]==null){return p}return q[r]}return l}();var Sorters=function(){var a=new Object();a.SortShapeStatesByIndex=function(c,d){try{if($("#"+c.Id).index()>$("#"+d.Id).index()){return 1}else{return -1}}catch(b){LogErrorMessage("Sorters.SortShapeStatesByIndex",b)}};a.SortShapesByVisibleX=function(b,c){return b.Property_VisibleX()==c.Property_VisibleX()?0:+(b.Property_VisibleX()>c.Property_VisibleX())||-1};a.SortShapesByVisibleY=function(b,c){return b.Property_VisibleY()==c.Property_VisibleY()?0:+(b.Property_VisibleY()>c.Property_VisibleY())||-1};return a}();var UndoHelper=function(){var a=new Object();a.UndoBulkTextChange=function(){try{for(var c=0;c<arguments.length;c++){var d=arguments[c].Id;var f=MyShapesState.Public_GetShapeStateById(d);if(UseQuill||UseSummerNote){f.TextState.Public_SetQuillDeltas(arguments[c].QuillDeltas)}else{f.SetText(arguments[c].Text)}f.UpdateDrawing()}}catch(b){LogErrorMessage("UndoHelper.UndoBulkTextChange",b)}};a.UndoTitleEmphasis=function(){try{for(var c=0;c<arguments.length;c++){var d=arguments[c].Id;var f=MyShapesState.Public_GetShapeStateById(d);f.Public_SetColorForRegion("Textables",arguments[c].BackgroundColor,false,false);if(UseQuill){f.TextState.Public_QuillSetFontColor(arguments[c].FontColor);f.TextState.Public_QuillSetFontSize(arguments[c].FontSize)}else{if(UseSummerNote){f.TextState.Public_SummerNote_SetFontSizeAndColor(arguments[c].FontSize,arguments[c].FontColor)}else{f.TextState.FontColor=arguments[c].FontColor;f.TextState.FontSize=arguments[c].FontSize}}f.UpdateDrawing()}}catch(b){LogErrorMessage("UndoHelper.UndoBulkTextChange",b)}};return a}();function ColorWheel(g,h,a,b,c,d,e,f){this.Region=g;this.Title=h;this.Color1=a;this.Color2=b;this.Color3=c;this.Color4=d;this.Color5=e;this.Color6=f}ColorWheel.prototype.GetTitle=function(){try{var b=MyLangMap.GetTextByToken("CW-"+this.Region);if(b!=""){return b}return this.Region}catch(a){LogErrorMessage("ColorWheel.GetTitle",a);throw a}};function ColorWheels(){this.SanitizeColor=function(a){var b=a.toLowerCase();if(b=="paws"){return"BrightColor1"}if(b=="ears"){return"BrightColor2"}if(b=="color1"){return"PrimaryColor"}if(b=="color2"){return"PrimaryColor2"}if(b=="color3"){return"PrimaryColorAccent"}if(b=="darkcolors"){return"DarkColor"}if(b=="basiccolors"){return"PrimaryColor"}if(b=="brightcolors1"){return"BrightColor1"}if(b=="brightcolors2"){return"BrightColor2"}if(b=="brightcolors3"){return"BrightColor3"}if(b=="brightcolors4"){return"BrightColor4"}if(b=="softcolors"){return"PaleColor"}if(b=="arrows"){return"PaleColor"}if(b=="shapes"){return"LightColor"}if(b=="shapes3d"){return"PaleColor"}return a};this.Skin=new ColorWheel("Skin","Skin",MyColors.White,MyColors.PaleTan,MyColors.PeachyTan,MyColors.Tan,MyColors.DarkTan,MyColors.SoftBrown);this.Hair=new ColorWheel("Hair","Hair",MyColors.White,MyColors.Blonde,MyColors.Orange,MyColors.Brown,MyColors.MediumGrey,MyColors.Black);this.Hair2=new ColorWheel("Hair2","Hair",MyColors.White,MyColors.Blonde,MyColors.Orange,MyColors.Brown,MyColors.MediumGrey,MyColors.Black);this.Eyes=new ColorWheel("Eyes","Eyes",MyColors.White,MyColors.BlueEye,MyColors.OliveGreen,MyColors.SoftBrown,MyColors.Red,MyColors.Black);this.Makeup=new ColorWheel("Makeup","Makeup",MyColors.LightBlue,MyColors.LightRed,MyColors.LightGreen,MyColors.BrightYellow,MyColors.BrightViolet,MyColors.BrightGray);this.Pants=new ColorWheel("Pants","Pants",MyColors.Parchment,MyColors.SoftBrown,MyColors.BlueEye,MyColors.VeryDarkGrayBlue,MyColors.DarkGray,MyColors.Black);this.Shirt=new ColorWheel("Shirt","Shirt",MyColors.White,MyColors.LightRed,MyColors.LightBlue,MyColors.LightGreen,MyColors.LightYellow,MyColors.LightGray);this.Shorts=new ColorWheel("Shorts","Shorts",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.Dress=new ColorWheel("Dress","Dress",MyColors.White,MyColors.PaleRed,MyColors.PaleBlue,MyColors.PaleGreen,MyColors.PaleYellow,MyColors.PaleGray);this.Skirt=new ColorWheel("Skirt","Skirt",MyColors.White,MyColors.BrightRed,MyColors.BrightBlue,MyColors.BrightGreen,MyColors.BrightYellow,MyColors.BrightGray);this.Shoes=new ColorWheel("Shoes","Shoes",MyColors.White,MyColors.VeryDarkRed,MyColors.VeryDarkBlue,MyColors.VeryDarkGreen,MyColors.VeryDarkYellow,MyColors.Black);this.Tie=new ColorWheel("Tie","Tie",MyColors.White,MyColors.VeryDarkRed,MyColors.VeryDarkBlue,MyColors.VeryDarkGreen,MyColors.VeryDarkYellow,MyColors.Black);this.Jacket=new ColorWheel("Jacket","Jacket",MyColors.White,MyColors.DarkRed,MyColors.DarkBlue,MyColors.DarkGreen,MyColors.DarkYellow,MyColors.DarkGray);this.PrimaryColor=new ColorWheel("PrimaryColor","Color",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor2=new ColorWheel("PrimaryColor2","Color 2",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor3=new ColorWheel("PrimaryColor3","Color 3",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor4=new ColorWheel("PrimaryColor4","Color 4",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor5=new ColorWheel("PrimaryColor5","Color 5",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor6=new ColorWheel("PrimaryColor6","Color 6",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor7=new ColorWheel("PrimaryColor7","Color 7",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor8=new ColorWheel("PrimaryColor8","Color 8",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColorAccent=new ColorWheel("PrimaryColorAccent","Color 2",MyColors.White,MyColors.DarkRed,MyColors.DarkBlue,MyColors.DarkGreen,MyColors.DarkYellow,MyColors.DarkGray);this.PrimaryColorWhiteAndBlack=new ColorWheel("PrimaryColorWhiteAndBlack","Color",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Black);this.PrimaryColorWhiteAndBlack2=new ColorWheel("PrimaryColorWhiteAndBlack2","Color 2",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Black);this.PrimaryColorNoWhite=new ColorWheel("PrimaryColor","Color",MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.DarkViolet,MyColors.Black);this.DarkColor=new ColorWheel("DarkColor","Color",MyColors.DarkGray,MyColors.DarkRed,MyColors.VeryDarkYellow,MyColors.VeryDarkGreen,MyColors.VeryDarkGrayBlue,MyColors.VeryDarkBrown);this.VeryDarkColor=new ColorWheel("VeryDarkColor","Color",MyColors.VeryDarkRed,MyColors.VeryDarkBlue,MyColors.VeryDarkGreen,MyColors.VeryDarkYellow,MyColors.VeryDarkViolet,MyColors.VeryDarkOrange);this.BrightColor1=new ColorWheel("BrightColor1","Color",MyColors.BrightRed,MyColors.BrightBlue,MyColors.BrightYellow,MyColors.BrightOrange,MyColors.BrightViolet,MyColors.BrightGreen);this.BrightColor2=new ColorWheel("BrightColor2","Color 2",MyColors.BrightRed,MyColors.BrightBlue,MyColors.BrightYellow,MyColors.BrightOrange,MyColors.BrightViolet,MyColors.BrightGreen);this.BrightColor3=new ColorWheel("BrightColor3","Color 3",MyColors.BrightRed,MyColors.BrightBlue,MyColors.BrightYellow,MyColors.BrightOrange,MyColors.BrightViolet,MyColors.BrightGreen);this.BrightColor4=new ColorWheel("BrightColor4","Color 4",MyColors.BrightRed,MyColors.BrightBlue,MyColors.BrightYellow,MyColors.BrightOrange,MyColors.BrightViolet,MyColors.BrightGreen);this.LightColor=new ColorWheel("LightColor","Color",MyColors.LightBlue,MyColors.LightRed,MyColors.LightGreen,MyColors.BrightYellow,MyColors.BrightViolet,MyColors.BrightGray);this.PaleColor=new ColorWheel("PaleColor","Color",MyColors.PaleRed,MyColors.PaleBlue,MyColors.PaleGreen,MyColors.PaleYellow,MyColors.PaleViolet,MyColors.PaleOrange);this.PaleColorWithWhite=new ColorWheel("PaleColorWithWhite","Color",MyColors.White,MyColors.PaleRed,MyColors.PaleBlue,MyColors.PaleGreen,MyColors.PaleYellow,MyColors.PaleViolet);this.HandColor=new ColorWheel("HandColor","Hand",MyColors.HandBlue,MyColors.PaleTan,MyColors.PeachyTan,MyColors.Tan,MyColors.DarkTan,MyColors.SoftBrown);this.HandColor2=new ColorWheel("HandColor2","Hand 2",MyColors.HandBlue,MyColors.PaleTan,MyColors.PeachyTan,MyColors.Tan,MyColors.DarkTan,MyColors.SoftBrown);this.Turban=new ColorWheel("Turban","Turban",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Black);this.Fur=new ColorWheel("Fur","Fur",MyColors.Brown,MyColors.LightBrown,MyColors.PaleBrown,MyColors.Gray,MyColors.DarkGray,MyColors.LightRed);this.Fur2=new ColorWheel("Fur2","Fur 2",MyColors.VeryDarkBrown,MyColors.LightBrown,MyColors.PaleBrown,MyColors.Black,MyColors.LightGray,MyColors.PaleRed);this.Victorian=new ColorWheel("Victorian","Color",MyColors.VeryDarkRed,MyColors.VeryDarkTeal,MyColors.DarkGrayViolet,MyColors.SoftBrown,MyColors.PaleBrown,MyColors.DarkGold);this.Sky=new ColorWheel("Sky","Sky",MyColors.SkyPaleBlue,MyColors.SkyLightBlue,MyColors.SkyBlue,MyColors.SkyCloudy,MyColors.SkyNight,MyColors.SkyDarkNight);this.Furniture=new ColorWheel("Furniture","Furniture",MyColors.White,MyColors.PaleBrown,MyColors.BrightBrown,MyColors.DarkBrown,MyColors.VeryDarkBrown,MyColors.Gray);this.Textables=new ColorWheel("Textables","Textables",MyColors.White,MyColors.SbtPaleBlue,MyColors.PaleGrayBrown,MyColors.SbtBlue,MyColors.MutedYellow,MyColors.Parchment);this.CoolColor1=new ColorWheel("CoolColor1","Color 1",MyColors.SbtBlue,MyColors.MutedGray,MyColors.SbtPaleBlue,MyColors.SbtDarkBlue,MyColors.White,MyColors.PaleGray);this.CoolColor2=new ColorWheel("CoolColor2","Color 2",MyColors.SbtBlue,MyColors.MutedGray,MyColors.SbtPaleBlue,MyColors.SbtDarkBlue,MyColors.White,MyColors.PaleGray);this.CoolColor3=new ColorWheel("CoolColor3","Color 3",MyColors.SbtBlue,MyColors.MutedGray,MyColors.SbtPaleBlue,MyColors.SbtDarkBlue,MyColors.White,MyColors.PaleGray);this.CoolColor4=new ColorWheel("CoolColor4","Color 4",MyColors.SbtBlue,MyColors.MutedGray,MyColors.SbtPaleBlue,MyColors.SbtDarkBlue,MyColors.White,MyColors.PaleGray);this.Pavement=new ColorWheel("Pavement","Pavement",MyColors.LightGray,MyColors.LightPavement,MyColors.Pavement,MyColors.DarkPavement,MyColors.VeryDarkPavement,MyColors.Black);this.Grass=new ColorWheel("Grass","Grass",MyColors.White,MyColors.GrassPaleGreen,MyColors.GrassLightGreen,MyColors.GrassGreen,MyColors.GrassDarkGreen,MyColors.GrassVeryDarkGreen);this.Claws=new ColorWheel("Claws","Claws",MyColors.White,"rgb(232, 193, 132)","rgb(210, 140, 101)","rgb(204, 181, 158)","rgb(188, 190, 192)","rgb(234, 203, 198)");this.Clothes=new ColorWheel("Clothes","Color",MyColors.OffWhite,MyColors.GreenKelly,MyColors.BlueBright,MyColors.RedShaded,MyColors.YellowLight,MyColors.Black);this.ClothesMuted=new ColorWheel("ClothesMuted","Color",MyColors.OffWhite,MyColors.GreenArmy,MyColors.BlueGrey,MyColors.GreyMedium,MyColors.YellowLight,MyColors.BrownLight);this.Venitian=new ColorWheel("Venitian","Clothing",MyColors.BlueOcean,MyColors.PurplePlum,MyColors.RedRose,MyColors.GreenLeaf,MyColors.YellowButtercup,MyColors.BrownLeather);this.Silhouette=new ColorWheel("Silhouette","Silhouette",MyColors.Black,MyColors.GreySteel,MyColors.RedRust,MyColors.GreyGrey,MyColors.GreenMachine,MyColors.PurpleSil);this.MythicSkin=new ColorWheel("MythicSkin","Skin",MyColors.White,MyColors.DarkGreen,MyColors.BrownLeather,MyColors.GreySteel,MyColors.LightYellow,MyColors.Red);this.House=new ColorWheel("House","House",MyColors.White,MyColors.BrownGray,MyColors.BarnRed,MyColors.ButterYellow,MyColors.LightPavement,MyColors.Sand);this.Water=new ColorWheel("Water","Water",MyColors.White,MyColors.LightWater,MyColors.Water,MyColors.LightBrown,MyColors.VeryDarkBrown,MyColors.Black);this.Metal=new ColorWheel("Metal","Metal",MyColors.Silver,MyColors.Pewter,MyColors.GoldCoin,MyColors.MutedGold,MyColors.BrightGold,MyColors.GreenMetal);this.Retro1=new ColorWheel("Retro1","Color 1",MyColors.White,MyColors.AvocadoGreen,MyColors.SunflowerYellow,MyColors.Aqua,MyColors.PumpkinOrange,MyColors.BubblegumPink);this.Retro2=new ColorWheel("Retro2","Color 2",MyColors.White,MyColors.AvocadoGreen,MyColors.SunflowerYellow,MyColors.Aqua,MyColors.PumpkinOrange,MyColors.BubblegumPink);this.EarthyTones=new ColorWheel("EarthyTones","Earthy Tones",MyColors.ButterYellow,MyColors.ArmyGreen,MyColors.Sand,MyColors.DarkTan,MyColors.VeryDarkBrown,MyColors.VeryDarkGray);this.Modern=new ColorWheel("Modern","Color 1",MyColors.DesertSage,MyColors.DriedHerb,MyColors.OakBuff,MyColors.Marsala,MyColors.StormyWeather,MyColors.ClassicBlue);this.AlternateModern=new ColorWheel("AlternateModern","Color 2",MyColors.BiscayBay,MyColors.ReflectingPond,MyColors.CadmiumOrange,MyColors.CashmereRose,MyColors.AmethystOrchid,MyColors.ToastedAlmond);this.HairDyes=new ColorWheel("HairDyes","Color",MyColors.HotHotPink,MyColors.NeonElectricLizard,MyColors.ShockingBlue,MyColors.Wildfire,MyColors.ElectricTigerLily,MyColors.PurpleHaze,MyColors.OfficeTones);this.OfficeTones=new ColorWheel("OfficeTones","Color",MyColors.Aleutian,MyColors.Alabaster,MyColors.UrbanPutty,MyColors.AquaSphere,MyColors.TempeStar,MyColors.PurplePassage);this.AlternateEarthyTones=new ColorWheel("AlternateEarthyTones","Color",MyColors.BabyBrown,MyColors.MossyGlossGreen,MyColors.SailorBlue,MyColors.TitaniumGrey,MyColors.Hemetite,MyColors.DarkOakBrown);this.AlternateHouse=new ColorWheel("AlternateHouse","Color",MyColors.TornadoSeason,MyColors.Yogi,MyColors.CherryCola,MyColors.Charismatic,MyColors.Camelot,MyColors.Spearmints);this.BrightModern=new ColorWheel("BrightModern","Color",MyColors.RoseQuartz,MyColors.PeachEcho,MyColors.Serenity,MyColors.SnorkelBlue,MyColors.Buttercup,MyColors.CandyPink);this.BrightModern2=new ColorWheel("BrightModern2","Color",MyColors.LimpetShell,MyColors.LilacGray,MyColors.Fiesta,MyColors.IcedCoffee,MyColors.GreenFlash,MyColors.Creamsicle);this.Nautical=new ColorWheel("Nautical","Color",MyColors.Aleutian,MyColors.Naval,MyColors.RenwickOlive,MyColors.CrabbyApple,MyColors.MorrisRoomGrey,MyColors.RoycroftPewter);this.ModernInterior=new ColorWheel("ModernInterior","Color",MyColors.BowString,MyColors.Celadon,MyColors.Coralette,MyColors.Stratus,MyColors.IvoryKeys,MyColors.Opus);this.Technology=new ColorWheel("Technology","Color",MyColors.White,MyColors.PaleGray,MyColors.Silver,MyColors.Gray,MyColors.DarkGray,MyColors.Black);this.Infographic1=new ColorWheel("Infographic1","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray);this.Infographic2=new ColorWheel("Infographic2","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray);this.Infographic3=new ColorWheel("Infographic3","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray);this.Infographic4=new ColorWheel("Infographic4","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray);this.Infographic5=new ColorWheel("Infographic5","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray);this.Infographic6=new ColorWheel("Infographic6","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray)};function SbtColors(){this.GreenKelly="rgb(0, 104, 56)";this.BlueBright="rgb(46, 49, 146)";this.RedShaded="rgb(181, 28, 28)";this.YellowLight="rgb(249, 220, 48)";this.OffWhite="rgb(227, 227, 227)";this.GreenArmy="rgb(115, 113, 68)";this.BlueGrey="rgb(128, 158, 173)";this.GreyMedium="rgb(63, 66, 68)";this.BrownLight="rgb(193, 172, 151)";this.BlueOcean="rgb(88, 101, 174)";this.PurplePlum="rgb(136, 63, 92)";this.RedRose="rgb(178, 42, 43)";this.GreenLeaf="rgb(93, 162, 80)";this.YellowButtercup="rgb(221, 211, 79)";this.BrownLeather="rgb(123, 83, 55)";this.GreySteel="rgb(94, 103, 119)";this.RedRust="rgb(109, 57, 57)";this.GreyGrey="rgb(68, 64, 57)";this.GreenMachine="rgb(70, 92, 73)";this.PurpleSil="rgb(92, 63, 137)";this.PaleTan="rgb(243, 223, 199)";this.PeachyTan="rgb(235, 195, 165)";this.Tan="rgb(211, 159, 111)";this.DarkTan="rgb(154, 105, 65)";this.SoftBrown="rgb(99, 70, 54)";this.Blonde="rgb(247, 204, 97)";this.MediumGrey="rgb(128, 128, 128)";this.BlueEye="rgb(65,95,122)";this.OliveGreen="rgb(102,102, 51)";this.HandBlue="rgb(133, 184, 212)";this.Parchment="rgb(226, 205, 156)";this.MutedYellow="rgb(255, 230, 128)";this.MutedGray="rgb(244, 245, 251)";this.PaleRed="rgb(254, 132, 132)";this.PaleBlue="rgb(167, 194, 252)";this.PaleGreen="rgb(117, 234, 117)";this.PaleYellow="rgb(252, 243, 159)";this.PaleGray="rgb(229, 229, 229)";this.PaleGrayBrown="rgb(204, 198, 194)";this.PaleBrown="rgb(226, 192, 161)";this.PaleViolet="rgb(210, 144, 252)";this.PaleOrange="rgb(249, 183, 138)";this.SbtPaleBlue="rgb(232, 245, 255)";this.LightRed="rgb(254, 77, 77)";this.LightBlue="rgb(85, 134, 245)";this.LightGreen="rgb(55, 196, 55)";this.LightYellow="rgb(255, 235,115)";this.LightGray="rgb(204, 204, 204)";this.LightBrown="rgb(198, 156, 109)";this.LightViolet="rgb(187, 90, 249)";this.BrightRed="rgb(254, 32, 32)";this.BrightBlue="rgb(66, 91, 211)";this.BrightGreen="rgb(7, 147, 7)";this.BrightYellow="rgb(255, 216, 0)";this.BrightGray="rgb(153, 153, 153)";this.BrightBrown="rgb(198, 156, 109)";this.BrightViolet="rgb(158, 60, 221)";this.BrightOrange="rgb(255, 133, 0)";this.White="rgb(255, 255, 255)";this.Black="rgb(0, 0, 0)";this.Orange="rgb(219, 101, 22)";this.Brown="rgb(141, 85, 53) ";this.Red="rgb(186, 0, 0)";this.Blue="rgb(47, 55, 147)";this.Green="rgb(8, 107, 8)";this.Yellow="rgb(255, 185, 0)";this.Gray="rgb(102, 102, 102)";this.Brown="rgb(117, 76, 36)";this.Violet="rgb(108, 29, 178)";this.SbtBlue="rgb(115, 158, 201)";this.DarkRed="rgb(107, 0, 0)";this.DarkBlue="rgb(32, 32, 102)";this.DarkGreen="rgb(2, 68, 2)";this.DarkYellow="rgb(237, 156, 15)";this.DarkGray="rgb(58, 58, 58)";this.DarkBrown="rgb(86, 48, 17)";this.DarkViolet="rgb(78, 4, 142)";this.DarkGrayViolet="rgb(39, 21, 40)";this.DarkGold="rgb(165, 108, 33)";this.SbtDarkBlue="rgb(36, 59, 83)";this.VeryDarkRed="rgb(58, 2, 2)";this.VeryDarkBlue="rgb(12, 12, 58)";this.VeryDarkGreen="rgb(0, 42, 0)";this.VeryDarkYellow="rgb(193, 113, 16)";this.VeryDarkBrown="rgb(66, 33, 11)";this.VeryDarkViolet="rgb(48, 0, 77)";this.VeryDarkGrayBlue="rgb(0, 39, 77)";this.VeryDarkGray="rgb(29, 29, 29)";this.VeryDarkOrange="rgb(165, 50, 10)";this.VeryDarkTeal="rgb(17, 49, 53)";this.SkyPaleBlue="rgb(210, 237, 245)";this.SkyLightBlue="rgb(170, 216, 232)";this.SkyBlue="rgb(87, 167, 195)";this.SkyCloudy="rgb(152, 167, 168)";this.SkyNight="rgb(14, 13, 63)";this.SkyDarkNight="rgb(4, 4, 30)";this.BrownGray="rgb(109,103,100)";this.BarnRed="rgb(191, 78, 73)";this.ButterYellow="rgb(252, 248, 217)";this.LightPavement="rgb(179, 179, 179)";this.Sand="rgb(181, 160, 140)";this.GrassPaleGreen="rgb(202, 214, 174)";this.GrassLightGreen="rgb(152, 174, 115)";this.GrassGreen="rgb(103, 146, 61)";this.GrassDarkGreen="rgb(64, 99, 36)";this.GrassVeryDarkGreen="rgb(35, 66, 14)";this.DarkPavement="rgb(77, 77, 77)";this.VeryDarkPavement="rgb(51, 51, 51)";this.LightWater="rgb(174, 208, 236)";this.Water="rgb(59, 107, 145)";this.Silver="rgb(196, 196, 196)";this.Pewter="rgb(86, 85, 85)";this.GoldCoin="rgb(195, 146, 46)";this.MutedGold="rgb(196, 191, 108)";this.BrightGold="rgb(251, 201, 38)";this.GreenMetal="rgb(99, 126, 119)";this.AvocadoGreen="rgb(111, 150, 72)";this.SunflowerYellow="rgb(229, 164, 48)";this.Aqua="rgb(111, 193, 187)";this.PumpkinOrange="rgb(224, 102, 40)";this.BubblegumPink="rgb(229, 101, 169)";this.DarkTeal="rgb(0, 144, 178)";this.PoppyOrange="rgb(255, 111, 76)";this.AquaMarine="rgb(100, 186, 183)";this.RetroGreen="rgb(211, 212, 56)";this.RetroLightGray="rgb(215, 213, 200)";this.RetroDarkGray="rgb(119, 119,117)";this.ArmyGreen="rgb(73, 76, 52)";this.DesertSage="rgb(167, 174, 158)";this.DriedHerb="rgb(132, 122, 89)";this.OakBuff="rgb(207, 156, 99)";this.Marsala="rgb(150, 79, 76)";this.StormyWeather="rgb(88, 100, 109)";this.ClassicBlue="rgb(29, 78, 137)";this.BiscayBay="rgb(9, 121, 136)";this.ReflectingPond="rgb(32, 62, 74)";this.CadmiumOrange="rgb(249, 148, 113)";this.CashmereRose="rgb(206, 135, 159)";this.AmethystOrchid="rgb(146, 106, 166)";this.ToastedAlmond="rgb(210, 178, 155)";this.Alabaster="rgb(235, 235, 223)";this.Aleutian="rgb(157, 170, 186)";this.AquaSphere="rgb(194, 205, 197)";this.BabyBrown="rgb(150, 95, 30)";this.BowString="rgb(214, 208, 201)";this.Buttercup="rgb(251, 227, 56)";this.Camelot="rgb(139, 144, 164)";this.CandyPink="rgb(224, 84, 123)";this.Celadon="rgb(185, 192, 185)";this.Charismatic="rgb(231, 193, 129)";this.CherryCola="rgb(117, 67, 66)";this.Coralette="rgb(240, 133, 116)";this.CrabbyApple="rgb(127, 41, 50)";this.Creamsicle="rgb(252, 172, 83)";this.DarkOakBrown="rgb(113, 54, 20)";this.ElectricTigerLily="rgb(234, 128, 0)";this.Fiesta="rgb(221, 68, 60)";this.GreenFlash="rgb(114, 204, 81)";this.Hemetite="rgb(33, 32, 30)";this.HotHotPink="rgb(183, 39, 104)";this.IcedCoffee="rgb(177, 143, 106)";this.IvoryKeys="rgb(243, 241, 233)";this.LilacGray="rgb(152, 150, 164)";this.LimpetShell="rgb(153, 221, 222)";this.MorrisRoomGrey="rgb(176, 168, 155)";this.MossyGlossGreen="rgb(109, 122, 42)";this.Naval="rgb(36, 53, 69)";this.NeonElectricLizard="rgb(111, 216, 9)";this.Opus="rgb(114, 103, 93)";this.PeachEcho="rgb(248, 120, 107)";this.PurpleHaze="rgb(156, 24, 232)";this.PurplePassage="rgb(102, 92, 119)";this.RenwickOlive="rgb(153, 140, 106)";this.RoseQuartz="rgb(248, 202, 202)";this.RoycroftPewter="rgb(87, 99, 97)";this.SailorBlue="rgb(46, 55, 70)";this.Serenity="rgb(145, 168, 209)";this.ShockingBlue="rgb(9, 19, 211)";this.SnorkelBlue="rgb(2, 77, 142)";this.Spearmints="rgb(188, 226, 203)";this.Stratus="rgb(128, 147, 171)";this.TempeStar="rgb(75, 97, 108)";this.TitaniumGrey="rgb(130, 127, 118)";this.TornadoSeason="rgb(77, 113, 122)";this.UrbanPutty="rgb(208, 193, 174)";this.Wildfire="rgb(206, 9, 9)";this.Yogi="rgb(138, 139, 103)"};function StoryboardSaveData(a){this.Length="";this.RawLength="";this.ShapeStates="";this.UrlTitle="";this.UserName="";this.MagicToken="";this.LayoutConfig=JSON.stringify(CellConfiguration.GetLayoutConfig());this.LayoutConfigLength=this.LayoutConfig.length;this.Title="";this.Description="";this.Svg=a;this.SaveDuration=+new Date();this.CharacterSwapLibrary="";this.CharacterSwapLibraryLength=""};function Vector(a,c,b,d){this.X1=a;this.Y1=c;this.X2=b;this.Y2=d};function BoxPosition(b,e,f,g,c,a,d){this.Height=b;this.Width=e;this.X=f;this.Y=g;this.Row=c;this.Col=a;this.StoryboardPartType=d};function SpiderCellLocation(d,a,b,c){this.Title=d;this.FakeCol=a;this.FakeRow=b;this.RowOffset=c};function CharacterLibrarySwappablePose(d,a,b,c){this._SwapOptions=new Object();this._ShapeId=d;this.GlobalImageId=a;this._SelectedSwapOption;this.PoseType=SbtDataEnum.PoseType_Swap;this.Title;this._AppendToId;this.Position=c;this.Private_ParseSwapOptions(b)}CharacterLibrarySwappablePose.prototype.Private_ParseSwapOptions=function(c){if(c==null){return}this.Title=GetSafeAttributeNS(c,SbtDataEnum.Attribute_SwapPose_Title);var a=GetSafeAttributeNS(c,SbtDataEnum.Attribute_SwapPose_DefaultId);this._AppendToId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_SwapPose_AppendToId);FindAndUpdateId(this._ShapeId,this._AppendToId,this.Public_GetAppendToId());for(var b=0;b<c.childElementCount;b++){var d=new Pose_CharacterLibrarySwapOption(this._ShapeId,this.GlobalImageId,GetIESafeChild(c,b),this.Position);this._SwapOptions[d.Public_GetInternalId()]=d}this.Public_SetActiveOption(this.Public_GetSwapOptionById(a));if(this.Public_GetActiveOption()==null){}};CharacterLibrarySwappablePose.prototype.Private_GetLocalId=function(a){return this._ShapeId+SbtDataEnum.Id_Swap_Middle+a};CharacterLibrarySwappablePose.prototype.Private_GetCopyId=function(b,a){return b._ShapeId+SbtDataEnum.Id_Swap_Middle+a};CharacterLibrarySwappablePose.prototype.Public_GetAppendToId=function(){return this.Private_GetLocalId(this._AppendToId)};CharacterLibrarySwappablePose.prototype.Public_GetSwapOptions=function(){return this._SwapOptions};CharacterLibrarySwappablePose.prototype.Public_GetSwapOptionById=function(a){return this._SwapOptions[a]};CharacterLibrarySwappablePose.prototype.Public_SetActiveOption=function(a){this._SelectedSwapOption=a};CharacterLibrarySwappablePose.prototype.Public_GetActiveOption=function(){return this._SelectedSwapOption};CharacterLibrarySwappablePose.prototype.Public_Copy=function(c){this.Title=c.Title;this._AppendToId=c._AppendToId;this.GlobalImageId=c.GlobalImageId;this.Position=c.Position;FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(c,c._AppendToId),this.Public_GetAppendToId());this._SelectedSwapOption=new Pose_CharacterLibrarySwapOption(this._ShapeId,this.GlobalImageId,null,this.Position);if(c._SelectedSwapOption!=null){c._SelectedSwapOption._Position=c._SelectedSwapOption._Position||this.Position;this._SelectedSwapOption.Public_Copy(c._SelectedSwapOption)}else{this._SelectedSwapOption._Position=this.Position;this._SelectedSwapOption._SwapId="";this._SelectedSwapOption._Title="";c._SelectedSwapOption=new Object();c._SelectedSwapOption._Position=this.Position}for(var b in c._SwapOptions){if(c._SwapOptions.hasOwnProperty(b)){try{var d=new Pose_CharacterLibrarySwapOption(this._ShapeId,this.GlobalImageId,null,this.Position);c._SwapOptions[b]._Position=c._SelectedSwapOption._Position||this.Position;d.Public_Copy(c._SwapOptions[b]);this._SwapOptions[b]=d}catch(a){LogErrorMessage("CharacterLibrarySwap.Public_Copy",a)}}}};function Pose_CharacterLibrarySwapOption(c,a,d,b){this._SwapId;this._Title;this._Position=b;this.Private_ParseSwapOption(c,d,a)}Pose_CharacterLibrarySwapOption.prototype.Private_ParseSwapOption=function(c,d,a){if(d==null){return}this._Title=GetSafeAttributeNS(d,SbtDataEnum.Attribute_SwapOption_Title);this._SwapId=GetSafeAttributeNS(d,SbtDataEnum.Attribute_SwapOption_SwapId);var b=RemoveAndGetChild_By_ParentId_ChildId(c,this._SwapId);if(b==null||b.length==0){return}b.attr("display","inline");RecursivelyUpdateChildrenIds(b,c,SbtDataEnum.Id_Storage);MyCharacterSwapLibrary.Public_SetSwap(a,this._Position,this._SwapId,b)};Pose_CharacterLibrarySwapOption.prototype.Public_GetPoseSvg=function(a){var b=MyCharacterSwapLibrary.Public_GetSwap(a,this._Position,this._SwapId);if(b==null){}return ParseRawSVG(b)};Pose_CharacterLibrarySwapOption.prototype.Public_GetInternalId=function(){return this._SwapId};Pose_CharacterLibrarySwapOption.prototype.Public_Copy=function(a){this._SwapId=a._SwapId;this._Title=a._Title;this._Position=a._Position};Pose_CharacterLibrarySwapOption.prototype.Public_GetTitle=function(){if(this._Title==null||this._Title==""){return MyLangMap.GetTextByToken("Cls-"+this._SwapId)}return this._Title};Pose_CharacterLibrarySwapOption.prototype.IsEqual=function(a){if(a==null){return false}if(this._Position!=a._Position){return false}if(this._SwapId!=a._SwapId){return false}return true};function GlobalLibrarySwappablePose(b,a){this._LibrarySwapOptions=new Object();this._ShapeId=b;this._SelectedLibraryOption;this.PoseType=SbtDataEnum.PoseType_LibrarySwap;this.Title;this._StartPointId;this._AppendToId;this.Private_ParseLibrarySwapOptions(a)}GlobalLibrarySwappablePose.prototype.Private_ParseLibrarySwapOptions=function(c){if(c==null){return}this.Title=GetSafeAttributeNS(c,SbtDataEnum.Attribute_LibrarySwapOption_Title);var a=GetSafeAttributeNS(c,SbtDataEnum.Attribute_LibrarySwapPose_DefaultId);this._StartPointId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_LibrarySwapPose_StartPointId);this._AppendToId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_LibrarySwapPose_AppendToId);FindAndUpdateId(this._ShapeId,this._StartPointId,this.Public_GetStartPointToId());FindAndUpdateId(this._ShapeId,this._AppendToId,this.Public_GetAppendToId());for(var b=0;b<c.childElementCount;b++){var d=new Pose_GlobalLibrarySwapOption(GetIESafeChild(c,b));this._LibrarySwapOptions[d.LibrarySwapId]=d}this.Public_SetActiveOption(this.Public_GetLibrarySwapOptionById(a));if(this.Public_GetActiveOption()==null){}};GlobalLibrarySwappablePose.prototype.Private_GetLocalId=function(a){return this._ShapeId+SbtDataEnum.Id_GlobalLibrary_Middle+a};GlobalLibrarySwappablePose.prototype.Private_GetCopyId=function(b,a){return b._ShapeId+SbtDataEnum.Id_GlobalLibrary_Middle+a};GlobalLibrarySwappablePose.prototype.Public_GetAppendToId=function(){return this.Private_GetLocalId(this._AppendToId)};GlobalLibrarySwappablePose.prototype.Public_GetStartPointToId=function(){return this.Private_GetLocalId(this._StartPointId)};GlobalLibrarySwappablePose.prototype.Public_GetLibrarySwapOptions=function(){return this._LibrarySwapOptions};GlobalLibrarySwappablePose.prototype.Public_GetLibrarySwapOptionById=function(a){return this._LibrarySwapOptions[a]};GlobalLibrarySwappablePose.prototype.Public_SetActiveOption=function(a){this._SelectedLibraryOption=a};GlobalLibrarySwappablePose.prototype.Public_GetActiveOption=function(){return this._SelectedLibraryOption};GlobalLibrarySwappablePose.prototype.Public_Copy=function(b){this.Title=b.Title;this._StartPointId=b._StartPointId;this._AppendToId=b._AppendToId;FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(b,b._AppendToId),this.Public_GetAppendToId());FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(b,b._StartPointId),this.Public_GetStartPointToId());this._SelectedLibraryOption=new Pose_GlobalLibrarySwapOption(null);this._SelectedLibraryOption.Public_Copy(b._SelectedLibraryOption);for(var a in b._LibrarySwapOptions){if(b._LibrarySwapOptions.hasOwnProperty(a)){var c=new Pose_GlobalLibrarySwapOption(null);c.Public_Copy(b._LibrarySwapOptions[a]);this._LibrarySwapOptions[a]=c}}};function Pose_GlobalLibrarySwapOption(a){this.LibrarySwapId;this._Title;this.Private_ParseSwapOption(a)}Pose_GlobalLibrarySwapOption.prototype.Private_ParseSwapOption=function(a){if(a===null){return}this._Title=GetSafeAttributeNS(a,SbtDataEnum.Attribute_LibrarySwapOption_Title);this.LibrarySwapId=GetSafeAttributeNS(a,SbtDataEnum.Attribute_LibrarySwapOption_SwapId)};Pose_GlobalLibrarySwapOption.prototype.Public_Copy=function(a){this.LibrarySwapId=a.LibrarySwapId;this._Title=a._Title};Pose_GlobalLibrarySwapOption.prototype.Public_GetTitle=function(){if(this._Title===null||this._Title===""){var a=this.LibrarySwapId;if(a.indexOf("-Face-")!==-1){a=a.split(/-(Face-.+)/)[1]}return MyLangMap.GetTextByToken("Cls-"+a)}return this._Title};Pose_GlobalLibrarySwapOption.prototype.Public_GetInternalId=function(){return this.LibrarySwapId};Pose_GlobalLibrarySwapOption.prototype.IsEqual=function(a){if(a===null){return false}if(this.LibrarySwapId!==a.LibrarySwapId){return false}return true};function Pose_TiltOption(b,a){this._Region;this.Degrees;this.Position;this.Private_ParseTiltOption(b,a)}Pose_TiltOption.prototype.Public_Copy=function(a){this.Degrees=a.Degrees;this._Region=a._Region;this.Position=a.Position};Pose_TiltOption.prototype.Public_GetTitle=function(){return MyLangMap.GetTextByToken("Tilt-"+this._Region+"-"+this.Position+"-"+this.Degrees)};Pose_TiltOption.prototype.Public_GetInternalId=function(){return this.Degrees};Pose_TiltOption.prototype.Private_ParseTiltOption=function(b,a){if(b==null){return}this._Region=a.Title;this.Degrees=GetSafeAttributeNS(b,SbtDataEnum.Attribute_TiltOption_Degree);this.Position=a.Position};Pose_TiltOption.prototype.IsEqual=function(a){if(a==null){return false}if(this._Region!=a._Region){return false}if(this.Position!=a.Position){return false}if(this.Degrees!=a.Degrees){return false}return true};function TiltablePose(c,a,b){this._TiltOptions=new Array();this._ShapeId=c;this.Position=b;this.PoseType=SbtDataEnum.PoseType_Tilt;this._TiltableId;this._Tiltable2Id;this._PivotId;this._ClearId;this.Title;this.Private_SelectedTiltOption;this.Private_ParseTiltOptions(a)}TiltablePose.prototype.Private_ParseTiltOptions=function(c){if(c==null){return}this.Title=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_Title);var a=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_DefaultTilt);this._ClearId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_ClearId);this._PivotId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_PivotId);this._TiltableId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_TiltableId);this._Tiltable2Id=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_Tiltable2Id);FindAndUpdateId(this._ShapeId,this._PivotId,this.Public_GetPivotId());FindAndUpdateId(this._ShapeId,this._TiltableId,this.Public_GetTiltableId());FindAndUpdateId(this._ShapeId,this._Tiltable2Id,this.Public_GetTiltable2Id());for(var b=0;b<c.childElementCount;b++){this._TiltOptions[b]=new Pose_TiltOption(GetIESafeChild(c,b),this)}this.Private_SelectedTiltOption=this.Public_GetTiltOptionByDegrees(a)};TiltablePose.prototype.Public_GetTiltOptionByDegrees=function(a){for(var b=0;b<this._TiltOptions.length;b++){if(this._TiltOptions[b].Degrees==a){return this._TiltOptions[b]}}return null};TiltablePose.prototype.Private_GetLocalId=function(a){return this._ShapeId+"_TILT_"+a};TiltablePose.prototype.Private_GetCopyId=function(b,a){return b._ShapeId+"_TILT_"+a};TiltablePose.prototype.Public_GetTiltableId=function(){return this.Private_GetLocalId(this._TiltableId)};TiltablePose.prototype.Public_GetTiltable2Id=function(){if(this._Tiltable2Id==null||this._Tiltable2Id==""){return null}return this.Private_GetLocalId(this._Tiltable2Id)};TiltablePose.prototype.Public_GetPivotId=function(){return this.Private_GetLocalId(this._PivotId)};TiltablePose.prototype.Public_GetClearId=function(){return this._ClearId};TiltablePose.prototype.Public_GetTiltOptions=function(){return this._TiltOptions};TiltablePose.prototype.Public_Copy=function(b){this.Title=b.Title;this.Public_DefaultTilt=b.Public_DefaultTilt;this._TiltableId=b._TiltableId;this._Tiltable2Id=b._Tiltable2Id;this._PivotId=b._PivotId;this._ClearId=b._ClearId;this.Position=b.Position;FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(b,b._PivotId),this.Public_GetPivotId());FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(b,b._TiltableId),this.Public_GetTiltableId());FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(b,b._Tiltable2Id),this.Public_GetTiltable2Id());this.Private_SelectedTiltOption=new Pose_TiltOption(null);if(b.Private_SelectedTiltOption==null){b.Private_SelectedTiltOption=new Pose_TiltOption(null)}b.Private_SelectedTiltOption.Position=b.Private_SelectedTiltOption.Position||b.Position;this.Private_SelectedTiltOption.Public_Copy(b.Private_SelectedTiltOption);for(var a=0;a<b._TiltOptions.length;a++){var c=new Pose_TiltOption(null,null);b._TiltOptions[a].Position=b._TiltOptions[a].Position||b.Position;c.Public_Copy(b._TiltOptions[a]);this._TiltOptions[a]=c}};TiltablePose.prototype.Public_GetActiveOption=function(){return this.Private_SelectedTiltOption};TiltablePose.prototype.Public_SetActiveOption=function(a){this.Private_SelectedTiltOption=a};function SmartSceneItem(){this.Title="";this.SmartSceneItemOptions=[]}SmartSceneItem.prototype.ParseMetaData=function(d,f,a){this.Title=GetSafeAttributeNS(f,SbtDataEnum.Attribute_SmartSceneItemOption_Title);var h=$(f).find(SbtDataEnum.MetaData_SmartSceneItemOption);for(var c=0;c<h.length;c++){try{var g=new SmartSceneItemOption(d,a);g.ParseMetaData(h[c]);this.SmartSceneItemOptions.push(g)}catch(b){LogErrorMessage("SmartSceneItem._ParseMetaData:  ",b)}}};SmartSceneItem.prototype.GetActiveSceneIndex=function(){for(var a=0;a<this.SmartSceneItemOptions.length;a++){if(this.SmartSceneItemOptions[a].IsActive){return a}}return 0};SmartSceneItem.prototype.ActivateSceneOption=function(b){for(var a=0;a<this.SmartSceneItemOptions.length;a++){this.SmartSceneItemOptions[a].IsActive=false}this.SmartSceneItemOptions[b].Activate()};SmartSceneItem.prototype.CopySmartSceneItem=function(c,d,a){this.Title=c.Title;for(var b=0;b<c.SmartSceneItemOptions.length;b++){var e=new SmartSceneItemOption(d,a);e.CopySmartSceneItemOption(c.SmartSceneItemOptions[b]);this.SmartSceneItemOptions.push(e)}};SmartSceneItem.prototype.GetTitle=function(){var a=MyLangMap.GetTextByToken("ST-"+this.Title);if(a===""){return this.Title}return a};function SmartSceneItemOption(b,a){this.Title="";this._TurnOn=[];this._TurnOff=[];this._ColorableState=a;this._ColorRegions=[];this.IsActive=false;this._ShapeId=b}SmartSceneItemOption.prototype.ParseMetaData=function(g){this.Title=GetSafeAttributeNS(g,SbtDataEnum.Attribute_SmartSceneItemOption_Title);var j=GetSafeAttributeNS(g,SbtDataEnum.Attribute_SmartSceneItemOption_TurnOn);var h=GetSafeAttributeNS(g,SbtDataEnum.Attribute_SmartSceneItemOption_TurnOff);var d=GetSafeAttributeNS(g,SbtDataEnum.Attribute_SmartSceneItemOption_Default);if(d!=null&&d.toLowerCase()=="true"){this.IsActive=true}this._TurnOn=this._ParseAndUpdateIds(this._ShapeId,this._ShapeId+"-",j);this._TurnOff=this._ParseAndUpdateIds(this._ShapeId,this._ShapeId+"-",h);var b=$(g).find(SbtDataEnum.MetaData_SmartSceneItemOptionColor);for(var c=0;c<b.length;c++){var e=GetSafeAttributeNS(b[c],SbtDataEnum.Attribute_SmartSceneItemOptionColor_Region);var f=GetSafeAttributeNS(b[c],SbtDataEnum.Attribute_SmartSceneItemOptionColor_ReplaceColor);var a={Region:e,ReplaceColor:f};this._ColorRegions.push(a)}};SmartSceneItemOption.prototype.Activate=function(){this._UpdateDisplayForIds(this._TurnOn,"inline");this._UpdateDisplayForIds(this._TurnOff,"none");this.IsActive=true;if(this._ColorableState!=null&&this._ColorRegions.length>0){for(var a=0;a<this._ColorRegions.length;a++){this._ColorableState.Public_UpdateColorForRegion(this._ColorRegions[a].Region,this._ColorRegions[a].ReplaceColor,false)}}};SmartSceneItemOption.prototype._UpdateDisplayForIds=function(c,a){for(var b=0;b<c.length;b++){$("#"+c[b]).attr("display",a)}};SmartSceneItemOption.prototype._ParseAndUpdateIds=function(a,f,c){var g=c.split(",");var e=[];for(var b=0;b<g.length;b++){var h=g[b].trim();var d=f+h;FindAndUpdateId(a,h,d);e.push(d)}return e};SmartSceneItemOption.prototype.CopySmartSceneItemOption=function(e){this.Title=e.Title;this.IsActive=e.IsActive;for(var b=0;b<e._TurnOn.length;b++){var d=e._TurnOn[b];var c=d.replace(e._ShapeId,this._ShapeId);FindAndUpdateId(this._ShapeId,d,c);this._TurnOn.push(c)}for(var b=0;b<e._TurnOff.length;b++){var d=e._TurnOff[b];var c=d.replace(e._ShapeId,this._ShapeId);FindAndUpdateId(this._ShapeId,d,c);this._TurnOff.push(c)}for(var b=0;b<e._ColorRegions.length;b++){var a={Region:e._ColorRegions[b].Region,ReplaceColor:e._ColorRegions[b].ReplaceColor};this._ColorRegions.push(a)}};SmartSceneItemOption.prototype.GetTitle=function(){var a=MyLangMap.GetTextByToken("ST-"+this.Title);if(a==""){return this.Title}return a};function CharacterPosistionLibrary(){this.Private_Library=new Object();this.Private_Populate=function(){};this.GetCharacterPositions=function(b,a){if(this.Private_Library.hasOwnProperty(b)){a(this.Private_Library[b]);return}this.Private_LoadCharacter(b,a)};this.GetCharacterPosition=function(a,c){if(this.Private_Library.hasOwnProperty(a)==false){return null}for(var b=0;b<this.Private_Library[a].length;b++){var d=this.Private_Library[a][b];if(d==null){continue}if(d.Position==c){return this.Private_Library[a][b]}}return null};this.Private_LoadCharacter=function(c,a){var b=this;$.ajax({caller:"CharacterPosistionLibrary.Private_LoadCharacter",timeout:120*1000,url:CreatorUrls.CharacterPositions+"?guid="+c+"&time="+TimeStamp,cache:false}).fail(function(e,f,d){a(null)}).done(function(f,d){b.Private_Library[c]=new Array();if(f==null){b.Private_Library[c]=null;a(null);return}for(var e=0;e<f.length;e++){b.Private_Library[c][f[e].Order]=f[e]}a(b.Private_Library[c])})};this.Private_Populate()};function Private_GetShapeStateGroupObjects(c,b){for(var a=0;a<c.length;a++){b.push(c[a].GlobalImageId);if(c[a].isGroupObject===true){Private_GetShapeStateGroupObjects(c[a].groupShapeStates,b)}}}function CharacterSwapLibrary(a){this.Private_Library=new Object();this.Private_XmlSerializer=new XMLSerializer();this.Private_ClearUnused=function(e){var c=new Array();var b=new Array();var f=e.Public_GetAllMovableShapeStates(false);Private_GetShapeStateGroupObjects(f,c);for(var d in this.Private_Library){if(this.Private_Library.hasOwnProperty(d)){if(SbtLib.IndexOf(c,d)<0){b.push(d)}}}for(i=0;i<b.length;i++){this.Private_Library[b[i]]=null}};this.Private_HandleLoad=function(b){if(b==null){return}this.Private_Library=b};this.Public_SetSwap=function(b,f,d,e){if(this.Private_Library[b]==null){this.Private_Library[b]=new Object()}if(this.Private_Library[b][f]==null){this.Private_Library[b][f]=new Object()}var c=this.Private_XmlSerializer.serializeToString(e[0]);this.Private_Library[b][f][d]=c};this.Public_GetSwap=function(b,f,d){try{return this.Private_Library[b][f][d]}catch(c){LogErrorMessage("Failed to get swap for ["+b+"]["+f+"]["+d+"]",c)}};this.Public_GetJSON=function(b){this.Private_ClearUnused(b);return JSON.stringify(this.Private_Library)};this.Private_HandleLoad(a)};function GlobalSwapLibrary(){this.Private_Library=new Object();this.Private_LoadLibrary=function(){this.Private_ParseGlobalLibrary(SbtDataEnum.GlobalLibraryFacesFrontId,"Front");this.Private_ParseGlobalLibrary(SbtDataEnum.GlobalLibraryFacesSideId,"Side");$("#global_library_load").remove()};this.Private_ParseGlobalLibrary=function(c,f){this.Private_Library[f]=new Object();MyShapeMetaData.LookForMetaData(c);var b=$("#"+c);var e=$("#"+c).find("sbtdata");var g=e.find("swaplibrary");var k=g.find("swaplibraryoption");b.attr("display","inline");for(var a=0;a<k.length;a++){var j=k[a];var h=GetSafeAttributeNS(j,SbtDataEnum.Attribute_LibrarySwapOption_SwapId);var d=b.find("#"+h).remove();this.Private_Library[f][h]=d}};this.Public_GetSvgById=function(a,b){if(b==null){b="Front"}return this.Private_Library[b][a]};this.Private_LoadLibrary()};function ColorableState(a){this.Private_Colorable=false;this.Private_ShapeId=a;this.Regions=new Object();this.Titles=new Object();this.Private_ParseMetaData()}ColorableState.prototype.Property_IsColorable=function(){return this.Private_Colorable};ColorableState.prototype.Public_GetColorWheelForRegion=function(a){a=MyColorWheels.SanitizeColor(a);return MyColorWheels[a]};ColorableState.prototype.Public_GetColorForRegion=function(a){return this.Regions[a]};ColorableState.prototype.Public_GetTitleForRegion=function(c){try{if(this.Titles==undefined||this.Titles==null){return""}var d=this.Titles[c];if(d==null||d==undefined){return""}var b=MyLangMap.GetTextByToken("ST-"+d);if(b!=""){return b}return d}catch(a){return""}return""};ColorableState.prototype.Public_GetRegionList=function(){var a=new Array();$.each(this.Regions,function(b,c){a.push(b)});return a};ColorableState.prototype.Public_ResetColors=function(){var b=this.Public_GetRegionList();for(var a=0;a<b.length;a++){this.Public_UpdateColorForRegion(b[a],this.Public_GetColorForRegion(b[a]))}};ColorableState.prototype.Public_UpdateColorForRegion=function(c,b,a){this.Private_UpdateColorForRegion(c,b,a)};ColorableState.prototype.Public_GetColorStyles=function(){var b=new Object();if(this.Regions==null||this.Regions.length==0){return null}$.each(this.Regions,function(c,d){b[c]=d});var a=new Object();a.Regions=b;return a};ColorableState.prototype.Public_CopyColorStyles=function(a){this.Regions=a.Regions;this.Public_ResetColors()};ColorableState.prototype.Public_Copy=function(f){if(f==undefined||f==null){this.Private_Colorable=false;return}this.Private_Colorable=f.Private_Colorable;var d=new Object();$.each(f.Regions,function(e,h){d[e]=h});this.Regions=d;try{var g=new Object();if(f.Titles!=null&&f.Titles!=undefined){$.each(f.Titles,function(e,h){g[e]=h})}this.Titles=g}catch(a){}var c=this.Public_GetRegionList();for(var b=0;b<c.length;b++){this.Private_UpdateRegionIds(c[b])}this.Public_ResetColors()};ColorableState.prototype.Private_HasColor=function(a){if(this.Regions==undefined||this.Regions==null){return false}if(this.Regions[a]==undefined||this.Regions[a]==null){return false}return true};ColorableState.prototype.Public_HandlePositionSwap=function(){this.Private_ParseMetaData();this.Public_ResetColors()};ColorableState.prototype.Private_ParseMetaData=function(){var c=$("#"+this.Private_ShapeId).find("sbtdata");if(c.length==0){return}var a=c.find("colorable");for(var b=0;b<a.length;b++){this.Private_Colorable=true;var d=GetSafeAttributeNS(a[b],"Region");var e=GetSafeAttributeNS(a[b],"ReplaceColor");var f=GetSafeAttributeNS(a[b],"SpecialTitle");if(this.Private_HasColor(d)==false){this.Private_UpdateRegionColor(d,e)}this.Private_UpdateRegionTitle(d,f);this.Private_UpdateRegionIds(d)}};ColorableState.prototype.Private_GetBaseRegionId=function(a){return a+"_"+this.Private_ShapeId+"_"};ColorableState.prototype.Private_UpdateRegionIds=function(d){var a='[id^="'+d+'_"]';var e=$("#"+this.Private_ShapeId).find(a);for(var b=0;b<e.length;b++){var c=this.Private_GetBaseRegionId(d)+b;e[b].setAttributeNS(null,"id",c)}};ColorableState.prototype.Private_UpdateColorForRegion=function(g,f,d){try{var b="[id^="+this.Private_GetBaseRegionId(g)+"]";if(this.Private_ShapeId!=null){var h=$("#"+this.Private_ShapeId).find(b)}else{var h=$(b)}for(var c=0;c<h.length;c++){h[c].setAttributeNS(null,"fill",f)}if(d===false){this.Private_UpdateRegionColor(g,f)}}catch(a){LogErrorMessage("ColorableState.Private_UpdateColorForRegion",a)}};ColorableState.prototype.Private_UpdateRegionColor=function(b,a){this.Regions[b]=a};ColorableState.prototype.Private_UpdateRegionTitle=function(a,b){this.Titles[a]=b};function ImageAttribution(a){this.HasAttribution=false;this.Title="";this.Author="";this.ImageUrl="";this.License="";this.PhotoId="";if(a==undefined||a==null||a.length==0){return}this.HasAttribution=true;this.Title=a.getAttribute("title");this.Author=a.getAttribute("author");this.ImageUrl=a.getAttribute("imageurl");this.License=a.getAttribute("license");this.PhotoId=a.getAttribute("photoid")};function PosableState(b,a,c){this.Private_ShapeId=b;this.Private_GlobalImageId=a;this.Position=c;this.Private_PreviousPoseList;this.Private_PoseGroups=new Array();this.Private_HandleLoad()}PosableState.prototype.Private_HandleLoad=function(){this.Private_ParseMetaData();this.Private_LoadDefaults()};PosableState.prototype.Private_LoadDefaults=function(){for(var a=0;a<this.Private_PoseGroups.length;a++){var b=this.Private_PoseGroups[a];if(b.PoseType==SbtDataEnum.PoseType_Swap){var c=b.Public_GetActiveOption();this.Private_CharacterLibrarySwap(b,c)}if(b.PoseType==SbtDataEnum.PoseType_Tilt){this.Private_TiltPose(b,b.Public_GetActiveOption())}if(b.PoseType==SbtDataEnum.PoseType_LibrarySwap){var c=b.Public_GetActiveOption();this.Private_GlobalLibrarySwap(b,c)}}};PosableState.prototype.Private_GlobalLibrarySwap=function(f,g){var c=MyGlobalSwapLibrary.Public_GetSvgById(g.LibrarySwapId,this.Position);if(c==null){}c=c.clone();var a=$("#"+f.Public_GetAppendToId());if(a.length==0){}a.children().remove();a.append(c);var e="gls_"+new Date().getTime();c.attr("id",e);RecursivelyUpdateChildrenIds(c,SbtDataEnum.GlobalLibraryId,this.Private_ShapeId);var d=GetGlobalById(e);var b=d.getBBox();var h=ExtractPositionPoint($("#"+f.Public_GetStartPointToId()));var i=h.X-b.x;var j=h.Y-b.y;c.attr("transform","translate("+i+", "+j+")")};PosableState.prototype.Private_ParseMetaData=function(){try{var c=$("#"+this.Private_ShapeId).find("sbtdata");var d=c.find(SbtDataEnum.MetaData_Posable);var h=d.find(SbtDataEnum.MetaData_Poses);for(var b=0;b<h.length;b++){var f=GetSafeAttributeNS(h[b],SbtDataEnum.Attribute_Pose_Type);var g=null;if(LowerCaseCompare(f,SbtDataEnum.PoseType_Tilt)){g=new TiltablePose(this.Private_ShapeId,h[b],this.Position)}else{if(LowerCaseCompare(f,SbtDataEnum.PoseType_Swap)){g=new CharacterLibrarySwappablePose(this.Private_ShapeId,this.Private_GlobalImageId,h[b],this.Position)}else{if(LowerCaseCompare(f,SbtDataEnum.PoseType_LibrarySwap)){g=new GlobalLibrarySwappablePose(this.Private_ShapeId,h[b],this.Position)}}}this.Private_PoseGroups.push(g)}}catch(a){LogErrorMessage("PosableState.Private_ParseMetaData GUID:  "+this.Private_GlobalImageId,a);throw a}};PosableState.prototype.Private_CharacterLibrarySwap=function(f,d){try{if(d==null){return}var b=d.Public_GetPoseSvg(f.GlobalImageId);RecursivelyUpdateChildrenIds(b,SbtDataEnum.Id_Storage,this.Private_ShapeId);var a=$("#"+f.Public_GetAppendToId());if(a.length==0){}a.children().remove();a.append(b)}catch(c){LogErrorMessage("PosableState.Private_CharacterLibrarySwap",c)}};PosableState.prototype.Private_TiltPose=function(h,i){try{var a=i.Degrees;var f=GetGlobalById(h.Public_GetTiltableId());var c=$("#"+h.Public_GetPivotId());var d=ExtractPositionPoint(c);if(a==null){return}if(c.length==0){LogErrorMessage("Unable to find pivot group: "+h.Public_GetTiltableId());return}f.setAttributeNS(null,"transform","rotate("+a+", "+d.X+", "+d.Y+")");if(h.Public_GetTiltable2Id()!=null){var g=GetGlobalById(h.Public_GetTiltable2Id());if(g!=null){g.setAttributeNS(null,"transform","rotate("+a+", "+d.X+", "+d.Y+")")}else{LogErrorMessage("Public_GetTiltable2Id: "+this.Private_GlobalImageId+" "+h.Public_GetTiltable2Id())}}}catch(b){LogErrorMessage("PosableState.Public_TiltPose",b);try{LogErrorMessage("PosableState.Public_TiltPose extra "+this.Private_GlobalImageId+" : "+i.Degrees,b);LogErrorMessage("PosableState.Public_TiltPose extra "+h.Public_GetTiltableId,b)}catch(b){}}};PosableState.prototype.Public_IsPosable=function(){return this.Private_PoseGroups.length>0};PosableState.prototype.Public_PoseGroups=function(){return this.Private_PoseGroups};PosableState.prototype.Public_GetPreviousPoseList=function(){return this.Private_PreviousPoseList};PosableState.prototype.Public_SetPreviousPoseList=function(a){this.Private_PreviousPoseList=a};PosableState.prototype.Public_UpdatePoseOption=function(a,b){a.Public_SetActiveOption(b);if(a.PoseType==SbtDataEnum.PoseType_Swap){this.Private_CharacterLibrarySwap(a,b)}else{if(a.PoseType==SbtDataEnum.PoseType_Tilt){this.Private_TiltPose(a,b)}else{if(a.PoseType==SbtDataEnum.PoseType_LibrarySwap){this.Private_GlobalLibrarySwap(a,b)}}}};PosableState.prototype.Public_Copy=function(c){if(c==undefined||c==null){return}this.Private_GlobalImageId=c.Private_GlobalImageId;this.Position=c.Position;for(var a=0;a<c.Private_PoseGroups.length;a++){var d=c.Private_PoseGroups[a];d.Position=d.Position||c.Position;var b=null;if(d.PoseType==SbtDataEnum.PoseType_Tilt){b=new TiltablePose(this.Private_ShapeId,null)}else{if(d.PoseType==SbtDataEnum.PoseType_Swap){b=new CharacterLibrarySwappablePose(this.Private_ShapeId,this.Private_GlobalImageId,null,c.Position)}else{if(d.PoseType==SbtDataEnum.PoseType_LibrarySwap){b=new GlobalLibrarySwappablePose(this.Private_ShapeId,null)}}}b.Public_Copy(d);this.Private_PoseGroups.push(b)}};PosableState.prototype.Private_FindPoseAndOption=function(d,b){var c=new Object();for(var a=0;a<this.Private_PoseGroups.length;a++){c.PoseGroup=this.Private_PoseGroups[a];c.PoseOption=null;if(c.PoseGroup.PoseType==SbtDataEnum.PoseType_Tilt&&d==SbtDataEnum.PoseType_Tilt){c.PoseOption=c.PoseGroup.Public_GetTiltOptionByDegrees(b)}else{if(c.PoseGroup.PoseType==SbtDataEnum.PoseType_Swap&&d==SbtDataEnum.PoseType_Swap){c.PoseOption=c.PoseGroup.Public_GetSwapOptionById(b)}else{if(c.PoseGroup.PoseType==SbtDataEnum.PoseType_LibrarySwap&&d==SbtDataEnum.PoseType_LibrarySwap){c.PoseOption=c.PoseGroup.Public_GetLibrarySwapOptionById(b)}}}if(c.PoseOption!=null){return c}}return null};PosableState.prototype.Public_GetSafePoseArray=function(c){if(c==null){return null}var b=new Array();for(var a=0;a<c.length;a++){var d=this.Private_FindPoseAndOption(c[a].PoseType,c[a].PoseId);if(d!=null){b.push(d)}}return b};PosableState.prototype.Private_AddFaces=function(b,a){b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Male-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Male-Face-Crazy-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Female-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Female2-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Female2-Face-Crazy-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Kid-Female-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Kid-Male-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Basic-Male-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Basic-Female-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Asian-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Indian-Male-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Indian-Female-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"Face-"+a})};PosableState.prototype.Private_GetPoseAngry=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Mad");return a};PosableState.prototype.Private_GetPoseSpeaking=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Hold"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"MouthOpen");return a};PosableState.prototype.Private_GetPoseExplaining=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"15"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Hold"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"MouthOpen");return a};PosableState.prototype.Private_GetPoseSad=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"VerySad");return a};PosableState.prototype.Private_GetPoseSleeping=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"EyesClosed");return a};PosableState.prototype.Private_GetPoseComplaining=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"-15"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Hold"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hold"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Mad");return a};PosableState.prototype.Private_GetPoseHolding=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hold"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Happy");return a};PosableState.prototype.Private_GetPoseConfusion=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"-15"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Unsure");return a};PosableState.prototype.Private_GetPoseUpset=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Kneel"});this.Private_AddFaces(a,"VerySad");return a};PosableState.prototype.Private_GetPoseSit=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Sit"});this.Private_AddFaces(a,"Happy");return a};PosableState.prototype.Private_GetPoseDetermined=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Mad");return a};PosableState.prototype.Private_GetPoseHappy=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Happy");return a};PosableState.prototype.Private_GetPoseWalking=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Walk"});this.Private_AddFaces(a,"Happy");return a};PosableState.prototype.Private_GetPoseShouting=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"MouthOpen");return a};PosableState.prototype.Private_GetPoseScared=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Nervous"});this.Private_AddFaces(a,"Shocked");return a};PosableState.prototype.Public_GetPose=function(a){switch(a){case InstaPoseEnum.Angry:return this.Private_GetPoseAngry();case InstaPoseEnum.Speaking:return this.Private_GetPoseSpeaking();case InstaPoseEnum.Explaining:return this.Private_GetPoseExplaining();case InstaPoseEnum.Sad:return this.Private_GetPoseSad();case InstaPoseEnum.Sleeping:return this.Private_GetPoseSleeping();case InstaPoseEnum.Complaining:return this.Private_GetPoseComplaining();case InstaPoseEnum.Holding:return this.Private_GetPoseHolding();case InstaPoseEnum.Confusion:return this.Private_GetPoseConfusion();case InstaPoseEnum.Upset:return this.Private_GetPoseUpset();case InstaPoseEnum.Sit:return this.Private_GetPoseSit();case InstaPoseEnum.Determined:return this.Private_GetPoseDetermined();case InstaPoseEnum.Happy:return this.Private_GetPoseHappy();case InstaPoseEnum.Walking:return this.Private_GetPoseWalking();case InstaPoseEnum.Shouting:return this.Private_GetPoseShouting();case InstaPoseEnum.Scared:return this.Private_GetPoseScared()}return null};function ShapesState(){this.Private_CurrentShapeAction=ShapeActionEnum.Nothing;this.Private_SelectedShapes=new Array();this.Private_ShapeStates=new Object()}ShapesState.Public_ZSortShapeStates=function(a){a.sort(function(c,e){var d=$("g").index($("#"+c.Id));var f=$("g").index($("#"+e.Id));return parseInt(d-f)});return a};ShapesState.prototype.Property_SetCurrentShapeAction=function(a){this.Private_CurrentShapeAction=a};ShapesState.prototype.Property_GetCurrentShapeAction=function(){return this.Private_CurrentShapeAction};ShapesState.prototype.Property_SelectedCount=function(){return this.Private_SelectedShapes.length};ShapesState.prototype.Property_GetShapeStatesCount=function(){var b=0;try{for(shapeStateId in this.Private_ShapeStates){if(shapeStateId!=null){var c=this.Public_GetShapeStateById(shapeStateId);if(c!=null&&c.Movable){b++}if(c.Movable==false&&c.TextState!=null){if(c.TextState.D[c.TextState.CurrentId].DefaultText!=c.TextState.D[c.TextState.CurrentId].Text){b++}}}}}catch(a){LogErrorMessage("ShapesState.Property_GetShapeStatesCount",a)}return b};ShapesState.prototype.Public_GetImageAttributions=function(){var b=this.Public_GetAllShapeStates();var a=new Object();for(var c=0;c<b.length;c++){var d=b[c];if(d.ImageAttribution!=null&&d.ImageAttribution.HasAttribution){a[d.ImageAttribution.PhotoId]=d.ImageAttribution}}return a};ShapesState.prototype.Public_GetFirstSelectedShapeState=function(){if(this.Property_SelectedCount()==0){return null}var c=this.Public_GetFirstSelectedShape().attr("id");var b=this.Public_GetShapeStateById(c);if(b==null){if(c==null){LogErrorMessage("ShapeState.Public_GetFirstSelectedShapeState: firstSelectedShape is null & id is null")}else{$("#"+c).remove();swalQueue({title:MyLangMap.GetTextByToken("warning-title-uh-oh"),text:MyLangMap.GetTextByToken("warning-corrupted-image"),type:"warning",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")});MyShapesState.Public_ClearAllSelectedShapes();LogErrorMessage("ShapeState.Public_GetFirstSelectedShapeState: firstSelectedShape is null & ID is "+c+" total shapes state: "+this.Property_GetShapeStatesCount());try{var d="";for(shapeState in this.Private_ShapeStates){d+=shapeState+", "}LogErrorMessage("ShapeState.Public_GetFirstSelectedShapeState: Known Shape States: "+d)}catch(a){}}}return b};ShapesState.prototype.Public_ClearDefaults=function(){this.Private_ClearUnusedShapes();for(var a in this.Private_ShapeStates){if(a===null){continue}a=this.Public_GetShapeStateById(a);a.Public_ClearDefaults()}};ShapesState.prototype.Public_GetAllShapeStates=function(){var a=new Array();for(var b in this.Private_ShapeStates){if(b===null){continue}b=this.Public_GetShapeStateById(b);if(b!=null){a.push(b)}}return a};ShapesState.prototype.Public_GetAllMovableShapeStates=function(a){a=(typeof a!=="undefined")?a:false;var e=this.Public_GetAllShapeStates();var c=new Array();for(var b=0;b<e.length;b++){var d=e[b];if(d==null){continue}if(a){if(d.IsLocked==true){continue}}if(d.Movable==false){continue}c.push(d)}return c};ShapesState.prototype.Public_GetAllSelectedShapeStates=function(){var c=new Array();if(this.Property_SelectedCount()==0){return c}for(var a=0;a<this.Private_SelectedShapes.length;a++){var b=this.Private_SelectedShapes[a].attr("id");c.push(this.Private_ShapeStates[b])}return c};ShapesState.prototype.Public_GetAllSelectedMovableShapeStates=function(a){a=(typeof a!=="undefined")?a:false;var d=new Array();if(this.Property_SelectedCount()==0){return d}for(var b=0;b<this.Private_SelectedShapes.length;b++){var c=this.Private_SelectedShapes[b].attr("id");if(a){if(this.Private_ShapeStates[c].IsLocked==true){continue}}if(this.Private_ShapeStates[c].Movable==false){continue}d.push(this.Private_ShapeStates[c])}return d};ShapesState.prototype.Public_GetShapeStateByShape=function(a){return this.Public_GetShapeStateById(a.attr("id"))};ShapesState.prototype.Public_GetShapeStateById=function(a){return this.Private_ShapeStates[a]};ShapesState.prototype.Public_RemoveShapeStateById=function(a){this.Public_UnselectShape($("#"+a));delete this.Private_ShapeStates[a]};ShapesState.prototype.Public_LoadShapeStatesFromJson=function(a){this.Private_ShapeStates=JSON.parse(a)};ShapesState.prototype.Public_SetShapeState=function(a,b){if(!(b instanceof SvgState)){throw {message:"shapestate "+a+" is not of type ShapeState, skipping"}}this.Private_ShapeStates[a]=b};ShapesState.prototype.Public_ResetShapeStates=function(){this.Private_ShapeStates=new Object()};ShapesState.prototype.Private_ClearUnusedShapes=function(){var c=[];for(id in MyShapesState.Private_ShapeStates){try{var b=$("#"+id);if(b.length==0){c.push(id);continue}}catch(a){LogErrorMessage("ShapeStates.Public_ClearUnusedShapes",a)}}for(i=0;i<c.length;i++){this.Public_RemoveShapeStateById(c[i])}};ShapesState.prototype.Public_ShapeStateToJson=function(){this.Private_ClearUnusedShapes();var b=JSON.stringify(this.Private_ShapeStates,function a(c,d){if(c=="_SnapshotStateData"){return undefined}if(c=="Private_PreviousPoseList"){return undefined}if(c=="_TextStateDataProperties"){return undefined}if(c=="_SvgStateProperties"){return undefined}return d});return b};ShapesState.prototype.Public_GetFirstSelectedShape=function(){if(this.Property_SelectedCount()==0){return null}return this.Private_SelectedShapes[0]};ShapesState.prototype.Public_GetAllSelectedShapes=function(){return this.Private_SelectedShapes};ShapesState.prototype.Public_ClearAllSelectedShapes=function(){var b=this.Public_GetAllSelectedShapeStates();if(b!=null){for(var a=0;a<b.length;a++){if(b[a]!=null){b[a].SetActive(false);b[a].UpdateDrawing()}}}this.Private_SelectedShapes=new Array();this.Private_CurrentShapeAction=ShapeActionEnum.Nothing};ShapesState.prototype.Public_UpdateSingleShapeAndAction=function(b,a){this.Public_ClearAllSelectedShapes();this.Public_SelectShape(b);this.Property_SetCurrentShapeAction(a)};ShapesState.prototype.Public_SelectShape=function(a){if(this.Public_ShapeSelected(a)==false){this.Private_SelectedShapes.push(a)}var b=this.Public_GetShapeStateByShape(a);if(b!=null){b.SetActive(true)}};ShapesState.prototype.Public_ShapeSelected=function(a){return(this.Private_GetShapeIndex(a)>=0)};ShapesState.prototype.Public_UnselectShape=function(b){var c=this.Public_GetShapeStateByShape(b);if(c!=null&&c instanceof SvgState){c.SetActive(false)}var a=this.Private_GetShapeIndex(b);if(a<0){return}this.Private_SelectedShapes.splice(a,1)};ShapesState.prototype.Private_GetShapeIndex=function(c){var b=c.attr("id");for(var a=0;a<this.Private_SelectedShapes.length;a++){if(b===this.Private_SelectedShapes[a].attr("id")){return a}}return -1};function SmartSceneState(a){this._ShapeId=a;this.SmartSceneItems=[]}SmartSceneState.prototype.IsSmartScene=function(){return this.SmartSceneItems.length>0};SmartSceneState.prototype.GetSelectedSceneOptions=function(){var b=[];for(var a=0;a<this.SmartSceneItems.length;a++){b.push(this.SmartSceneItems[a].GetActiveSceneIndex())}return b};SmartSceneState.prototype.SetSelectedSceneOptions=function(b){if(b.length!=this.SmartSceneItems.length){return}for(var a=0;a<this.SmartSceneItems.length;a++){this.SmartSceneItems[a].ActivateSceneOption(b[a])}};SmartSceneState.prototype.ParseMetaData=function(a){try{var d=$("#"+this._ShapeId).find("sbtdata");if(d==null||d.length==0){return}var f=d.find(SbtDataEnum.MetaData_SmartScene);var h=f.find(SbtDataEnum.MetaData_SmartSceneItem);for(var c=0;c<h.length;c++){var g=new SmartSceneItem();g.ParseMetaData(this._ShapeId,h[c],a);this.SmartSceneItems.push(g)}}catch(b){LogErrorMessage("SmartSceneState._ParseMetaData:  ",b);throw b}};SmartSceneState.prototype.CopySmartSceneState=function(c,a){if(c==undefined||c==null){return}for(var b=0;b<c.SmartSceneItems.length;b++){var d=new SmartSceneItem();d.CopySmartSceneItem(c.SmartSceneItems[b],this._ShapeId,a);this.SmartSceneItems.push(d)}};function SpringableState(a){this._ShapeId=a;this.IsSpringable=false;this.Anchors=new Object();this.Anchors.Right=[];this.Anchors.Bottom=[];this.Springs=new Object();this.Springs.Horizontal=[];this.Springs.Vertical=[]}SpringableState.prototype.ParseMetaData=function(){var b=$("#"+this._ShapeId).find("sbtdata");if(b.length==0){return}var a=b.find(SbtDataEnum.MetaData_Springable_Anchorset);var c=b.find(SbtDataEnum.MetaData_Springable_SpringSet);if(a.length==0||c.length==0){return}this._ParseMetaData_ExtractItems(a,this.Anchors,SbtDataEnum.MetaData_Springable_Attribute_Side);this._ParseMetaData_ExtractItems(c,this.Springs,SbtDataEnum.MetaData_Springable_Attribute_Direction);this.IsSpringable=true};SpringableState.prototype._ParseMetaData_ExtractItems=function(e,d,b){for(var c=0;c<e.length;c++){var f=GetSafeAttributeNS(e[c],b);var a=GetSafeAttributeNS(e[c],SbtDataEnum.MetaData_Springable_Attribute_Groups);if(f==null||a==null||a==""){continue}f=f.toLowerCase().CapitalizeFirstLetter();d[f]=StoryboardCreatorLibrary.ParseAndUpdateIds(this._ShapeId,this._ShapeId+"-spring-",a)}};SpringableState.prototype.CopySpringableState=function(a,b){if(a==undefined||a==null){return}this.IsSpringable=a.IsSpringable;this._UpdateIdsInArray(this.Anchors.Right,a.Anchors.Right,a._ShapeId);this._UpdateIdsInArray(this.Anchors.Bottom,a.Anchors.Bottom,a._ShapeId);this._UpdateIdsInArray(this.Springs.Horizontal,a.Springs.Horizontal,a._ShapeId);this._UpdateIdsInArray(this.Springs.Vertical,a.Springs.Vertical,a._ShapeId)};SpringableState.prototype._UpdateIdsInArray=function(b,a,f){for(var c=0;c<a.length;c++){var e=a[c];var d=e.replace(f,this._ShapeId);FindAndUpdateId(this._ShapeId,e,d);b.push(d)}};SpringableState.prototype.GetSpringStateTransforms=function(){var c=[];c=c.concat(this.Anchors.Right);c=c.concat(this.Anchors.Bottom);c=c.concat(this.Springs.Horizontal);c=c.concat(this.Springs.Vertical);var d=[];for(var a=0;a<c.length;a++){var b=new Object();b.Id=c[a];b.Transform=SvgCreator.GetTransform(b.Id);d.push(b)}return d};SpringableState.prototype.CanResizeVertical=function(){if(this.IsSpringable==false){return false}return this.Springs.Vertical.length>0};SpringableState.prototype.CanResizeHorizontal=function(){if(this.IsSpringable==false){return false}return this.Springs.Horizontal.length>0};function SvgState(a){this.Id=a;this.GlobalImageId;this.FlipHorizontal=false;this.FlipVertical=false;this.X=0;this.Y=0;this.ScaleX=1;this.ScaleY=1;this.SkewX=0;this.SkewY=0;this.Angle=0;this.NaturalOffsetX=0;this.NaturalOffsetY=0;this.isSceneItem=false;this.opacity=1;this.CropType=CropTypeEnum.Standard;this.UseClipping=false;this.ClipX=10;this.ClipY=10;this.ClipWidth=150;this.ClipHeight=100;this.CropPolygonPoint=[{x:0,y:0},{x:150,y:0},{x:150,y:100},{x:0,y:100}];this.CropPolygonPointJson="";this.CacheAddress=new Array();this.isGroupObject=false;this.groupShapeStates=[];this.nextShapeId=null;this.FilterColorMode="";this.IsLocked=false;this.Position="Front";this.Movable=true;this.TextState;this.ColorableState;this.PosableState;this.ImageAttribution;this.SmartSceneState;this.ActivelySelected=false;this.virtualSelected=false;this._SvgStateProperties=["Id","FlipHorizontal","FlipVertical","X","Y","ScaleX","ScaleY","Angle","opacity","NaturalOffsetX","NaturalOffsetY","UseClipping","ClipX","ClipY","ClipWidth","ClipHeight","FilterColorMode","IsLocked","ActivelySelected","Position","CropPolygonPointJson","CropType"];this._TextStateDataProperties=["Text","Font","FontSize","FontColor","TextAlignment","_QuillDeltas","Html","VerticalAlignment"];this._SnapshotStateData={};this.Private_Init()}SvgState.prototype.Public_IsSmartScene=function(){if(this.SmartSceneState==null){return false}return this.SmartSceneState.IsSmartScene()};SvgState.prototype.Property_ClippedOffsetX=function(){if(this.UseClipping==false){return 0}return(this.ClipX*this.ScaleX)};SvgState.prototype.Property_ClippedOffsetY=function(){if(this.UseClipping==false){return 0}return(this.ClipY*this.ScaleY)};SvgState.prototype.Private_Init=function(){var b=this.Private_GetElement("");var a=b.querySelector("sbtdata");if(a!=null){this.GlobalImageId=a.getAttribute(SbtDataEnum.AttributeGlobalImageId);this.Position=a.getAttribute(SbtDataEnum.MetaData_Position)||this.Position}this.TextState=new TextState(this.Id);this.ColorableState=new ColorableState(this.Id);this.PosableState=new PosableState(this.Id,this.GlobalImageId,this.Position);this.SmartSceneState=new SmartSceneState(this.Id);this.SmartSceneState.ParseMetaData(this.ColorableState);this.SpringableState=new SpringableState(this.Id);this.SpringableState.ParseMetaData();this.ImageAttribution=new ImageAttribution(b.querySelector("attribution"));this.Private_ClearMetaData()};SvgState.prototype.Property_VisibleX=function(){var a=this.X+this.Property_ClippedOffsetX();return a};SvgState.prototype.Property_VisibleY=function(){var a=this.Y+this.Property_ClippedOffsetY();return a};SvgState.prototype.IsTextable=function(){for(var a=0;a<this.TextState.D.length;a++){if(this.TextState.D[a].Textable){return true}}return false};SvgState.prototype.IsMultiTextable=function(){return this.TextState.D.length>1};SvgState.prototype.ChangeCharacterPosition=function(e){if(e==this.Position){return}var f=MyCharacterPosistionLibrary.GetCharacterPosition(this.GlobalImageId,e);var c=this.X;var d=this.Y;var a=this.Private_GetPointer(SvgPartsEnum.Natural);var f=MyCharacterPosistionLibrary.GetCharacterPosition(this.GlobalImageId,e);var c=this.X;var d=this.Y;var a=this.Private_GetPointer(SvgPartsEnum.Natural);var b=this.Private_GetElement(SvgPartsEnum.Natural);while(b.firstChild){b.removeChild(b.firstChild)}b.insertAdjacentHTML("afterbegin",f.Svg);b.querySelector("svg").setAttribute("id",this.Id+SvgPartsEnum.SvgImage);StoryboardContainer.UpdateGradientIds(a);MyShapeMetaData.LookForMetaData(this.Id);this.Position=f.Position;this.Private_ResetNaturalOffset();this.PosableState=new PosableState(this.Id,this.GlobalImageId,this.Position);this.ColorableState.Public_HandlePositionSwap();this.Private_ClearMetaData();this.X=c;this.Y=d;this.UpdateDrawing()};function GetParametersFromSVG(k,a){var l=k.getAttribute("transform");var f={X:0,Y:0,Angle:0,ScaleX:1,ScaleY:1,NaturalOffsetX:0,NaturalOffsetY:0,FlipHorizontal:false,FlipVertical:false};if(l!=null){var c=(l==null)?0:l.indexOf("translate");var b=(l==null)?0:l.indexOf("rotate");var e=l.substring(c+"translate".length,l.indexOf(")",c));var g=l.substring(b+"rotate".length,l.indexOf(")",b));e=SplitParenthesis(e);g=SplitParenthesis(g);f.X=Number(e[0]);f.Y=Number(e[1]);f.Angle=Number(g[0])}else{f.X=0;f.Y=0;f.Angle=0}var j=$(k).find("#"+a+SvgPartsEnum.Scale)[0];var h=j.getAttribute("transform");if(h!=null){h=h.replace("scale","");h=SplitParenthesis(h);if(Number(h[0])<0){f.FlipHorizontal=true}if(Number(h[1])<0){f.FlipVertical=true}f.ScaleX=Math.abs(Number(h[0]));f.ScaleY=Math.abs(Number(h[1]))}else{f.ScaleX=1;f.ScaleY=1}f.NaturalOffsetX=0;f.NaturalOffsetY=0;var d=$(k).find("#"+a+SvgPartsEnum.Natural)[0];var m=d.getAttribute("transform");m=m.replace("translate","");m=SplitParenthesis(m);f.NaturalOffsetX=-1*Number(m[0]);f.NaturalOffsetY=-1*Number(m[1]);f.NaturalOffsetX=isNaN(f.NaturalOffsetX)?0:f.NaturalOffsetX;f.NaturalOffsetY=isNaN(f.NaturalOffsetY)?0:f.NaturalOffsetY;return f}SvgState.prototype.Public_RecreateFromOrphan=function(){try{var c=this.Private_GetElement("");var b=GetParametersFromSVG(c,thisId);this.X=b.X;this.Y=b.Y;this.Angle=b.Angle;this.ScaleX=b.ScaleX;this.ScaleY=b.ScaleY;this.FlipHorizontal=b.FlipHorizontal;this.FlipVertical=b.FlipVertical;this.NaturalOffsetX=b.NaturalOffsetX;this.NaturalOffsetY=b.NaturalOffsetY}catch(a){}};SvgState.prototype.Public_ChangeShapeLocation=function(d,c){if(d==null||c==null){return}var a=c.X-d.X;var b=c.Y-d.Y;this.MoveDistance(a,b);this.UpdateDrawing()};SvgState.prototype.Property_IsColorable=function(){if(this.ColorableState==undefined||this.ColorableState==null){return false}return this.ColorableState.Property_IsColorable()};SvgState.prototype.Public_ResetColors=function(){if(this.TextState!=null){this.TextState.Public_ResetFontColor()}if(this.Property_IsColorable()==false){return}this.ColorableState.Public_ResetColors()};SvgState.prototype.Public_SetColorForRegion=function(e,b,d,f,a){if(this.Property_IsColorable()==false){return}if(a){var c=this.ColorableState.Public_GetColorForRegion(e);UndoManager.register(undefined,UndoColorChange,[this.Id,e,c],"",undefined,UndoColorChange,[this.Id,e,b],"")}this.ColorableState.Public_UpdateColorForRegion(e,b,d);if(f){DrawControlsMenu()}};SvgState.prototype.Public_GetColorRegions=function(){if(this.Property_IsColorable()==false){return null}return this.ColorableState.Public_GetRegionList()};SvgState.prototype.Public_GetColorWheelForRegion=function(a){if(this.Property_IsColorable()==false){return null}return this.ColorableState.Public_GetColorWheelForRegion(a)};SvgState.prototype.Public_GetColorForRegion=function(a){if(this.Property_IsColorable()==false){return null}return this.ColorableState.Public_GetColorForRegion(a)};SvgState.prototype.Public_GetTitleForRegion=function(b){if(this.Property_IsColorable()==false){return null}try{return this.ColorableState.Public_GetTitleForRegion(b)}catch(a){}return""};SvgState.prototype.Private_CopyColorableState=function(a){this.ColorableState.Public_Copy(a)};SvgState.prototype.Private_CopySpringableState=function(a){if(a==null){return}this.SpringableState.CopySpringableState(a)};SvgState.prototype.IsSpringable=function(){if(this.SpringableState==null){return false}return this.SpringableState.IsSpringable};SvgState.prototype._CanResizeVertical=function(){if(this.IsSpringable()==false){return true}return this.SpringableState.CanResizeVertical()};SvgState.prototype._CanResizeHorizontal=function(){if(this.IsSpringable()==false){return true}return this.SpringableState.CanResizeHorizontal()};SvgState.prototype.CopyShapeState=function(d,c){DebugLine("not calling here CopyShapeState");this.SetScale(d.ScaleX,d.ScaleY);this.RotateShape(d.Angle);this.FlipHorizontal=d.FlipHorizontal;this.FlipVertical=d.FlipVertical;this.isSceneItem=d.isSceneItem||false;this.FilterColorMode=d.FilterColorMode;this.IsLocked=false;this.UseClipping=d.UseClipping;this.ClipX=d.ClipX;this.ClipY=d.ClipY;this.opacity=d.opacity;this.ClipWidth=d.ClipWidth;this.ClipHeight=d.ClipHeight;this.SkewX=d.SkewX;this.SkewY=d.SkewY;this.CropType=d.CropType;this.CropPolygonPointJson=JSON.stringify(d.CropPolygonPoint);this.CropPolygonPoint=JSON.parse(this.CropPolygonPointJson);this.isGroupObject=d.isGroupObject;this.nextShapeId=d.nextShapeId;if(c){this.NaturalOffsetX=d.NaturalOffsetX;this.NaturalOffsetY=d.NaturalOffsetY;this.X=d.X;this.Y=d.Y;this.ScaleX=d.ScaleX;this.ScaleY=d.ScaleY;this.Angle=d.Angle}this.GlobalImageId=d.GlobalImageId;this.Position=d.Position;if(this.UseClipping==undefined||this.UseClipping==null){this.UseClipping=false;this.ClipX=0;this.ClipY=0;this.ClipWidth=0;this.ClipHeight=0}if(d.IsTextable()){this.CopyTextState(d.TextState)}if(d.Property_IsColorable()){this.Private_CopyColorableState(d.ColorableState)}if(d.Public_IsPosable()){this.Private_CopyPosableState(d.PosableState)}if(d.Public_IsSmartScene()){this.Private_CopySmartSceneState(d.SmartSceneState)}if(d.IsSpringable()){this.Private_CopySpringableState(d.SpringableState)}var b;for(b=0;b<d.groupShapeStates.length;b++){AddSvg.CurrentShapeIndex++;newShapeId=SvgPartsEnum.ShapeId+AddSvg.CurrentShapeIndex;$("#"+this.Id+SvgPartsEnum.SvgImage).find('[id^="'+d.groupShapeStates[b].Id+'"]').each(function(){var f=this.getAttribute("id");var e=newShapeId+f.substring(newShapeId.length,f.length);this.setAttribute("id",e)});var a=new SvgState(newShapeId);a.CopyShapeState(d.groupShapeStates[b],true);this.groupShapeStates.push(a)}};SvgState.prototype.Private_SnapshotState=function(){var a;for(a=0;a<this._SvgStateProperties.length;a++){this._SnapshotStateData[this._SvgStateProperties[a]]=this[this._SvgStateProperties[a]]}for(a=0;a<this._TextStateDataProperties.length;a++){this._SnapshotStateData[this._TextStateDataProperties[a]]=this.TextState[this._TextStateDataProperties[a]]}if(this.Public_IsPosable()){var c=this.PosableState.Public_PoseGroups();for(a=0;a<c.length;a++){pose=c[a];var b="posable_"+a;this._SnapshotStateData[b]=pose.Public_GetActiveOption()}}};SvgState.prototype.Private_HasChangedSinceLastUpdateDrawing=function(){var c;try{for(c=0;c<this._SvgStateProperties.length;c++){if((this._SnapshotStateData[this._SvgStateProperties[c]]||EMPTY_STRING)!==(this[this._SvgStateProperties[c]]||EMPTY_STRING)){this.Private_SnapshotState();return true}}}catch(b){LogErrorMessage("Private_HasChangedSinceLastUpdateDrawing.a",b);return true}try{for(c=0;c<this._TextStateDataProperties.length;c++){if((this._SnapshotStateData[this._TextStateDataProperties[c]]||EMPTY_STRING)!==(this.TextState[this._TextStateDataProperties[c]]||EMPTY_STRING)){this.Private_SnapshotState();return true}}}catch(b){LogErrorMessage("Private_HasChangedSinceLastUpdateDrawing.b",b);return true}try{if(this.Public_IsPosable()){var f=this.PosableState.Public_PoseGroups();for(c=0;c<f.length;c++){pose=f[c];var d="posable_"+c;var a=pose.Public_GetActiveOption();if(a==null){LogErrorMessage("SvgState.Private_HasChangedSinceLastUpdateDrawing ActivePoseOption is null");this.Private_SnapshotState();return true}if(this._SnapshotStateData[d]==null){LogErrorMessage("SvgState.Private_HasChangedSinceLastUpdateDrawing _SnapshotStateData is null - id "+d);this.Private_SnapshotState();return true}if(a.IsEqual(this._SnapshotStateData[d])==false){this.Private_SnapshotState();return true}}}}catch(b){LogErrorMessage("Private_HasChangedSinceLastUpdateDrawing.c",b);return true}return false};SvgState.prototype.Public_ClearDefaults=function(){if(this.IsTextable&&this.TextState.Public_ClearDefaults()){try{this.UpdateDrawing(true)}catch(a){LogErrorMessage("SvgState.Public_ClearDefaults",a)}}};SvgState.prototype.GetPivotPoint=function(b){var e=this.UseClipping;if(b){this.UseClipping=false}var a=this.Public_GetVisibleShapeDimensions();var c=a.width/2+this.Property_ClippedOffsetX();var d=a.height/2+this.Property_ClippedOffsetY();if(this.FlipHorizontal){c*=-1}if(this.FlipVertical){d*=-1}this.UseClipping=e;return{x:c,y:d}};SvgState.prototype.UpdateDrawing=function(d){if(d==null||d==false){if(!this.Private_HasChangedSinceLastUpdateDrawing()){return}}if(this.ActivelySelected==false){this.ClearSelectionBox()}var q=this.Private_GetElement("");var r=$("#"+this.Id+SvgPartsEnum.SvgImage);if(!r.isEmptyObject&&r.attr("filter")!=this.FilterColorMode){r.attr("filter",this.FilterColorMode);r.hide().show(0);r.hide().show(0)}var h=this.Private_GetElement(SvgPartsEnum.Natural);var l=this.Private_GetElement(SvgPartsEnum.Scale);var b=this.Private_GetFullShapeDimensions();var c=this.Public_GetVisibleShapeDimensions();var m=this.ScaleX;var u=0;var v=0;var j=c.width/2+this.Property_ClippedOffsetX();var k=c.height/2+this.Property_ClippedOffsetY();if(this.FlipHorizontal){m*=-1;j*=-1;u+=b.width;if(this.UseClipping){var p=c.width+(2*this.Property_ClippedOffsetX());u-=b.width-p}}var n=this.ScaleY;if(this.FlipVertical){n*=-1;k*=-1;v+=b.height;if(this.UseClipping){var p=c.height+(2*this.Property_ClippedOffsetY());v-=b.height-p}}var f=-1*this.NaturalOffsetX;var g=-1*this.NaturalOffsetY;f=isNaN(f)?0:f;g=isNaN(g)?0:g;if(h==null){LogErrorMessage("SvgState.UpdateDrawing - No NaturalOffsetG "+this.Id)}else{h.setAttribute("transform","translate("+f+","+g+")")}if(l==null){LogErrorMessage("SvgState.UpdateDrawing - No scaleG "+this.Id)}else{var a=this.SkewX!=0?Math.atan(this.SkewX/b.height)*180/Math.PI:Math.atan(this.SkewY/b.width)*180/Math.PI;var o=this.SkewX!=0?"skewX("+a+")":"skewY("+a+")";l.setAttribute("transform",o+"scale("+m+", "+n+")");l.setAttribute("opacity",this.opacity)}var t="translate("+(this.X+u)+", "+(this.Y+v)+")";t+="rotate("+this.Angle+", "+j+","+k+")";if(q==null){LogErrorMessage("SvgState.UpdateDrawing - No svg "+this.Id)}else{q.setAttribute("transform",t)}this.UpdateCropping();if(this.IsTextable()){this.AddText();$("#OpacitySlider").css("opacity",0.5)}else{$("#OpacitySlider").css("opacity",1)}if(this.ActivelySelected){this.DrawSelectionBox()}if(MyBrowserProperties.IsSafari5){var e=MyPointers.CoreSvg;var s=MyPointers.SvgContainer;e.detach();s.append(e)}};SvgState.prototype.ClearSelectionBox=function(){var a=this.Private_GetElement(SvgPartsEnum.SelectionBox);if(a){a.parentNode.removeChild(a)}a=this.Private_GetElement(SvgPartsEnum.RotateCircleGroup);if(a){a.parentNode.removeChild(a)}a=this.Private_GetElement(SvgPartsEnum.SelectionBoxRectangleWrapper);if(a){a.parentNode.removeChild(a)}};SvgState.prototype.SetEdgeHandlers=function(a,b,c){this.Private_GetElement(a).addEventListener("mousedown",b);this.Private_GetElement(a).addEventListener("mouseup",c);this.Private_GetElement(a).addEventListener("mouseleave",c)};SvgState.prototype.Private_GetSelectionBoxArea=function(k){var a=this.Private_GetFullShapeDimensions();var m=a.width;var g=a.height;var c=0;var d=0;if(this.UseClipping){m=this.ClipWidth*this.ScaleX;g=this.ClipHeight*this.ScaleY;c=this.ClipX*this.ScaleX;d=this.ClipY*this.ScaleY}if(isNaN(m)||isFinite(m)==false){m=40}if(isNaN(g)||isFinite(g)==false){g=10}var h=-1*k+c;var j=m+k+c;var l=-1*k+d;var b=g+k+d;if(this.FlipHorizontal){var e=m+(2*this.Property_ClippedOffsetX());h-=e;j-=e}if(this.FlipVertical){var f=g+(2*this.Property_ClippedOffsetY());l-=f;b-=f}return{Width:m,Height:g,Left:h,Right:j,Bottom:b,Top:l,CenterX:m/2+c,CenterY:g/2+d}};SvgState.prototype.DrawSelectionBox=function(){if(this.Movable==false){return}var l=5;try{if(this.IsTextable()){l=15}}catch(b){LogErrorMessage("SvgState.DrawSelectionBox",b)}var a=this.Private_GetSelectionBoxArea(l);var g=this.Private_GetElement(SvgPartsEnum.SelectionBox);var k=a.Width+(2*l);var d=a.Height+(2*l);if(g==null){var f=this.Private_GetId(SvgPartsEnum.SelectionBox);var c=document.createElementNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"id",f);var j=this.Private_GetId(SvgPartsEnum.SelectionBoxRectangleWrapper);var h=document.createElementNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"id",j);var m=this.Private_GetElement("");m.insertBefore(h,m.childNodes[0]);h.appendChild(SvgCreator.AddRect(a.Left,a.Top,k,d,"#526C85","#D0E8F4","4,4",".25",this.Private_GetId(SvgPartsEnum.SelectionBoxRectangle)));m.appendChild(c);try{if(this.IsTextable()){$("#"+this.Private_GetId(SvgPartsEnum.SelectionBoxRectangle)).css("stroke-width","5px")}}catch(b){LogErrorMessage("SvgState.DrawSelectionBox",b)}g=this.Private_GetElement(SvgPartsEnum.SelectionBox)}else{SvgCreator.UpdateRectangleDom(this.Private_GetElement(SvgPartsEnum.SelectionBoxRectangle),a.Left,a.Top,k,d)}this.Private_HandleHotSpots(g,a.Top,a.Right,a.Bottom,a.Left)};SvgState.prototype.Private_HandleHotSpots=function(d,e,c,a,b){if(MyBrowserProperties.IsMobile){this.Private_HandleMobileSelectionHotSpots(d,e,c,a,b)}else{this.Private_HandlePCSelectionHotSpots(d,e,c,a,b)}};SvgState.prototype.Private_HandleMobileSelectionHotSpots=function(e,o,h,a,f){var c=13;var l=(f+h)/2;var m=o-30;var n="#AAA393";var d="#6285C7";var k=this.Private_GetElement(SvgPartsEnum.RotateCircleGroup);if(k==null){e.appendChild(SvgCreator.AddLine(l,m,l,o-3,"Stroke-dasharray:4,4; stroke: "+n,this.Private_GetId(SvgPartsEnum.RotateCircleBar)));var b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"id",this.Private_GetId(SvgPartsEnum.RotateCircleGroup));e.appendChild(b);b.appendChild(SvgCreator.AddCircle(l,m,c,n,d,this.Private_GetId(SvgPartsEnum.RotateCircle),"RotateBar"));var j=this.Private_GetElement(SvgPartsEnum.RotateCircleGroup);inputAdapter.EnableRotate($(j),HandleRotate)}else{SvgCreator.UpdateLineDom(this.Private_GetElement(SvgPartsEnum.RotateCircleBar),l,m,l,o-3);SvgCreator.UpdateCircleDom(this.Private_GetElement(SvgPartsEnum.RotateCircle),l,m)}};SvgState.prototype.Private_HandlePCSelectionHotSpots=function(b,k,f,a,c){var h=(c+f)/2;var j=k-30;var d=(c+f)/2;var e=(k+a)/2;if(this.Private_GetElement(SvgPartsEnum.Selector_NW)){this.Private_UpdatePCSelectionHotSpots(b,k,f,a,c,h,j,d,e)}else{this.Private_AddPCSelectionHotSpots(b,k,f,a,c,h,j,d,e)}};SvgState.prototype.Private_UpdatePCSelectionHotSpots=function(c,l,h,a,d,j,k,e,f){var b=this.Private_GetElement(SvgPartsEnum.RotateCircleBar);if(b){SvgCreator.UpdateLineDom(b,j,k,j,l-3)}b=this.Private_GetElement(SvgPartsEnum.RotateCircle);if(b){SvgCreator.UpdateCircleDom(b,j,k)}b=this.Private_GetElement(SvgPartsEnum.Selector_NW);if(b){SvgCreator.UpdateCircleDom(b,d,l);b.setAttribute("class",this.Private_GetResizeArrow(3))}b=this.Private_GetElement(SvgPartsEnum.Selector_NE);if(b){SvgCreator.UpdateCircleDom(b,h,l);b.setAttribute("class",this.Private_GetResizeArrow(1))}b=this.Private_GetElement(SvgPartsEnum.Selector_SW);if(b){SvgCreator.UpdateCircleDom(b,d,a);b.setAttribute("class",this.Private_GetResizeArrow(1))}b=this.Private_GetElement(SvgPartsEnum.Selector_SE);if(b){SvgCreator.UpdateCircleDom(b,h,a);b.setAttribute("class",this.Private_GetResizeArrow(3))}b=this.Private_GetElement(SvgPartsEnum.Selector_N);if(b){SvgCreator.UpdateCircleDom(b,e,l);b.setAttribute("class",this.Private_GetResizeArrow(0))}b=this.Private_GetElement(SvgPartsEnum.Selector_S);if(b){SvgCreator.UpdateCircleDom(b,e,a);b.setAttribute("class",this.Private_GetResizeArrow(0))}b=this.Private_GetElement(SvgPartsEnum.Selector_W);if(b){SvgCreator.UpdateCircleDom(b,d,f);b.setAttribute("class",this.Private_GetResizeArrow(2))}b=this.Private_GetElement(SvgPartsEnum.Selector_E);if(b){SvgCreator.UpdateCircleDom(b,h,f);b.setAttribute("class",this.Private_GetResizeArrow(2))}};SvgState.prototype.Private_AddPCSelectionHotSpots=function(f,p,l,a,h,m,n,j,k){var b=CommonStylingEnum.ShapeSelector_HotSpot_Corner_CircleSize;var o=CommonStylingEnum.ShapeSelector_HotSpot_Corner_Stroke;var d=CommonStylingEnum.ShapeSelector_HotSpot_Corner_Fill;try{if(this.IsTextable()){b=8}}catch(c){LogErrorMessage("SvgState.Private_AddPCSelectionHotSpots",c)}f.appendChild(SvgCreator.AddLine(m,n,m,p-3,"Stroke-dasharray:4,4; stroke: "+o,this.Private_GetId(SvgPartsEnum.RotateCircleBar)));f.appendChild(SvgCreator.AddCircle(m,n,b,o,d,this.Private_GetId(SvgPartsEnum.RotateCircle),CommonStylingEnum.ShapeSelector_HotSpot_Fill));f.appendChild(SvgCreator.AddCircle(h,p,b,o,d,this.Private_GetId(SvgPartsEnum.Selector_NW),this.Private_GetResizeArrow(3)));f.appendChild(SvgCreator.AddCircle(l,p,b,o,d,this.Private_GetId(SvgPartsEnum.Selector_NE),this.Private_GetResizeArrow(1)));f.appendChild(SvgCreator.AddCircle(h,a,b,o,d,this.Private_GetId(SvgPartsEnum.Selector_SW),this.Private_GetResizeArrow(1)));f.appendChild(SvgCreator.AddCircle(l,a,b,o,d,this.Private_GetId(SvgPartsEnum.Selector_SE),this.Private_GetResizeArrow(3)));var b=CommonStylingEnum.ShapeSelector_HotSpot_Side_CircleSize;var o=CommonStylingEnum.ShapeSelector_HotSpot_Side_Stroke;var d=CommonStylingEnum.ShapeSelector_HotSpot_Side_Fill;try{if(this.IsTextable()){b=8}}catch(c){LogErrorMessage("SvgState.Private_AddPCSelectionHotSpots",c)}if(this._CanResizeVertical()){f.appendChild(SvgCreator.AddCircle(j,p,b,o,d,this.Private_GetId(SvgPartsEnum.Selector_N),this.Private_GetResizeArrow(0)));f.appendChild(SvgCreator.AddCircle(j,a,b,o,d,this.Private_GetId(SvgPartsEnum.Selector_S),this.Private_GetResizeArrow(0)))}if(this._CanResizeHorizontal()){f.appendChild(SvgCreator.AddCircle(h,k,b,o,d,this.Private_GetId(SvgPartsEnum.Selector_W),this.Private_GetResizeArrow(2)));f.appendChild(SvgCreator.AddCircle(l,k,b,o,d,this.Private_GetId(SvgPartsEnum.Selector_E),this.Private_GetResizeArrow(2)))}this.SetEdgeHandlers(SvgPartsEnum.RotateCircle,StartRotate,StopRotate);this.SetEdgeHandlers(SvgPartsEnum.Selector_NE,StartResize,StopResize);this.SetEdgeHandlers(SvgPartsEnum.Selector_NW,StartResize,StopResize);this.SetEdgeHandlers(SvgPartsEnum.Selector_SE,StartResize,StopResize);this.SetEdgeHandlers(SvgPartsEnum.Selector_SW,StartResize,StopResize);if(this._CanResizeVertical()){this.SetEdgeHandlers(SvgPartsEnum.Selector_N,StartResize,StopResize);this.SetEdgeHandlers(SvgPartsEnum.Selector_S,StartResize,StopResize)}if(this._CanResizeHorizontal()){this.SetEdgeHandlers(SvgPartsEnum.Selector_E,StartResize,StopResize);this.SetEdgeHandlers(SvgPartsEnum.Selector_W,StartResize,StopResize)}};SvgState.prototype.Private_GetResizeArrow=function(b){var a=this.Angle+360;a=a%180;if(a>=30&&a<75){b+=1}if(a>=75&&a<120){b+=2}if(a>=120&&a<165){b+=3}b%=4;switch(b){case 0:return CommonStylingEnum.ShapeSelector_ResizeHotSpot_V_Css;case 1:return CommonStylingEnum.ShapeSelector_ResizeHotSpot_NE_Css;case 2:return CommonStylingEnum.ShapeSelector_ResizeHotSpot_H_Css;case 3:return CommonStylingEnum.ShapeSelector_ResizeHotSpot_NW_Css}};SvgState.prototype.CreateTextBlock=function(f,g,b,e,d){var c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttributeNS(null,"x",f);c.setAttributeNS(null,"y",g);c.setAttributeNS(null,"id",b);c.setAttributeNS(null,"style",d);c.setAttributeNS(null,"class","DisableSelection");var a=document.createTextNode(e);c.appendChild(a);return c};SvgState.prototype.AddText_Quill=function(){var c=this.TextState.CurrentId;for(this.TextState.CurrentId=0;this.TextState.CurrentId<this.TextState.D.length;this.TextState.CurrentId++){var g=this.TextState.CurrentId;if(this.TextState.D[g].RemovalId!==null){var b="#"+this.Id+" #"+this.TextState.D[g].RemovalId;$(b).remove();this.TextState.D[g].RemovalId=null}var f=this.Id+"_text";$("#"+f).remove();var f=this.Id+"_text"+g;$("#"+f).remove();var a=this.Private_GetFullShapeDimensions();var e=this.TextState.Public_GetTextArea(a,this.ScaleX,this.ScaleY,this.NaturalOffsetX,this.NaturalOffsetY,this.IsSpringable());var d=document.createElementNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"id",f);d=$("#"+this.Id).append(d);d=$("#"+this.Id).children().last();WordRunRenderHelper.RenderText(this.TextState.Public_GetQuillDeltas(),e,d,this.FlipHorizontal,this.FlipVertical,this.Angle)}this.TextState.CurrentId=c};SvgState.prototype.AddText_InlineEditor=function(){var o=this.TextState.CurrentId;for(this.TextState.CurrentId=0;this.TextState.CurrentId<this.TextState.D.length;this.TextState.CurrentId++){var v=this.TextState.CurrentId;var t="#"+this.Id+"_text"+v+"_wrap";var e=$(t);if(e.length>0&&e[0].tagName==="foreignObject"){var d=$("#"+this.Id+"_text"+v);var w=d.css("vertical-align");var g=d.height();var a=$("#"+this.Id+"_text"+v+"_wrap .note-editor .note-editing-area .note-editable");if(a.length>0){g=a.height();w=a.css("vertical-align")}var r=this.Public_GetDefaultTextAreaDimensions();if(w=="baseline"){if(g>Math.ceil(r.Height)){w="top"}else{w="middle"}a.css("vertical-align",w);d.css("vertical-align",w)}var f=Math.max(g,r.Height);var u=r.Top;if(this.FlipVertical){u=-(r.Top+r.Height)}if(w==="middle"){u-=(f-r.Height)/2}else{if(w==="bottom"){u-=(f-r.Height)}}d.height(f);var m=r.Left;if(this.FlipHorizontal){m=-(r.Left+r.Width)}e.attr("x",m);e.attr("y",u);e.attr("width",r.Width);e.attr("height",f);var d=$("#"+this.Id+"_text"+v);d.width(r.Width);var b=$(t+" .note-editor .note-editing-area .note-editable, "+t+" .note-editor .note-editing-area .note-placeholder, "+t+" .note-editor .note-editing-area .note-inner-placeholder");b.width(r.Width);b.height(f);b.css("vertical-align",w);b.css(SbtInlineEditorHelper.GetDefaultStyleCssObject(this.TextState.D[this.TextState.CurrentId]));var c=$(t+" .note-editor .note-editing-area .note-placeholder, "+t+" .note-editor .note-editing-area .note-inner-placeholder");c.css({color:"#CCCCCC"})}else{if(this.TextState.D[v].RemovalId!==null){var l="#"+this.Id+" #"+this.TextState.D[v].RemovalId;$(l).remove();this.TextState.D[v].RemovalId=null}var s=this.Id+"_text";$("#"+s).remove();if($("#"+s+"_wrap").length===1){$("#"+s+"_wrap").remove()}s=this.Id+"_text"+v;if(($("#"+s).length===0)||($("#"+s).length===1&&$("#"+s)[0].tagName==="g")){$("#"+s).remove();var r=this.Public_GetDefaultTextAreaDimensions();var w="baseline";var j=true;var p=this.TextState.D[this.TextState.CurrentId].Html||"";var k=(p!=="")?p:(this.TextState.D[this.TextState.CurrentId]._QuillDeltas==null?SbtInlineEditorHelper.GetDefaultHtmlFromText(this.TextState.D[this.TextState.CurrentId]):SbtInlineEditorHelper.GetDeltasToHtml(this.TextState.Public_GetQuillDeltas()));var h=this.TextState.D[this.TextState.CurrentId].DefaultText||"";if(h===""){h=PlaceHolderClickToEdit}var n=$("<p>"+k+"</p>").text();if(n===""||n===h){k=h;j=false;w="middle"}var u=r.Top;if(this.FlipVertical){u=-(r.Top+r.Height)}var m=r.Left;if(this.FlipHorizontal){m=-(r.Left+r.Width)}var q=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");q.setAttributeNS(null,"id",s+"_wrap");q.setAttributeNS(null,"x",m);q.setAttributeNS(null,"y",u);q.setAttributeNS(null,"width",r.Width);q.setAttributeNS(null,"height",r.Height);q=$("#"+this.Id).append(q);q=$("#"+this.Id).children().last();q.html('<div xmlns="http://www.w3.org/1999/xhtml" id="'+s+'" style="width:'+r.Width+"px;height:"+r.Height+"px;vertical-align:"+w+";display:table-cell;overflow-wrap: break-word;word-wrap: break-word;-ms-word-break: break-all;word-break: break-all;word-break: break-word;-ms-hyphens: auto;-moz-hyphens: auto;-webkit-hyphens: auto;hyphens: auto;"+SbtInlineEditorHelper.GetDefaultStyleCssString(this.TextState.D[this.TextState.CurrentId])+'" edited = "'+j+'">'+k+"</div>")}}}this.TextState.CurrentId=o};SvgState.prototype.Public_GetDefaultTextAreaDimensions=function(){var a=this.Private_GetFullShapeDimensions();return this.TextState.Public_GetTextArea(a,this.ScaleX,this.ScaleY,this.NaturalOffsetX,this.NaturalOffsetY,this.IsSpringable())};SvgState.prototype.ForceSize_InlineEditor=function(){var a=this.TextState.CurrentId;for(this.TextState.CurrentId=0;this.TextState.CurrentId<this.TextState.D.length;this.TextState.CurrentId++){this.ForceSize_InlineEditorForCurrentSubId()}this.TextState.CurrentId=a};SvgState.prototype.ForceSize_InlineEditorForSubId=function(b){var a=this.TextState.CurrentId;this.TextState.CurrentId=b;this.ForceSize_InlineEditorForCurrentSubId();this.TextState.CurrentId=a};SvgState.prototype.ForceSize_InlineEditorForCurrentSubId=function(){var m=this.TextState.CurrentId;var k="#"+this.Id+"_text"+m+"_wrap";var e=$(k);if(e.length>0&&e[0].tagName==="foreignObject"){var d=$("#"+this.Id+"_text"+m);var n=d.css("vertical-align");d.height("auto");var g=d.height();var a=$("#"+this.Id+"_text"+m+"_wrap .note-editor .note-editing-area .note-editable");if(a.length>0){a.height("auto");a.height(a.height());g=a.height();n=a.css("vertical-align")}var j=this.Public_GetDefaultTextAreaDimensions();if(n=="baseline"){if(g>Math.ceil(j.Height)){n="top"}else{n="middle"}a.css("vertical-align",n);d.css("vertical-align",n)}var f=Math.max(g,j.Height);var l=j.Top;if(this.FlipVertical){l=-(j.Top+j.Height)}if(n==="middle"){l-=(f-j.Height)/2}else{if(n==="bottom"){l-=(f-j.Height)}}d.height(f);var h=j.Left;if(this.FlipHorizontal){h=-(j.Left+j.Width)}e.attr("x",h);e.attr("y",l);e.attr("width",j.Width);e.attr("height",f);d.width(j.Width);var b=$(k+" .note-editor .note-editing-area .note-editable, "+k+" .note-editor .note-editing-area .note-placeholder, "+k+" .note-editor .note-editing-area .note-inner-placeholder");b.width(j.Width);b.height(f);b.css("vertical-align",n);var c=$(k+" .note-editor .note-editing-area .note-placeholder, "+k+" .note-editor .note-editing-area .note-inner-placeholder");c.css({color:"#CCCCCC"})}};SvgState.prototype.ConvertForeignObjectToQuillBlock=function(){var c=this.TextState.CurrentId;for(this.TextState.CurrentId=0;this.TextState.CurrentId<this.TextState.D.length;this.TextState.CurrentId++){var f=this.TextState.CurrentId;var e="#"+this.Id+"_text"+f+"_wrap";var a=$(e);if(a.length>0&&a[0].tagName==="foreignObject"){var b=this.TextState.D[this.TextState.CurrentId].Html;var d=$(b).text();this.TextState.D[this.TextState.CurrentId].Html=null;this.TextState.D[this.TextState.CurrentId].Text=d;this.TextState.D[this.TextState.CurrentId]._QuillDeltas[0].insert=d;a.remove()}else{if(this.TextState.D[this.TextState.CurrentId].Html){var b=this.TextState.D[this.TextState.CurrentId].Html;var d=$(b).text();this.TextState.D[this.TextState.CurrentId].Html=null;this.TextState.D[this.TextState.CurrentId].Text=d;this.TextState.D[this.TextState.CurrentId]._QuillDeltas[0].insert=d}}}this.TextState.CurrentId=c};SvgState.prototype.AddText=function(){if(UseInlineEditor){this.AddText_InlineEditor();return}this.ConvertForeignObjectToQuillBlock();if(UseQuill||UseSummerNote){this.AddText_Quill();return}if(this.TextState.RemovalId!==null){var g="#"+this.Id+" #"+this.TextState.RemovalId;$(g).remove();this.RemovalId=null}var w=this.TextState.CurrentId;var u=this.Id+"_text"+w;$("#"+u).remove();var p=this.TextState.D[this.TextState.CurrentId].Text;p=p.replaceAll("\r\n","\n");p=p.replaceAll("\r","\n");p=p.replaceAll("\n"," \n ");p=p.replaceAll("\t"," ");var x=p.trim().split(" ");var j=new Array();var a=this.Private_GetFullShapeDimensions();var r=this.TextState.Public_GetTextArea(a,this.ScaleX,this.ScaleY,this.NaturalOffsetX,this.NaturalOffsetY,this.IsSpringable());var q=(this.TextState.D[this.TextState.CurrentId].TextAlignment||"middle");var y=0;switch(q){case"start":y=r.Left;break;case"middle":y=r.Left+(r.Width/2);break;case"end":y=r.Left+r.Width;break}var d="";var h=0;var c=0;var t=this.TextState.FontColor;if(t.indexOf("#")<0){t="#"+t}var k="font-size:"+this.TextState.FontSize+"pt;font-family:"+this.TextState.Font+";fill:"+t+"; text-anchor:"+q+";";var l=document.createElementNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"id",u);l=$("#"+this.Id).append(l);l=$("#"+this.Id).children().last();c=this.TextState.FontSize/0.75;for(var f=0;f<x.length;f++){if(x[f]==="\n"){j[h]=d;d="";h++}else{var m=d+x[f];var n=this.Id+"_temp_text";var s=this.CreateTextBlock(r.Left,r.Top,n,m,k);l.append(s);var o=s.getBBox().width;if(o>r.Width){j[h]=d;d=x[f]+" ";h++}else{d+=x[f]+" "}$("#"+n).remove()}}j[h]=d;if(j[0]==""){j.shift()}var b=0;if(this.FlipHorizontal){switch(q){case"start":y=-1*(r.Left+r.Width);break;case"middle":y=-1*(r.Left+(r.Width/2));break;case"end":y=-1*r.Left;break}}if(this.FlipVertical){r.Top=-1*(r.Top+r.Height)}if(isFinite(r.Height)){var e=j.length*c;if(e<r.Height){b=(r.Height-e)/2}b-=(c*0.25)}for(f=0;f<j.length;f++){var z=r.Top+((f+1)*c)+b;var v="ts_"+AddSvg.CurrentShapeIndex++;var s=this.CreateTextBlock(y,z,v,j[f],k);l.append(s)}};SvgState.prototype.SetNaturalOffset=function(a,b){this.NaturalOffsetX=a;this.NaturalOffsetY=b};SvgState.prototype.GetSavedFontColor=function(){if(this.TextState==null){return null}return this.TextState.Public_GetSavedFontColor()};SvgState.prototype.GetFontColor=function(){return this.TextState.D[this.TextState.CurrentId].FontColor};SvgState.prototype.SetFontColor=function(a,b){this.TextState.Public_SetFontColor(a,b)};SvgState.prototype.ResetFontColor=function(){try{this.TextState.Public_ResetFontColor();MyPointers.Controls_TextableControls_ColorSelector.spectrum("set",this.TextState.FontColor)}catch(a){DebugLine("Reset Font Color: "+a)}};SvgState.prototype.GetFontSize=function(){return this.TextState.D[this.TextState.CurrentId].FontSize};SvgState.prototype.SetFontSize=function(a){this.TextState.D[this.TextState.CurrentId].FontSize=a};SvgState.prototype.SetFontFace=function(a){this.TextState.D[this.TextState.CurrentId].Font=a};SvgState.prototype.GetFontFace=function(){return this.TextState.D[this.TextState.CurrentId].Font};SvgState.prototype.GetText=function(){return this.TextState.D[this.TextState.CurrentId].Text};SvgState.prototype.SetText=function(a){this.TextState.D[this.TextState.CurrentId].Text=a};SvgState.prototype.GetTextAlignment=function(){return this.TextState.D[this.TextState.CurrentId].TextAlignment};SvgState.prototype.SetTextAlignment=function(a){this.TextState.D[this.TextState.CurrentId].TextAlignment=a};SvgState.prototype.FlipShapeHorizontal=function(){this.FlipHorizontal=!this.FlipHorizontal};SvgState.prototype.FlipShapeVertical=function(){this.FlipVertical=!this.FlipVertical};SvgState.prototype.MoveTo=function(a,b){this.X=a;this.Y=b};SvgState.prototype.MoveDistance=function(a,b){this.X+=a;this.Y+=b};SvgState.prototype.RotateShape=function(a){this.Angle+=a;this.Angle%=360};SvgState.prototype.SetScale=function(a,b){this.ScaleX=a;this.ScaleY=b};SvgState.prototype.ChangeScale=function(a){this.ScaleX*=a;this.ScaleY*=a};SvgState.prototype.ChangeScaleXY=function(a,b){this.ScaleX*=a;this.ScaleY*=b};SvgState.prototype.Resize=function(a,b){this.ScaleX+=a;this.ScaleY+=b};SvgState.prototype.GetBBox=function(b){this.ClearSelectionBox();var a=this.Private_GetElement("").getBBox();if(this.ActivelySelected&&b){this.DrawSelectionBox()}return a};SvgState.prototype.SetLockState=function(a){this.IsLocked=a};SvgState.prototype.SetActive=function(a){this.ActivelySelected=a;if(a){try{inputAdapter.EnableScale($("#"+this.Id),HandleScale);inputAdapter.EnableMove($("#"+this.Id+SvgPartsEnum.Scale),HandleMove)}catch(b){throw b+" Debug: true, "+$("#"+this.Id).length+", "+$("#"+this.Id+SvgPartsEnum.Scale).length}}else{try{this.Public_ResetColors();inputAdapter.DisableScale($("#"+this.Id));inputAdapter.DisableMove($("#"+this.Id+SvgPartsEnum.Scale))}catch(c){throw c+" Debug: true, "+$("#"+this.Id).length+", "+$("#"+this.Id+SvgPartsEnum.Scale).length}}};SvgState.prototype.CopyTextState=function(a){this.TextState.Copy(a)};SvgState.prototype.PopulateFromJson=function(b){this.ActivelySelected=b.ActivelySelected;this.Angle=b.Angle?b.Angle:0;this.FlipHorizontal=b.FlipHorizontal;this.FlipVertical=b.FlipVertical;this.isGroupObject=b.isGroupObject;this.FilterColorMode=b.FilterColorMode;this.IsLocked=false;try{this.isSceneItem=b.isSceneItem||false;this.IsLocked=b.IsLocked||false}catch(c){LogErrorMessage("svgstate.populate from JS",c)}this.NaturalOffsetX=b.NaturalOffsetX;this.NaturalOffsetY=b.NaturalOffsetY;this.ScaleX=b.ScaleX?b.ScaleX:1;this.ScaleY=b.ScaleY?b.ScaleY:this.ScaleX;this.X=b.X!=null?b.X:10;this.Y=b.Y!=null?b.Y:10;this.opacity=b.opacity;this.UseClipping=b.UseClipping;this.ClipX=b.ClipX;this.ClipY=b.ClipY;this.ClipWidth=b.ClipWidth;this.ClipHeight=b.ClipHeight;if(b.CropType!=null){this.CropType=b.CropType;this.CropPolygonPointJson=b.CropPolygonPointJson;this.CropPolygonPoint=b.CropPolygonPoint}if(b.SkewX!==void (0)){this.SkewX=b.SkewX}if(b.SkewY!==void (0)){this.SkewY=b.SkewY}if(b.nextShapeId!=void 0){this.nextShapeId=b.nextShapeId}this.groupShapeStates=new Array();var d;if(b.groupShapeStates===void (0)){b.groupShapeStates=new Array()}var f=[];for(d=0;d<b.groupShapeStates.length;d++){try{var a=new SvgState(b.groupShapeStates[d].Id);a.PopulateFromJson(b.groupShapeStates[d]);this.groupShapeStates.push(a)}catch(c){LogErrorMessage("SvgState.PopulateFromJson",{message:"Failed to load grouped object with Id '"+b.groupShapeStates[d].Id+"', discarding"});f.push(d)}}for(var d=0;d<f.length;d++){b.groupShapeStates.splice(f[d],1)}f=[];if(b.CropPolygonPointJson){this.CropPolygonPointJson=b.CropPolygonPointJson;this.CropPolygonPoint=JSON.parse(b.CropPolygonPointJson)}this.GlobalImageId=b.GlobalImageId;this.Position=b.Position||this.Position;this.Movable=(b.Movable==null?true:b.Movable);if(this.UseClipping==undefined||this.UseClipping==null){this.UseClipping=false;this.ClipX=0;this.ClipY=0;this.ClipWidth=0;this.ClipHeight=0}this.CopyTextState(b.TextState);this.Private_CopyColorableState(b.ColorableState);this.Private_CopyPosableState(b.PosableState);this.Private_CopySmartSceneState(b.SmartSceneState);this.Private_CopySpringableState(b.SpringableState);this.ImageAttribution=b.ImageAttribution};SvgState.prototype.Private_GetPointer=function(a){return $("#"+this.Private_GetId(a))};SvgState.prototype.Private_GetElement=function(b){var a=GetGlobalById(this.Private_GetId(b));if(a===null&&b.substring(0,1)==="_"){a=GetGlobalById(this.Private_GetId(b.substring(1)));if(a!==null){a.setAttributeNS(null,"id",this.Private_GetId(b))}}return a};SvgState.prototype.Private_GetId=function(a){return this.Id+a};SvgState.prototype.Private_GetFullShapeDimensions=function(){var f=this.Private_GetElement(SvgPartsEnum.Scale);var d;try{if(f==null){LogErrorMessage("Scale element is null: "+this.Private_GetId(SvgPartsEnum.Scale))}d=f.getBBox()}catch(b){try{LogErrorMessage("SVG CORRUPTED! Unable to get BBOX for "+this.Private_GetId(SvgPartsEnum.Scale),b);d=f.getBoundingClientRect()}catch(c){LogErrorMessage("SVG Really CORRUPTED! Unable to get BBOX for "+this.Private_GetId(SvgPartsEnum.Scale),b);var a=new Object();a.width=5;a.height=5;return a}}var a=new Object();a.width=d.width*this.ScaleX+(this.SkewX);a.height=d.height*this.ScaleY+(this.SkewX==0?this.SkewY:0);if(a.width<5){a.width=5}if(a.height<5){a.height=5}return a};SvgState.prototype.Public_GetVisibleShapeDimensions=function(){if(this.UseClipping){var a=new Object();a.height=this.ClipHeight*this.ScaleY;a.width=this.ClipWidth*this.ScaleX;if(a.width<5){a.width=5}if(a.height<5){a.height=5}return a}return this.Private_GetFullShapeDimensions()};SvgState.prototype.ConvertCoordinateToOrigin=function(c,a,b){c={x:c.x-this.X,y:c.y-this.Y};c={x:c.x-a.x,y:c.y-a.y};c={x:c.x*Math.cos(-this.Angle*Math.PI/180)-c.y*Math.sin(-this.Angle*Math.PI/180),y:c.x*Math.sin(-this.Angle*Math.PI/180)+c.y*Math.cos(-this.Angle*Math.PI/180)};c={x:c.x+a.x,y:c.y+a.y};if(this.FlipHorizontal){c.x-=a.x*2}if(this.FlipVertical){c.y-=a.y*2}if(b){c={x:c.x/this.ScaleX,y:c.y/this.ScaleY}}return c};SvgState.prototype.ConvertCoordinateToStage=function(c,a,b){if(this.FlipHorizontal){c.x+=a.x*2}if(this.FlipVertical){c.y+=a.y*2}c={x:c.x-a.x,y:c.y-a.y};c={x:c.x*Math.cos(this.Angle*Math.PI/180)-c.y*Math.sin(this.Angle*Math.PI/180),y:c.x*Math.sin(this.Angle*Math.PI/180)+c.y*Math.cos(this.Angle*Math.PI/180)};c={x:c.x+a.x,y:c.y+a.y};if(b){c={x:c.x*this.ScaleX,y:c.y*this.ScaleY}}c={x:c.x+this.X,y:c.y+this.Y};return c};SvgState.prototype.Public_GetImaginaryOuterPoints=function(){var a=this.Private_GetSelectionBoxArea(0);var c=0;var b=[{x:a.Left,y:a.Top},{x:a.Right,y:a.Top},{x:a.Left,y:a.Bottom},{x:a.Right,y:a.Bottom}];var d=new Array();for(i=0;i<b.length;i++){d[i]=this.ConvertCoordinateToStage(b[i],{x:a.CenterX,y:a.CenterY})}return d};SvgState.prototype.Public_GetImaginaryOuterBox=function(){var b=this.Public_GetImaginaryOuterPoints();var a;var g=b[0].y,d=b[0].y;var e=b[0].x,f=b[0].x;for(a=1;a<b.length;a++){g=Math.min(g,b[a].y);d=Math.max(d,b[a].y);e=Math.min(e,b[a].x);f=Math.max(f,b[a].x)}var c={Top:g,Bottom:d,Left:e,Right:f};return c};SvgState.prototype.UpdateCropping=function(){if(this.UseClipping){this.Private_AddClipArea();switch(this.CropType){case CropTypeEnum.Standard:var c=this.Private_GetElement(SvgPartsEnum.ClipRect);c.setAttributeNS(null,"x",this.ClipX);c.setAttributeNS(null,"y",this.ClipY);c.setAttributeNS(null,"width",this.ClipWidth);c.setAttributeNS(null,"height",this.ClipHeight);break;case CropTypeEnum.Advanced:var b=this.Private_GetElement(SvgPartsEnum.ClipPolygon);var e;var f="";for(e=0;e<this.CropPolygonPoint.length;e++){f=f+" "+this.CropPolygonPoint[e].x+","+this.CropPolygonPoint[e].y}b.setAttributeNS(null,"points",f);break;case CropTypeEnum.Circle:var a=this.Private_GetElement(SvgPartsEnum.ClipEllipse);a.setAttributeNS(null,"cx",this.ClipX+this.ClipWidth/2);a.setAttributeNS(null,"cy",this.ClipY+this.ClipHeight/2);a.setAttributeNS(null,"rx",this.ClipWidth/2);a.setAttributeNS(null,"ry",this.ClipHeight/2);break}var g=this.Private_GetElement(SvgPartsEnum.Defs);var h=null;if(g){h=g.cloneNode(true);g.parentNode.removeChild(g)}var j=this.Private_GetElement(SvgPartsEnum.Scale);if(j&&h){j.insertBefore(h,j.childNodes[0])}var d=this.Private_GetElement(SvgPartsEnum.CropGroup);if(d){d.removeAttribute("clip-path");d.setAttribute("clip-path","url(#"+this.Private_GetId(SvgPartsEnum.ClipPath)+")")}}else{var d=this.Private_GetElement(SvgPartsEnum.CropGroup);if(d){d.removeAttribute("clip-path")}}};SvgState.prototype.Private_AddClipArea=function(){var j=this.Private_GetElement(SvgPartsEnum.Scale);var g=this.Private_GetElement(SvgPartsEnum.Defs);if(g==null){g=SvgCreator.CreateSvgGroup(this.Private_GetId(SvgPartsEnum.Defs));j.appendChild(g)}var f=this.Private_GetElement(SvgPartsEnum.CropGroup);if(f==null){f=SvgCreator.CreateSvgGroup(this.Private_GetId(SvgPartsEnum.CropGroup));var h=this.Private_GetElement(SvgPartsEnum.Natural);j.appendChild(f);f=this.Private_GetElement(SvgPartsEnum.CropGroup);f.appendChild(h)}var b=this.Private_GetElement(SvgPartsEnum.ClipPath);if(b==null){b=SvgCreator.CreateClipPath(this.Private_GetId(SvgPartsEnum.ClipPath));g.appendChild(b);b=this.Private_GetElement(SvgPartsEnum.ClipPath)}switch(this.CropType){case CropTypeEnum.Standard:var c=this.Private_GetElement(SvgPartsEnum.ClipPolygon);if(c){b.removeChild(c)}var a=this.Private_GetElement(SvgPartsEnum.ClipEllipse);if(a){b.removeChild(a)}var e=this.Private_GetElement(SvgPartsEnum.ClipRect);if(e==null){e=SvgCreator.AddRect(this.ClipX,this.ClipY,this.ClipWidth,this.ClipHeight,"black","black","solid",".5",this.Private_GetId(SvgPartsEnum.ClipRect));b.appendChild(e)}break;case CropTypeEnum.Advanced:var d=this.Private_GetElement(SvgPartsEnum.ClipRect);if(d){b.removeChild(d)}var a=this.Private_GetElement(SvgPartsEnum.ClipEllipse);if(a){b.removeChild(a)}var c=this.Private_GetElement(SvgPartsEnum.ClipPolygon);if(c==null&&this.CropPolygonPoint.length){c=SvgCreator.AddPolygon(this.CropPolygonPoint,"black","black","solid",1,".5",this.Private_GetId(SvgPartsEnum.ClipPolygon));b.appendChild(c)}break;case CropTypeEnum.Circle:var d=this.Private_GetElement(SvgPartsEnum.ClipRect);if(d){b.removeChild(d)}var c=this.Private_GetElement(SvgPartsEnum.ClipPolygon);if(c){b.removeChild(c)}var a=this.Private_GetElement(SvgPartsEnum.ClipEllipse);if(a==null){a=SvgCreator.AddEllipse(this.ClipX+this.ClipWidth/2,this.ClipY+this.ClipHeight/2,this.ClipWidth/2,this.ClipHeight/2,"black","red","4,4",".25",this.Private_GetId(SvgPartsEnum.ClipEllipse));b.appendChild(a)}break}};SvgState.prototype.GiveSvgId=function(){var a=this.Private_GetPointer(SvgPartsEnum.SvgImage);if(a===null||a.length==0){natural.children().first().attr("id",this.Private_GetId(SvgPartsEnum.SvgImage))}};SvgState.prototype.Private_ClearMetaData=function(){var a=$("#"+this.Id).find("sbtdata");if(a.length==0){return}a.remove()};SvgState.prototype.Private_ResetNaturalOffset=function(){var d=this.Private_GetElement(SvgPartsEnum.Natural);var a=d.getBBox();var b=this.NaturalOffsetX-a.x;var c=this.NaturalOffsetY-a.y;this.NaturalOffsetX=a.x;this.NaturalOffsetY=a.y;if(this.FlipHorizontal){b*=-1}this.X-=(b*this.ScaleX);this.Y-=(c*this.ScaleY)};SvgState.prototype.Private_CopySmartSceneState=function(a){if(a==null){return}this.SmartSceneState.CopySmartSceneState(a,this.ColorableState)};SvgState.prototype.Private_CopyPosableState=function(a){if(a==null){return}a.Position=a.Position||this.Position;this.PosableState.Public_Copy(a)};SvgState.prototype.Public_IsPosable=function(){if(this.PosableState==null){return false}return this.PosableState.Public_IsPosable()};SvgState.prototype.Public_IsInstaPosable=function(){if(this.Public_IsPosable==false){return false}var a=this.PosableState.Public_PoseGroups();if(a==null||a.length<3){return false}return true};SvgState.prototype.Public_GetPoseGroups=function(){if(this.Public_IsPosable()==false){return null}return this.PosableState.Public_PoseGroups()};SvgState.prototype.Public_GetPreviousPoseList=function(){if(this.Public_IsPosable()==false){return null}return this.PosableState.Public_GetPreviousPoseList()};SvgState.prototype.Public_GetPoseGroupList=function(){var c=new Array();var d=this.Public_GetPoseGroups();for(var a=0;a<d.length;a++){var b=d[a];c.push({PoseType:b.PoseType,PoseId:b.Public_GetActiveOption().Public_GetInternalId()})}return c};SvgState.prototype.Public_UpdatePoseOption=function(a,b){if(this.Public_IsPosable()==false){return}this.PosableState.Public_UpdatePoseOption(a,b);this.Private_ResetNaturalOffset();this.Public_ResetColors();this.UpdateDrawing()};SvgState.prototype.Public_GetPose=function(a){if(this.Public_IsPosable()==false){return null}return this.PosableState.Public_GetPose(a)};SvgState.prototype.Public_GetSafePoseArray=function(a){if(a==null||this.Public_IsPosable()==false){return null}return this.PosableState.Public_GetSafePoseArray(a)};SvgState.prototype.Public_SetPreviousPoseList=function(a){if(this.Public_IsPosable()==false){return}this.PosableState.Public_SetPreviousPoseList(a)};SvgState.prototype.Public_BulkUpdatePoseGroups=function(b){if(b==null){return}for(var a=0;a<b.length;a++){var c=b[a].PoseGroup;var d=b[a].PoseOption;this.Public_UpdatePoseOption(c,d)}this.UpdateDrawing()};SvgState.prototype.Public_HandleCellExpansion=function(c,b,a){if(this.Movable==false){return}var k=c;var l=c;if(b!=null&&a!=null){var e=a.X/b.X;var j=a.Y/b.Y;var h=(a.X+a.Width)/(b.X+b.Width);var d=(a.Y+a.Height)/(b.Y+b.Height);var f=(e+h)/2;var g=(j+d)/2;if(this.X<b.X+b.Width*0.25){k=e}else{if(this.X>b.X+b.Width*0.25&&this.X<b.X+b.Width*0.75){k=f}else{if(this.X>b.X+b.Width*0.75){k=h}}}if(this.Y<b.Y+b.Height*0.25){l=j}else{if(this.Y>b.Y+b.Height*0.25&&this.Y<b.Y+b.Height*0.75){l=g}else{if(this.Y>b.Y+b.Height*0.75){l=d}}}}this.X*=k;this.Y*=l;this.ScaleX*=c;this.ScaleY*=c;this.UpdateDrawing()};SvgState.prototype.Public_update_ClipRegionByAdvancedCrop=function(){if(this.UseClipping&&this.CropType==CropTypeEnum.Advanced&&this.CropPolygonPoint.length>2){this.ClipX=this.CropPolygonPoint[0].x;this.ClipY=this.CropPolygonPoint[0].y;this.ClipWidth=this.CropPolygonPoint[0].x;this.ClipHeight=this.CropPolygonPoint[0].y;var a;for(a=1;a<this.CropPolygonPoint.length;a++){this.ClipX=Math.min(this.ClipX,this.CropPolygonPoint[a].x);this.ClipY=Math.min(this.ClipY,this.CropPolygonPoint[a].y);this.ClipWidth=Math.max(this.ClipWidth,this.CropPolygonPoint[a].x);this.ClipHeight=Math.max(this.ClipHeight,this.CropPolygonPoint[a].y)}this.ClipWidth-=this.ClipX;this.ClipHeight-=this.ClipY}};SvgState.prototype.Public_convert_RectangleToAdvanced=function(){if(this.UseClipping&&this.CropType==CropTypeEnum.Standard){this.CropType=CropTypeEnum.Advanced;this.CropPolygonPoint=new Array();this.CropPolygonPoint.push({x:this.ClipX,y:this.ClipY});this.CropPolygonPoint.push({x:this.ClipX,y:this.ClipY+this.ClipHeight});this.CropPolygonPoint.push({x:this.ClipX+this.ClipWidth,y:this.ClipY+this.ClipHeight});this.CropPolygonPoint.push({x:this.ClipX+this.ClipWidth,y:this.ClipY});this.CropPolygonPointJson=JSON.stringify(this.CropPolygonPoint)}};SvgState.prototype.getCropParam=function(){var a={Id:this.Id,X:this.X,Y:this.Y,Angle:this.Angle,ScaleX:this.ScaleX,ScaleY:this.ScaleY,FlipHorizontal:this.FlipHorizontal,FlipVertical:this.FlipVertical,UseClipping:this.UseClipping,CropType:this.CropType,FilterColorMode:this.FilterColorMode,opacity:this.opacity,ClipX:this.ClipX,ClipY:this.ClipY,ClipWidth:this.ClipWidth,ClipHeight:this.ClipHeight,CropPolygonPoint:new Array()};this.CropPolygonPoint.forEach(function(b){a.CropPolygonPoint.push(b)});return a};SvgState.prototype.setCropParam=function(b){this.X=b.X;this.Y=b.Y;this.Angle=b.Angle;this.ScaleX=b.ScaleY;this.ScaleY=b.ScaleY;this.FlipHorizontal=b.FlipHorizontal;this.FlipVertical=b.FlipVertical;this.UseClipping=b.UseClipping;this.CropType=b.CropType;this.FilterColorMode=b.FilterColorMode,this.opacity=b.opacity,this.ClipX=b.ClipX;this.ClipY=b.ClipY;this.ClipWidth=b.ClipWidth;this.ClipHeight=b.ClipHeight;this.CropPolygonPoint=[];var a=this.CropPolygonPoint;b.CropPolygonPoint.forEach(function(c){a.push(c)});this.CropPolygonPointJson=JSON.stringify(this.CropPolygonPoint)};function TextStateData(a){if(a===void 0){a={}}this.Text=a.Text||"";this.DefaultText=a.DefaultText||"";this.Html=a.Html||"";this.VerticalAlignment=a.VerticalAlignment||"middle";this.Font=a.Font||MyBrowserProperties.Public_GetDefaultFont();this.FontSize=a.FontSize||"10";this.FontColor=a.FontColor||"000000";this.TextAlignment=a.TextAlignment||"middle";this.Textable=a.Textable||false;this.TextOffsetLeft=a.TextOffsetLeft||0;this.TextOffsetRight=a.TextOffsetRight||0;this.TextOffsetTop=a.TextOffsetTop||0;this.Private_IdTextableRectangle=a.Private_IdTextableRectangle||"";this.Private_RevertColor=a.Private_IdTextableRectangle||"";this.RemovalId=a.RemovalId||null;this._QuillDeltas=a._QuillDeltas||null}function TextState(a,c){var b;if(c!==void 0){b=new TextStateData(c)}else{b=new TextStateData()}this.Private_ShapeId=a;this.D=new Array();this.D.push(b);this.CurrentId=0;this.CopyFontStyles(this.D[0]);this.Private_CheckForMetaData(a)}TextState.prototype.Public_ClearDefaults=function(){if(UseInlineEditor){return false}if(this.D[this.CurrentId].DefaultText==null||this.D[this.CurrentId].DefaultText==""){return false}if(this.D[this.CurrentId].Text!=this.D[this.CurrentId].DefaultText){return false}if(UseSummerNote){SbtSummerNoteHelper.ResetToDefaults();this.Public_SetQuillDeltas(SbtSummerNoteHelper.GetDeltas())}this.D[this.CurrentId].Text="";return true};TextState.prototype.Public_GetSavedFontColor=function(){if(this.D[this.CurrentId].Private_RevertColor!=""){return this.D[this.CurrentId].Private_RevertColor}return this.D[this.CurrentId].FontColor};TextState.prototype.Public_SetFontColor=function(a,b){if(this.D[this.CurrentId].Private_RevertColor===""){this.D[this.CurrentId].Private_RevertColor=this.D[this.CurrentId].FontColor}if(b===false){this.D[this.CurrentId].Private_RevertColor=a}this.D[this.CurrentId].FontColor=a};TextState.prototype.Public_ResetFontColor=function(){if(this.D[this.CurrentId].Private_RevertColor!=null&&this.D[this.CurrentId].Private_RevertColor!=""){this.D[this.CurrentId].FontColor=this.D[this.CurrentId].Private_RevertColor}};TextState.prototype.Public_GenerateQuillForOneLiner=function(d,c,e,a,b){if(UseSummerNote){this.Public_SetQuillDeltas(SbtSummerNoteHelper.GenerateQuillForOneLiner(d,c,e,a,b))}};TextState.prototype.Public_ConvertToQuill=function(){if(UseInlineEditor){return}var a="";if(this.D[this.CurrentId].TextAlignment=="middle"){a="center"}else{if(this.D[this.CurrentId].TextAlignment=="end"){a="right"}}var b=this.D[this.CurrentId].FontColor===""?"black":this.D[this.CurrentId].FontColor;if(UseSummerNote){try{a=a==""?"left":a;SbtSummerNoteHelper.ResetToDefaults();var f='<p style="text-align:'+a+"; color:"+b+";font-family: "+this.D[this.CurrentId].Font.replaceAll2('"',"'")+"; font-size:"+this.D[this.CurrentId].FontSize+'pt;">';var g=this.D[this.CurrentId].Text.replaceAll2("\n\n\n","\n\n").replaceAll2("\n","</p>"+f);g=f+g+"</p>";SbtSummerNoteHelper.UpdateForHtml(g);this.Public_SetQuillDeltas(SbtSummerNoteHelper.GetDeltas());if(this.Public_GetQuillDeltas()==null){try{LogErrorMessage("Post Conversion - Quill is NULL - "+this.D[this.CurrentId].Text)}catch(d){LogErrorMessage("Post Conversion - Quill is NULL - ERROR",d)}}SbtSummerNoteHelper.ResetToDefaults()}catch(c){try{LogErrorMessage("Public_ConvertToQuill Text "+this.D[this.CurrentId].Text,c)}catch(d){LogErrorMessage("Public_ConvertToQuill Error Fallback",d)}}}};TextState.prototype.Public_GetTextArea=function(a,h,i,e,f,d){var b=new Object();if(this.D[this.CurrentId].Private_IdTextableRectangle!=null&&this.D[this.CurrentId].Private_IdTextableRectangle.length>0){var j=$("#"+this.D[this.CurrentId].Private_IdTextableRectangle);var n=Number(j.attr("x"));var o=Number(j.attr("y"));var m=Number(j.attr("width"));var c=Number(j.attr("height"));b.Left=(n-e)*h;b.Width=m*h;b.Top=(o-f)*i;b.Height=c*i;if(d){var k=GetGlobalById(this.D[this.CurrentId].Private_IdTextableRectangle);var g=$(k).parent().attr("id");var l=SvgCreator.GetTransform(g);b.Width*=l.Scale[0];b.Height*=l.Scale[1]}}else{var m=a.width;var c=a.height;b.Left=m*this.D[this.CurrentId].TextOffsetLeft;b.Top=(c*this.D[this.CurrentId].TextOffsetTop);b.Width=(m*this.D[this.CurrentId].TextOffsetRight)-b.Left;b.Height=Infinity}return b};TextState.prototype.Public_SetQuillDeltas=function(b,c){this.D[this.CurrentId]._QuillDeltas=SbtLib.DeepCopy(b);try{if(c==null||c==false){if(this.D[this.CurrentId]._QuillDeltas==null){if(b==null){LogErrorMessage("_Quill deltas is null, and quilldeltas was null")}else{LogErrorMessage("_Quill deltas is null, and quilldeltas was NOT null",{message:"quillDeltas: "+JSON.stringify(b),stack:""})}}}}catch(a){LogErrorMessage("Public_SetQuillDeltas - errors",a)}};TextState.prototype.Public_GetTextableCount=function(){return this.D.length};TextState.prototype.Public_GetQuillDeltas=function(){return this.D[this.CurrentId]._QuillDeltas};TextState.prototype.Public_GetQuillDeltas_ByTextableIndex=function(a){return this.D[a]._QuillDeltas};TextState.prototype.Public_SummerNote_SetFontSizeAndColor=function(c,a){if(UseInlineEditor){return}var b=SbtSummerNoteHelper.Deltas_UpdateFontSizeAndColor(this.Public_GetQuillDeltas(),c,a);this.Public_SetQuillDeltas(b);if(b==null){LogErrorMessage("SbtSummerNoteHelper.OnChange: Deltas null ")}};TextState.prototype.Public_QuillSetFontColor=function(a){quill.setContents(this.Public_GetQuillDeltas().Public_GetQuillDeltas());quill.formatText(0,1000,"color",a);this.Public_SetQuillDeltas(quill.getContents().ops)};TextState.prototype.Public_QuillSetFontSize=function(a){quill.setContents(this.Public_GetQuillDeltas());quill.formatText(0,1000,"size",a.toString());this.Public_SetQuillDeltas(quill.getContents().ops)};TextState.prototype.Public_GetFontStyles=function(){var a=new Object();a.Text=this.D[this.CurrentId].Text;a.DefaultText=this.D[this.CurrentId].DefaultText;a.Font=this.D[this.CurrentId].Font;a.FontSize=this.D[this.CurrentId].FontSize;a.FontColor=this.D[this.CurrentId].FontColor;a.TextAlignment=this.D[this.CurrentId].TextAlignment;a.Textable=this.D[this.CurrentId].Textable;a._QuillDeltas=SbtLib.DeepCopy(this.D[this.CurrentId]._QuillDeltas);return a};TextState.prototype.CopyFontStyles=function(a){this.D[this.CurrentId].Text=a.Text;this.D[this.CurrentId].DefaultText=a.DefaultText;this.D[this.CurrentId].Font=this.UpdateOldFont(a.Font);this.D[this.CurrentId].FontSize=a.FontSize;this.D[this.CurrentId].FontColor=a.FontColor;this.D[this.CurrentId].TextAlignment=a.TextAlignment;this.D[this.CurrentId].Textable=a.Textable;if(this.D[this.CurrentId].Text!=null&&this.D[this.CurrentId].Text!=""){this.D[this.CurrentId].Textable=true}if(UseQuill||UseSummerNote||UseInlineEditor){this.D[this.CurrentId]._QuillDeltas=a._QuillDeltas;if(this.D[this.CurrentId]._QuillDeltas==null&&a.Textable==true){this.Public_ConvertToQuill()}}};TextState.prototype.Copy=function(e){var b;var f=e;if(e.D===void 0){var e=new TextState(void (0),e)}for(b=0;b<e.D.length;b++){if(this.D.length<b+1){var a=new TextStateData();this.D.push(a)}this.CurrentId=b;this.CopyFontStyles(e.D[b]);this.D[this.CurrentId].Textable=e.D[b].Textable;this.D[this.CurrentId].TextOffsetLeft=e.D[b].TextOffsetLeft;this.D[this.CurrentId].TextOffsetRight=e.D[b].TextOffsetRight;this.D[this.CurrentId].TextOffsetTop=e.D[b].TextOffsetTop;if(e.D[b].Private_IdTextableRectangle!=null&&e.D[b].Private_IdTextableRectangle.length>0){this.D[this.CurrentId].Private_IdTextableRectangle=this.Private_ShapeId+"_TextBoxArea"+b;var c=$("#"+this.Private_ShapeId);var d=c.find("[id="+e.D[b].Private_IdTextableRectangle+"]");d.attr("id",this.D[this.CurrentId].Private_IdTextableRectangle)}this.D[this.CurrentId].RemovalId=e.D[b].RemovalId;this.D[this.CurrentId].Html=e.D[b].Html;this.D[this.CurrentId].VerticalAlignment=e.D[b].VerticalAlignment}this.CurrentId=e.CurrentId};TextState.prototype.UpdateOldFont=function(b){try{return FontList.SubstituteObsoleteFont(b)}catch(a){LogErrorMessage("TextState.UpdateFont",a)}return b};TextState.prototype.Private_CheckForMetaData=function(a){var b=$("#"+a).find("sbtdata");if(b.length==0){return}var d=b.find("textoffset");if(d.length>0){this.Private_HandleOldTextables(d)}var c=b.find("textable");if(c.length>0){this.Private_HandleTextable(c)}this.Private_CheckForRemovals(b)};TextState.prototype.Private_HandleTextable=function(h){this.D[0].Textable=true;var g=$("#"+this.Private_ShapeId);for(var f=0;f<h.length;f++){if(!this.D[f]){this.D[f]=new TextStateData()}this.D[f].Private_IdTextableRectangle=h[f].getAttribute("textarea");var j=g.find("[id="+this.D[f].Private_IdTextableRectangle+"]");if(j!=null){this.D[f].Private_IdTextableRectangle=this.Private_ShapeId+"_TextBoxArea"+f;j.attr("id",this.D[f].Private_IdTextableRectangle)}var e=h[f].getAttribute("text");if(e!=null&&MyLangMap.GetTextByToken(e)!=null&&MyLangMap.GetTextByToken(e)!=""){e=MyLangMap.GetTextByToken(e);var d=h[f].getAttribute("size");var a=h[f].getAttribute("align");var c=h[f].getAttribute("font");var b=h[f].getAttribute("color");this.CurrentId=f;this.D[this.CurrentId].Text=e;this.Public_GenerateQuillForOneLiner(e,d,a,c,b)}}this.CurrentId=0};TextState.prototype.Private_HandleOldTextables=function(a){this.D[this.CurrentId].Textable=true;this.D[this.CurrentId].TextOffsetLeft=a.find("left").first().text();this.D[this.CurrentId].TextOffsetRight=a.find("right").first().text();this.D[this.CurrentId].TextOffsetTop=a.find("top").first().text()};TextState.prototype.Private_CheckForRemovals=function(a){var b=a.find("removetext");if(b.length==0){return}this.D[this.CurrentId].RemovalId=b.first().text()};function WordRun(){this.TextRuns=[];this.Width=0;this.Height=0;this.IsSpace=false;this.IsLineBreak=false;this.Alignment="left"}WordRun.prototype.AddTextRun=function(a){this.TextRuns.push(a);this.Width+=a.Width;this.Height=Math.max(a.Height,this.Height)};var WordRunHelper=function(){var e=new Object();e.GetWordRuns=function(g,n){var r=[];var f=null;for(var h=0;h<g.length;h++){var p=d(g[h]);var m=g[h].insert;if(g[h].insert.image!==undefined){continue}m=m.replaceAll2("\r\n","\n");m=m.replaceAll2("\r","\n");var k=m.split(/(\n)/g);for(var j=0;j<k.length;j++){if(k[j]===""){continue}var s=k[j].split(/( )/g);for(var q=0;q<s.length;q++){if(s[q]===""){continue}if(s[q]==="\n"){if(f!=null){r.push(f)}f=new WordRun();f.IsLineBreak=true;f.Alignment=p.Alignment===""||p.Alignment==="left"?f.Alignment:p.Alignment;r.push(f);f=null}else{if(s[q]===" "){if(f!=null){r.push(f)}f=new WordRun();f.IsSpace=true;var o=c(p,n,s[q]);o.Width=b(p,n);f.AddTextRun(o);r.push(f);f=null}else{if(f===null){f=new WordRun()}var o=c(p,n,s[q]);f.AddTextRun(o)}}}}}if(f!=null){r.push(f)}$(n).children().remove();return r};function b(g,f){return c(g,f,"X X").Width-c(g,f,"XX").Width}function c(k,i,h){var j=new Object();j.TextStyle=k;j.Tspan=a(h,j.TextStyle);i.appendChild(j.Tspan);j.Width=h.length*12;j.Height=12;try{var f=j.Tspan.getClientRects()[0];if(f==null){}else{j.Width=f.width;j.Height=(f.height)}}catch(g){LogErrorMessage("WordRun.GetTextRun: "+h,g)}$(i).children().remove();return j}function d(f){var h=new Object();h.Font=MyBrowserProperties.Public_GetDefaultFont();h.Color="Black";h.Bold=false;h.Italic=false;h.Strike=false;h.UnderLine=false;h.FontSize=10;h.Alignment="left";h.Shift="";try{if(f.attributes==null){return h}h.Bold=f.attributes.bold==null?false:f.attributes.bold;h.Italic=f.attributes.italic==null?false:f.attributes.italic;h.Strike=f.attributes.strike==null?false:f.attributes.strike;h.UnderLine=f.attributes.underline==null?false:f.attributes.underline;h.Color=f.attributes.color==null?"black":f.attributes.color;h.Alignment=f.attributes.align;h.Font=f.attributes.font==null?h.Font:f.attributes.font;h.FontSize=f.attributes.size==null?h.FontSize:f.attributes.size;h.Shift=f.attributes.script==null?h.Shift:f.attributes.script;h.Font=h.Font.replaceAll2("_"," ").replaceAll2('"',"").replaceAll2("'","");if(h.Font.indexOf(" ")>=0){h.Font='"'+h.Font+'"'}}catch(g){LogErrorMessage("WordRun.GetTextStyle:",g)}return h}function a(i,j){var h="";h+="font-family:"+j.Font+";";h+="fill: "+j.Color+";";if(EnableBold){if(j.Bold){h+="font-weight:bold;"}if(j.Italic){h+="font-style:italic;"}}if(j.Shift=="sub"){h+="font-size:"+(j.FontSize*0.75)+"pt;";h+="baseline-shift: sub; "}else{if(j.Shift=="super"){h+="font-size:"+(j.FontSize*0.75)+"pt;";h+="baseline-shift: super; "}else{h+="font-size:"+j.FontSize+"pt;"}}if(j.UnderLine){if(j.Strike){h+="text-decoration: underline, line-through;"}else{h+="text-decoration: underline;"}}else{if(j.Strike){h+="text-decoration: line-through;"}}var g=document.createElementNS("http://www.w3.org/2000/svg","tspan");g.setAttributeNS(null,"style",h);g.setAttributeNS(null,"class","DisableSelection");var f=document.createTextNode(i);g.appendChild(f);return g}return e}();var WordRunRenderHelper=function(){var c=new Object();c.OneLineOffset=1.075;c.RenderText=function(l,B,E,n,o,d){if(l==null||l.length==0){return}while(l.length>2&&l[l.length-1].insert=="\n"){l.pop()}var g="";var u=0;var f=0;var x=-1*d;E.children().remove();var z=B.Left;var A=B.Top;var w=B.Width+z;var J=B.Height;if(J=="Infinity"){J=100}var C=a(z,w,A,"",null,0,false,x);E.append(C);var M=WordRunHelper.GetWordRuns(l,C);if(M==null||M.length==0){try{LogErrorMessage("RenderText.Wordruns are null...",{message:"Deltas: "+JSON.stringify(l),stack:""})}catch(m){LogErrorMessage("RenderText.Wordruns are null.On logging errors",m)}}var h=z;var k=A;var v=1;var s=1.1;E.children().remove();var D=[];C=a(z,w,A,"",M,0,n,x);E.append(C);for(var p=0;p<M.length;p++){var L=M[p];var H=L.TextRuns;if(L==null){try{LogErrorMessage("Word run is null...",{message:"Deltas: "+JSON.stringify(l)+" word runs: "+JSON.stringify(M),stack:""})}catch(m){LogErrorMessage("Word run is null... Error on debug info",m)}continue}if(L.IsLineBreak){v++;if(C.clientHeight==0){k+=10}else{k+=C.clientHeight*s}h=z;if(UseSummerNote&&p==0){}else{D.push(C);C=a(z,w,k,"",M,p,n,x);E.append(C)}continue}if(h!=z&&h+L.Width*CellPickerHelper.Props.WidthRatio>w){v++;k+=C.clientHeight*s;h=z;D.push(C);C=a(z,w,k,"",M,p,n,x);E.append(C)}if(L.IsSpace&&h==z){continue}for(var q=0;q<L.TextRuns.length;q++){var G=H[q];C.appendChild(G.Tspan);h+=G.Width*CellPickerHelper.Props.WidthRatio}}D.push(C);var K=0;var r=10;var I=0;var t=0.8*CellPickerHelper.Props.WidthRatio;for(var p=0;p<D.length;p++){if(p===D.length-1&&D[p].innerHTML===""){continue}if(D[p].innerHTML!=""){K+=(D[p].getBoundingClientRect().height*t);r=(D[p].getBoundingClientRect().height*t);I++}else{K+=r}}var y=A;if(o){y=-1*(B.Top+(B.Height))}if(K<J){y+=(J-K)/2}else{if(I===1&&K*0.7<J){K*=WordRunRenderHelper.OneLineOffset;y+=(J-K)/2}else{var F=(D[0].getBoundingClientRect().height*t);y-=F*0.25}}r=10;for(var p=0;p<D.length;p++){var F=(D[p].getBoundingClientRect().height*t);if(F===0){F=r}else{r=F}y+=F*0.8;D[p].removeAttributeNS(null,"transform");D[p].setAttributeNS(null,"y",y);y+=F*0.1}};function b(f){var d=new Object();var h=Number(f.attr("x"));var i=Number(f.attr("y"));var g=Number(f.attr("width"));var e=Number(f.attr("height"));d.Left=h;d.Width=g;d.Top=i;d.Height=e;return d}function a(o,l,s,k,q,f,h,m){m=m||0;var r=o;var d="";var p="";if(UseSummerNote){if(q!=null&&q.length>0){for(var j=f;j>=0;j--){if(q[j]==null){try{LogErrorMessage("CreateTextBlock.Word run is null...",{message:"word runs: "+JSON.stringify(q),stack:""})}catch(g){LogErrorMessage("CreateTextBlock.Word run is null... Error on debug info",g)}continue}if(q[j].IsLineBreak){d=q[j].Alignment;break}}if(d===""){for(var j=f;j<q.length;j++){if(q[j]==null){try{LogErrorMessage("CreateTextBlock.2.Word run is null...",{message:"word runs: "+JSON.stringify(q),stack:""})}catch(g){LogErrorMessage("CreateTextBlock.2.Word run is null... Error on debug info",g)}continue}if(q[j].IsLineBreak){d=q[j].Alignment;break}}}}}if(UseQuill){if(q!=null){for(var j=f+1;j<q.length;j++){if(q[j].IsLineBreak){d=q[j].Alignment;break}}}}d=d===""?"center":d;if(h){if(d=="right"){r=-1*o;p="text-anchor: end;"}else{if(d=="center"){r=-1*(o+l)/2;p="text-anchor: middle;"}else{p="text-anchor: start;";r=-1*l}}}else{if(d=="right"){r=l;p="text-anchor: end;"}else{if(d=="center"){r=(o+l)/2;p="text-anchor: middle;"}else{p="text-anchor: start;"}}}var n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttributeNS(null,"x",r);n.setAttributeNS(null,"y",s);n.setAttributeNS(null,"style",p);n.setAttributeNS(null,"transform","rotate("+m+")");if(k!=null&&k!=""){n.setAttributeNS(null,"id",k)}return n}return c}();function CellSorter(){this.Public_ShowCellSorterDialog=function(){ClearActiveState();MyPointers.Dialog_ReorderCells_Grid.children().remove();MyPointers.Dialog_ReorderCells_Grid.css("width",(StoryboardContainer.Cols*54)+"px");MyPointers.Dialog_ReorderCells_GridWrapper.css("width",((StoryboardContainer.Cols*54)+6)+"px").css("height",((StoryboardContainer.Rows*54)+6)+"px");var b=StoryboardContainer.Cols*StoryboardContainer.Rows;for(var a=0;a<b;a++){MyPointers.Dialog_ReorderCells_Grid.append('<li class="ui-state-default" id="reorder_cell_'+(a+1)+'">'+(a+1)+"</li>")}MyPointers.Dialog_ReorderCells.modal()};this.Public_RearrangeCells=function(){var f=0;var g=[],j=[];for(var h=0;h<StoryboardContainer.Rows;h++){for(var e=0;e<StoryboardContainer.Cols;e++){var a=MyPointers.Dialog_ReorderCells_Grid.children()[f];var b=a.getAttribute("id");b=b.replace("reorder_cell_","");b-=1;var c=b%StoryboardContainer.Cols;var d=Math.floor(b/StoryboardContainer.Cols);g.push({oldCol:c,oldRow:d,newCol:e,newRow:h});j.push({oldCol:e,oldRow:h,newCol:c,newRow:d});f++}}UndoManager.register(undefined,UndoRearrangeCells,[j],"",undefined,UndoRearrangeCells,[g],"");this.Public_ApplyRearrangeCells(g);MyPointers.Dialog_ReorderCells.modal("hide")};this.Public_ApplyRearrangeCells=function(e){var d=0;StoryboardContainer.Public_ChangeCellOrder(e);if(CellConfiguration.HasTitle||CellConfiguration.HasDescription){var f=null;var b=null;if(CellConfiguration.HasTitle){f=this.Private_GetTextableGrid(MyIdGenerator.GenerateTitleCellId)}if(CellConfiguration.HasDescription){b=this.Private_GetTextableGrid(MyIdGenerator.GenerateDescriptionCellId)}for(d=0;d<e.length;d++){var a=e[d];if(a.newCol!=a.oldCol||a.newRow!=a.oldRow){if(CellConfiguration.HasTitle){var g=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateTitleCellId(a.newRow,a.newCol));this.Private_MoveUnmovableText(g,f[a.oldCol][a.oldRow])}if(CellConfiguration.HasDescription){var c=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateDescriptionCellId(a.newRow,a.newCol));this.Private_MoveUnmovableText(c,b[a.oldCol][a.oldRow])}}}}};this.Private_MoveUnmovableText=function(b,a){if(b==null||a==null){return}b.TextState.CopyFontStyles(a.TextStyles);b.ColorableState.Public_CopyColorStyles(a.ColorStyles);b.UpdateDrawing()};this.Public_CancelRearrangeCells=function(){MyPointers.Dialog_ReorderCells.modal("hide")};this.Private_GetTextableGrid=function(h){var c=new Array();try{for(var a=0;a<StoryboardContainer.Cols;a++){c[a]=new Array();for(var f=0;f<StoryboardContainer.Rows;f++){var d=h(f,a);var g=new Object();g.TextStyles=MyShapesState.Public_GetShapeStateById(d).TextState.Public_GetFontStyles();g.ColorStyles=MyShapesState.Public_GetShapeStateById(d).ColorableState.Public_GetColorStyles();c[a][f]=g}}}catch(b){}return c}};var UseFakeSpectrum=true;function ColorUpdaterBox(){this.Private_ActiveShapeId="";this.Private_ColorTable=$("#ColorUpdaterBoxTable");this.Public_PrepColorControls=function(a){var b=false;if(a.Id!=this.Private_ActiveShapeId){b=true}if(MyPointers.Controls_UpdateColor.css("display")==="none"){b=true}if(b){this.Private_AddColors(a)}else{this.Private_UpdateColors(a)}this.Private_ActiveShapeId=a.Id;this.MakeVisible()};this.HideUpdateColors=function(){var a=MyPointers.Controls_UpdateColor.css("display");if(a!="none"){MyPointers.Controls_UpdateColor.css("display","none");$(".sp-container").remove()}};this.MakeVisible=function(){MyPointers.Controls_UpdateColor.css("display","inline-block")};this.Private_UpdateColors=function(b){var p=b.Public_GetColorRegions();for(var k=0;k<p.length;k++){var a=b.Public_GetColorForRegion(p[k]);var o=p[k];if(o==""){continue}try{var c="ColorSelector_"+o+"_color_picker";var h=$("#"+c+"_selector_background");if(h.length>0){if(h.attr("style").indexOf(a)<0){h.css("background-color",a)}}else{var n=$("#"+c);if(n.spectrum("container").attr("class").indexOf("hidden")>0){n.spectrum("set",a)}}var d=a.replaceAll2(" ","");for(var m=1;m<7;m++){var l=this.Private_GenerateColorCellId(o,m);var f=document.getElementById(l);fastEmpty(f);if(f.getAttribute("style").replaceAll2(" ","").indexOf(d)>0){f.innerHTML=this.Private_GenerateColoredX(a)}}}catch(g){}}};this.Private_AddColors=function(b){var n,h;try{fastEmpty(document.getElementById("ColorUpdaterBoxTable"));$("body > .sp-container").remove();n=b.Public_GetColorRegions();for(h=0;h<n.length;h++){if(n[h]==""){continue}var f=b.Public_GetColorWheelForRegion(n[h]);var a=b.Public_GetColorForRegion(n[h]);if(f==null||f==undefined){var g=new Object();g.message="No palette: "+n[h];g.stack="";LogErrorMessage("Private_AddColors: No Color",g);continue}var o=b.Public_GetTitleForRegion(n[h]);if(o==null||o==""||o==undefined){o=f.GetTitle()}var m="";if(h>0){m="<tr>";m+='<td colspan="7" class="BufferRow"></tr>';m+="</tr>"}m+="<tr>";m+='<td  class="ColorPickerTitleCell">'+o+"</td>";m+="<td>";m+='<table class="color-selection-block">';m+="<tr>";m+=this.Private_GenerateColorCell(n[h],1,f.Color1,a);m+=this.Private_GenerateColorCell(n[h],2,f.Color2,a);m+=this.Private_GenerateColorCell(n[h],3,f.Color3,a);m+=this.Private_GenerateColorCell(n[h],4,f.Color4,a);m+=this.Private_GenerateColorCell(n[h],5,f.Color5,a);m+=this.Private_GenerateColorCell(n[h],6,f.Color6,a);m+="</tr>";m+="</table>";m+="</td>";m+=this.Private_GenerateColorPickerCell(n[h],a);m+="</tr>";this.Private_ColorTable.append(m);for(j=0;j<=6;j++){var k=this.Private_GenerateColorCellId(n[h],j);$("#"+k).click(UpdateColorRegion)}var l=$("#ColorSelector_"+n[h]+"_color_picker");if(UseFakeSpectrum){l.css("display","none");l.addClass("fake-spectrum");var d="ColorSelector_"+n[h]+"_color_picker_selector";var c=d+"_background";l.parent().append('<div id="'+d+'" class="sp-replacer sp-light"><div class="sp-preview"><div id="'+c+'" class="sp-preview-inner" style="background-color: '+a+';"></div></div><div class="sp-dd">'+DOWN_ARROW_STRING+"</div></div>");$("#"+d).one("click",this._AddSpectrumClosure(l))}else{l.spectrum({color:a,showInput:true,showAlpha:false,showPalette:true,localStorageKey:"StoryboardThat",clickoutFiresChange:true,showInitial:true,change:UpdateColorRegionFromColorPicker,move:UpdateColorRegionFromColorPickerPreview,hide:UpdateColorRegionFromColorPickerHide})}}}catch(g){throw g+" - Debug: "+h+", "+n.join(",")}};this._AddSpectrumClosure=function(a){return function(){var b=a.parent().find(".sp-preview-inner").css("background-color");a.parent().children()[1].remove();a.removeClass("fake-spectrum");a.spectrum({color:b,showInput:true,showAlpha:false,showPalette:true,localStorageKey:"StoryboardThat",clickoutFiresChange:true,showInitial:true,change:UpdateColorRegionFromColorPicker,move:UpdateColorRegionFromColorPickerPreview,hide:UpdateColorRegionFromColorPickerHide});window.setTimeout(function(){a.spectrum("show")},25)}};this.Private_GenerateColorPickerCell=function(c,a){var b="ColorSelector_"+c+"_color_picker";return'<td  class="ColorPickerInput"><input id="'+b+'" type="text" /></td>'};this.Private_GenerateColorCell=function(f,c,d,a){var e=this.Private_GenerateColorCellId(f,c);var b="<td>";b+='<div id="'+e+'" class="ColorPickerCell" style=" background-color: '+d+'; ">';if(a.replaceAll2(" ","")===d.replaceAll2(" ","")){b+=this.Private_GenerateColoredX(a)}b+="</div></td>";return b};this.Private_GenerateColorCellId=function(b,a){return"ColorSelector_div_"+b+"_cell_"+a};this.Private_GenerateColoredX=function(a){try{if(a===null){return""}var d=a.luma();var b=(d>=165)?"000":"fff";return'<span class="selected-color-x" style="color:#'+b+'">X</span>'}catch(c){return""}}};function LoadHelpTopic(a){MyPointers.HelpTopicArea.load(a);trackVirtualPageView(a)};function MainControlsBox(){var h=this;var i=false;var g=null;var f;this.TextControls=new TextControlsBox();this.ColorUpdateControls=new ColorUpdaterBox();this.CurrentShapeIsMultiTextable=false;var a=function(){var m=undefined;var n=undefined;var p=undefined;var j=undefined;var o=MyShapesState.Public_GetAllSelectedShapeStates();for(var l=0;l<o.length;l++){var k=o[l].Public_GetImaginaryOuterBox();if(m===undefined){m=k.Left;n=k.Right;p=k.Top;j=k.Bottom}m=Math.min(m,k.Left);n=Math.max(n,k.Right);p=Math.min(p,k.Top);j=Math.max(j,k.Bottom)}return{X:m,Y:p,Width:n-m,Height:j-p}};var e=function(j){MyPointers.Controls_ShapeControls.css("display","none");h.TextControls.HideTextControlsBox(j);h.ColorUpdateControls.HideUpdateColors()};var d=function(){MyPointers.Controls_MultiShapeControls.css("display","none")};var b=function(){var k=a();var v=k.X;var w=k.Y;var u=k.Width;var q=k.Height;var r=45;var s=MyPointers.Tabs.width()-r;v+=u+r;var n=MyPointers.Controls_MultiShapeControls.width();var t=v+n;var o=document.getElementById("CoreSvg").getBoundingClientRect();var p=(o.width-2);if(t>(MyPointers.SvgContainer.width()+MyPointers.SvgContainer.scrollLeft())||(t>p&&t>MyPointers.SvgContainer.width())){v=k.X-r-n}if(w<MyPointers.SvgContainer.scrollTop()){w=MyPointers.SvgContainer.scrollTop()+10}var l=StoryboardXtoPageX(v);var m=StoryboardYtoPageY(w);MyPointers.Controls_MultiShapeControls.css("display","inline-block");MyPointers.Controls_MultiShapeControls.css("left",l);MyPointers.Controls_MultiShapeControls.css("top",m);if(MyBrowserProperties.IsSafari5||MyBrowserProperties.IsOldIE){$("#multiSelectControlsBoxTable tr.colorfilterrow").hide()}else{$("#multiSelectControlsBoxTable tr.colorfilterrow").show();var j=$("#multiSelectControlsBoxTable tr.colorfilterrow td.filter-dropdown-wrapper ul.dropdown-menu");j.parent().find("button.btn.btn-label").html(MyLangMap.GetTextByToken("text-filter-select")+' <span class="caret"></span>');j.find("li").removeClass("active")}};var c=function(){var B=MyShapesState.Public_GetFirstSelectedShapeState();var D=B.IsTextable();var v=B.IsMultiTextable();MainControlsBox.CurrentShapeIsMultiTextable=v;if(!UseInlineEditor){(D&&v)?$("#EditDivMultiTextable").show():$("#EditDivMultiTextable").hide()}OpacityHelper.setSliderValue(Math.round(B.opacity*100));if(B.isGroupObject){$("#UnGroupObject").show();$("#UnGroupRow").show()}else{$("#UnGroupObject").hide();$("#UnGroupRow").hide()}if(D&&(B.Id.startsWith("c_descr")||B.Id.startsWith("c_title"))){if(B.ColorableState.Private_Colorable===void 0){B.ColorableState.Private_Colorable=true}if(B.ColorableState.Regions===void 0){B.ColorableState.Regions={}}if(B.ColorableState.Regions.Textables===void 0){B.ColorableState.Regions.Textables="rgb(255, 255, 255)"}if(B.ColorableState.Titles===void 0){B.ColorableState.Titles={}}if(B.ColorableState.Titles.Textables===void 0){B.ColorableState.Titles.Textables="Fill"}}var w=B.Public_IsPosable();var C=B.Public_IsSmartScene();var k=B.Property_IsColorable();var u=B.Movable;var z=$("#EditPoseRow");var q=$("#EditItemOptionsRow");z.hide();q.hide();if(w){if(B.Public_IsInstaPosable()){z.show()}else{q.show()}}var r=$("#EditSceneRow");(C)?r.show():r.hide();if(B.isSceneItem){$("#filters-single-select .artpen-colors").show();$("#filters-single-select .black-out").hide()}else{$("#filters-single-select .artpen-colors").hide();$("#filters-single-select .black-out").show()}if(B.IsLocked==true){$("#lockButton").css("display","none");$("#unlockButton").css("display","")}else{$("#lockButton").css("display","");$("#unlockButton").css("display","none")}if(k){h.ColorUpdateControls.Public_PrepColorControls(B)}var j=a();var K=j.X;var L=j.Y;var F=j.Width;var s=j.Height;var m=MyPointers.Controls_AllShapeControls.width();var l=MyPointers.Controls_AllShapeControls.height();if(g===B.Id){if(!(f.x>(K+F)||(f.x+m)<K||f.y>(L+s)||(f.y+l)<L)){g=0}}if(g!==B.Id){var t=20;if(B.Angle%180>=45&&B.Angle%180<=135){t+=25}K+=F+t;L=L-l/2;g=0;f={x:K,y:L,width:F,height:s,margin:t,areaBox:j,controlsWidth:m,controlsHeight:l}}var H=MyPointers.SvgContainer.scrollLeft();var I=MyPointers.SvgContainer.width()+MyPointers.SvgContainer.scrollLeft();var n=document.getElementById("CoreSvg").getBoundingClientRect();var o=(n.width-2);var A=f.x+f.controlsWidth;if(A>I||(A>o&&A>MyPointers.SvgContainer.width())){f.x=f.areaBox.X-f.margin-f.controlsWidth;if(f.x<H){f.x=H+10}}var J=MyPointers.SvgContainer.scrollTop();var G=MyPointers.SvgContainer.height()+MyPointers.SvgContainer.scrollTop();if(f.y<J){f.y=J+10}if(f.y+f.controlsHeight>G){f.y=Math.max(J+10,G-f.controlsHeight)}MyPointers.Controls_AllShapeControls.css("display","block");MyPointers.Controls_AllShapeControls.css("left",StoryboardXtoPageX(f.x));MyPointers.Controls_AllShapeControls.css("top",StoryboardYtoPageY(f.y));if(u){MyPointers.Controls_ShapeControls.css("display","inline-block")}else{MyPointers.Controls_ShapeControls.css("display","none")}if(k){h.ColorUpdateControls.MakeVisible()}try{if(UseInlineEditor){if(D){SbtInlineEditorHelper.StartEditNode($("#"+B.Id+"_text"+SvgManipSelectedTextableIndex))}else{SbtInlineEditorHelper.EndEditNode()}}}catch(p){}if(D){if(!UseInlineEditor&&v){$("#EditDivMultiTextable").show()}else{if($("#textableControls").parent().attr("id")!=="textableControlsHome"){$("#textableControls").addClass("ControlsBox");var E=$("#textableControls").detach();$("#textableControlsHome").append(E)}$("#EditDivMultiTextable").hide();h.TextControls.PrepTextControls(MyPointers.Controls_TextableControls,B)}}if(MyBrowserProperties.IsSafari5||MyBrowserProperties.IsOldIE){$("#controlsBoxTable tr.colorfilterrow").hide();$("#single-select-filter-dropdown").hide()}};this.ToggleControlsBox=function(j){if(i){this.HideControlsBox(j);return false}else{this.DrawMainControlsBox();return true}};this.HideControlsBox=function(j){if(!i){if(j){h.TextControls.EndTextEdit()}return}else{try{MyPointers.Controls_AllShapeControls.draggable("destroy")}catch(k){}}d();e(j);i=false};this.DrawMainControlsBox=function(){if(!i){MyPointers.Controls_AllShapeControls.draggable({stop:function(k,m){var l=MyShapesState.Public_GetFirstSelectedShapeState();g=l.Id;f.x=PageXtoStoryboardX(m.position.left);f.y=PageYtoStoryboardY(m.position.top)},handle:".ControlsBox.draggable"})}var j=MyShapesState.Property_SelectedCount();if(j===0){return}if(j===1){d();c()}else{e(true);b()}i=true}};var MainWindowControls=function(){function a(){try{$("#help-btn").click(ShowHelpDialog);$("#undo-btn").click(Undo);$("#redo-btn").click(Redo);$("#addcell-btn").click(ChangeLayoutDialog);$("#movecell-btn").click(CellPickerHelper.StartMoveCell);$("#copycell-btn").click(CellPickerHelper.StartCopyCell);$("#bt-copy-cell-done").click(CellPickerHelper.Finish);$("#bt-copy-cell-undo").click(CellPickerHelper.UndoHelper);$("#change-storyboard-type-btn").click(ChangeStoryboardTypeDialog);$("#load-free-size-dialog-link").click(LoadFreeSizeDialog);$("#save-btn").click(function(){SaveHelper.SaveStoryboard(false,true,false);return false});$("#save-as-btn").click(function(){SaveHelper.SaveStoryboard(false,true,false);return false});$("#saveonly-btn").click(function(){SaveHelper.SaveStoryboard(true,true,true);return false});$("#savequit-btn").click(function(){SaveHelper.SaveStoryboard(false,true,true);return false});$("#save-choices-btn").click(function(){HandleMouseExit();setTimeout(function(){$("#SaveChoicesDialog").modal()},500)});$("#even-more-btn").click(function(){HandleMouseExit();setTimeout(function(){ShowAdvancedButtons()},500)});$("#cell-size-btn").click(ShowChangeCellSize);$("#gridlines-btn").click(ToggleGridLines);$("#title-caps-btn").click(GestureHelper.CapitalizeTitles);$("#title-emphasis-btn").click(GestureHelper.TitleEmphasis);$("#description-emphasis-btn").click(GestureHelper.DescriptionEmphasis);$("#fullscreen-btn").click(ToggleFullScreen);$("#clear-btn").click(DeleteAll)}catch(d){LogErrorMessage("MainWindowControls.BottomControls_ClickHandlers",d)}}function b(){try{$("#undo-btn").prop("disabled",true);$("#redo-btn").prop("disabled",true);if(ExtraSetup.EnableSaveButton==false){$("#save-btn, #saveonly-btn, #savequit-btn").prop("disabled",true);$("#saveAndContinueWrapper").hide();$("#saveOnlyWrapper").hide()}}catch(d){LogErrorMessage("MainWindowControls.BottomControls_ClickHandlers",d)}}var c=new Object();c.Init=function(){a();b()};return c}();var PosableTypeEnum={Character:1,SmartItem:2,};function PosableControlsBox(a,b){this.Private_ActiveShape=a;this.Private_PoseAreaSvg=$("#PoseAreaSvg");this.Private_PoseAreaOptions=$("#PoseOptions");this.Private_PositionSwap1=null;this.Private_PositionSwap2=null;this.Private_PoseWidth=275;this.Private_PoseHeight=500;this.Private_PartSize=45;this.Private_PoseAreaSize_SinglePose="675px";this.Private_PoseAreaSize_MultiPose="800px";this.Private_SidePoseHeight=114;this.Private_SidePoseWidth=205;this.Public_UndoInfo=null;this.Public_IsCancel=false;this.Private_PrepareDialog=function(c){var d=this;$("#character-poser-title").hide();$("#smart-item-title").hide();$("#pose-dialog-update-pose-button").hide();$("#pose-dialog-update-smart-item-button").hide();if(c==PosableTypeEnum.Character){$("#character-poser-title").show();$("#pose-dialog-update-pose-button").show()}else{if(c==PosableTypeEnum.SmartItem){$("#smart-item-title").show();$("#pose-dialog-update-smart-item-button").show()}}this.Private_SetPosableSizes();MyPointers.Dialog_PoseImage.one("shown.bs.modal",this.Private_PrepareShapePostModalClosure(d));this.Private_ShowAdditionalPositions(false);this.Private_PositionSwap1=this.Private_GetPositionSwapAreas("1");this.Private_PositionSwap2=this.Private_GetPositionSwapAreas("2");this.Private_ResetSvgAreas();this.Public_UndoInfo=new Object;this.Public_UndoInfo.UndoPosition=a.Position;this.Public_UndoInfo.UndoActivePoseList=a.Public_GetPoseGroupList();this.Public_UndoInfo.UndoPreviousPoseList=a.Public_GetPreviousPoseList();if(this.Private_ActiveShape.Public_IsInstaPosable()){$("#insta-pose-dialog-selector").show()}else{$("#insta-pose-dialog-selector").hide()}MyPointers.Dialog_PoseImage.modal();this.Public_IsCancel=false;this.Private_ResetInstaPoses()};this.Private_GetPositionSwapAreas=function(c){var d="#position-swap-"+c+"-";var e=new Object();e.SvgArea=$(d+"svg");e.TitleArea=$(d+"title");e.DivArea=$(d+"div");return e};this.Private_ShowAdditionalPositions=function(f){var c=$("#PoseAreaSize");var e=$("#position-divider");var d=$("#position-choices");if(f){c.css("width",this.Private_PoseAreaSize_MultiPose);e.show();d.show()}else{c.css("width",this.Private_PoseAreaSize_SinglePose);e.hide();d.hide()}};this.Private_ResetSvgAreas=function(){this.Private_PoseAreaSvg.children().remove();this.Private_PoseAreaOptions.children().remove();this.Private_PositionSwap1.SvgArea.children().remove();this.Private_PositionSwap2.SvgArea.children().remove()};this.Private_InstaPoseClosure=function(d,c){return function(){var f=d.Private_ActiveShape.Public_GetPose(c);var e=a.Public_GetSafePoseArray(f);d.Private_ActiveShape.Public_BulkUpdatePoseGroups(e);d.Private_ActiveShape.Public_SetPreviousPoseList(f);d.Private_RedrawActiveCharacter()}};this.Private_PrepareShapePostModalClosure=function(c){return function(d){c.Private_RedrawActiveCharacter();c.Private_DisplayPoseOptions();var f=c.Private_HandleAdditionalPositions(c);MyCharacterPosistionLibrary.GetCharacterPositions(c.Private_ActiveShape.GlobalImageId,f)}};this.Private_RedrawActiveCharacter=function(){SvgCloner.CloneSvg("PoseAreaSvg",a.Id,"Poser",this.Private_PoseWidth,this.Private_PoseHeight)};this.Private_UpdateColors=function(c){var k=this.Private_ActiveShape.ColorableState.Public_GetRegionList();for(var e=0;e<k.length;e++){var h=k[e];var g=this.Private_ActiveShape.ColorableState.Public_GetColorForRegion(h);var d="[id^="+h+"_]";var l=c.find(d);for(var f=0;f<l.length;f++){l[f].setAttributeNS(null,"fill",g)}}};this.Private_HandleAdditionalPositions=function(c){if(c==null){return function(d){}}return function(d){if(d==null){return}if(d.length==1){return}c.Private_ShowAdditionalPositions(true);var f=0;for(var e=0;e<d.length;e++){if(d[e].Position==c.Private_ActiveShape.Position){f=d[e].Order}}if(f==0){c.Private_AddCharacterPosition(c.Private_PositionSwap1,d[1]);c.Private_AddCharacterPosition(c.Private_PositionSwap2,d[2])}if(f==1){c.Private_AddCharacterPosition(c.Private_PositionSwap1,d[0]);c.Private_AddCharacterPosition(c.Private_PositionSwap2,d[2])}if(f==2){c.Private_AddCharacterPosition(c.Private_PositionSwap1,d[1]);c.Private_AddCharacterPosition(c.Private_PositionSwap2,d[0])}}};this.Private_AddCharacterPosition=function(i,k){var l=MyLangMap.GetTextByToken("ST-"+k.Title);var c=k.Svg;var h=k.Position;var j=SbtDataEnum.Id_DisplayOption+"_"+h;var e=SbtDataEnum.Id_DisplayOption+"_outer_"+h;var f=document.createElementNS("http://www.w3.org/2000/svg","g");f.setAttribute("id",e);i.SvgArea.append(f);var g=$("#"+e);StoryboardContainer.UpdateGradientIds(g);g.append(c);g.children()[0].setAttributeNS(null,"id",j);MyShapeMetaData.LookForMetaData(j);this.Private_UpdateColors($("#"+j));i.TitleArea.html(l);i.DivArea.attr("title",MyLangMap.GetTextByToken("text-character-position-change")+" "+l);var m=SbtMath.ScaleAndCenter(e,this.Private_SidePoseWidth,this.Private_SidePoseHeight,5,5);f.setAttributeNS(null,"transform","translate("+m.CenterX+", "+m.CenterY+") scale("+m.Scale+")");g.parent().attr("width",this.Private_SidePoseWidth+"px");g.parent().attr("height",this.Private_SidePoseHeight+"px");var d=function(n,o){return function(){var q=n.Private_ActiveShape.Public_GetPoseGroupList();var u=n.Private_ActiveShape.Public_GetPreviousPoseList();n.Private_ActiveShape.ChangeCharacterPosition(o);n.Private_ResetSvgAreas();n.Private_DisplayPoseOptions();var r=n.Private_ActiveShape;var t=r.PosableState.Public_GetSafePoseArray(u);r.Public_BulkUpdatePoseGroups(t);r.PosableState.Public_SetPreviousPoseList(q);var p=r.PosableState.Public_GetSafePoseArray(q);r.Public_BulkUpdatePoseGroups(p);n.Private_RedrawActiveCharacter();var s=n.Private_HandleAdditionalPositions(n);MyCharacterPosistionLibrary.GetCharacterPositions(n.Private_ActiveShape.GlobalImageId,s);return false}}(this,h);i.DivArea.off("click");i.DivArea.click(d)};this.Private_DisplayPoseOptions=function(){var c=this.Private_PoseAreaOptions;c.children().remove();var e=this.Private_ActiveShape.Public_GetPoseGroups();for(var d=0;d<e.length;d++){if(e[d].PoseType==SbtDataEnum.PoseType_Swap){this.Private_RenderCharacterSwapPose(c,e[d])}else{if(e[d].PoseType==SbtDataEnum.PoseType_Tilt){this.Private_RenderTiltPose(c,e[d])}else{if(e[d].PoseType==SbtDataEnum.PoseType_LibrarySwap){this.Private_RenderLibrarySwapPose(c,e[d])}}}}};this.Private_RenderTiltPose=function(j,r){j.append('<h3 class="PosableSelectionTitle">'+r.Title+"</h3>");var s=r.Public_GetTiltOptions();var w=r.Title.replaceAll(" ","")+"_wrapper_div";j.append('<div id="'+w+'" class="PosableSelectionArea"></div>');var n=GetGlobalById(r.Public_GetTiltableId());var m=n.getBBox();var p=m.x+(m.width/2);var q=m.y+(m.height/2);var h=$("#"+w);var o=$("#"+r.Public_GetPivotId());for(var k=0;k<s.length;k++){var t=s[k];var l=(r.Title+"_"+t.Degrees).replaceAll(" ","");var g=l+"_div";h.append('<div id="'+g+'" class="PosableSelection" title="'+t.Public_GetTitle()+'"></div>');var u=$("#"+g);var f=$("#"+r.Public_GetTiltableId()).clone();f.attr("transform","");var v=this.Private_CloneCenterAndCreateSvg(f,l,u,t.Degrees,p,q);var e=$("#"+v.InnerSvgId);var c=e.find("[id*="+r.Public_GetClearId()+"]").remove();var d=function(x,y,z,i){return function(){i.Public_UpdatePoseOption(y,z);x.Private_RedrawActiveCharacter()}}(this,r,t,this.Private_ActiveShape);$("#"+g).click(d)}};this.Private_RenderLibrarySwapPose=function(g,j){g.append('<h3 class="PosableSelectionTitle">'+j.Title+"</h3>");var l=j.Public_GetLibrarySwapOptions();var n=j.Title.replaceAll(" ","")+"_wrapper_div";g.append('<div id="'+n+'" class="PosableSelectionArea"></div>');var f=$("#"+n);for(var i in l){if(l.hasOwnProperty(i)){var k=l[i];var h=(j.Title+"_"+k.LibrarySwapId).replaceAll(" ","");var e=h+"_div";f.append('<div id="'+e+'" class="PosableSelection" title="'+k.Public_GetTitle()+'"></div>');var m=$("#"+e);var d=MyGlobalSwapLibrary.Public_GetSvgById(k.LibrarySwapId,this.Private_ActiveShape.Position).clone();this.Private_CloneCenterAndCreateSvg(d,h,m);RecursivelyUpdateChildrenIds(d,SbtDataEnum.GlobalLibraryId,SbtDataEnum.Id_DisplayOption);this.Private_UpdateColors(d);var c=function(p,q,r,o){return function(){o.Public_UpdatePoseOption(q,r);p.Private_RedrawActiveCharacter()}}(this,j,k,this.Private_ActiveShape);$("#"+e).click(c)}}};this.Private_RenderCharacterSwapPose=function(g,j){g.append('<h3 class="PosableSelectionTitle">'+j.Title+"</h3>");var l=j.Public_GetSwapOptions();var o=j.Title.replaceAll(" ","")+"_wrapper_div";g.append('<div id="'+o+'" class="PosableSelectionArea"></div>');var f=$("#"+o);for(var i in l){if(l.hasOwnProperty(i)){var k=l[i];var h=j.Title.replaceAll(" ","")+"_"+k.Public_GetInternalId();var e=h+"_div";f.append('<div id="'+e+'" class="PosableSelection" title="'+k.Public_GetTitle()+'"></div>');var m=$("#"+e);var d=k.Public_GetPoseSvg(j.GlobalImageId).clone();var n=this.Private_CloneCenterAndCreateSvg(d,h,m);d=$("#"+n.InnerSvgId);RecursivelyUpdateChildrenIds(d,SbtDataEnum.Id_Storage,SbtDataEnum.Id_DisplayOption);this.Private_UpdateColors(d);var c=function(q,r,s,p){return function(){p.Public_UpdatePoseOption(r,s);q.Private_RedrawActiveCharacter()}}(this,j,k,this.Private_ActiveShape);$("#"+e).click(c)}}};this.Private_CloneCenterAndCreateSvg=function(d,g,c,k,h,i){var o=this.Private_PartSize;var n=this.Private_PartSize;var f=g+"_translate";var p=g+"_swap_part";var m=SvgCreator.CreateBlankSvg(o,n);var e=SvgCreator.CreateSvgGroup(f);d.appendTo(e);d=e.lastChild;d.setAttribute("id",p);d.setAttribute("display","inline");m.appendChild(e);c.append(m);var l=SbtMath.ScaleAndCenter(f,o,n,0,0);var q="translate("+(l.CenterX)+","+l.CenterY+") scale("+l.Scale+")";if(k!=null&&h!=null&&i!=null){q+="rotate("+k+", "+h+", "+i+")"}if(q.indexOf("NaN")<0){e.setAttributeNS(null,"transform",q)}var j=new Object();j.InnerSvgId=p;return j};this.Private_PrepareDialog(b)}PosableControlsBox.prototype.Private_SetPosableSizes=function(){var a=$(window).width()>900;if(a){this.Private_PoseWidth=275;this.Private_PoseHeight=500;this.Private_PartSize=45;this.Private_PoseAreaSize_SinglePose="675px";this.Private_PoseAreaSize_MultiPose="800px";this.Private_SidePoseHeight=205;this.Private_SidePoseWidth=114}else{this.Private_PoseWidth=200;this.Private_PoseHeight=392;this.Private_PartSize=30;this.Private_PoseAreaSize_SinglePose="590px";this.Private_PoseAreaSize_MultiPose="590px";this.Private_SidePoseHeight=156;this.Private_SidePoseWidth=100}};PosableControlsBox.prototype.Private_ResetInstaPoses=function(){$("#Pose-Dialog-Angry").off("click");$("#Pose-Dialog-Speaking").off("click");$("#Pose-Dialog-Sad").off("click");$("#Pose-Dialog-Sleeping").off("click");$("#Pose-Dialog-Complaining").off("click");$("#Pose-Dialog-Holding").off("click");$("#Pose-Dialog-Confusion").off("click");$("#Pose-Dialog-Upset").off("click");$("#Pose-Dialog-Sit").off("click");$("#Pose-Dialog-Determined").off("click");$("#Pose-Dialog-Happy").off("click");$("#Pose-Dialog-Walking").off("click");$("#Pose-Dialog-Shouting").off("click");$("#Pose-Dialog-Scared").off("click");$("#Pose-Dialog-Angry").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Angry));$("#Pose-Dialog-Speaking").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Speaking));$("#Pose-Dialog-Sad").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Sad));$("#Pose-Dialog-Sleeping").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Sleeping));$("#Pose-Dialog-Complaining").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Complaining));$("#Pose-Dialog-Holding").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Holding));$("#Pose-Dialog-Confusion").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Confusion));$("#Pose-Dialog-Upset").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Upset));$("#Pose-Dialog-Sit").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Sit));$("#Pose-Dialog-Determined").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Determined));$("#Pose-Dialog-Happy").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Happy));$("#Pose-Dialog-Walking").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Walking));$("#Pose-Dialog-Shouting").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Shouting));$("#Pose-Dialog-Scared").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Scared))};function SmartSceneDialog(a){this._ActiveShape=a;this._PreviewSceneWidth=600;this._PreviewSceneHeight=400;this._PrepareDialog();this.CancelButtonPressed=false;this.UndoInfo_Colors;this.UndoInfo_SelectedSceneOptions}SmartSceneDialog.prototype._PrepareDialog=function(){this._PrepareDialog_PrepareUndo();this._PrepareDialog_SceneOptions();this._PrepareDialog_FigureOutSize();this.CancelButtonPressed=false;$("#Smart-Scene-Preview").children().remove();MyPointers.Dialog_SmartScene.one("shown.bs.modal",this._PrepareDialog_PostModalShown_Closure(this));MyPointers.Dialog_SmartScene.modal()};SmartSceneDialog.prototype._PrepareDialog_PostModalShown_Closure=function(a){return function(b){a._RedrawActiveScene()}};SmartSceneDialog.prototype._RedrawActiveScene=function(){SvgCloner.CloneSvg("Smart-Scene-Preview",this._ActiveShape.Id,"smart-scene-preview-area",this._PreviewSceneWidth,this._PreviewSceneHeight)};SmartSceneDialog.prototype._PrepareDialog_PrepareUndo=function(){this.UndoInfo_SelectedSceneOptions=this._ActiveShape.SmartSceneState.GetSelectedSceneOptions();this.UndoInfo_Colors=null;if(this._ActiveShape.Property_IsColorable()){this.UndoInfo_Colors=this._ActiveShape.ColorableState.Public_GetColorStyles()}};SmartSceneDialog.prototype._PrepareDialog_SceneOptions=function(){var g=$("#smart-scene-options");g.empty();var m=this._ActiveShape.SmartSceneState.SmartSceneItems;for(var b=0;b<m.length;b++){var k=m[b];g.append("<h2>"+k.GetTitle()+"</h2>");g.append('<div class="btn-group" data-toggle="buttons">');var h=g.children().last();for(var e=0;e<k.SmartSceneItemOptions.length;e++){var l=k.SmartSceneItemOptions[e];var c="sco-"+b+"-"+e;var a=l.IsActive?"checked":"";var d=l.IsActive?"active":"";h.append('<label class="btn btn-default smart-scene-button '+d+'">');h.children().last().append('<input id="'+c+'" type="radio" autocomplete="off" '+a+" >"+l.GetTitle());var f=this._CreateOptionClosure(this,k,e);$("#"+c).change(f)}}};SmartSceneDialog.prototype._PrepareDialog_FigureOutSize=function(){var a=$(window).width()>1000;if(a){$("#SmartSceneDialogSize").css("width","900px");this._PreviewSceneHeight=400;this._PreviewSceneWidth=600}else{$("#SmartSceneDialogSize").css("width","600px");this._PreviewSceneHeight=400;this._PreviewSceneWidth=300}};SmartSceneDialog.prototype._CreateOptionClosure=function(b,c,a){return function(d){if($(d.currentTarget).is(":checked")){c.ActivateSceneOption(a);b._RedrawActiveScene()}}};var TabRoller=function(){var f=new Object();var g={Up:1,Normal:2,Down:3};var b=new Object();b.TabRollerState=g.Normal;b.ContentPanelHeight=0;b.ActiveTabId=null;f.Up=function(){if(b.TabRollerState==g.Down){d()}else{e()}};f.Normal=function(){d()};f.Down=function(){if(b.TabRollerState==g.Up){d()}else{c()}};f.RefreshRollers_PostResize=function(){switch(b.TabRollerState){case g.Up:e();return;case g.Normal:d();return;case g.Down:c();return}};f.RefreshRollers_PostChangeTab=function(i){b.ActiveTabId=i;switch(b.TabRollerState){case g.Up:case g.Normal:d();return;case g.Down:c();return}};f.RefreshRollers_PostAdd=function(){if(b.TabRollerState!=g.Down){return}var i=$("#"+b.ActiveTabId).height();if(i!=b.ContentPanelHeight){TabRoller.Down()}};function e(){b.TabRollerState=g.Up;$(".content-wrapper").css("display","none");h()}function d(){b.TabRollerState=g.Normal;$(".content-wrapper").css("display","block");$(".content-wrapper").css("white-space","nowrap");$(".content-wrapper").css("max-height","none");$(".content-wrapper").css("overflow-x","scroll");$(".content-wrapper").css("overflow-y","auto");h()}function c(){b.TabRollerState=g.Down;b.ContentPanelHeight=$("#"+b.ActiveTabId).height();svgContainerHeight=parseInt(MyPointers.SvgContainer.css("height"));svgHeight=parseInt(MyPointers.CoreSvg.css("height"));var i=Math.max(b.ContentPanelHeight+svgContainerHeight-svgHeight-50,225);$(".content-wrapper").css("display","block");$(".content-wrapper").css("white-space","normal");$(".content-wrapper").css("max-height",i+"px");$(".content-wrapper").css("overflow-x","auto");$(".content-wrapper").css("overflow-y","scroll");b.ContentPanelHeight=$("#"+b.ActiveTabId).height();h()}function h(){StoryboardContainer.JiggleSvgSize();StoryboardContainer.SetCoreSvgDimensions();a()}function a(){if(b.ActiveTabId==null){if($(".content-wrapper").length>0){b.ActiveTabId=$(".content-wrapper").first().attr("id")}}var i=$("#tab-roller");var j=$("#top-nav-div");i.css("top",j.height());i.css("display","block")}return f}();function TextControlsBox(){this.Private_ActiveShapeId="";this.EndTextEdit=function(){SbtInlineEditorHelper.EndEditNode()};this.HideTextControlsBox=function(a){if(UseInlineEditor&&a){this.EndTextEdit()}MyPointers.Controls_TextableControls.css("display","none");this.Private_ActiveShapeId=""};this.Private_ResetColorSelector=function(){MyPointers.Controls_TextableControls_ColorSelector.spectrum({color:"#ccc",showInput:true,showAlpha:false,showPalette:true,localStorageKey:"StoryboardThat",clickoutFiresChange:true,showInitial:true,change:UpdateFontColor,move:PreviewUpdateFontColor,hide:UpdateFontColorHidden,})};this.PrepTextControls=function(g,a){try{if(UseInlineEditor){SbtInlineEditorHelper.StartEditNode($("#"+a.Id+"_text"+SvgManipSelectedTextableIndex))}}catch(b){LogErrorMessage("TextControlBox.PrepTextControls Summer",b)}try{try{if(UseQuill){var h=true;var d=(a.TextState.Public_GetQuillDeltas()===null);if(a.TextState.Public_GetQuillDeltas()===null&&quill.getLength()==1){h=false}if(h&&SbtLib.DeepCompareEquality(a.TextState.Public_GetQuillDeltas(),quill.getContents().ops)){h=false}if(h){quill.setContents(a.TextState.Public_GetQuillDeltas())}if(d){SbtQuillHelper.ResetToDefaults()}SbtQuillHelper.HandleWhiteText()}}catch(b){LogErrorMessage("TextControlBox.PrepTextContros",b)}try{if(UseSummerNote){SbtSummerNoteHelper.InitSummerNoteIfNeeded();var i=true;var d=(a.TextState.Public_GetQuillDeltas()===null);if(a.TextState.Public_GetQuillDeltas()===null&&SbtSummerNoteHelper.IsDefault()){i=false}if(i&&SbtLib.DeepCompareEquality(a.TextState.Public_GetQuillDeltas(),SbtSummerNoteHelper.GetDeltas())){i=false}if(d){SbtSummerNoteHelper.ResetToDefaults()}else{if(i){SbtSummerNoteHelper.UpdateForDeltas(a.TextState.Public_GetQuillDeltas())}}SbtSummerNoteHelper.HandleWhiteText()}}catch(b){LogErrorMessage("TextControlBox.PrepTextControls Summer",b)}g.css("display","inline-block");if(false){if(UseQuill==false&&UseSummerNote==false){var f=$("#sizeSelector");MyPointers.Controls_TextableControls_TextArea.val(a.TextState.D[this.CurrentId].Text);f.val(a.TextState.D[this.CurrentId].FontSize);MyPointers.Controls_TextableControls_TextAlignmentSelectors.removeClass("active");MyPointers.Controls_TextableControls_TextAlignmentSelectors.filter("."+(a.TextState.D[this.CurrentId].TextAlignment||"middle")).addClass("active")}if(UseQuill==false&&UseSummerNote==false){this.Private_SetFontSelector(a.TextState.D[this.CurrentId].Font);MyPointers.Controls_TextableControls_ColorSelector.spectrum("set",a.TextState.D[this.CurrentId].FontColor);if(MyPointers.Controls_TextableControls_TextArea.is(":focus")==false){MyPointers.Controls_TextableControls_TextArea.focus()}this.Private_ResetColorSelector()}}this.Private_ActiveShapeId=a.Id}catch(c){LogErrorMessage("TextControlsBox.PrepTextControls ",c)}};this.Private_SetFontSelector=function(a){MyPointers.Controls_TextableControls_FontSelector.fontSelector("UpdateDisplayName",a)}};var TimelineDateManager=function(){var b=function(g,h,m,l,j){try{var i=$("#timeline-"+h+"-cell-"+g).val();if(i==null||i.length==0){return j}var n=parseInt(i);if(n<m||n>l){return j}return n}catch(k){LogErrorMessage("TimelineDateManager._GetDatePart",k)}return j};var e=function(h,g){$("#timeline-use-"+h).prop("checked",g);if(g){$(".timeline-"+h).css("display","")}else{$(".timeline-"+h).css("display","none")}if(g==true){if(h=="second"){e("minute",true)}if(h=="minute"){e("hour",true)}if(h=="hour"){e("day",true)}if(h=="day"){e("month",true)}}if(g==false){if(h=="month"){e("day",false)}if(h=="day"){e("hour",false)}if(h=="hour"){e("minute",false)}if(h=="minute"){e("second",false)}}};var a=function(){if(f.Cols==10){swalQueue({title:"",text:MyLangMap.GetTextLineBreaksByToken("warning-timeline-max-size"),type:"info",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")});return}$("#timeline-row-cell-"+f.Cols).css("display","");f.Cols++};var d=function(){if(f.Cols==3){swalQueue({title:"",text:MyLangMap.GetTextLineBreaksByToken("warning-timeline-min-size"),type:"info",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")});return}f.Cols--;$("#timeline-row-cell-"+f.Cols).css("display","none")};var c=function(){$("#timeline-use-month").click(function(){e("month",$("#timeline-use-month").prop("checked"))});$("#timeline-use-day").click(function(){e("day",$("#timeline-use-day").prop("checked"))});$("#timeline-use-hour").click(function(){e("hour",$("#timeline-use-hour").prop("checked"))});$("#timeline-use-minute").click(function(){e("minute",$("#timeline-use-minute").prop("checked"))});$("#timeline-use-second").click(function(){e("second",$("#timeline-use-second").prop("checked"))});$("#timeline-add-cell").click(a);$("#timeline-remove-cell").click(d);e("hour",false);e("minute",false);e("second",false)};var f=new Object();f.Cols=0;f.GetSelectedDates=function(g){var h=[];for(var l=0;l<g;l++){var q=b(l,"year",-250000,250000,2000);var n=b(l,"month",1,12,1)-1;var j=b(l,"day",1,31,1);var k=b(l,"hour",1,12,0);var m=b(l,"minute",0,59,0);var o=b(l,"second",0,59,0);q=parseInt($("#timeline-year-era-cell-"+l).val())*q;k=(k==12?0:k)+parseInt($("#timeline-hour-am-cell-"+l).val());var p=new Date(q,n,j,k,m,o);p.setFullYear(q);h.push(p)}h=h.sort(function(i,r){return i>r});return h};f.PreparePopup=function(h){f.Cols=StoryboardContainer.Cols;var n=false;var l=false;var k=false;var j=false;var m=false;$("[id^=timeline-row-cell-]").css("display","");for(var g=StoryboardContainer.Cols;g<10;g++){$("#timeline-row-cell-"+g).css("display","none")}$("#timeline-cell-count").val(StoryboardContainer.Cols);if(h!=null){for(var q=0;q<h.length;q++){var r=h[q].getFullYear()>0?1:2;var o=h[q].getHours()<12?1:2;var p=h[q].getHours();if(p>12){p-=12}if(p==0){p=12}$("#timeline-year-cell-"+q).val(Math.abs(h[q].getFullYear()));$("#timeline-year-era-cell-"+q+" :nth-child("+r+")").prop("selected",true);$("#timeline-month-cell-"+q).val(h[q].getMonth()+1);$("#timeline-day-cell-"+q).val(h[q].getDate());$("#timeline-hour-cell-"+q).val(p);$("#timeline-hour-am-cell-"+q+" :nth-child("+o+")").prop("selected",true);$("#timeline-minute-cell-"+q).val(h[q].getMinutes());$("#timeline-second-cell-"+q).val(h[q].getSeconds());if(h[q].getMonth()>0){m=true}if(h[q].getDate()>1){j=true}if(h[q].getHours()>0){k=true}if(h[q].getMinutes()>0){l=true}if(h[q].getSeconds()>0){n=true}}}e("month",m);e("day",j);e("hour",k);e("minute",l);e("second",n)};c();return f}();function GroupAction(){var a=1;this.MakeGroup=function(b){var c=ShapesState.Public_ZSortShapeStates(MyShapesState.Public_GetAllSelectedShapeStates());if(c.length<=1){return}MyGroupAction.MakeGroupFromSelectedObjects(c)};this.MakeGroupFromSelectedObjects=function(r,o){var v=new Array();var p=new Array();var e=new Array();var h;var u=null;var l=null;var c=null;var q=null;var j=FindTopMostSVG_in_SelectedGroup(r);var k=$("#"+j).next();var b=false;for(h=0;h<r.length;h++){var d=r[h].Public_GetImaginaryOuterBox();if(h==0||u>d.Top){u=d.Top}if(h==0||l>d.Left){l=d.Left}if(h==0||q<d.Right){q=d.Right}if(h==0||c<d.Bottom){c=d.Bottom}b=b||r[h].UseClipping}var x=q-l;var w=c-u;var s=SvgCreator.CreateBlankSvg(x,w);s.setAttribute("viewBox",0+" "+0+" "+x+" "+w);var f=SvgCreator.CreateSvgGroup("natural"+a);f.appendChild(s);var t=$(s);for(var h=0;h<r.length;h++){r[h].nextShapeId=$("#"+r[h].Id).next().attr("id")}AttachChildrenShapesToParent(r,t,l,u);var m=AddSvg.AddSvgToStoryboard(f,0,0,true);k.before(m);var n=MyShapesState.Public_GetShapeStateByShape(m);n.X=l;n.Y=u;n.ScaleX=1;n.ScaleY=1;n.NaturalOffsetX=0;n.NaturalOffsetY=0;n.UseClipping=b;n.ClipX=0;n.ClipY=0;n.ClipWidth=x;n.ClipHeight=w;n.isGroupObject=true;for(h=0;h<r.length;h++){n.groupShapeStates.push(r[h])}MyShapesState.Public_ClearAllSelectedShapes();HideControlsMenu();MyShapesState.Public_SelectShape(m);UpdateActiveDrawing();UndoManager.register(undefined,DisassembleShapes,[{childShapeStates:r,parentShapeState:n,parentShape:m}],"",undefined,AssembleShapes,[{childShapeStates:r,parentShapeState:n,parentShape:m,LastSVGId:j}],"");return n};this.ApplyParentStateToChild=function(f,e){var b=f.Private_GetSelectionBoxArea(0);var c={x:e.CenterX,y:e.CenterY};var d={x:f.X*e.Sx,y:f.Y*e.Sy};d={x:d.x+b.CenterX*e.Sx-c.x,y:d.y+b.CenterY*e.Sy-c.y};d={x:d.x*Math.cos(e.Angle*Math.PI/180)-d.y*Math.sin(e.Angle*Math.PI/180),y:d.x*Math.sin(e.Angle*Math.PI/180)+d.y*Math.cos(e.Angle*Math.PI/180)};d={x:d.x-b.CenterX*e.Sx+c.x,y:d.y-b.CenterY*e.Sy+c.y};f.X=d.x+e.fX;f.Y=d.y+e.fY};this.ApplyParentClippingToChild=function(e,l,d){if(!l.UseClipping){return}if(l.CropType!=CropTypeEnum.Advanced){return}var b=e.Private_GetSelectionBoxArea(0);var c={x:b.CenterX,y:b.CenterY};e.CropPolygonPoint=[];var h=null,k=null,g=null,j=null;for(i=0;i<l.CropPolygonPoint.length;i++){var f={x:l.CropPolygonPoint[i].x,y:l.CropPolygonPoint[i].y};f=l.ConvertCoordinateToStage(f,d,true);f=e.ConvertCoordinateToOrigin(f,c,true);e.CropPolygonPoint.push(f)}e.UseClipping=l.UseClipping;e.CropType=l.CropType;e.Public_update_ClipRegionByAdvancedCrop()};this.MinimizeAdvancedCropRegion=function(n){if(!n.UseClipping||n.CropType!=CropTypeEnum.Advanced){return false}var d=new ConvexHullGrahamScan();var f;var m=n.Private_GetElement(SvgPartsEnum.Scale);var l=m.getBBox();var k={Left:l.x,Right:l.x+l.width,Top:l.y,Bottom:l.y+l.height};if(checkPolygonInnerPoint({x:k.Left,y:k.Top},n.CropPolygonPoint)){d.addPoint(k.Left,k.Top)}if(checkPolygonInnerPoint({x:k.Left,y:k.Bottom},n.CropPolygonPoint)){d.addPoint(k.Left,k.Bottom)}if(checkPolygonInnerPoint({x:k.Right,y:k.Top},n.CropPolygonPoint)){d.addPoint(k.Right,k.Top)}if(checkPolygonInnerPoint({x:k.Right,y:k.Bottom},n.CropPolygonPoint)){d.addPoint(k.Right,k.Bottom)}for(f=0;f<n.CropPolygonPoint.length;f++){var b=n.CropPolygonPoint[f];var c=n.CropPolygonPoint[(f+1)%n.CropPolygonPoint.length];var g=new Array();g[0]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Left,k.Top,k.Left,k.Bottom);g[1]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Left,k.Bottom,k.Right,k.Bottom);g[2]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Right,k.Bottom,k.Right,k.Top);g[3]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Right,k.Top,k.Left,k.Top);if(checkRectangleInnerPoint(b,k)){d.addPoint(b.x,b.y)}for(var h=0;h<4;h++){if(g[h].intersect){d.addPoint(g[h].x,g[h].y)}}}var e=d.getHull();if(e.length>=3){n.CropPolygonPoint=new Array();for(f=0;f<e.length;f++){n.CropPolygonPoint.push({x:e[f].x,y:e[f].y})}n.Public_update_ClipRegionByAdvancedCrop();n.CropPolygonPointJson=JSON.stringify(n.CropPolygonPoint);return true}else{n.CropType=CropTypeEnum.Standard;n.ClipWidth=0;n.ClipHeight=0;n.X=-1000;return false}};this.UnGroup=function(d,o){if(!o||o==undefined){o=MyShapesState.Public_GetFirstSelectedShapeState()}if(!o.isGroupObject){return}o.FlipHorizontal=false;o.FlipVertical=false;var k=o.getCropParam();o.Public_convert_RectangleToAdvanced();var g=$("#"+o.Id).next().attr("id");var b=o.Private_GetSelectionBoxArea(0);var q=[],m=[];var h={CenterX:b.CenterX,CenterY:b.CenterY,fX:o.X,fY:o.Y,Sx:o.ScaleX,Sy:o.ScaleY,flipH:o.FlipHorizontal,flipV:o.FlipVertical,Angle:o.Angle,FilterColorMode:o.FilterColorMode};var c={x:b.CenterX,y:b.CenterY};var f;DetachChildrenShapesFromParent(o,true);MyShapesState.Public_ClearAllSelectedShapes();HideControlsMenu();for(f=0;f<o.groupShapeStates.length;f++){var p=o.groupShapeStates[f].getCropParam();MyGroupAction.ApplyParentStateToChild(o.groupShapeStates[f],h);o.groupShapeStates[f].Angle+=h.Angle;o.groupShapeStates[f].ScaleX*=h.Sx;o.groupShapeStates[f].ScaleY*=h.Sy;o.groupShapeStates[f].opacity*=o.opacity;if(h.FilterColorMode){o.groupShapeStates[f].FilterColorMode=h.FilterColorMode}o.groupShapeStates[f].UpdateDrawing();if(o.FlipVertical){o.groupShapeStates[f].FlipVertical=!o.groupShapeStates[f].FlipVertical}if(o.FlipHorizontal){o.groupShapeStates[f].FlipHorizontal=!o.groupShapeStates[f].FlipHorizontal}MyShapesState.Public_SelectShape($("#"+o.groupShapeStates[f].Id));MyGroupAction.ApplyParentClippingToChild(o.groupShapeStates[f],o,c);MyGroupAction.MinimizeAdvancedCropRegion(o.groupShapeStates[f]);var l=o.groupShapeStates[f].getCropParam();q.push(p);m.push(l)}var j=o.getCropParam();var n=$("#"+o.Id).detach();MyShapesState.Public_RemoveShapeStateById(o.Id);UpdateActiveDrawing();UndoManager.register(undefined,AssembleWithOriginalChildren,[{childShapeStates:o.groupShapeStates,parentShapeState:o,parentShape:n,ChildParams:q,ParentParam:k,LastSVGId:g}],"",undefined,DisassembleWithOriginalChildren,[{childShapeStates:o.groupShapeStates,parentShapeState:o,parentShape:n,ChildParams:m,ParentParam:j}],"")};this.CheckGroupObject=function(){var b=MyShapesState.Public_GetFirstSelectedShapeState();return b.isGroupObject}}function DetachChildrenShapesFromParent(e,g){var b;var d=$("#"+e.Id).next();var a=$("#"+e.Id+SvgPartsEnum.SvgImage);a.children("g").each(function(){var j=this.getAttribute("id");var h=$(this).detach();h.on("mousedown",ShapeSelected);h.on("mouseup",HandleMouseExit);d.before(h)});if(!g){var c;for(c=e.groupShapeStates.length-1;c>=0;c--){var f=$("#"+e.groupShapeStates[c].Id);if($("#"+e.groupShapeStates[c].nextShapeId).length){$("#"+e.groupShapeStates[c].nextShapeId).before(f)}}}for(b=0;b<e.groupShapeStates.length;b++){MyShapesState.Public_SetShapeState(e.groupShapeStates[b].Id,e.groupShapeStates[b])}}function DisassembleShapes(){if(arguments.length<1){return}var a=arguments[0].childShapeStates;var c=arguments[0].parentShape;var d=arguments[0].parentShapeState;var f=arguments[1];var b;DetachChildrenShapesFromParent(d,f);MyShapesState.Public_ClearAllSelectedShapes();for(b=0;b<a.length;b++){var e=a[b];e.X+=d.X;e.Y+=d.Y;MyShapesState.Public_SelectShape($("#"+e.Id));e.UpdateDrawing()}$("#"+d.Id).remove();MyShapesState.Public_RemoveShapeStateById(d.Id)}function AttachChildrenShapesToParent(a,b,d,e,h){var c;for(c=0;c<a.length;c++){var g=a[c];if(!h){g.X-=d;g.Y-=e}g.UpdateDrawing();var f=$("#"+g.Id);f.find("[id$='"+SvgPartsEnum.SelectionBox+"']").remove();f.off("mousedown");f.off("mouseup");b.append(f);MyShapesState.Public_RemoveShapeStateById(g.Id)}}function AssembleShapes(){if(arguments.length<1){return}var a=arguments[0].childShapeStates;var d=arguments[0].parentShape;var e=arguments[0].parentShapeState;var c=arguments[0].LastSVGId;var f=arguments[1];$("#"+c).before(d);var b=$("#"+e.Id+SvgPartsEnum.SvgImage);AttachChildrenShapesToParent(a,b,e.X,e.Y,f);d=$("#"+e.Id);d.on("mousedown",ShapeSelected);d.on("mouseup",HandleMouseExit);MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Public_SetShapeState(e.Id,e);MyShapesState.Public_SelectShape($("#"+e.Id));e.UpdateDrawing()}function AssembleWithOriginalChildren(){if(arguments.length<1){return}var b=arguments[0].childShapeStates;var e=arguments[0].parentShape;var f=arguments[0].parentShapeState;var a=arguments[0].ChildParams;var d=arguments[0].ParentParam;var c;for(c=0;c<b.length;c++){b[c].setCropParam(a[c])}AssembleShapes(arguments[0],true);f.setCropParam(d);f.UpdateDrawing()}function DisassembleWithOriginalChildren(){if(arguments.length<1){return}var b=arguments[0].childShapeStates;var e=arguments[0].parentShape;var f=arguments[0].parentShapeState;var a=arguments[0].ChildParams;var d=arguments[0].ParentParam;var c;f.setCropParam(d);DisassembleShapes(arguments[0],true);for(c=0;c<b.length;c++){b[c].setCropParam(a[c]);b[c].UpdateDrawing()}};function MoveShapeAction(){this.UndoMoveX=null;this.UndoMoveY=null;this.MouseMoveOffsetX=0;this.MouseMoveOffsetY=0;this.Public_ClearAction=function(){this.UndoMoveX=null;this.UndoMoveY=null;this.MouseMoveOffsetX=0;this.MouseMoveOffsetY=0};this.Public_UpdateMouseMoveOffsets=function(a,b){this.MouseMoveOffsetX=a;this.MouseMoveOffsetY=b};this.Public_UpdateUndos=function(a,b){this.UndoMoveX=a;this.UndoMoveY=b}};function MultiSelectState(){this.StartX=undefined;this.StartY=undefined;this.Private_Left=undefined;this.Private_Right=undefined;this.Private_Top=undefined;this.Private_Bottom=undefined;this.SelectionAreaPartsEnum={SelectionAreaRect:"selection_area_rect",};this.Public_StartMultiSelect=function(a){this.StartX=PageXtoStoryboardX(a.pageX);this.StartY=PageYtoStoryboardY(a.pageY);if(this.StartY<0){this.StartY=0}if(this.StartX<0){this.StartX=0}this.Private_Left=0;this.Private_Right=0;this.Private_Top=0;this.Private_Bottom=0};this.Public_CompleteSelection=function(){var e=GetGlobalById(this.SelectionAreaPartsEnum.SelectionAreaRect);if(e){e.parentNode.removeChild(e)}var a=MyShapesState.Public_GetAllMovableShapeStates(true);for(var c=0;c<a.length;c++){var d=a[c];var b=null;b=d.Public_GetImaginaryOuterBox();if(b.Top>=this.Private_Top&&b.Bottom<=this.Private_Bottom){if(b.Left>=this.Private_Left&&b.Right<=this.Private_Right){MyShapesState.Public_SelectShape($("#"+d.Id))}}}UpdateActiveDrawing()};this.Public_DrawSelectionArea=function(a){var c=a.pageX-StoryboardContainer.CoreSvgLeft+MyPointers.SvgContainer.scrollLeft();var d=a.pageY-StoryboardContainer.CoreSvgTop+MyPointers.SvgContainer.scrollTop();this.Private_Left=Math.min(c,this.StartX);this.Private_Right=Math.max(c,this.StartX);this.Private_Top=Math.min(d,this.StartY);this.Private_Bottom=Math.max(d,this.StartY);var c=GetGlobalById(this.SelectionAreaPartsEnum.SelectionAreaRect);if(c){c.parentNode.removeChild(c)}var b=SvgCreator.AddRect(this.Private_Left,this.Private_Top,this.Private_Right-this.Private_Left,this.Private_Bottom-this.Private_Top,SbtConstants.SelectionAreaStrokeColor,SbtConstants.SelectionAreaFillColor,SbtConstants.SelectionAreaStrokeDash,SbtConstants.SelectionAreaOpacity,this.SelectionAreaPartsEnum.SelectionAreaRect);MyPointers.CoreSvg.append(b)}};function ResizeImageAction(){this.ActiveShape=null;this.UndoLog=new Object;this.ResizeDirection=null;this.Public_StartResize=function(a,d){this.ResizeDirection=DetermineResizeDirection(d);this.ActiveShape=a;var e=MyShapesState.Public_GetAllSelectedShapeStates();for(var c=0;c<e.length;c++){var f=e[c];var b=f.Public_GetVisibleShapeDimensions();var g=false;if(this.ResizeDirection==ResizeEnum.N||this.ResizeDirection==ResizeEnum.S||this.ResizeDirection==ResizeEnum.E||this.ResizeDirection==ResizeEnum.W){g=true}if(g&&f.IsSpringable()){this.UndoLog[f.Id]={Transforms:f.SpringableState.GetSpringStateTransforms(),SvgSize:SvgCreator.GetSvgSize(f.Id+SvgPartsEnum.SvgImage),MoveX:f.X,MoveY:f.Y,UseClipping:f.UseClipping,ClipHeight:f.ClipHeight,ClipWidth:f.ClipWidth,IsSpringable:true}}else{this.UndoLog[f.Id]={ScaleX:f.ScaleX,ScaleY:f.ScaleY,MoveX:f.X,MoveY:f.Y,Width:b.width,Height:b.height,IsSpringable:false}}}};this.Public_ResizeShapes=function(a){var m={x:PageXtoStoryboardX(a.pageX),y:PageYtoStoryboardY(a.pageY)};var h=this.ActiveShape.Public_GetImaginaryOuterPoints();var q=this.ActiveShape.Private_GetSelectionBoxArea(0);var r={x:q.CenterX,y:q.CenterY};var d=0;var c=1;var g=2;var f=3;var N={x:0,y:0};var O=1,P=1;var M={x:h[g].x-h[d].x,y:h[g].y-h[d].y};var L={x:h[c].x-h[d].x,y:h[c].y-h[d].y};var w=false;switch(this.ResizeDirection){case ResizeEnum.SW:var B={x:h[g].x-h[c].x,y:h[g].y-h[c].y};var K={x:m.x-h[g].x,y:m.y-h[g].y};var E=SbtMath.ProjectAtoB(K,B);O=-SbtMath.ProjectAtoBScale(E,L)+1;P=SbtMath.ProjectAtoBScale(E,M)+1;r={x:r.x*O,y:r.y*P};var y={x:q.Left*O,y:q.Bottom*P};var x=this.ActiveShape.ConvertCoordinateToStage(y,r);var z={x:h[g].x+E.x,y:h[g].y+E.y};N={x:z.x-x.x,y:z.y-x.y};break;case ResizeEnum.NE:var J={x:h[c].x-h[g].x,y:h[c].y-h[g].y};var A={x:m.x-h[c].x,y:m.y-h[c].y};var E=SbtMath.ProjectAtoB(A,J);O=SbtMath.ProjectAtoBScale(E,L)+1;P=-SbtMath.ProjectAtoBScale(E,M)+1;r={x:r.x*O,y:r.y*P};var k={x:q.Right*O,y:q.Top*P};var j=this.ActiveShape.ConvertCoordinateToStage(k,r);var l={x:h[c].x+E.x,y:h[c].y+E.y};N={x:l.x-j.x,y:l.y-j.y};break;case ResizeEnum.SE:var D={x:h[f].x-h[d].x,y:h[f].y-h[d].y};var H={x:m.x-h[f].x,y:m.y-h[f].y};var E=SbtMath.ProjectAtoB(H,D);O=SbtMath.ProjectAtoBScale(E,L)+1;P=SbtMath.ProjectAtoBScale(E,M)+1;r={x:r.x*O,y:r.y*P};var t={x:q.Right*O,y:q.Bottom*P};var s=this.ActiveShape.ConvertCoordinateToStage(t,r);var u={x:h[f].x+E.x,y:h[f].y+E.y};N={x:u.x-s.x,y:u.y-s.y};break;case ResizeEnum.NW:var I={x:h[d].x-h[f].x,y:h[d].y-h[f].y};var C={x:m.x-h[d].x,y:m.y-h[d].y};var E=SbtMath.ProjectAtoB(C,I);O=-SbtMath.ProjectAtoBScale(E,L)+1;P=-SbtMath.ProjectAtoBScale(E,M)+1;r={x:r.x*O,y:r.y*P};var o={x:q.Left*O,y:q.Top*P};var n=this.ActiveShape.ConvertCoordinateToStage(o,r);var p={x:h[d].x+E.x,y:h[d].y+E.y};N={x:p.x-n.x,y:p.y-n.y};break;case ResizeEnum.N:var C={x:m.x-h[d].x,y:m.y-h[d].y};var G=SbtMath.ProjectAtoB(C,M);P=-SbtMath.ProjectAtoBScale(C,M)+1;r={x:r.x,y:r.y*P};var o={x:q.Left,y:q.Top*P};var n=this.ActiveShape.ConvertCoordinateToStage(o,r);var p={x:h[d].x+G.x,y:h[d].y+G.y};N={x:p.x-n.x,y:p.y-n.y};w=true;break;case ResizeEnum.S:var K={x:m.x-h[g].x,y:m.y-h[g].y};var G=SbtMath.ProjectAtoB(K,M);P=SbtMath.ProjectAtoBScale(K,M)+1;var y={x:q.Left,y:q.Bottom*P};r={x:r.x,y:r.y*P};var x=this.ActiveShape.ConvertCoordinateToStage(y,r);var z={x:h[g].x+G.x,y:h[g].y+G.y};N={x:z.x-x.x,y:z.y-x.y};w=true;break;case ResizeEnum.E:var A={x:m.x-h[c].x,y:m.y-h[c].y};var F=SbtMath.ProjectAtoB(A,L);O=SbtMath.ProjectAtoBScale(A,L)+1;r={x:r.x*O,y:r.y};var k={x:q.Right*O,y:q.Top};var j=this.ActiveShape.ConvertCoordinateToStage(k,r);var l={x:h[c].x+F.x,y:h[c].y+F.y};N={x:l.x-j.x,y:l.y-j.y};w=true;break;case ResizeEnum.W:var C={x:m.x-h[d].x,y:m.y-h[d].y};var F=SbtMath.ProjectAtoB(C,L);O=-SbtMath.ProjectAtoBScale(C,L)+1;r={x:r.x*O,y:r.y};var o={x:q.Left*O,y:q.Top};var n=this.ActiveShape.ConvertCoordinateToStage(o,r);var p={x:h[d].x+F.x,y:h[d].y+F.y};N={x:p.x-n.x,y:p.y-n.y};w=true;break}if(O==null||P==null||O<0.1||P<0.1){return}if((q.Width<10&&O<1)||(q.Height<10&&P<1)){return}var v=MyShapesState.Public_GetAllSelectedShapeStates();for(var b=0;b<v.length;b++){if(w&&v[b].SpringableState!=null&&v[b].SpringableState.IsSpringable){this.Private_ScaleAndMoveSpringable(v[b],O,P,this.ResizeDirection);v[b].MoveDistance(N.x,N.y)}else{v[b].ChangeScaleXY(O,P);v[b].MoveDistance(N.x,N.y)}v[b].UpdateDrawing(true)}};this.Public_StopResizing=function(){var e=new Array();var b=new Array();var c=MyShapesState.Public_GetAllSelectedShapeStates();for(var a=0;a<c.length;a++){var d=c[a];var f=this.UndoLog[d.Id];if(f==null||f==undefined){continue}if(f.IsSpringable){e.push({Id:d.Id,Transforms:f.Transforms,SvgSize:f.SvgSize,MoveX:f.MoveX,MoveY:f.MoveY,UseClipping:f.UseClipping,ClipHeight:f.ClipHeight,ClipWidth:f.ClipWidth,IsSpringable:true});b.push({Id:d.Id,Transforms:d.SpringableState.GetSpringStateTransforms(),SvgSize:SvgCreator.GetSvgSize(d.Id+SvgPartsEnum.SvgImage),UseClipping:d.UseClipping,ClipHeight:d.ClipHeight,ClipWidth:d.ClipWidth,MoveX:d.X,MoveY:d.Y,IsSpringable:true})}else{e.push({Id:d.Id,ScaleX:f.ScaleX,ScaleY:f.ScaleY,MoveX:f.MoveX,MoveY:f.MoveY,IsSpringable:false});b.push({Id:d.Id,ScaleX:d.ScaleX,ScaleY:d.ScaleY,MoveX:d.X,MoveY:d.Y,IsSpringable:false})}}UndoManager.register(undefined,UndoShapeResizeWithMove,e,"",undefined,UndoShapeResizeWithMove,b,"")};this.ResizeViaPinch=function(s,t,d,e,p){var n=this.UndoLog[this.ActiveShape.Id];var o=this.ActiveShape.Angle/57.2957795;var b=this.Private_SanitizeAngle(this.ActiveShape.Angle);var q={x:Math.abs(s*Math.cos(o)+t*Math.sin(o)),y:Math.abs(t*Math.cos(o)-s*Math.sin(o))};var c={x:Math.abs(d*Math.cos(o)+e*Math.sin(o)),y:Math.abs(e*Math.cos(o)-d*Math.sin(o))};var h=c.x-q.x;var i=c.y-q.y;var f=Math.min(h,i)/Math.max(h,i,0.001);var u=10,g=0.499;var j,k;var m=this.ActiveShape.Public_GetVisibleShapeDimensions();var v=false;if(((h<u)&&(i<u))||((h>u)&&(i>u)&&(f>g))){j=n.MoveX-((n.Width*(p-1))/2);k=n.MoveY-((n.Height*(p-1))/2);this.ActiveShape.SetScale(p*n.ScaleX,p*n.ScaleY)}else{v=this.ActiveShape.IsSpringable();if((i<u)||((h>i)&&(f<=g))){p=c.x/((q.x===0)?1:q.x);j=n.MoveX-((n.Width*(p-1))/2);k=n.MoveY;if(v){var l=(this.ActiveShape.X-j)*2;var a=1+((h/m.width)/10);this.Private_ScaleAndMoveSpringable(this.ActiveShape,a,1,this.Private_AnchorCorner("W",b),"W")}else{this.ActiveShape.SetScale(p*n.ScaleX,n.ScaleY)}}else{p=c.y/((q.y===0)?1:q.y);j=n.MoveX;k=n.MoveY-((n.Height*(p-1))/2);if(v){var a=1+((i/m.height)/10);this.Private_ScaleAndMoveSpringable(this.ActiveShape,1,a,this.Private_AnchorCorner("N",b),"N")}else{this.ActiveShape.SetScale(n.ScaleX,p*n.ScaleY)}}}if((j<0&&(j-m.width<0))||(k<0&&(k-m.height<0))){}else{this.ActiveShape.MoveTo(j,k)}this.ActiveShape.UpdateDrawing()};this.Private_SanitizeAngle=function(a){a%=360;if(a<0){a+=360}if(a%90===0){a+=1}a%=360;return a};this.Private_AnchorCorner=function(c,a){var b="";switch(c){case ResizeEnum.N:case ResizeEnum.NE:b="SW";if(a>=90&&a<180){b="NW"}else{if(a>=180&&a<270){b="NE"}else{if(a>=270){b="SE"}}}break;case ResizeEnum.S:case ResizeEnum.SW:b="NE";if(a>=90&&a<180){b="SE"}else{if(a>=180&&a<270){b="SW"}else{if(a>=270){b="NW"}}}break;case ResizeEnum.E:case ResizeEnum.SE:b="NW";if(a>=90&&a<180){b="NE"}else{if(a>=180&&a<270){b="SE"}else{if(a>=270){b="SW"}}}break;case ResizeEnum.W:case ResizeEnum.NW:b="SE";if(a>=90&&a<180){b="SW"}else{if(a>=180&&a<270){b="NW"}else{if(a>=270){b="NE"}}}break}return b};this.Private_ScaleAndMoveSpringable=function(o,m,n,l){var h=o.Public_GetVisibleShapeDimensions();var k=h.width;var j=h.height;var d=(m-1)*(k/o.ScaleX);var e=(n-1)*(j/o.ScaleY);var q=o.SpringableState.Anchors.Right;var s=o.SpringableState.Springs.Horizontal;var r=o.SpringableState.Anchors.Bottom;var t=o.SpringableState.Springs.Vertical;if(!this.Private_VerifySafeToScaleSpringable(o,s,m,1,d,0)){return}if(!this.Private_VerifySafeToScaleSpringable(o,t,1,n,0,e)){return}if(o.UseClipping){o.ClipWidth+=d;o.ClipHeight+=e}for(var c=0;c<q.length;c++){var u=SvgCreator.GetTransform(q[c]);var b=q[c].indexOf("-hhalf")>0?2:1;u.Translate[0]+=d/b;SvgCreator.WriteTransform(q[c],u)}for(var c=0;c<r.length;c++){var u=SvgCreator.GetTransform(r[c]);var v=r[c].indexOf("-vhalf")>0?2:1;u.Translate[1]+=e/v;SvgCreator.WriteTransform(r[c],u)}for(var c=0;c<s.length;c++){var p=GetGlobalById(s[c]);var u=SvgCreator.GetTransform(s[c]);var a=p.getBBox();var f=d/a.width;f=isNaN(f)?0:f;u.Scale[0]+=f;if(u.Scale[0]<0){continue}if(f!=0){u.Translate[0]=(1-u.Scale[0])*a.x}SvgCreator.WriteTransform(s[c],u)}for(var c=0;c<t.length;c++){var p=GetGlobalById(t[c]);var u=SvgCreator.GetTransform(t[c]);var a=p.getBBox();var g=e/a.height;g=isNaN(g)?0:g;u.Scale[1]+=g;if(u.Scale[1]<0){continue}if(g!=0){u.Translate[1]=(1-u.Scale[1])*a.y}SvgCreator.WriteTransform(t[c],u)}SvgCreator.UpdateSvgSize_WithDeltas(o.Id+SvgPartsEnum.SvgImage,d,e)};this.UndoSpringableResize=function(b){SvgCreator.UpdateSvgSize(b.Id+SvgPartsEnum.SvgImage,b.SvgSize);for(var a=0;a<b.Transforms.length;a++){SvgCreator.WriteTransform(b.Transforms[a].Id,b.Transforms[a].Transform)}};this.Private_VerifySafeToScaleSpringable=function(k,m,h,j,d,e){if(h<0||j<0){return false}for(var c=0;c<m.length;c++){var l=GetGlobalById(m[c]);var n=SvgCreator.GetTransform(m[c]);var a=l.getBBox();var f=d/a.width;var g=e/a.height;f=isNaN(f)?0:f;g=isNaN(g)?0:g;f=n.Scale[0]+=f;g=n.Scale[1]+=g;if(h<1&&((f*a.width*k.ScaleX)<10)){return false}if(j<1&&((g*a.height*k.ScaleY)<10)){return false}}var b=GetGlobalById(k.Id+SvgPartsEnum.SvgImage);if(d<0||e<0){if(parseInt(b.getAttribute("width"),10)+d<10){return false}if(parseInt(b.getAttribute("height"),10)+e<10){return false}}return true};this.Private_ScaleAndMove=function(k,i,j,a){var e=this.ActiveShape.Public_GetVisibleShapeDimensions();var h=e.width;var f=e.height;if(i!=1&&(i*h)<10){return}if(j!=1&&(j*f)<10){return}var b=0;var c=0;var g=k.Public_GetImaginaryOuterBox();k.ChangeScaleXY(i,j);var d=k.Public_GetImaginaryOuterBox();switch(a){case"SW":c=(g.Bottom-d.Bottom);b=(g.Left-d.Left);break;case"NW":c=(g.Top-d.Top);b=(g.Left-d.Left);break;case"NE":c=(g.Top-d.Top);b=(g.Right-d.Right);break;case"SE":c=(g.Bottom-d.Bottom);b=(g.Right-d.Right);break}k.MoveDistance(b,c);k.UpdateDrawing()}};function RotateImageAction(){this.ShapeStateBeingRotated=null;this.MouseRotateX=null;this.MouseRotateY=null;this.UndoRotateAngle=null;this.ResetRotateImageAction=function(b,a){this.ShapeStateBeingRotated=b;this.MouseRotateX=PageXtoStoryboardX(a.pageX);this.MouseRotateY=PageYtoStoryboardY(a.pageY);this.UndoRotateAngle=this.ShapeStateBeingRotated.Angle};this.CalculateRotationAngle=function(f){var b=this.ShapeStateBeingRotated.Public_GetVisibleShapeDimensions();var j=b.width;var g=b.height;var h=PageXtoStoryboardX(f.pageX);var i=PageYtoStoryboardY(f.pageY);var c=this.ShapeStateBeingRotated.Property_VisibleX()+(j/2);var d=this.ShapeStateBeingRotated.Property_VisibleY()+(g/2);var a=SbtMath.CalculateAngle(c,d,h,i,this.MouseRotateX,this.MouseRotateY);this.MouseRotateX=h;this.MouseRotateY=i;return a};this.Public_TotalAngleRotation=function(){var a=this.ShapeStateBeingRotated.Angle-this.UndoRotateAngle;a%=360;return a}};function ShapeMetaData(){this.LookForMetaData=function(k){var l=$("#"+k).find("sbtdata");if(l.length==0){return}try{var b=l.find("colorable");for(var j=0;j<b.length;j++){var q=b[j].getAttributeNS("","region");if(q.length===0){q=b[j].getAttributeNS("","Region")}var s=b[j].getAttributeNS("","secretcolor");if(s.length===0){s=b[j].getAttributeNS("","SecretColor")}var r=b[j].getAttributeNS("","replacecolor");if(r.length===0){r=b[j].getAttributeNS("","ReplaceColor")}this.Private_ExtractColors(k,s,r,q)}}catch(d){LogErrorMessage("ShapeMetaData.LookForMetaData.Colorables",d)}var h=null;try{var u=$("#"+k).children().first();if(u.prop("tagName")!="svg"){u=l.closest("svg")}h=l.attr(SbtDataEnum.AttributeGlobalImageId);var p=l.attr(SbtDataEnum.MetaData_Position);var m=l.find(SbtDataEnum.MetaData_Posable);var n=m.find(SbtDataEnum.MetaData_Poses);if(h==null&&n!=null&&n.length>0){}for(var j=0;j<n.length;j++){var o=GetSafeAttributeNS(n[j],SbtDataEnum.Attribute_Pose_Type);if(LowerCaseCompare(o,SbtDataEnum.PoseType_LibrarySwap)){var c=GetSafeAttributeNS(n[j],SbtDataEnum.Attribute_LibrarySwapPose_DefaultId);var t=GetSafeAttributeNS(n[j],SbtDataEnum.Attribute_LibrarySwapPose_StartPointId);var a=GetSafeAttributeNS(n[j],SbtDataEnum.Attribute_LibrarySwapPose_AppendToId);this.Private_GlobalLibrarySwap(u,c,t,a,h,p)}}}catch(d){try{LogErrorMessage("ShapeMetaData.LookForMetaData.Posables GUID:  "+h,d)}catch(f){LogErrorMessage("ShapeMetaData.LookForMetaData.Posables: ",d)}}};this.Private_ExtractColors=function(d,g,f,e){var h=$("#"+d);var b='[fill="'+g+'"]';var j=h.find(b);if(j.length===0){b='[fill="'+g.toLowerCase()+'"]';j=h.find(b)}if(j.length===0){b='[FILL="'+g.toLowerCase()+'"]';j=h.find(b)}for(var c=0;c<j.length;c++){var a=e+"_"+d+"_"+c;j[c].setAttributeNS(null,"fill",f);j[c].setAttributeNS(null,"id",a)}};this.Private_GlobalLibrarySwap=function(l,h,k,b,g,i){var d=MyGlobalSwapLibrary.Public_GetSvgById(h,i);if(d==null){}d=d.clone();var a=l.find("#"+b);a.children().remove();a.append(d);var f="gls_"+new Date().getTime();d.attr("id",f);RecursivelyUpdateChildrenIds(d,SbtDataEnum.GlobalLibraryId,g);var e=GetGlobalById(f);var c=e.getBBox();var j=ExtractPositionPoint(l.find("#"+k));var m=j.X-c.x;var n=j.Y-c.y;d.attr("transform","translate("+m+", "+n+")")}};var AddSvg=function(){var d=0;var g=0;var f=0;var b=function(E,p,C){var D=E;var q=D.indexOf("?>");if(q>=0){D=D.substring(q+2)}var u=$("#"+p);var A=u.parent();try{u.append(D)}catch(s){}c.CurrentShapeIndex+=1;var F=A.attr("width");var v=A.attr("height");var w="clipart_"+c.CurrentShapeIndex;u.attr("id",w);A.attr("class","ClipartLibrary");MyShapeMetaData.LookForMetaData(w);var n=GetGlobalById(w);var o=n.parentElement;var x=$("#"+w);if(x.children().first().attr("width")==null||x.children().first().attr("height")==null){x.children().first().attr("width",F+"px");x.children().first().attr("height",v+"px")}var h=null;try{h=n.getBBox()}catch(t){LogErrorMessage("indexBS._PerformSvgTranslationsForTabs",t)}if(C===false){if(h===null||h.x<-50||h.y<-50){x.parent().remove();return false}}var j=h.width;var i=h.height;var y=(F-4)/j;var z=(v-4)/i;var B=Math.min(y,z);n.setAttribute("transform","translate(0,0) scale("+B+")");var k=(F-((j)*B))/2;k-=(h.x*B);var l=(v-((i)*B))/2;l-=(h.y*B);n.setAttribute("transform","translate("+(k)+","+l+") scale("+B+")");var m=n.getBoundingClientRect();if(m.width>275||m.height>275){x.parent().remove();return false}var r=$("#"+w).parent().parent().attr("id");StoryboardContainer.UpdateGradientIds(x);StoryboardContainer.RemoveFilters();return true};var a=function(p,l,s,t){try{var n=MyPointers.GetSvgTop().before(p);n=MyPointers.GetSvgTop().prev();n.attr("id",l);n.attr("class","activeShape");var m=$("#"+l);m.off("mousedown").on("mousedown",ShapeSelected);m.off("mouseup").on("mouseup",HandleMouseExit);SetInitialShapeIds(m,l);var q=new SvgState(l);q.isSceneItem=NewShapeIsBackdrop;if(NewShapeIsBackdrop&&StoryboardContainer.IsPaperTypeLayout()){NewShapeIsBackdrop=false}var i=GetGlobalById(l);var h=i.getBBox();newFunction(m,q);var o=SetInitalShapeScale(m,q,h);SetInitialShapeCords(m,h,s,t,o,q);var r=$("#"+l+SvgPartsEnum.Natural+" svg");var k=(r.css("filter")||EMPTY_STRING).replace("none",EMPTY_STRING).replace(/"/g,EMPTY_STRING).replace(/http[^#]*/,EMPTY_STRING).replace("[s]+",EMPTY_STRING).replace("url(",EMPTY_STRING).replace(")",EMPTY_STRING).replace("#",EMPTY_STRING);k=(k===EMPTY_STRING)?EMPTY_STRING:"url(#"+k+")";$("#"+$(n).attr("id")+SvgPartsEnum.Natural).children("svg").css("filter",k);q.FilterColorMode=k;r.css("filter",EMPTY_STRING);MyShapesState.Public_SetShapeState(l,q);MyShapesState.Public_UpdateSingleShapeAndAction(n,ShapeActionEnum.Nothing);q.Public_ResetColors();UpdateActiveDrawing();if(NewShapeIsBackdrop){StretchToFillShape(q,q.Property_VisibleX(),q.Property_VisibleY());NewShapeIsBackdrop=false;e(q,n)}if(q.ImageAttribution!=null){StoryboardContainer.UpdateImageAttributions()}}catch(j){LogErrorMessage("SvgManip.AddShape",j)}};var c=new Object();c.CurrentShapeIndex=1;c.AddSvgToTabs=function(m,s,j,h,k,n,p){this.CurrentShapeIndex++;var o="clipartPanel"+this.CurrentShapeIndex;var r="svgGroup"+this.CurrentShapeIndex;var l='<div id="'+o+'" class="ClipartItemPanel'+(k?" SceneItem":"")+'"></div>';if(m.find("div.search-more").length>0){m.find("div.search-more").after(l)}else{m.append(l)}var q=SvgCreator.CreateBlankSvg(s,j);var i=SvgCreator.CreateSvgGroup(r);q.appendChild(i);MyPointers.StagingGround.append(q);$("#"+o).draggable({addClasses:false,revert:"invalid",helper:function(){ClearActiveState();d=d+1;var t=$(this).clone();t.children().eq(0).children().eq(0).attr("id",t.children().eq(0).children().eq(0).attr("id")+"_"+d);StoryboardContainer.UpdateGradientIds(t);return t},cursorAt:{left:26,top:40},appendTo:"body",scroll:false});if(b(h,r,p)==false){$("#"+o).remove();return}$("#"+o).append(q);if(typeof(n)===FUNCTION_KEYWORD){n($("#"+o))}TabRoller.RefreshRollers_PostAdd()};function e(p,n){var l=StoryboardContainer.GetAllLayoutParts(CellConfiguration);var o=StoryboardContainer._GetLayoutPartForShape(l,p);if(o===null){return}var m=StoryboardContainer.GetShapeStatesForCell(o.Row,o.Col);var r=null;var q=-1;var t=null;var s=9999999;for(var j=0;j<m[StoryboardPartTypeEnum.StoryboardCell].length;j++){var h=m[StoryboardPartTypeEnum.StoryboardCell][j];if(h.Id==p.Id){continue}var k=$("g").index($("#"+h.Id));if(h.isSceneItem&&k>q){q=k;r=h}if(!h.isSceneItem&&k<s){s=k;t=h}}if(q!=-1){n.detach();$("#"+r.Id).after(n)}else{if(s!=9999999){n.detach();$("#"+t.Id).before(n)}}}c.AddSvgToStoryboard=function(n,p,q,h){try{this.CurrentShapeIndex++;var k=SvgPartsEnum.ShapeId+this.CurrentShapeIndex;var l="sbt_offset"+this.CurrentShapeIndex;var m=document.createElementNS("http://www.w3.org/2000/svg","g");m.setAttribute("id",k);var o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("id",l);m.appendChild(o);MyPointers.GetSvgTop().before(m);var j=$("#"+l);j.append(n);o.firstChild.setAttribute("transform","");j=$("#"+k);j.detach();a(m,k,p,q);if(h){UndoManager.register(undefined,UndoShapeAdd,[{Id:k}],undefined,"",UndoDeleteShape,[{Detached:j,NextShapeId:"SvgTop",Id:k,ShapeState:MyShapesState.Public_GetShapeStateById(k)}])}GetStoryboardSize();return j}catch(i){LogErrorMessage("SvgManip.PrepAndAddShape",i)}};return c}();function newFunction(a,b){SetInitialShapeOffset(a,b)};function UglyUploadCallback(a){if(a==null||a.length==0){return}SvgRetriever.uploadCallback(a)}var _prevent_menu_double_select_mask=0;var ClipartTab_ModuleRef=(function(){var e={};var f;var g;var h;var b;var a=function(m,j){if(m==null||m.ImageSubCategories==null){return}var p="parent-category-"+m.ImageCategoryId;var o="parent-category-a-"+m.ImageCategoryId;var n="";n+='<li id="'+p+'" '+(m.HideOnLoad?" style=display:none":"")+(j?' class="active"':"")+">";n+='  <a id="'+o+'" href="#cliplib-'+m.ImageCategoryId+'" data-toggle="tab" class="tab-link content-tab" title="'+m.HoverText+'">'+m.Title+"</a>";n+="</li>";g.before(n);var q="";q+='<div class="cliplib-pane tab-pane'+(j?" in active":"")+'" id="cliplib-'+m.ImageCategoryId+'">';q+='  <nav class="navbar navbar-default subcategories" style="box-shadow:none" role="navigation">';q+='      <div class="navbar-content">';q+='          <ul class="nav navbar-nav nav-sm subcategory-ul">';var r=[q];var k="content-wrapper-"+m.ImageCategoryId;var s=['<div class="content-wrapper" id="'+k+'">'];for(var l=0;l<m.ImageSubCategories.length;l++){var t=c(m.ImageSubCategories[l],l===0);r.push(t[0]);s.push(t[1])}r.push("</ul></div></nav>");s.push("</div></div>");h.before(r.join("")+s.join(""));$("#"+o).click(d)};var d=function(i){i.preventDefault();$(this).tab("show");if($(this).hasClass("content-tab")){$($(this).attr("href")+" nav ul.nav li.active a").trigger("click")}$(".subcategory-ul").resize();setTimeout(TabRoller.RefreshRollers_PostResize,500)};var c=function(j,i,l){var m="";var k="";m+="<li "+(i?' class="active"':"")+' id="category-'+j.ImageCategoryId+'">';m+='     <a href="javascript:void(0)" class="cliplib-'+j.ImageCategoryId+'" title="'+j.HoverText+'">'+j.Title+"</a>";m+="</li>";k+='<div id="cliplib-'+j.ImageCategoryId+'-content" class="content-list'+(i?"":" hidden")+'">';k+='     <div class="waiting">Loading...</div>';if(l){k+='     <div class="search-more"><a href="javascript:void(0)" class="1">More...</a></div>'}k+="</div>";return[m,k]};e.load=function(){f=$("#myTabContent");g=$("#uploadTab");h=$("#cliplib-upload");b=$("#clipart-filter-wrapper");var k;for(k=0;k<allCategories.length;k++){a(allCategories[k],k===0)}if(MyBrowserProperties.IsSafari5||MyBrowserProperties.IsOldIE){$("#clipart-filter-wrapper").hide();StoryboardContainer.RemoveFilters()}else{var l=$(SVGFilterDeclaration.replace(/inkscape\:/gi,EMPTY_STRING));var j=[];l.children("filter").each(function(p,t){var i=$(t);var o=i.attr("id");var q=i.attr("label");var s=i.attr("menu-tooltip");var m=!(i.attr("disabled")==="disabled");if(q==="divider"){j.push('<li role="separator" id="divider-'+o+'" class="divider"></li>');m=false}if(m===false){return}var r=q;q=MyLangMap.GetTextByToken("text-filter-label-"+r);s=MyLangMap.GetTextByToken("text-filter-tooltip-"+r);var n="";n+="<li>";n+='<a href="javascript: void (0)" class="'+o+'" title="'+s+'">';n+='<span class="MenuFilter MenuFilter'+o+'" title="'+q+'">';n+='<img height="16" width="16" src="/content/menu/blank.gif" class="'+o+'">';n+="</span> "+q+"</a>";n+="</li>";j.push(n)});b.find("ul.dropdown-menu").append(j.join(""));$(" #filters-multi-select, #filters-single-select").append(j.join(""));$("#filters-multi-select, #filters-single-select").click(function(i){if(_prevent_menu_double_select_mask==1){_prevent_menu_double_select_mask=0;return}i.preventDefault();var m=isLIHit(i.target,this);if(m==null){return false}var n=$(m).find("a");FilterColorMode((n[0].className==="color")?EMPTY_STRING:"url(#"+n[0].className+")")});$(".remove-colors").click(function(i){_prevent_menu_double_select_mask=1;i.preventDefault();WhiteOutShape()});$(".artpen-colors").click(function(i){_prevent_menu_double_select_mask=1;i.preventDefault();ArtpenShape()});$(".black-out").click(function(i){_prevent_menu_double_select_mask=1;i.preventDefault();BlackOutShape()})}SvgRetriever.getClipartContent(allCategories[0].ImageSubCategories[0].ImageCategoryId,null,null);$("#myTabContent .scroll-indicator").css("display","");$("#myTabContent .cliplib-pane nav.navbar ul.nav").click(function(n){if($(n.target).hasClass("dropdown-toggle")){return}n.preventDefault();var o=isLIHit(n.target,this);if(o==null){return false}var i=$(o).find("a");var p="#"+i[0].className+"-content";$(this).parents("div.cliplib-pane").find(".content-wrapper div.content-list").addClass("hidden");$(p).removeClass("hidden");$(this).find("li").removeClass("active");$(o).addClass("active");activeTabId=$(p).parent().attr("id");TabRoller.RefreshRollers_PostChangeTab(activeTabId);var m=i[0].className.replace("cliplib-","");SvgRetriever.getClipartContent(m,null,null);return false});$("#upload-btn").click(function(i){SvgRetriever.initiateUpload(null,null)})};return e}());var SvgRetriever=(function(){var c={};var d={};c.initiateUpload=function(f,e){d={node:$("#cliplib-upload-content"),onitemadded:f,oncomplete:e};ShowUploadDialog()};c.uploadCallback=function(e){AddSvg.AddSvgToTabs(d.node,MyBrowserProperties.ClipartDisplayWidth,MyBrowserProperties.ClipartDisplayHeight,e,false,d.onitemadded,true);if(typeof(d.oncomplete)==FUNCTION_KEYWORD){d.oncomplete()}};c.getClipartContent=function(e,g,f){if($("#cliplib-"+e+"-content .waiting").length>0){a(e,1,g,f)}};var a=function(e,i,h,g){var f=CreatorUrls.LibraryImages+"?svg_category_id="+e+"&page="+i+"&time="+TimeStamp;if(CreatorUrls.UseCdnForLibraryAssets&&MyBrowserProperties.SupportsCdn()){f=CreatorUrls.Cdn+"/storyboard-creator/core-library/category-"+e+"-page-"+i+"?time="+TimeStamp}$.getJSON(f).success((function(j,m,l,k){return function(n){b(j,n,l);if(m<4){a(j,m+1,l,k)}else{if(typeof(k)===FUNCTION_KEYWORD){k()}}}}(e,i,h,g)))};var b=function(e,l,k){$("#cliplib-"+e+"-content .waiting").remove();var m=$("#cliplib-"+e+"-content");e=parseInt(e);var h=((e>=18&&e<=24)||e==38||e==39||e==42||(e>=79&&e<=82)||(e>=94&&e<=110)||e==139||e==140||e==156);var g=(e>=94&&e<=110)||e==140;var j=(e===153||e===154||e===165||e===166||e===167||e===168||e===169);for(var f=2;f<l.length;f++){if(g){AddSvg.AddSvgToTabs(m,MyBrowserProperties.ClipartDisplayWidth16x9Scene,MyBrowserProperties.ClipartDisplayHeight,l[f],h,k,false)}else{if(h){AddSvg.AddSvgToTabs(m,MyBrowserProperties.ClipartDisplayWidthScene,MyBrowserProperties.ClipartDisplayHeight,l[f],h,k,false)}else{if(j){AddSvg.AddSvgToTabs(m,MyBrowserProperties.ClipartDisplayWidth16x9Scene,MyBrowserProperties.ClipartDisplayHeight,l[f],h,k,false)}else{AddSvg.AddSvgToTabs(m,MyBrowserProperties.ClipartDisplayWidth,MyBrowserProperties.ClipartDisplayHeight,l[f],h,k,false)}}}}};return c}());var SvgSearch=function(){var d={Title:1,Content:2,More:3,};var n;var o;var m;var c=function(q,r){switch(r){case d.Title:return"search-tab-"+q+"-title";case d.Content:return"search-tab-"+q+"-content";case d.More:return"search-tab-"+q+"-more"}};var h=function(q){return m.find("li a[title='"+q+"']")};var g=function(r){var s=h(r);var q=c(s.data("SearchTabBaseId"),d.Content);return $("#"+q)};var b=function(s,t){var r="";var q="";r+='<li class="active">';r+='   <a id="'+c(s,d.Title)+'" title="'+t+'">'+t+"</a>";r+="</li>";q+='<div id="'+c(s,d.Content)+'" class="content-list">';q+='     <div class="waiting">'+MyLangMap.GetTextByToken("text-search-loading")+"</div>";q+='     <div class="search-more"><a id="'+c(s,d.More)+'">'+MyLangMap.GetTextByToken("text-search-more")+"</a></div>";q+="</div>";return[r,q]};var a=function(t){var q=$("#tab-search-results-content-container");m.find("li.active").removeClass("active");q.find(".content-list").addClass("hidden");var u="s-"+m.find("li").length;var s=b(u,t);m.append(s[0]);q.append(s[1]);var v=$("#"+c(u,d.Title));v.data("SearchTabBaseId",u);var r=$("#"+c(u,d.More));r.click(this.SearchMore);r.data("SearchString",t);r.data("Page",1);n.removeClass("hidden").find("a").trigger("click");TabRoller.RefreshRollers_PostChangeTab("tab-search-results-content-container");$(".subcategory-ul").resize();setTimeout(StoryboardContainer.JiggleSvgSize,500);return $("#"+c(u,d.Content))};function e(r){if($(r.target).hasClass("dropdown-toggle")){return}r.preventDefault();var s=isLIHit(r.target,this);if(s==null){return false}var t=$(s).find("a");$(this).find("li").removeClass("active");$(s).addClass("active");TabRoller.RefreshRollers_PostChangeTab("tab-search-results-content-container");$("#tab-search-results-content-container .content-list").addClass("hidden");var q=c(t.data("SearchTabBaseId"),d.Content);$("#"+q).removeClass("hidden")}function l(u,q){q.data("ItemsToDownload",u.length);if(u.length==0){if(q.find(".ClipartItemPanel").length==0){q.append("<div class='no-results'>"+MyLangMap.GetTextByToken("text-search-no-results")+"</div>")}else{q.append("<div class='no-results'>"+MyLangMap.GetTextByToken("text-search-no-more-results")+"</div>")}q.find(".waiting").hide();return}for(var r=0;r<u.length;r++){if(u[r].startsWith("/search")||u[r].indexOf("storyboardsearch")>0){$.ajax({caller:"SvgSearch.ProcessSearchResultsList",type:"GET",url:u[r]}).done(k(q))}if(u[r].startsWith("swal:")){var s=q.data("ItemsToDownload")-1;q.data("ItemsToDownload",s);var t=u[r].substring(5);swalQueue(MyLangMap.GetTextByToken("text-search-tip"),t)}}}function k(q){return function(r){var s=q.data("ItemsToDownload")-1;q.data("ItemsToDownload",s);if(r!=null&&r.svg!=null&&r.svg!=""){AddSvg.AddSvgToTabs(q,MyBrowserProperties.ClipartDisplayWidth,MyBrowserProperties.ClipartDisplayHeight,r.svg,false,null)}if(s==0){q.find(".waiting").hide();q.find(".search-more").show()}}}var j=false;function i(r){var s=o.cleanupInput({noquotes:true}).fixedVal();if(s===EMPTY_STRING){return}s=s.toUpperCase();var t=h(s);if(t.length===0){var q=a(s);q.find(".waiting").show();q.find(".search-more").hide();try{if(j==false&&MyUserPermissions.EnableUploads==false){j=true;$("#PurchaseForPhotosForClass").modal("show")}}catch(r){LogErrorMessage("PerformSearch.P4c Popup",r)}f(s,1,function(u){l(u,q)},function(){})}else{n.find("a").trigger("click");t.trigger("click")}}this.SearchMore=function(r){var s=parseInt($(this).data("Page"))+1;$(this).data("Page",s);var t=$(this).data("SearchString");var q=g(t);q.find(".waiting").show();q.find(".search-more").hide();f(t,s,function(u){l(u,q)},function(){})};function f(t,s,q,r){$.getJSON("/search2/searchweb?page="+s+"&searchstring="+t+"&photosForClass="+ExtraSetup.PhotosForClassSearchType).success(q).error(r)}var p=new Object();p.Load=function(){n=$("#searchResultTab");o=$("#cliplib-search-txt");m=$("#tab-search-results-tab-list");$("#tab-search-results-tab-list").click(e);o.keydown(function(q){q.stopPropagation()});o.keypress(function(q){q.stopPropagation();if(q.which==13){if($(this).cleanupInput({noquotes:true}).fixedVal()!==EMPTY_STRING){$("#cliplib-search-btn").trigger("click")}}});$("#cliplib-search-btn").click(i)};return p}();function MathUtilsLibrary(){}MathUtilsLibrary.prototype.CartesianSegmentLength=function(f,e){var c=e.X-f.X;var d=e.Y-f.Y;return Math.sqrt((c*c)+(d*d))};function Point(a,b){this.X=a||0;this.Y=b||0}Point.prototype.ToString=function(){return this.X+","+this.Y};Point.prototype.Mult=function(b){var a=new Point(this.X,this.Y);a.X*=b;a.Y*=b;return a};Point.Up=Object.freeze(new Point(0,-1));Point.Down=Object.freeze(new Point(0,1));Point.Left=Object.freeze(new Point(-1,0));Point.Right=Object.freeze(new Point(1,0));Point.CubicBezierCircleUnit=Object.freeze(new Number(-0.55191502449));var SvgCloner=function(){var a=new Object();a.CloneSvg=function(g,q,n,r,j){var h=$("#"+g);var f=$("#"+q).clone();StoryboardContainer.UpdateGradientIds(f);f.attr("id",n);var e=new Array();RecursivelyFindChildrenIds(f,e);for(var k=0;k<e.length;k++){var o=e[k];var m=o.replaceAll(q,n);FindAndUpdateId(n,o,m)}f.attr("id",n);f.attr("class","");f.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").remove();f.find("[id$='"+SvgPartsEnum.SelectionBoxRectangle+"'], [id$='_defs']").remove();f.find("[id$='"+SvgPartsEnum.CropGroup+"']").removeAttr("clip-path").attr("id",n+SvgPartsEnum.CropGroup);var p=f.find("[id$='"+SvgPartsEnum.Scale+"']").attr("id",n+SvgPartsEnum.Scale);f.find("[id$='"+SvgPartsEnum.Natural+"']").attr("id",n+SvgPartsEnum.Natural);p.attr("transform","scale(1,1)");h.children().remove();h.attr("width",r);h.attr("height",j);h.append(f);var b=GetGlobalById(n).getBBox();var s=(r-5)/b.width;var t=(j-5)/b.height;var l=Math.min(s,t);p.attr("transform","scale("+l+")");var c=(r-((b.width)*l))/2;c-=(b.x*l);var d=(j-((b.height)*l))/2;d-=(b.y*l);f.attr("transform","translate("+c+", "+d+")")};return a}();function BrowserProperties(){this.ClipartDisplayWidth=66;this.ClipartDisplayHeight=95;this.ClipartDisplayWidthScene=105;this.ClipartDisplayWidth16x9Scene=169;this.CompressionRatio=1;this.IsSafari5=false;this.IsMobile=false;this.IsIE9=false;this.IsOldIE=false;this.IsChrome=false;this._SupportsCdn=null;this.Private_DefaultFont="";this.Public_GetDefaultFont=function(){if(this.Private_DefaultFont.length>0){return this.Private_DefaultFont}this.Private_DefaultFont=FontList.GetCreatorDefaultFontForLanguageSupport(window.navigator.userLanguage||window.navigator.language);return this.Private_DefaultFont};this.SupportsSvg=function(){try{if(document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")===false){return false}var b=navigator.userAgent;if(b.indexOf("Safari/533")>0){return false}if(b.indexOf("Safari/531")>0){return false}if(b.indexOf("MSIE 8.0")>0){return false}if(b.indexOf("Firefox/3.6")>0){return false}if(b.indexOf("Mozilla/4.0")>=0){return false}if(b.indexOf("UCBrowser")>=0||b.indexOf("UCWEB")>=0){if(Modernizr.svg==false){LogErrorMessage("Supports Svg - UCBrowser - FALSE - "+b);return false}else{if(b.indexOf("10.")||b.indexOf("9.")){LogErrorMessage("Supports Svg - UCBrowser - Manual Rejection - "+b);return false}else{LogErrorMessage("Supports Svg - UCBrowser - TRUE - "+b)}}}if(b.indexOf("MSIE 9.0")>0){swalQueue({title:"",text:MyLangMap.GetTextLineBreaksByToken("warning-upgrade-ie9"),type:"error",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")})}}catch(a){return false}return true};this.EnableCompression=function(){return MyUserPermissions.UseCompression};this.SupportsWebWorkers=function(){try{return Modernizr.webworkers}catch(a){return false}};this.DetermineBrowserInfo=function(){if(navigator.userAgent.indexOf("Safari/534")>0){this.IsSafari5=true}if(navigator.userAgent.indexOf("Chrome")>0){this.IsChrome=true}if($("#ieversion span").is(".ie8")){this.IsOldIE=true}if($("#ieversion span").is(".ie9")){this.IsOldIE=true;this.IsIE9=true}this.IsMobile=this._DetermineMobile();if(this.IsMobile){$("#toggle-keyboard-controls").toggle();$("#tab-roller").css("font-size","18px")}};this._DetermineMobile=function(){if(Modernizr.touchevents==false){return false}var a=navigator.platform.toLowerCase();if(a.indexOf("win")>=0||a.indexOf("mac")>=0){swalQueue({title:MyLangMap.GetTextByToken("Text-Smartboard-Title"),text:MyLangMap.GetTextByToken("Text-Smartboard-Text"),type:"info",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:MyLangMap.GetTextByToken("Text-Smartboard-Option-Mouse"),cancelButtonText:MyLangMap.GetTextByToken("Text-Smartboard-Option-Touch"),closeOnConfirm:true,closeOnCancel:true},function(c){if(c){MyBrowserProperties.SetSmartBoard(false)}else{MyBrowserProperties.SetSmartBoard(true)}StoryboardContainer.JiggleSvgSize()});return false}var b=navigator.userAgent;if(/iPad/i.test(b)||/iPhone/i.test(b)||/iPod/i.test(b)||/Android/i.test(b)){return true}return window.confirm(MyLangMap.GetTextByToken("Text-Confirm-Mobile"))};this.SetSmartBoard=function(a){MyBrowserProperties.IsMobile=a;inputAdapter.useDelegation(a);if(a){$("#toggle-keyboard-controls").css("display","")}else{$("#toggle-keyboard-controls").css("display","none")}ValidateUILayout()};this.SupportsCdn=function(){try{if(MyBrowserProperties._SupportsCdn!=null){return MyBrowserProperties._SupportsCdn}$.get("https://cdn.storyboardthat.com/storyboard-creator/core-library/test-cdn.txt").success(function(b){MyBrowserProperties._SupportsCdn=true}).error(function(d,f,c){try{MyBrowserProperties._SupportsCdn=false;LogErrorMessage("unable to reach CDN")}catch(b){}});if(MyBrowserProperties._SupportsCdn!=null){return MyBrowserProperties._SupportsCdn}}catch(a){LogErrorMessage("BrowserProperties.SupportsCdn",a)}return false}};var FontList=(function(a){a.Config={Local:[{Family:"Komika Text",Title:"Komika",SvgLookupName:"komika",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"komtxt__-webfont",FontFileSvgReferenceHash:"komika_textregular",FontWeight:"normal",FontStyle:"normal"},{Family:"OpenDyslexic",Title:"Open Dyslexic",SvgLookupName:"dyslexic",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"opendyslexic-regular",FontFileSvgReferenceHash:"OpenDyslexic-Regular",FontWeight:"normal",FontStyle:"normal"},],Google:[{Family:"Coustard",Title:"Coustard",SvgLookupName:"coustard",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"coustard",UrlFontName:"Coustard"},{Family:"Montserrat Alternates",Title:"Montserrat",SvgLookupName:"montserrat",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"montserrat",UrlFontName:"Montserrat+Alternates"},{Family:"Francois One",Title:"Francois One",SvgLookupName:"francois",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"francoisone",UrlFontName:"Francois+One"},{Family:"Creepster",Title:"Creepster",SvgLookupName:"creepster",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"creepster",UrlFontName:"Creepster"},{Family:"Lobster Two",Title:"Lobster Two",SvgLookupName:"lobster",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"lobstertwo",UrlFontName:"Lobster+Two"},{Family:"Germania One",Title:"Germania One",SvgLookupName:"germania",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"germaniaone",UrlFontName:"Germania+One"},{Family:"Lora",Title:"Lora",SvgLookupName:"lora",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"Lora-regular",UrlFontName:"Lora"},{Family:"Roboto",Title:"Roboto",SvgLookupName:"roboto",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"Roboto-Regular",UrlFontName:"Roboto"},{Family:"Varela Round",Title:"Varela Round",SvgLookupName:"varela",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["Hebrew","Romanian","Polish","Czech"],FontFileBaseName:"VarelaRound-Regular",UrlFontName:"Varela+Round"},{Family:"Suez One",Title:"Suez One",SvgLookupName:"suez",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["Hebrew","Turkish","Romanian","Polish","Czech"],FontFileBaseName:"SuezOne-Regular",UrlFontName:"Suez+One"},{Family:"Tinos",Title:"Tinos",SvgLookupName:"tinos",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["Hebrew","Greek","Vietnamese","Russian"],FontFileBaseName:"Tinos-Regular",UrlFontName:"Tinos"},{Family:"Lemonada",Title:"Lemonada",SvgLookupName:"lemonada",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["Arabic","Turkish","Romanian","Polish","Czech"],FontFileBaseName:"Lemonada-Regular",UrlFontName:"Lemonada"},{Family:"Lateef",Title:"Lateef",SvgLookupName:"lateef",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["Arabic"],FontFileBaseName:"LateefRegOT",UrlFontName:"Lateef"},{Family:"Lalezar",Title:"Lalezar",SvgLookupName:"lalezar",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["Arabic","Turkish","Romanian","Polish","Czech"],FontFileBaseName:"Lalezar-Regular",UrlFontName:"Lalezar"},{Family:"Dekko",Title:"Dekko",SvgLookupName:"dekko",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["Hindi","Turkish","Romanian","Polish","Czech"],FontFileBaseName:"Dekko-Regular",UrlFontName:"Dekko"},{Family:"Noto Sans",Title:"Noto Sans",SvgLookupName:"noto",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["Russian","Hindi"],FontFileBaseName:"NotoSans-Regular",UrlFontName:"Noto+Sans"},{Family:"Palanquin Dark",Title:"Palanquin Dark",SvgLookupName:"palanquin",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["Hindi","Turkish","Romanian","Polish","Czech"],FontFileBaseName:"PalanquinDark-Regular",UrlFontName:"Palanquin+Dark"},{Family:"Raleway Dots",Title:"Raleway Dots",SvgLookupName:"raleway",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["Hindi","Turkish","Romanian","Polish","Czech"],FontFileBaseName:"raleway-dots",UrlFontName:"Raleway+Dots"},{Family:"Acme",Title:"Acme",SvgLookupName:"acme",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"acme",UrlFontName:"Acme"},{Family:"Alfa Slab One",Title:"Alfa Slab One",SvgLookupName:"alfa",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"alfaslabone",UrlFontName:"Alfa+Slab+One"},{Family:"Alice",Title:"Alice",SvgLookupName:"alice",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"alice",UrlFontName:"Alice"},{Family:"Amiko",Title:"Amiko",SvgLookupName:"amiko",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"amiko",UrlFontName:"Amiko"},{Family:"Annie Use Your Telescope",Title:"Annie Use Your Telescope",SvgLookupName:"annie",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"annieuseyourtelescope",UrlFontName:"Annie+Use+Your+Telescope"},{Family:"Berkshire Swash",Title:"Berkshire Swash",SvgLookupName:"berkshire",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"berkshireswash",UrlFontName:"Berkshire+Swash"},{Family:"BioRhyme",Title:"BioRhyme",SvgLookupName:"biorhyme",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"biorhyme",UrlFontName:"BioRhyme"},{Family:"Cabin Sketch",Title:"Cabin Sketch",SvgLookupName:"cabin",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"cabinsketch",UrlFontName:"Cabin+Sketch"},{Family:"Chango",Title:"Chango",SvgLookupName:"chango",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"chango",UrlFontName:"Chango"},{Family:"Clicker Script",Title:"Clicker Script",SvgLookupName:"clicker",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"clickerscript",UrlFontName:"Clicker+Script"},{Family:"Cherry Swash",Title:"Cherry Swash",SvgLookupName:"cherry",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"cherryswash",UrlFontName:"Cherry+Swash"},{Family:"Cutive Mono",Title:"Cutive Mono",SvgLookupName:"cutive",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"cutivemono",UrlFontName:"Cutive+Mono"},{Family:"Erica One",Title:"Erica One",SvgLookupName:"erica",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"ericaone",UrlFontName:"Erica+One"},{Family:"Fredoka One",Title:"Fredoka One",SvgLookupName:"fredoka",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"fredokaone",UrlFontName:"Fredoka+One"},{Family:"Glass Antiqua",Title:"Glass Antiqua",SvgLookupName:"glass",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"glassantiqua",UrlFontName:"Glass+Antiqua"},{Family:"Gochi Hand",Title:"Gochi Hand",SvgLookupName:"gochi",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"gochihand",UrlFontName:"Gochi+Hand"},{Family:"Kranky",Title:"Kranky",SvgLookupName:"kranky",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"kranky",UrlFontName:"Kranky"},{Family:"Love Ya Like A Sister",Title:"Love Ya Like A Sister",SvgLookupName:"love ya",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"loveyalikeasister",UrlFontName:"Love+Ya+Like+A+Sister"},{Family:"Open Sans",Title:"Open Sans",SvgLookupName:"open sans",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"opensans",UrlFontName:"Open+Sans"},{Family:"Pacifico",Title:"Pacifico",SvgLookupName:"pacifico",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"pacifico",UrlFontName:"Pacifico"},{Family:"Permanent Marker",Title:"Permanent Marker",SvgLookupName:"permanent",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"permanentmarker",UrlFontName:"Permanent+Marker"},{Family:"Play",Title:"Play",SvgLookupName:"play",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"play",UrlFontName:"Play"},{Family:"Playball",Title:"Playball",SvgLookupName:"playball",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"playball",UrlFontName:"Playball"},{Family:"Ribeye",Title:"Ribeye",SvgLookupName:"ribeye",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"ribeye",UrlFontName:"Ribeye"},{Family:"Righteous",Title:"Righteous",SvgLookupName:"righteous",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"righteous",UrlFontName:"Righteous"},{Family:"Rye",Title:"Rye",SvgLookupName:"rye",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"rye",UrlFontName:"Rye"},{Family:"Sedgwick Ave",Title:"Sedgwick Ave",SvgLookupName:"sedgwick",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"sedgwickave",UrlFontName:"Sedgwick+Ave"},{Family:"Spicy Rice",Title:"Spicy Rice",SvgLookupName:"spicy",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"spicyrice",UrlFontName:"Spicy+Rice"},{Family:"Sriracha",Title:"Sriracha",SvgLookupName:"sriracha",SupportsStandardLatinLanguages:true,SupportedInternationalLanguages:["None"],FontFileBaseName:"sriracha",UrlFontName:"Sriracha"},]};return a})(FontList||{});var FontList=(function(a){var b={Coustard:{he:"Tinos",ar:"Lateef",hi:'"Noto Sans"',ru:"Lora",bg:"Lora",ro:'"Suez One"',pl:'"Suez One"',cs:'"Suez One"',tr:'"Suez One"',sk:'"Suez One"',hu:'"Suez One"',hr:'"Suez One"',lt:'"Suez One"',sl:'"Suez One"',lv:'"Suez One"',et:'"Suez One"'},Creepster:{he:'"Suez One"',ar:"Lalezar",hi:'"Palanquin Dark"',ru:'"Noto Sans"',bg:'"Noto Sans"',ro:"Dekko",pl:"Dekko",cs:"Dekko",tr:"Dekko",sk:"Dekko",hr:"Dekko",hu:"Dekko",lt:"Dekko",sl:"Dekko",lv:"Dekko",et:"Dekko"},Dekko:{ru:"Roboto"},'"Francois One"':{he:'"Suez One"',ar:"Lalezar",hi:'"Palanquin Dark"',ru:"Roboto",bg:"Roboto",ro:'"Palanquin Dark"',pl:'"Palanquin Dark"',cs:'"Palanquin Dark"',tr:'"Palanquin Dark"',sk:'"Palanquin Dark"',hr:'"Palanquin Dark"',hu:'"Palanquin Dark"',lt:'"Palanquin Dark"',sl:'"Palanquin Dark"',lv:'"Palanquin Dark"',et:'"Palanquin Dark"'},'"Germania One"':{he:'"Suez One"',ar:"Lateef",hi:'"Palanquin Dark"',ru:'"Noto Sans"',bg:'"Noto Sans"',ro:'"Suez One"',tr:'"Suez One"',pl:'"Suez One"',cs:'"Suez One"',sk:'"Suez One"',hr:'"Suez One"',hu:'"Suez One"',lt:'"Suez One"',sl:'"Suez One"',lv:'"Suez One"',et:'"Suez One"'},'"Komika Text"':{he:'"Varela Round"',ar:"Lemonada",hi:"Dekko",ru:'"Noto Sans"',bg:'"Noto Sans"',ro:"Dekko",pl:"Dekko",cs:"Dekko",tr:"Dekko",sk:"Dekko",hr:"Dekko",hu:"Dekko",lt:"Dekko",sl:"Dekko",lv:"Dekko",et:"Dekko"},Lalezar:{ru:"Roboto",bg:"Roboto"},Lateef:{ru:"Tinos",bg:"Tinos",sk:"Tinos",hr:"Tinos",hu:"Tinos",lt:"Tinos",sl:"Tinos",lv:"Tinos",et:"Tinos"},Lemonada:{ru:'"Noto Sans"',bg:'"Noto Sans"'},'"Lobster Two"':{he:"Tinos",ar:"Lemonada",hi:"Dekko",ru:'"Noto Sans"',bg:'"Noto Sans"',ro:"Lemonada",pl:"Lemonada",cs:"Lemonada",tr:"Lemonada"},Lora:{he:"Tinos",ar:"Lateef",hi:'"Noto Sans"',ro:"Lemonada",pl:"Lemonada",cs:"Lemonada",tr:"Lemonada"},'"Montserrat Alternates"':{he:'"Varela Round"',ar:"Lemonada",hi:"Dekko",ru:"Tinos",bg:"Tinos",ro:'"Palanquin Dark"',pl:'"Palanquin Dark"',cs:'"Palanquin Dark"',tr:'"Palanquin Dark"',sk:'"Palanquin Dark"',hr:'"Palanquin Dark"',hu:'"Palanquin Dark"',lt:'"Palanquin Dark"',sl:'"Palanquin Dark"',lv:'"Palanquin Dark"',et:'"Palanquin Dark"'},OpenDyslexic:{he:'"Varela Round"',ar:"Lemonada",hi:"Dekko",ru:"Roboto",bg:"Roboto"},'"Palenquin Dark"':{ru:"Roboto",bg:"Roboto"},Roboto:{he:'"Varela Round"',ar:"Lemonada",hi:'Noto Sans"',ro:'"Varela Round"'},Tinos:{},'"Varela Round"':{ru:"Tinos",bg:"Tinos",sk:"Tinos",hr:"Tinos",hu:"Tinos",lt:"Tinos",sl:"Tinos",lv:"Tinos",et:"Tinos"}};a.GetLocalizedFontSubstitution=function(d,c){c=c.replaceAll("'",'"');if(!b.hasOwnProperty(c)){return c}if(!b[c].hasOwnProperty(d)){return c}return b[c][d]};a.GetGoogleCssInjectionMarkupForFoundFontUsage=function(c){return a.GetCssInjectionMarkupForFoundFontUsage(c,"google")};a.GetLocalCssInjectionMarkupForFoundFontUsage=function(c){return a.GetCssInjectionMarkupForFoundFontUsage(c,"local")};a.GetCssInjectionMarkupForFoundFontUsage=function(g,h){var c=g.toLowerCase();var f="";var d="";if(h==null||h=="local"){for(var e=0;e<a.Config.Local.length;e++){if(c.indexOf(a.Config.Local[e].SvgLookupName)>-1){f='<link rel="stylesheet" href="/content/css/storyboardfonts.css.min.css" type="text/css" />';break}}if(h=="local"){return f}}if(h==null||h=="google"){var j=[];for(var e=0;e<a.Config.Google.length;e++){if(c.indexOf(a.Config.Google[e].SvgLookupName)>-1){j.push(a.Config.Google[e].UrlFontName)}}d=(j.length==0)?"":'<link rel="stylesheet" href="//fonts.googleapis.com/css?family='+j.join("|")+'" type="text/css" />'}return f+d};a.SubstituteObsoleteFont=function(c){var d=c.toLowerCase();var e={arial:"Roboto",calibri:"Roboto",courier:"Roboto",junction:"'Montserrat Alternates'",gothic:"'Francois One'",linden:"Lora",nobile:"'Montserrat Alternates'",goudy:"Coustard",aleo:"Coustard",questrial:"'Montserrat Alternates'","green fuz":"Creepster","times new roman":"Lora",david:"'Varela Round'"};for(var f in e){if(e.hasOwnProperty(f)){if(d.indexOf(f)>-1){return e[f]}}}return c};a.GetCreatorDefaultFontForLanguageSupport=function(c){try{if(["ca","da","de","en","es","fi","fr","it","nb","nl","pl","sv","se"].map(function(e){return c.indexOf(e)>-1}).filter(function(e){return e}).length>-1){return"'Francois One'"}if(c.indexOf("he")>-1){return"'Varela Round'"}}catch(d){}return"'Francois One'"};a.GetCoreFontList=function(){return a.Config.Local.filter(function(c){return c.SupportsStandardLatinLanguages}).map(function(c){return{Family:c.Family,Title:c.Title}}).concat(a.Config.Google.filter(function(c){return c.SupportsStandardLatinLanguages}).map(function(c){return{Family:c.Family,Title:c.Title}})).sort(function(c,d){return c.Title>d.Title})};return a})(FontList||{});function UserPermissions(a,b){this.IsLoggedOn=b;this.EnableAllCellOptions=a.EnableAllCellOptions;this.EnableUploads=a.EnableUploads;this.UseCompression=a.UseCompression;this.MagicToken=a.MagicToken;this.AllowNewSave=false;this.AllowEditSave=false;this.SaveMessage="";this.ModalPop="";this.PortalFolders=null;this.SelectedPortalFolder=null;var e=function(i,g,j,f){j.AllowNewSave=i.AllowNewSave;j.AllowEditSave=i.AllowEditSave;j.EnableUploads=i.EnableUploads;j.EnableAllCellOptions=i.EnableAllCellOptions;j.IsLoggedOn=i.LoggedOn;j.SaveMessage=MyLangMap.GetTextById(i.SaveMessageId);j.PortalFolders=i.PortalFolders;try{j.SelectedPortalFolder=i.SelectedPortalFolder}catch(h){LogErrorMessage("UserPermissions.Public_RefreshPermissions.selectedportalfolder",h)}j.FolderTitle=MyLangMap.GetTextById(i.FolderTitleId);j.NoFolderTitle=MyLangMap.GetTextById(i.NoFolderTitleId);j.MagicToken=i.MagicToken;try{j.ModalPop=i.ModalPopToken}catch(h){LogErrorMessage("UserPermissions.Public_RefreshPermissions.ModalPop",h)}if(j.EnableAllCellOptions){StoryboardContainer.RemoveUpgradeCtas()}f()};var d=function(g,h,f){LogAjaxError("UserPermissions.Public_RefreshPermissions",g,h,f);swalQueue({title:"",text:MyLangMap.GetTextByToken("Error-Save-Internet"),type:"error",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button"),additionalInfoTitle:"Technical Info",additionalInfoText:LastErrorMessage()});SbtUnblockUI()};var c=function(i,h,k,j,f){var g="/api_storyboardcreator/userstoryboardaccess?logresult="+i+"&magictoken="+j+"&time="+TimeStamp+"&hideFoldersWithoutGroups="+HideFoldersWithoutGroups;if(h!=null&&h!=""){g+="&folderid="+h}jQuery.ajax({caller:"UserPermissions.Public_RefreshPermissions (fallback)",type:"GET",url:g,async:true,cache:false,timeout:180*1000,error:d,success:function(m,l){e(m,l,k,f);LogErrorMessage("(Self-Heal) UserPermissions.Public_RefreshPermissions was able to fallback to www")},})};this.Public_RefreshPermissions=function(k,g){var l=this;try{var j="";try{j=GetQueryStringParameterByName("f")}catch(i){LogErrorMessage("Public_RefreshPermissions.folderId",i)}var h=SbtApiServer+"/userstoryboardaccess/"+(j||"")+"?magictoken="+this.MagicToken+"&hideFoldersWithoutGroups="+HideFoldersWithoutGroups;var n=this;var m;var f=jQuery.ajaxAuth(m={caller:"UserPermissions.Public_RefreshPermissions",type:"GET",url:h,async:true,cache:false,timeout:180*1000,userKey:IsUserLoggedOn}).fail(function(p,q,o){c(k,j,n,l.MagicToken,g)}).done(function(p,o){if(p.LoggedOn!=(IsUserLoggedOn>0)){LogAjaxError("Public_RefreshPermissions unexpected IsLoggedOn value",f,"OK, but...","result.IsLoggedOn ("+n.IsLoggedOn+") does not match expected value ("+(IsUserLoggedOn>0)+")",m);c(k,j,n,l.MagicToken,g)}else{e(p,o,n,g)}})}catch(i){LogErrorMessage("SvgManip.UpdateUserPermissions",i)}}};function BaseStoryboardLayout(b,a,d,c){this.LayoutType="";this._Padding=c;this._CellStroke=2;this.ContainerBorderPaddingRight=0;this.ContainerBorderPaddingBottom=this._Padding;this.WatermarkPaddingTop=25;this.Row1PaddingTop=0;this.Row1PaddingLeft=this._Padding;this.CellPaddingLeft=this._Padding;this.CellPaddingTop=this._Padding;this.CellHeight=336;this.CellWidth=372;this.TitlePaddingTop=0;this.TitleHeight=0;this.DescriptionHeight=0;this.DescriptionPaddingTop=0;this.BetweenRowPadding=0;this.TitleLayout=new BasicTextLayoutTitle();this.DescriptionLayout=new BasicTextLayoutDescription();this.Stroke="#757575";this.StrokeWidth="2";this.Fill="white";this.Rx="2";this.Ry="2";this.StrokeDashArray="";this.Opacity="1";this.BackGroundOffsetX=0.5;this.BackGroundOffsetY=0.5;this.DefaultDropWidth=180;this.DefaultDropHeight=180;this.HasTitle=false;this.HasDescription=false;this.UnscaledCellWidth=372;this.AllowTitlesAndDescriptions=true;this.EnableDescription(a);this.EnableTitle(b);this.ExpandCells(d)}BaseStoryboardLayout.prototype._ExtraFullColumnWidth=function(){return 0};BaseStoryboardLayout.prototype._ExtraFullRowHeight=function(){return 0};BaseStoryboardLayout.prototype.FullColumnWidth=function(){var a=this.CellPaddingLeft;a+=this.CellWidth;a+=this._ExtraFullColumnWidth();return a};BaseStoryboardLayout.prototype.FullRowHeight=function(){var a=this.TitlePaddingTop;a+=this.TitleHeight;a+=this.CellPaddingTop;a+=this.CellHeight;a+=this.DescriptionPaddingTop;a+=this.DescriptionHeight;a+=this.BetweenRowPadding;a+=this._ExtraFullRowHeight();return a};BaseStoryboardLayout.prototype.BeforeCellHeight=function(){var a=this.TitlePaddingTop;a+=this.TitleHeight;a+=this.CellPaddingTop;return a};BaseStoryboardLayout.prototype.BeforeDescriptionHeight=function(){var a=this.TitlePaddingTop;a+=this.TitleHeight;a+=this.CellPaddingTop;a+=this.CellHeight;a+=this.DescriptionPaddingTop;return a};BaseStoryboardLayout.prototype._ExpandCellsLayoutSpecific=function(a){};BaseStoryboardLayout.prototype.ExpandCells=function(a){if(a==null||isNaN(a)){return}this.CellWidth*=a;this.CellHeight*=a;this.DefaultDropWidth*=a;this.DefaultDropHeight*=a;this.CellPaddingTop*=a;this.CellPaddingLeft*=a;this.Row1PaddingTop*=a;this.Row1PaddingLeft*=a;this.ContainerBorderPaddingRight*=a;this.TitlePaddingTop*=a;this.TitleHeight*=a;this.DescriptionHeight*=a;this.DescriptionPaddingTop*=a;this.BetweenRowPadding*=a;this._ExpandCellsLayoutSpecific(a)};BaseStoryboardLayout.prototype.Activate=function(){};BaseStoryboardLayout.prototype.Deactivate=function(){};BaseStoryboardLayout.prototype._EnableTitleLayoutSpecific=function(a){};BaseStoryboardLayout.prototype.EnableTitle=function(a){if(a==null||a==this.HasTitle){return}if(a){var b=this.GetScale();this.TitlePaddingTop=b*this._Padding;this.TitleHeight=b*50;this.BetweenRowPadding=25}else{this.TitlePaddingTop=0;this.TitleHeight=0;if(this.HasDescription==false){this.BetweenRowPadding=0}}this.HasTitle=a;this._EnableTitleLayoutSpecific(a)};BaseStoryboardLayout.prototype._EnableDescriptionLayoutSpecific=function(a){};BaseStoryboardLayout.prototype.EnableDescription=function(a){if(a==null||a==this.HasDescription){return}if(a){var b=this.GetScale();this.DescriptionPaddingTop=b*this._Padding;this.DescriptionHeight=b*90;this.BetweenRowPadding=25}else{this.DescriptionPaddingTop=0;this.DescriptionHeight=0;if(this.HasTitle==false){this.BetweenRowPadding=0}}this.HasDescription=a;this._EnableDescriptionLayoutSpecific(a)};BaseStoryboardLayout.prototype.GetScale=function(){return this.CellWidth/this.UnscaledCellWidth};BaseStoryboardLayout.prototype.GetStoryboardAreaTitleLayout=function(a){return null};BaseStoryboardLayout.prototype.GetCellTitleOverrideText=function(b,a){return this.TitleLayout.DefaultText};BaseStoryboardLayout.prototype.GetLayoutLines=function(b,a){StoryboardContainer.ClearLogos();return null};BaseStoryboardLayout.prototype.GetCellPartPosition=function(b,c,a){switch(b){case StoryboardPartTypeEnum.StoryboardCell:return this._CellPosition(c,a);case StoryboardPartTypeEnum.StoryboardCellTitle:return this._CellTitlePosition(c,a);case StoryboardPartTypeEnum.StoryboardCellDescription:return this._CellDescriptionPosition(c,a);case StoryboardPartTypeEnum.StoryboardAreaTitle:return this._AreaTitlePosition(c,a);case StoryboardPartTypeEnum.StoryboardAttributionArea:return this._AttributionAreaPosition(c,a)}};BaseStoryboardLayout.prototype._CellPosition=function(c,b){var d=this.Row1PaddingLeft+(b*(this.CellPaddingLeft+this.CellWidth));var e=this.Row1PaddingTop+this.BeforeCellHeight()+(c*(this.FullRowHeight()));var a=new BoxPosition(this.CellHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCell);return a};BaseStoryboardLayout.prototype._CellTitlePosition=function(c,b){var d=this.Row1PaddingLeft+(b*(this.CellPaddingLeft+this.CellWidth));var e=this.Row1PaddingTop+this.TitlePaddingTop+(c*(this.FullRowHeight()));var a=new BoxPosition(this.TitleHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellTitle);return a};BaseStoryboardLayout.prototype._CellDescriptionPosition=function(c,b){var d=this.Row1PaddingLeft+(b*(this.CellPaddingLeft+this.CellWidth));var e=this.Row1PaddingTop+this.BeforeDescriptionHeight()+(c*(this.FullRowHeight()));var a=new BoxPosition(this.DescriptionHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellDescription);return a};BaseStoryboardLayout.prototype._AttributionAreaPosition=function(c,b){var d=this._GetStoryboardSizePreAttribution(c,b);var a=new BoxPosition(20,d.Width-(2*this._Padding),this._Padding,d.Height+this._Padding,c,b,StoryboardPartTypeEnum.StoryboardAttributionArea);return a};BaseStoryboardLayout.prototype._AreaTitlePosition=function(b,a){return null};BaseStoryboardLayout.prototype.GetAnchorPoints=function(a){a.Top=a.Y;a.NearTop=a.Y+2*this._Padding;a.MiddleY=a.Y+a.Height/2;a.NearBottom=a.Y+a.Height-(2*this._Padding);a.Bottom=a.Y+a.Height;a.Left=a.X;a.NearLeft=a.X+2*this._Padding;a.MiddleX=a.X+a.Width/2;a.NearRight=a.X+a.Width-(2*this._Padding);a.Right=a.X+a.Width;a.Center=new Point(a.MiddleX,a.MiddleY);return a};BaseStoryboardLayout.prototype.GetMinimumStoryboardHeight=function(){var a=this.Row1PaddingTop+this.FullRowHeight()+this.ContainerBorderPaddingBottom+this.WatermarkPaddingTop+20;return a};BaseStoryboardLayout.prototype._GetStoryboardSizePreAttribution=function(c,b){var a=new BoxPosition();a.X=0;a.Y=0;a.Width=this.Row1PaddingLeft+this.ContainerBorderPaddingRight+(b*(this.FullColumnWidth()));a.Height=this.Row1PaddingTop+this.WatermarkPaddingTop+this.ContainerBorderPaddingBottom+(c*(this.FullRowHeight()))-this.BetweenRowPadding;return a};BaseStoryboardLayout.prototype.GetStoryboardSize=function(g,d){var c=this._GetStoryboardSizePreAttribution(g,d);var a=GetGlobalById("ImageAttributionGroup");if(a!=null){try{var b=a.getBBox();if(b.height>0){c.Height+=2*this._Padding+b.height}}catch(f){LogErrorMessage("BaseStoryboardLayout.GetStoryboardSize",f)}}return c};BaseStoryboardLayout.prototype.GetStoryboardContentBounds=function(c,b){var a=new BoxPosition();a.X=0;a.Y=0;a.Height=this.Row1PaddingTop+(c*(this.FullRowHeight()))-this.BetweenRowPadding;a.Width=this.Row1PaddingLeft+(b*(this.FullColumnWidth()));return a};BaseStoryboardLayout.prototype.GetWatermarkTop=function(a){var b=this.Row1PaddingTop+this.WatermarkPaddingTop+(a*this.FullRowHeight())-this.BetweenRowPadding;return b};BaseStoryboardLayout.prototype.GetLayoutConfig=function(){return new Object()};function FrayerLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,15);this.LayoutType=StoryboardLayoutType.Frayer;this._ChartLabelHeight=55;this._ChartLabelPaddingTop=2*this._Padding;this._ChartLabelPaddingBottom=2*this._Padding;this.BetweenRowPadding=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom-(this.CellPaddingTop/c);this._ChartLabelHeight*=c;this._ChartLabelPaddingTop*=c;this._ChartLabelPaddingBottom*=c;this.BetweenRowPadding*=c}inheritPrototype(FrayerLayout,BaseStoryboardLayout);FrayerLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a;this._ChartLabelPaddingTop*=a;this._ChartLabelPaddingBottom*=a};FrayerLayout.prototype._EnableDescriptionLayoutSpecific=function(a){this.BetweenRowPadding=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom-this.CellPaddingTop};FrayerLayout.prototype._EnableTitleLayoutSpecific=function(a){this.BetweenRowPadding=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom-this.CellPaddingTop};FrayerLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};FrayerLayout.prototype.GetCellTitleOverrideText=function(c,a){var b="Definitions";if(c==0&&a==1){b="Characteristics"}else{if(c==1&&a==0){b="Examples"}else{if(c==1&&a==1){b="Non-Examples"}}}return b};FrayerLayout.prototype._AreaTitlePosition=function(d,b){if(d!=0||b!=0){return}var e=this.GetStoryboardAreaTitleLayout(d,b);var c=e.StrokeWidth-3;var f=this.FullColumnWidth()/2+this.CellPaddingLeft;var g=this.FullRowHeight()+this._ChartLabelPaddingTop-this.BetweenRowPadding;var a=new BoxPosition(this._ChartLabelHeight,this.CellWidth-c,f,g,0,0,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};function FreeSizeLayout(b,a,d,c){BaseStoryboardLayout.call(this,b,a,d,12);this.LayoutType=StoryboardLayoutType.FreeSize;this.CellWidth=900;this.CellHeight=600;this.Stroke="black";this.StrokeWidth="0";this.Row1PaddingTop=0;this.Row1PaddingLeft=0;this.ContainerBorderPaddingRight=0;this.ContainerBorderPaddingBottom=0;this.WatermarkPaddingTop=0;this.Fill="white";this.Rx="0";this.Ry="0";this.StrokeDashArray="";this.Opacity="1";if(c!=null){this.CellWidth=c.CellWidth;this.CellHeight=c.CellHeight;this.StrokeWidth=c.StrokeWidth}this.UnscaledCellWidth=this.CellWidth;this.AllowTitlesAndDescriptions=false;if(this.StrokeWidth===0){MyPointers.CoreSvg.css("background-color","#E0E1DC");MyPointers.CoreSvg.css("border","0");MyPointers.CoreSvg.css("border-radius","0")}else{MyPointers.CoreSvg.css("background-color","white")}}inheritPrototype(FreeSizeLayout,BaseStoryboardLayout);FreeSizeLayout.prototype.FreeStyle=function(b,a){this.CellWidth=b;this.CellHeight=a;StoryboardContainer.ChangeCellCellLayout();StoryboardContainer.JiggleSvgSize()};FreeSizeLayout.prototype.GetLayoutConfig=function(){var a=new Object();a.CellHeight=this.CellHeight;a.CellWidth=this.CellWidth;a.StrokeWidth=this.StrokeWidth;return a};FreeSizeLayout.prototype.GetLayoutLines=function(b,a){StoryboardContainer.AppendLogoAllCells()};FreeSizeLayout.prototype.BeforeCellHeight=function(){return 0};FreeSizeLayout.prototype.GetMinimumStoryboardHeight=function(){var a=this.Row1PaddingTop+this.FullRowHeight()+this.ContainerBorderPaddingBottom+this.WatermarkPaddingTop+0;return a};FreeSizeLayout.prototype._GetStoryboardSizePreAttribution=function(c,b){var a=new BoxPosition();a.X=0;a.Y=0;a.Width=this.Row1PaddingLeft+(b*(this.FullColumnWidth()))-this.CellPaddingLeft;a.Height=this.Row1PaddingTop+this.WatermarkPaddingTop+this.ContainerBorderPaddingBottom+(c*(this.FullRowHeight()))-this.BetweenRowPadding-this.CellPaddingTop;return a};function HorizontalTimelineLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.TChart;this._ChartTitleStrokeWidth=6;this._ChartGridStrokeWidth=9;this._ChartOuterBoxWidth=3;this._ChartLabelHeight=55;this._ChartLabelPaddingTop=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2);this._ChartLabelPaddingBottom=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2)+(this._ChartGridStrokeWidth/2);this.CellPaddingLeft=(this._Padding*2)+this._ChartGridStrokeWidth;this.Row1PaddingTop=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom+(this._ChartGridStrokeWidth/2)+60;this.Row1PaddingLeft=this.CellPaddingLeft;this.CellPaddingLeft*=c;this.Row1PaddingTop*=c;this.Row1PaddingLeft*=c;this._ChartLabelHeight*=c;this._ChartLabelPaddingTop*=c;this._ChartLabelPaddingBottom*=c;this.WatermarkPaddingTop=50}inheritPrototype(HorizontalTimelineLayout,BaseStoryboardLayout);HorizontalTimelineLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a;this._ChartLabelPaddingTop*=a;this._ChartLabelPaddingBottom*=a};HorizontalTimelineLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};HorizontalTimelineLayout.prototype.GetLayoutLines=function(h,d){var e=SvgCreator.CreateSvgGroup("t-chart");var n=this.Row1PaddingLeft-this._Padding;var o=this.Row1PaddingLeft+this._GetGap(d-1)+this.FullColumnWidth();var p=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom+20;var q=p;var i="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";e.appendChild(SvgCreator.AddLine(n,p,o,q,i,"t-chart-horizontal"));for(var c=0;c<d;c++){var b=this.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCellTitle,0,c);var a=this.GetAnchorPoints(b);b.X-=this._Padding;b.Width+=2*this._Padding;b.Y-=this._Padding;b.Height=this.FullRowHeight()+2*this._Padding-this.BetweenRowPadding;var f=SvgCreator.AddRect(b.X,b.Y,b.Width,b.Height,"black","none",null,null,"outerbox_"+c);f.setAttributeNS(null,"stroke-width",+this._ChartOuterBoxWidth+"px");e.appendChild(f);e.appendChild(SvgCreator.AddLine(a.MiddleX,72,a.MiddleX,150,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","timeline-connector-"+c));if(this._TimeJump(c)){var j=a.Left-0.25*this.FullColumnWidth()-10;var k=a.Left-0.25*this.FullColumnWidth()+10;var l=p+15;var m=p-15;e.appendChild(SvgCreator.AddLine(j,l,k,m,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","time-jump-a"+c));e.appendChild(SvgCreator.AddLine(j+10,l,k+10,m,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","time-jump-b"+c))}}return e};HorizontalTimelineLayout.prototype._TimeJump=function(a){var b=[new Date("3/22/1765"),new Date("3/5/1770"),new Date("12/16/1773"),new Date("1/1/1774"),new Date("9/5/1774"),new Date("4/18/1775"),new Date("7/4/1776"),new Date("9/19/1777"),new Date("10/19/1781"),new Date("9/3/1783")];if(a==0){return 0}var d=b[5]-b[4];var c=(b[a]-b[a-1])/d;if(c>5||c<1){return true}return false};HorizontalTimelineLayout.prototype._GetGap=function(a){var b=[new Date("3/22/1765"),new Date("3/5/1770"),new Date("12/16/1773"),new Date("1/1/1774"),new Date("9/5/1774"),new Date("4/18/1775"),new Date("7/4/1776"),new Date("9/19/1777"),new Date("10/19/1781"),new Date("9/3/1783")];if(a==0){return 0}var d=b[5]-b[4];var c=(b[a]-b[a-1])/d;if(c>5||c<1){c=1.5}return c*this.FullColumnWidth()+this._GetGap(a-1)};HorizontalTimelineLayout.prototype._AreaTitlePosition=function(d,b){if(d!=0){return}var e=this.GetStoryboardAreaTitleLayout(d,b);var c=e.StrokeWidth-3;var f=this._GetGap(b)+(this.Row1PaddingLeft)+c/2;var g=this._ChartLabelPaddingTop;var a=new BoxPosition(this._ChartLabelHeight,this.CellWidth-c,f,g,d,b,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};HorizontalTimelineLayout.prototype._CellPosition=function(c,b){var d=this._GetGap(b)+(this.Row1PaddingLeft);var e=this.Row1PaddingTop+this.BeforeCellHeight()+(c*(this.FullRowHeight()));var a=new BoxPosition(this.CellHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCell);return a};HorizontalTimelineLayout.prototype._CellTitlePosition=function(c,b){var d=this._GetGap(b)+(this.Row1PaddingLeft);var e=this.Row1PaddingTop+this.TitlePaddingTop+(c*(this.FullRowHeight()));var a=new BoxPosition(this.TitleHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellTitle);return a};HorizontalTimelineLayout.prototype._CellDescriptionPosition=function(c,b){var d=this._GetGap(b)+(this.Row1PaddingLeft);var e=this.Row1PaddingTop+this.BeforeDescriptionHeight()+(c*(this.FullRowHeight()));var a=new BoxPosition(this.DescriptionHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellDescription);return a};HorizontalTimelineLayout.prototype._GetStoryboardSizePreAttribution=function(c,b){var a=new BoxPosition();a.X=0;a.Y=0;a.Width=this.Row1PaddingLeft+this._GetGap(b-1)+this.FullColumnWidth();a.Height=this.Row1PaddingTop+this.WatermarkPaddingTop+this.ContainerBorderPaddingBottom+(c*(this.FullRowHeight()))-this.BetweenRowPadding;return a};HorizontalTimelineLayout.prototype.GetStoryboardContentBounds=function(c,b){var a=new BoxPosition();a.X=0;a.Y=0;a.Height=this.Row1PaddingTop+(c*(this.FullRowHeight()))-this.BetweenRowPadding;a.Width=this.Row1PaddingLeft+this._GetGap(b-1)+this.FullColumnWidth();return a};function LandscapePaperLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.LandscapePaper;this.CellWidth=1400;this.CellHeight=this.CellWidth*(8.5/11);this.UnscaledCellWidth=this.CellWidth;this.AllowTitlesAndDescriptions=false}inheritPrototype(LandscapePaperLayout,BaseStoryboardLayout);LandscapePaperLayout.prototype.GetLayoutLines=function(b,a){StoryboardContainer.AppendLogoAllCells()};function LandscapeLegalLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.LandscapeLegal;this.CellWidth=(1400/11)*14;this.CellHeight=this.CellWidth*(8.5/14);this.UnscaledCellWidth=this.CellWidth;this.AllowTitlesAndDescriptions=false}inheritPrototype(LandscapeLegalLayout,BaseStoryboardLayout);LandscapeLegalLayout.prototype.GetLayoutLines=function(b,a){StoryboardContainer.AppendLogoAllCells()};function LandscapeLedgerLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.LandscapeLedger;this.CellHeight=(1400/11)*11;this.CellWidth=this.CellHeight*(17/11);this.UnscaledCellWidth=this.CellWidth;this.AllowTitlesAndDescriptions=false}inheritPrototype(LandscapeLedgerLayout,BaseStoryboardLayout);LandscapeLedgerLayout.prototype.GetLayoutLines=function(b,a){StoryboardContainer.AppendLogoAllCells()};function LayoutFactory(){this.GetLayout=function(d,b,a,g,f){if(d==StoryboardLayoutType.StoryboardGrid){return new StoryboardGridLayout(b,a,g,f)}if(d==StoryboardLayoutType.TChart){return new TChartLayout(b,a,g,f)}if(d==StoryboardLayoutType.Frayer){return new FrayerLayout(b,a,g,f)}if(d==StoryboardLayoutType.Matrix){return new MatrixLayout(b,a,g,f)}if(d==StoryboardLayoutType.Spider){return new SpiderLayout(b,a,g,f)}if(d==StoryboardLayoutType.Timeline){return new TimelineLayout(b,a,g,f)}if(d==StoryboardLayoutType.Movie){return new MovieLayout(b,a,g,f)}if(d==StoryboardLayoutType.ParallelLabelMatrix){return new ParallelLabelMatrixLayout(b,a,g,f)}if(d==StoryboardLayoutType.Cycle){return new CycleLayout(b,a,g,f)}if(d==StoryboardLayoutType.PortraitPaper){return new PortraitPaperLayout(false,false,g,f)}if(d==StoryboardLayoutType.LandscapePaper){return new LandscapePaperLayout(false,false,g,f)}if(d==StoryboardLayoutType.PortraitLegal){return new PortraitLegalLayout(false,false,g,f)}if(d==StoryboardLayoutType.LandscapeLegal){return new LandscapeLegalLayout(false,false,g,f)}if(d==StoryboardLayoutType.PortraitTabloid){return new PortraitTabloidLayout(false,false,g,f)}if(d==StoryboardLayoutType.LandscapeLedger){return new LandscapeLedgerLayout(false,false,g,f)}try{if(d==StoryboardLayoutType.FreeSize){return new FreeSizeLayout(false,false,g,f)}}catch(c){LogErrorMessage("LayoutFactory.Freesize",e)}}};function MatrixLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.Matrix;this._ChartTitleStrokeWidth=6;this._ChartGridStrokeWidth=9;this._ChartLabelHeight=55;this._ChartLabelPaddingTop=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2)+(this._Padding+this._ChartTitleStrokeWidth);this._ChartLabelPaddingBottom=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2)+(this._ChartGridStrokeWidth/2);this._ChartLabelPaddingLeft=this._ChartLabelPaddingTop;this._ChartLabelPaddingRight=this._ChartLabelPaddingBottom;this.CellPaddingLeft=(this._Padding*2)+this._ChartGridStrokeWidth;this.BetweenRowPadding=(this._Padding*2)+(this._ChartGridStrokeWidth/2);this.Row1PaddingTop=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom+(this._ChartGridStrokeWidth/2);this.Row1PaddingLeft=this._ChartLabelPaddingLeft+(this.CellWidth/c)+this._ChartLabelPaddingRight+(this._ChartGridStrokeWidth/2)+(this._Padding/2);this.WatermarkPaddingTop=50;this.BetweenRowPadding*=c;this.CellPaddingLeft*=c;this.Row1PaddingTop*=c;this.Row1PaddingLeft*=c;this._ChartLabelHeight*=c;this._ChartLabelPaddingTop*=c;this._ChartLabelPaddingBottom*=c;this._ChartLabelPaddingLeft*=c;this._ChartLabelPaddingRight*=c;this.WatermarkPaddingTop*=c}inheritPrototype(MatrixLayout,BaseStoryboardLayout);MatrixLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a;this._ChartLabelPaddingTop*=a;this._ChartLabelPaddingBottom*=a;this._ChartLabelPaddingLeft*=a;this._ChartLabelPaddingRight*=a;this.WatermarkPaddingTop*=a};MatrixLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};MatrixLayout.prototype._EnableDescriptionLayoutSpecific=function(a){this.BetweenRowPadding=(this._Padding*2)+(this._ChartGridStrokeWidth/2)};MatrixLayout.prototype._EnableTitleLayoutSpecific=function(a){this.BetweenRowPadding=(this._Padding*2)+(this._ChartGridStrokeWidth/2)};MatrixLayout.prototype.ChartLabelWidth=function(){};MatrixLayout.prototype.GetLayoutLines=function(m,a){var d=SvgCreator.CreateSvgGroup("t-chart");var p,q,r,s;var o="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";var c=this._Padding;var b=(this.FullRowHeight()*m)+this.Row1PaddingTop-this._Padding+this._ChartGridStrokeWidth;var f=this._Padding+this._ChartGridStrokeWidth/2;d.appendChild(SvgCreator.AddLine(f,c,f,b,o,"t-chart-vertical-0"));for(var e=0;e<=a;e++){p=(e*this.FullColumnWidth())+this.Row1PaddingLeft-(this.CellPaddingLeft/2);q=p;d.appendChild(SvgCreator.AddLine(p,c,q,b,o,"t-chart-vertical-"+e))}var n=this._Padding;var l=this.FullColumnWidth()*a+this.Row1PaddingLeft-this._Padding;var h=this._Padding+this._ChartGridStrokeWidth/2;d.appendChild(SvgCreator.AddLine(n,h,l,h,o,"t-chart-vertical-0"));for(var k=0;k<=m;k++){r=this.Row1PaddingTop+(k*this.FullRowHeight())-(this._Padding/2);s=r;d.appendChild(SvgCreator.AddLine(n,r,l,s,o,"t-chart-vertical-"+e+k))}return d};MatrixLayout.prototype._AreaTitlePosition=function(d,b){var e=false;if(d==-1&&b==-1){d=0;b=0;e=true}if(d!=0&&b!=0){return null}var c=this.GetStoryboardAreaTitleLayout().StrokeWidth-3;if(e){x=this._ChartLabelPaddingLeft;y=this.Row1PaddingTop+this._Padding}else{if(d==0){x=(b*this.FullColumnWidth())+(this.Row1PaddingLeft)+c/2;y=this._ChartLabelPaddingTop}else{x=this._ChartLabelPaddingLeft;y=this.Row1PaddingTop+((d)*this.FullRowHeight())+this._Padding}}var a=new BoxPosition(this._ChartLabelHeight,this.CellWidth-c,x,y,d,b,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};function ParallelLabelMatrixLayout(b,a,c){MatrixLayout.call(this,b,a,c,12);var d=this.GetStoryboardAreaTitleLayout();this.Col1PaddingTop=this.Row1PaddingTop-this._ChartLabelHeight+(this._Padding*1.5);this.Col1PaddingLeft=this._ChartLabelPaddingTop-(d.StrokeWidth-3);this.Row1PaddingLeft=this.Row1PaddingTop+this._Padding;this.LayoutType=StoryboardLayoutType.ParallelLabelMatrix}inheritPrototype(ParallelLabelMatrixLayout,MatrixLayout);ParallelLabelMatrixLayout.prototype._IsRowTitleCell=function(b,a){return(a===-1&&b===-1)||(b>0&&a===0)};ParallelLabelMatrixLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){var c=MatrixLayout.prototype.GetStoryboardAreaTitleLayout.call(this,b,a);if(this._IsRowTitleCell(b,a)){c.Rotation=270}return c};ParallelLabelMatrixLayout.prototype._AreaTitlePosition=function(i,d){var a=MatrixLayout.prototype._AreaTitlePosition.call(this,i,d);if(this._IsRowTitleCell(i,d)){var g=(d==-1)?0:d;var h=(i==-1)?0:i;var j=this.GetStoryboardAreaTitleLayout();var e=j.StrokeWidth-3;var b=this.CellPaddingTop+this.CellHeight+this.BetweenRowPadding;var c=this.TitleHeight+((this.TitleHeight>0)?this.CellPaddingTop:0)+this.DescriptionPaddingTop+this.DescriptionHeight;var f=this.CellHeight+c;a.Width=f-j.StrokeWidth;a.X=this.Col1PaddingLeft-(b/2)+this._ChartLabelHeight-(c/2);a.Y=this.Col1PaddingTop+((h)*this.FullRowHeight())+(this.FullRowHeight()/2)}return a};ParallelLabelMatrixLayout.prototype._ExpandCellsLayoutSpecific=function(a){MatrixLayout.prototype._ExpandCellsLayoutSpecific.call(this,a);this.Col1PaddingLeft*=a;this.Col1PaddingTop*=a};function MovieLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.Movie;this.CellWidth=this.CellHeight*(16/9);this.UnscaledCellWidth=597.333}inheritPrototype(MovieLayout,BaseStoryboardLayout);MovieLayout.prototype.GetScale=function(){return this.CellHeight/336};function PortraitPaperLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.PortraitPaper;this.CellHeight=1400;this.CellWidth=this.CellHeight*(8.5/11);this.UnscaledCellWidth=this.CellWidth;this.AllowTitlesAndDescriptions=false}inheritPrototype(PortraitPaperLayout,BaseStoryboardLayout);PortraitPaperLayout.prototype.GetLayoutLines=function(b,a){StoryboardContainer.AppendLogoAllCells()};function PortraitLegalLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.PortraitLegal;this.CellHeight=(1400/11)*14;this.CellWidth=this.CellHeight*(8.5/14);this.UnscaledCellWidth=this.CellWidth;this.AllowTitlesAndDescriptions=false}inheritPrototype(PortraitLegalLayout,BaseStoryboardLayout);PortraitLegalLayout.prototype.GetLayoutLines=function(b,a){StoryboardContainer.AppendLogoAllCells()};function PortraitTabloidLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.PortraitTabloid;this.CellHeight=(1400/11)*17;this.CellWidth=this.CellHeight*(11/17);this.UnscaledCellWidth=this.CellWidth;this.AllowTitlesAndDescriptions=false}inheritPrototype(PortraitTabloidLayout,BaseStoryboardLayout);PortraitTabloidLayout.prototype.GetLayoutLines=function(b,a){StoryboardContainer.AppendLogoAllCells()};function SpiderLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.Spider;this.Layouts=null;this._ChartGridStrokeWidth=6;this._ChartLabelHeight=55;this.ContainerBorderPaddingRight=-2*this._Padding;this.CellPaddingLeft=4*this._Padding;this.Row1PaddingTop=2*this._Padding;this.Row1PaddingLeft=2*this._Padding;this.BetweenRowPadding=(this.TitlePaddingTop/c+this.TitleHeight/c+this.CellPaddingTop/c+this.CellHeight/c+this.DescriptionPaddingTop/c+this.DescriptionHeight/c)*0.75;this._ChartLabelHeight*=c;this.ContainerBorderPaddingRight*=c;this.CellPaddingLeft*=c;this.Row1PaddingTop*=c;this.Row1PaddingLeft*=c;this.BetweenRowPadding*=c;this._InitializeCellLayouts()}inheritPrototype(SpiderLayout,BaseStoryboardLayout);SpiderLayout.prototype._ExtraFullColumnWidth=function(){return(this._Padding*2)};SpiderLayout.prototype._ExtraFullRowHeight=function(){return(this._Padding*1)};SpiderLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a};SpiderLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};SpiderLayout.prototype._EnableDescriptionLayoutSpecific=function(a){this.BetweenRowPadding=(this.TitlePaddingTop+this.TitleHeight+this.CellPaddingTop+this.CellHeight+this.DescriptionPaddingTop+this.DescriptionHeight)*0.75};SpiderLayout.prototype._EnableTitleLayoutSpecific=function(a){this.BetweenRowPadding=(this.TitlePaddingTop+this.TitleHeight+this.CellPaddingTop+this.CellHeight+this.DescriptionPaddingTop+this.DescriptionHeight)*0.75};SpiderLayout.prototype.GetLayoutLines=function(f,b){var c=SvgCreator.CreateSvgGroup("t-chart");var k;var h="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";var j=this.GetAnchorPoints(this._AreaTitlePosition(0,0));for(var d=0;d<b;d++){var a=this.GetAnchorPoints(this._CellAnchorPoint(d));var e=SvgCreator.AddRect(a.X,a.Y,a.Width,a.Height,"black","none",null,null,"outerbox_"+d);e.setAttributeNS(null,"stroke-width",this._ChartGridStrokeWidth+"px");c.appendChild(e);k=null;switch(a.CellTitle){case"6A":case"8A":case"10A":k=new Vector(a.MiddleX,j.Top,a.MiddleX,a.Bottom);break;case"6D":case"8E":case"10F":k=new Vector(a.MiddleX,j.Bottom,a.MiddleX,a.Top);break;case"6B":case"8B":case"10B":k=new Vector(j.NearRight,j.Top,a.Left,a.NearBottom);break;case"6C":case"8D":case"10E":k=new Vector(j.NearRight,j.Bottom,a.Left,a.NearTop);break;case"6F":case"8H":case"10J":k=new Vector(j.NearLeft,j.Top,a.Right,a.NearBottom);break;case"6E":case"8F":case"10G":k=new Vector(j.NearLeft,j.Bottom,a.Right,a.NearTop);break;case"8C":k=new Vector(j.Right,j.MiddleY,a.Left,j.MiddleY);break;case"8G":k=new Vector(j.Left,j.MiddleY,a.Right,j.MiddleY);break;case"10C":k=new Vector(j.Right,j.MiddleY-this._Padding/2,a.Left,a.NearBottom);break;case"10D":k=new Vector(j.Right,j.MiddleY+this._Padding/2,a.Left,a.NearTop);break;case"10I":k=new Vector(j.Left,j.MiddleY-this._Padding/2,a.Right,a.NearBottom);break;case"10H":k=new Vector(j.Left,j.MiddleY+this._Padding/2,a.Right,a.NearTop);break}if(k){c.appendChild(SvgCreator.AddLine(k.X1,k.Y1,k.X2,k.Y2,h,"t-chart-vertical-"+d))}}return c};SpiderLayout.prototype._AreaTitlePosition=function(e,b){if(e!=0||b!=0){return}var f=this.GetStoryboardAreaTitleLayout();var d=f.StrokeWidth-3;var g=this._VirtualCols(StoryboardContainer.Cols);var c=(g-1)/2;var h=this.FullColumnWidth()*c+this.Row1PaddingLeft+this._Padding;var i=this.Row1PaddingTop+this.FullRowHeight()-this.BetweenRowPadding+(this.BetweenRowPadding-this._ChartLabelHeight)/2;var a=new BoxPosition(this._ChartLabelHeight,this.CellWidth-d,h,i,0,0,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};SpiderLayout.prototype._CellPosition=function(d,c){var b=this._CellAnchorPoint(c);var e=b.X+this._Padding;var f=b.Y+this.BeforeCellHeight();var a=new BoxPosition(this.CellHeight,this.CellWidth,e,f,d,c,StoryboardPartTypeEnum.StoryboardCell);return a};SpiderLayout.prototype._CellTitlePosition=function(d,c){var b=this._CellAnchorPoint(c);var e=b.X+this._Padding;var f=b.Y+this.TitlePaddingTop;var a=new BoxPosition(this.TitleHeight,this.CellWidth,e,f,d,c,StoryboardPartTypeEnum.StoryboardCellTitle);return a};SpiderLayout.prototype._CellDescriptionPosition=function(d,c){var b=this._CellAnchorPoint(c);var e=b.X+this._Padding;var f=b.Y+this.BeforeDescriptionHeight();var a=new BoxPosition(this.DescriptionHeight,this.CellWidth,e,f,d,c,StoryboardPartTypeEnum.StoryboardCellDescription);return a};SpiderLayout.prototype._InitializeCellLayouts=function(){this.Layouts=new Object();this.Layouts["6A"]=new SpiderCellLocation("6A",1,0,0);this.Layouts["6B"]=new SpiderCellLocation("6B",2,0,0.25);this.Layouts["6C"]=new SpiderCellLocation("6C",2,1,-0.25);this.Layouts["6D"]=new SpiderCellLocation("6D",1,1,0);this.Layouts["6E"]=new SpiderCellLocation("6E",0,1,-0.25);this.Layouts["6F"]=new SpiderCellLocation("6F",0,0,0.25);this.Layouts["8A"]=new SpiderCellLocation("8A",2,0,0);this.Layouts["8B"]=new SpiderCellLocation("8B",3,0,0.25);this.Layouts["8C"]=new SpiderCellLocation("8C",4,0,0.85);this.Layouts["8D"]=new SpiderCellLocation("8D",3,1,-0.25);this.Layouts["8E"]=new SpiderCellLocation("8E",2,1,0);this.Layouts["8F"]=new SpiderCellLocation("8F",1,1,-0.25);this.Layouts["8G"]=new SpiderCellLocation("8G",0,0,0.85);this.Layouts["8H"]=new SpiderCellLocation("8H",1,0,0.25);this.Layouts["10A"]=new SpiderCellLocation("10A",2,0,0);this.Layouts["10B"]=new SpiderCellLocation("10B",3,0,0.15);this.Layouts["10C"]=new SpiderCellLocation("10C",4,0,0.3);this.Layouts["10D"]=new SpiderCellLocation("10D",4,1,-0.3);this.Layouts["10E"]=new SpiderCellLocation("10E",3,1,-0.15);this.Layouts["10F"]=new SpiderCellLocation("10F",2,1,0);this.Layouts["10G"]=new SpiderCellLocation("10G",1,1,-0.15);this.Layouts["10H"]=new SpiderCellLocation("10H",0,1,-0.3);this.Layouts["10I"]=new SpiderCellLocation("10I",0,0,0.3);this.Layouts["10J"]=new SpiderCellLocation("10J",1,0,0.15);this.Layouts[3]=["6A","6B","6F"];this.Layouts[4]=["6F","6B","6C","6E"];this.Layouts[5]=["6A","6B","6C","6E","6F"];this.Layouts[6]=["6A","6B","6C","6D","6E","6F"];this.Layouts[7]=["8A","8B","8C","8D","8F","8G","8H"];this.Layouts[8]=["8A","8B","8C","8D","8E","8F","8G","8H"];this.Layouts[9]=["10A","10B","10C","10D","10E","10G","10H","10I","10J"];this.Layouts[10]=["10A","10B","10C","10D","10E","10F","10G","10H","10I","10J"];this.Layouts[1]=["6A","6B","6F"];this.Layouts[2]=["6A","6B","6F"]};SpiderLayout.prototype.GetCellLayouts=function(){return Layouts};SpiderLayout.prototype._CellAnchorPoint=function(c){var b=this.Layouts[StoryboardContainer.Cols][c];var f=this.Layouts[b];var e=this.FullRowHeight()-this.BetweenRowPadding;var d=this._Padding*2+this.CellWidth;var g=this.Row1PaddingLeft+(f.FakeCol*this.FullColumnWidth());var h=this.Row1PaddingTop+(f.FakeRow*this.FullRowHeight())+(e*f.RowOffset);var a=new BoxPosition(e,d,g,h,0,c,StoryboardPartTypeEnum.StoryboardCellOuterBox);a.CellTitle=b;return a};SpiderLayout.prototype._VirtualCols=function(a){layoutType=parseInt(this.Layouts[a][0]);if(layoutType==6){return 3}if(layoutType==8){return 5}if(layoutType==10){return 5}return 3};SpiderLayout.prototype._VirtualRows=function(a){if(a==3){return 1}return 2};SpiderLayout.prototype._GetStoryboardSizePreAttribution=function(c,b){var a=new BoxPosition();c=this._VirtualRows(b);b=this._VirtualCols(b);a.X=0;a.Y=0;a.Width=this.Row1PaddingLeft+this.ContainerBorderPaddingRight+(b*(this.FullColumnWidth()));a.Height=this.Row1PaddingTop+this.WatermarkPaddingTop+this.ContainerBorderPaddingBottom+(c*(this.FullRowHeight()))-this.BetweenRowPadding;if(c==1){a.Height+=0.6*this.BetweenRowPadding}return a};SpiderLayout.prototype.GetStoryboardContentBounds=function(c,b){c=this._VirtualRows(b);b=this._VirtualCols(b);var a=new BoxPosition();a.X=0;a.Y=0;a.Width=this.Row1PaddingLeft+(b*(this.FullColumnWidth()));a.Height=this.Row1PaddingTop+(c*this.FullRowHeight())-this.BetweenRowPadding;if(c==1){a.Height+=0.6*this.BetweenRowPadding}return a};SpiderLayout.prototype.GetWatermarkTop=function(b){if(StoryboardContainer.Cols==3){var a=this.GetStoryboardContentBounds(1,3);return a.Height+this.WatermarkPaddingTop}return this.Row1PaddingTop+this.WatermarkPaddingTop+(2*this.FullRowHeight())-this.BetweenRowPadding};function CycleLayout(b,a,c){SpiderLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.Cycle;this.IdPrefix="cycle-chart-arrow";this.ArrowStrokeWidth="6";this.DefaultColor="black";this.DefaultFill="none";this.Row1PaddingLeft=4*this._Padding;this.ContainerBorderPaddingRight=3*this._Padding;this.ContainerBorderPaddingBottom=3*this._Padding;this.Row1PaddingTop=4*this._Padding}inheritPrototype(CycleLayout,SpiderLayout);CycleLayout.prototype.IdGen=function(a,b){return this.IdPrefix+"-"+a+"-to-"+b};CycleLayout.prototype.GetLayoutLines=function(p,c){var d=SvgCreator.CreateSvgGroup("cycle-chart");var q="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";var s=this.GetAnchorPoints(this._AreaTitlePosition(0,0));for(var r=0;r<c;r++){var h=(r+1)%c;var a=this.GetAnchorPoints(this._CellAnchorPoint(r));var f=this.GetAnchorPoints(this._CellAnchorPoint(h));var o=SvgCreator.AddRect(a.X,a.Y,a.Width,a.Height,"black","none",null,null,"outerbox_"+r);o.setAttributeNS(null,"stroke-width",this._ChartGridStrokeWidth+"px");d.appendChild(o)}var b=[];for(var e=0;e<c;++e){b.push(this.GetAnchorPoints(this._CellAnchorPoint(e)))}var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].MiddleY));switch(c){case 3:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].MiddleY));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].Right,b[0].MiddleY),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].Left,b[1].MiddleY),new Point(b[2].Right,b[2].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[2].MiddleX,b[2].Top),new Point(b[0].Left,b[0].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 4:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].MiddleY));var l=new Point(j.X/2.5,j.Y);d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].Right,b[0].NearTop),new Point(b[1].Left,b[1].NearTop),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(l,new Point(b[1].Right,(b[1].NearBottom+b[1].MiddleY)/2),new Point(b[2].Right,(b[2].NearTop+b[2].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[2].Left,b[2].NearBottom),new Point(b[3].Right,b[3].NearBottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(l,new Point(b[3].Left,(b[3].NearTop+b[3].MiddleY)/2),new Point(b[0].Left,(b[0].NearBottom+b[0].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 5:var n=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));var k=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[1].MiddleY));d.appendChild(SvgCreator.AddEllipsisArc(n,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(n,new Point(b[1].Right,(b[1].NearBottom+b[1].MiddleY)/2),new Point(b[2].Right,(b[2].NearTop+b[2].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(k,new Point(b[2].Left,b[2].NearBottom),new Point(b[3].Right,b[3].NearBottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(n,new Point(b[3].Left,(b[3].NearTop+b[3].MiddleY)/2),new Point(b[4].Left,(b[4].NearBottom+b[4].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(n,new Point(b[4].MiddleX,b[4].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 6:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].Right,(b[1].NearBottom+b[1].MiddleY)/2),new Point(b[2].Right,(b[2].NearTop+b[2].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[2].MiddleX,b[2].Bottom),new Point(b[3].MiddleX,b[3].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[3].MiddleX,b[3].Bottom),new Point(b[4].MiddleX,b[4].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[4].Left,(b[4].NearTop+b[4].MiddleY)/2),new Point(b[5].Left,(b[5].NearBottom+b[5].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[5].MiddleX,b[5].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 7:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));var k=new Point(Math.abs(s.Center.X-b[2].MiddleX),Math.abs(s.Center.Y-b[3].NearBottom));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].Right,b[1].NearTop),new Point(b[2].MiddleX,b[2].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[2].MiddleX,b[2].Bottom),new Point(b[3].Right,b[3].NearBottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[3].Left,b[3].NearBottom),new Point(b[4].Right,b[4].NearBottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[4].Left,b[4].NearBottom),new Point(b[5].MiddleX,b[5].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[5].MiddleX,b[5].Top),new Point(b[6].Left,b[6].NearTop),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[6].MiddleX,b[6].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 8:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].Right,b[1].NearTop),new Point(b[2].MiddleX,b[2].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[2].MiddleX,b[2].Bottom),new Point(b[3].Right,b[3].NearBottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[3].MiddleX,b[3].Bottom),new Point(b[4].MiddleX,b[4].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[4].MiddleX,b[4].Bottom),new Point(b[5].MiddleX,b[5].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[5].Left,b[5].NearBottom),new Point(b[6].MiddleX,b[6].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[6].MiddleX,b[6].Top),new Point(b[7].Left,b[7].NearTop),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[7].MiddleX,b[7].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 9:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-((b[0].MiddleY+b[0].NearTop)/2)));var m=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].MiddleX,b[1].Top),new Point(b[2].MiddleX,b[2].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(m,new Point(b[2].Right,b[2].MiddleY),new Point(b[3].Right,b[3].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[3].MiddleX,b[3].Bottom),new Point(b[4].MiddleX,b[4].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[4].NearLeft,b[4].Bottom),new Point(b[5].NearRight,b[5].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[5].MiddleX,b[5].Bottom),new Point(b[6].MiddleX,b[6].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(m,new Point(b[6].Left,b[6].MiddleY),new Point(b[7].Left,b[7].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[7].MiddleX,b[7].Top),new Point(b[8].MiddleX,b[8].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[8].MiddleX,b[8].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 10:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-((b[0].MiddleY+b[0].NearTop)/2)));var m=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].MiddleX,b[1].Top),new Point(b[2].MiddleX,b[2].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(m,new Point(b[2].Right,b[2].MiddleY),new Point(b[3].Right,b[3].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));for(var e=3;e<7;++e){d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(this.GetAnchorPoints(this._CellAnchorPoint(e)).MiddleX,this.GetAnchorPoints(this._CellAnchorPoint(e)).Bottom),new Point(this.GetAnchorPoints(this._CellAnchorPoint(e+1)).MiddleX,this.GetAnchorPoints(this._CellAnchorPoint(e+1)).Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)))}d.appendChild(SvgCreator.AddEllipsisArc(m,new Point(b[7].Left,b[7].MiddleY),new Point(b[8].Left,b[8].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[8].MiddleX,b[8].Top),new Point(b[9].MiddleX,b[9].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[9].MiddleX,b[9].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;default:break}return d};CycleLayout.prototype._OutsideEdgeCenter=function(c,e,n){var a=this.GetAnchorPoints(this._CellAnchorPoint(c));var t=this.GetAnchorPoints(this._AreaTitlePosition(0,0));var m=this.GetAnchorPoints(this._CellAnchorPoint(n));var b={left:false,right:false,top:false,bottom:false};var h={left:false,right:false,top:false,bottom:false};b=this._GetCovered(b,c,e,t,a,m);h=this._GetCovered(h,n,e,t,a,m);var k=null;var l=[];var r=null;var q=null;var g=999999999;var u=[0,0];var s=null;var o=a.Left>m.Right;var p=a.Top>m.Bottom;for(var f in b){var d=this._GetPointPreference(b,a,p,o);for(var j in h){if(!b[f]&&!h[j]){continue}var i=this._GetPointPreference(h,a,!p,!o);q=MathUtils.CartesianSegmentLength(d,i);testtitledistance=MathUtils.CartesianSegmentLength(d,t.centerPoint)+MathUtils.CartesianSegmentLength(i,t.centerPoint);if(q<g||(q==g&&testtitledistance>titleDistance)){l.source=d;l.target=i;g=q;titledistance=testtitledistance}}}return l};CycleLayout.prototype._GetPointPreference=function(b,a,e,d){for(var c in b){switch(c){case"left":return new Point(a.Left,(e)?a.NearTop:a.NearBottom);case"right":return new Point(a.Right,(e)?a.NearTop:a.NearBottom);case"top":return new Point(a.MiddleX,(d)?a.NearLeft:a.NearRight);case"bottom":return new Point(a.MiddleX,(d)?a.NearLeft:a.NearRight)}}};CycleLayout.prototype._GetCovered=function(d,b,c,g,a,e){for(var f=0;f<c;f++){var e;if(f==b){e=g;continue}else{e=this.GetAnchorPoints(this._CellAnchorPoint(f))}if(!(a.Top>e.Bottom||a.Bottom<e.Top)){if(a.X<e.X){d.right=true}else{d.left=true}}if(!(a.Right<e.Left||a.Left>e.Right)){if(a.Y>e.Y){d.top=true}else{d.bottom=true}}}return d};CycleLayout.prototype._InitializeCellLayouts=function(){this.Layouts=new Object();this.Layouts["6A"]=new SpiderCellLocation("6A",1,0,0);this.Layouts["6B"]=new SpiderCellLocation("6B",2,0,0.25);this.Layouts["6C"]=new SpiderCellLocation("6C",2,1,-0.25);this.Layouts["6D"]=new SpiderCellLocation("6D",1,1,0);this.Layouts["6E"]=new SpiderCellLocation("6E",0,1,-0.25);this.Layouts["6F"]=new SpiderCellLocation("6F",0,0,0.25);this.Layouts["8A"]=new SpiderCellLocation("8A",2,0,0);this.Layouts["8B"]=new SpiderCellLocation("8B",3,0,0.25);this.Layouts["8C"]=new SpiderCellLocation("8C",4,0,0.85);this.Layouts["8D"]=new SpiderCellLocation("8D",3,1,-0.25);this.Layouts["8E"]=new SpiderCellLocation("8E",2,1,0);this.Layouts["8F"]=new SpiderCellLocation("8F",1,1,-0.25);this.Layouts["8G"]=new SpiderCellLocation("8G",0,0,0.85);this.Layouts["8H"]=new SpiderCellLocation("8H",1,0,0.25);this.Layouts["10A"]=new SpiderCellLocation("10A",2,0,0);this.Layouts["10B"]=new SpiderCellLocation("10B",3,0,0.15);this.Layouts["10C"]=new SpiderCellLocation("10C",4,0,0.3);this.Layouts["10D"]=new SpiderCellLocation("10D",4,1,-0.3);this.Layouts["10E"]=new SpiderCellLocation("10E",3,1,-0.15);this.Layouts["10F"]=new SpiderCellLocation("10F",2,1,0);this.Layouts["10G"]=new SpiderCellLocation("10G",1,1,-0.15);this.Layouts["10H"]=new SpiderCellLocation("10H",0,1,-0.3);this.Layouts["10I"]=new SpiderCellLocation("10I",0,0,0.3);this.Layouts["10J"]=new SpiderCellLocation("10J",1,0,0.15);this.Layouts[3]=["6A","6C","6E"];this.Layouts[4]=["6F","6B","6C","6E"];this.Layouts[5]=["6A","6B","6C","6E","6F"];this.Layouts[6]=["6A","6B","6C","6D","6E","6F"];this.Layouts[7]=["8A","8B","8C","8D","8F","8G","8H"];this.Layouts[8]=["8A","8B","8C","8D","8E","8F","8G","8H"];this.Layouts[9]=["10A","10B","10C","10D","10E","10G","10H","10I","10J"];this.Layouts[10]=["10A","10B","10C","10D","10E","10F","10G","10H","10I","10J"];this.Layouts[1]=["6A","6C","6E"];this.Layouts[2]=["6A","6C","6E"]};CycleLayout.prototype._VirtualRows=function(a){return 2};CycleLayout.prototype.GetStoryboardContentBounds=function(c,b){c=this._VirtualRows(b);b=this._VirtualCols(b);var a=new BoxPosition();a.X=0;a.Y=0;a.Width=this.Row1PaddingLeft+(b*(this.FullColumnWidth()));a.Height=this.Row1PaddingTop+(c*this.FullRowHeight())-this.BetweenRowPadding;return a};function StoryboardGridLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.StoryboardGrid}inheritPrototype(StoryboardGridLayout,BaseStoryboardLayout);function TChartLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.TChart;this._ChartTitleStrokeWidth=6;this._ChartGridStrokeWidth=9;this._ChartLabelHeight=55;this._ChartLabelPaddingTop=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2);this._ChartLabelPaddingBottom=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2)+(this._ChartGridStrokeWidth/2);this.CellPaddingLeft=(this._Padding*2)+this._ChartGridStrokeWidth;this.Row1PaddingTop=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom+(this._ChartGridStrokeWidth/2);this.Row1PaddingLeft=this.CellPaddingLeft;this.CellPaddingLeft*=c;this.Row1PaddingTop*=c;this.Row1PaddingLeft*=c;this._ChartLabelHeight*=c;this._ChartLabelPaddingTop*=c;this._ChartLabelPaddingBottom*=c}inheritPrototype(TChartLayout,BaseStoryboardLayout);TChartLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a;this._ChartLabelPaddingTop*=a;this._ChartLabelPaddingBottom*=a};TChartLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};TChartLayout.prototype.GetLayoutLines=function(d,a){var b=SvgCreator.CreateSvgGroup("t-chart");var f=this.Row1PaddingLeft;var h=this.FullColumnWidth()*a;var j=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom;var k=j;var e="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";b.appendChild(SvgCreator.AddLine(f,j,h,k,e,"t-chart-horizontal"));for(var c=1;c<a;c++){var f=(c*this.FullColumnWidth())+this.Row1PaddingLeft/2;var h=f;var j=this._ChartLabelPaddingTop-(this._ChartTitleStrokeWidth/2);var k=(this.FullRowHeight()*d)+this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom+this._ChartTitleStrokeWidth-this.BetweenRowPadding;b.appendChild(SvgCreator.AddLine(f,j,h,k,e,"t-chart-vertical-"+c))}return b};TChartLayout.prototype._AreaTitlePosition=function(d,b){if(d!=0){return}var e=this.GetStoryboardAreaTitleLayout(d,b);var c=e.StrokeWidth-3;var f=(b*this.FullColumnWidth())+(this.Row1PaddingLeft)+c/2;var g=this._ChartLabelPaddingTop;var a=new BoxPosition(this._ChartLabelHeight,this.CellWidth-c,f,g,d,b,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};function TimelineLayout(b,a,d,c){BaseStoryboardLayout.call(this,b,a,d,12);this.LayoutType=StoryboardLayoutType.Timeline;this._ChartTitleStrokeWidth=6;this._ChartGridStrokeWidth=9;this._ChartOuterBoxWidth=3;this._ChartLabelHeight=55;this._ChartLabelPaddingTop=(2*this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2);this._ChartLabelPaddingBottom=(2*this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2)+(this._ChartGridStrokeWidth/2);this.CellPaddingLeft=0;this.Row1PaddingTop=this._ChartLabelPaddingTop+this._ChartLabelPaddingBottom+this._ChartLabelHeight;this.Row1PaddingLeft=this._Padding-this._ChartOuterBoxWidth/2;this._LegendPaddingTop=30;this._LegendBoxHeight=110;this.WatermarkPaddingTop=30+this._LegendBoxHeight+this._LegendPaddingTop;this._TimeLinePaddingMultiple=16;this.BetweenRowPadding=this._Padding;this.BetweenRowPadding*=d;this.CellPaddingLeft*=d;this.Row1PaddingTop*=d;this.Row1PaddingLeft*=d;this._ChartLabelHeight*=d;this._ChartLabelPaddingTop*=d;this._ChartLabelPaddingBottom*=d;this.TimelineDates=c.TimelineDates;this._TimeUnit=this._CalculateTimeUnit()}inheritPrototype(TimelineLayout,BaseStoryboardLayout);TimelineLayout.prototype._EnableTitleLayoutSpecific;this.BetweenRowPadding=this._Padding;TimelineLayout.prototype._EnableDescriptionLayoutSpecific;this.BetweenRowPadding=this._Padding;TimelineLayout.prototype._ExtraFullColumnWidth=function(){return(this._Padding*1)};TimelineLayout.prototype._ExtraFullRowHeight=function(){return(this._Padding*1)};TimelineLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a;this._ChartLabelPaddingTop*=a;this._ChartLabelPaddingBottom*=a};TimelineLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};TimelineLayout.prototype._AreaTitlePosition=function(d,b){if(d!=0||b!=0){return null}var e=this.GetStoryboardAreaTitleLayout(d,b);var c=e.StrokeWidth-3;var f=this.CellWidth*1.5;var g=this.Row1PaddingLeft+this.FullColumnWidth()+this._TimeLinePaddingMultiple*this._Padding-f/2;var h=this._ChartLabelPaddingTop;var a=new BoxPosition(this._ChartLabelHeight,f,g,h,d,b,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};TimelineLayout.prototype._GetCellX=function(a){if(a%2==0){return this.Row1PaddingLeft+this._Padding+this._ChartOuterBoxWidth}else{return this.Row1PaddingLeft+this.FullColumnWidth()+(2*this._TimeLinePaddingMultiple*this._Padding)}};TimelineLayout.prototype._CellPosition=function(c,b){var d=this._GetCellX(b);var e=this.Row1PaddingTop+this.BeforeCellHeight()+this._GetGap(b,this._TimeUnit);var a=new BoxPosition(this.CellHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCell);return a};TimelineLayout.prototype._CellTitlePosition=function(c,b){var d=this._GetCellX(b);var e=this.Row1PaddingTop+this.TitlePaddingTop+this._GetGap(b,this._TimeUnit);var a=new BoxPosition(this.TitleHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellTitle);return a};TimelineLayout.prototype._CellDescriptionPosition=function(c,b){var d=this._GetCellX(b);var e=this.Row1PaddingTop+this.BeforeDescriptionHeight()+this._GetGap(b,this._TimeUnit);var a=new BoxPosition(this.DescriptionHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellDescription);return a};TimelineLayout.prototype._GetStoryboardSizePreAttribution=function(c,b){var a=this.GetStoryboardContentBounds(c,b);a.Height+=this.WatermarkPaddingTop;return a};TimelineLayout.prototype.GetStoryboardContentBounds=function(c,b){var a=new BoxPosition();a.X=0;a.Y=0;a.Height=this.Row1PaddingTop+this._GetGap(b-1,this._TimeUnit)+this.FullRowHeight();a.Width=2*this.FullColumnWidth()+2*this.Row1PaddingLeft+(2*this._Padding*this._TimeLinePaddingMultiple);return a};TimelineLayout.prototype.GetWatermarkTop=function(b){var a=this.GetStoryboardContentBounds(StoryboardContainer.Rows,StoryboardContainer.Cols);var c=a.Height+this.WatermarkPaddingTop;return c};TimelineLayout.prototype._CalculateTimeUnit=function(){var f=this.TimelineDates[2]-this.TimelineDates[0];var b=10;for(var d=2;d<this.TimelineDates.length;d++){var e=this.TimelineDates[d]-this.TimelineDates[d-2];var c=0;for(var a=1;a<this.TimelineDates.length;a++){if(this._TimeJump(a,e)){c++}}if(c==b){if(this._GetGap(this.TimelineDates.length-1,e)<this._GetGap(this.TimelineDates.length-1,f)){f=e}}else{if(c<b){b=c;f=e}}}if(f<=0){return 1}return f};TimelineLayout.prototype._TimeJump=function(a,d){var c=3;if(a==0){return false}var b=(this.TimelineDates[a]-this.TimelineDates[a-1])/d;if(a==1){return(b>c)}b=(this.TimelineDates[a]-this.TimelineDates[a-2])/d;if(b>c||b<1){return true}return false};TimelineLayout.prototype._GetGap=function(a,c){if(a==0){return 0}var b=(this.TimelineDates[a]-this.TimelineDates[a-1])/c;if(this._TimeJump(a,c)){b=1.5}return b*this.FullRowHeight()+this._GetGap(a-1,c)};TimelineLayout.prototype.GetLayoutLines=function(k,d){StoryboardContainer.ClearLogos();var e="font-size:16pt;font-family:'Francois One';fill:#000000; text-anchor:end;";var f="font-size:16pt;font-family:'Francois One';fill:#000000; text-anchor:start;";var h=SvgCreator.CreateSvgGroup("timeline-grids");var q=this.Row1PaddingLeft+this.FullColumnWidth()+this._TimeLinePaddingMultiple*this._Padding;var r=this.Row1PaddingTop+2.5;var s=this._GetGap(d-1,this._TimeUnit)+this.FullRowHeight()+r-this.BetweenRowPadding-3.5;var l="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";h.appendChild(SvgCreator.AddLine(q,r,q,s,l,"timeline-big-line"));h.appendChild(SvgCreator.AddLine(q-2*this._Padding,r,q+2*this._Padding,r,l,"timeline-big-line-top-cap"));h.appendChild(SvgCreator.AddLine(q-2*this._Padding,s,q+2*this._Padding,s,l,"timeline-big-line-bottom-cap"));for(var c=0;c<d;c++){var b=this.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCellTitle,0,c);if(this.HasTitle==false){b=this.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCell,0,c)}b.X-=this._Padding;b.Width+=2*this._Padding;b.Y-=this._Padding;b.Height=this.FullRowHeight()-this.BetweenRowPadding;var a=this.GetAnchorPoints(b);var j=SvgCreator.AddRect(b.X,b.Y,b.Width,b.Height,"black","none",null,null,"outerbox_"+c);j.setAttributeNS(null,"stroke-width",+this._ChartOuterBoxWidth+"px");h.appendChild(j);if(c%2==0){var i=a.Right+((this._TimeLinePaddingMultiple-1)*this._Padding);h.appendChild(SvgCreator.AddLine(a.Right,a.MiddleY,i,a.MiddleY,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","timeline-connector-"+c));h.appendChild(SvgCreator.AddText(i-this._Padding,a.MiddleY-5,this._FormatDate(this.TimelineDates[c]),e,"date-text-"+c));h.appendChild(SvgCreator.AddText(i-this._Padding,a.MiddleY+22,this._FormatTime(this.TimelineDates[c]),e,"date-text-"+c))}else{var i=a.Left-((this._TimeLinePaddingMultiple-1)*this._Padding);h.appendChild(SvgCreator.AddLine(a.Left,a.MiddleY,i,a.MiddleY,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","timeline-connector-"+c));h.appendChild(SvgCreator.AddText(i+this._Padding,a.MiddleY-5,this._FormatDate(this.TimelineDates[c]),f,"date-text-"+c));h.appendChild(SvgCreator.AddText(i+this._Padding,a.MiddleY+22,this._FormatTime(this.TimelineDates[c]),f,"date-text-"+c))}if(this._TimeJump(c,this._TimeUnit)){var m=q-15;var n=q+15;var o=a.Top-0.25*this.FullRowHeight()+15;var p=a.Top-0.25*this.FullRowHeight()-15;h.appendChild(SvgCreator.AddLine(m,o,n,p,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","time-jump-a"+c));h.appendChild(SvgCreator.AddLine(m,o+10,n,p+10,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","time-jump-b"+c))}}h.appendChild(this._DrawLegend());return h};TimelineLayout.prototype._DrawLegend=function(){var i=SvgCreator.CreateSvgGroup("timeline-legend");var v=this.GetStoryboardContentBounds(StoryboardContainer.Rows,StoryboardContainer.Cols);var w="stroke:black; stroke-width:1px; ";var h="font-size:10pt;font-family:'roboto';fill:#000000; text-anchor:middle;";var b=v.Y+v.Height+this._LegendPaddingTop;var a=this.Row1PaddingLeft;var c=this.FullRowHeight()+2*this._Padding;var o=b+1.5*this._Padding+25;var l=a+this._Padding;var m=this.FullRowHeight()+l;var r=SvgCreator.AddRect(a,b,c,this._LegendBoxHeight,"black","white",null,null,"legend-box");r.setAttributeNS(null,"stroke-width","2px");i.appendChild(r);i.appendChild(SvgCreator.AddText((a+c)/2,b+20,MyLangMap.GetTextByToken("text-timeline-legend-Legend"),h.replace("10pt","14pt"),"legend-text-legend"));i.appendChild(SvgCreator.AddLine(l,o,m,o,w,"timeline-legend-width"));i.appendChild(SvgCreator.AddLine(l,o-this._Padding/2,l,o+this._Padding/2,w,"timeline-legend-left"));i.appendChild(SvgCreator.AddLine(m,o-this._Padding/2,m,o+this._Padding/2,w,"timeline-legend-right"));var d=o+50;var u=6;i.appendChild(SvgCreator.AddLine(l,d+u,l+u,d-u,w,"timeline-legend-slash1"));i.appendChild(SvgCreator.AddLine(l+u,d+u,l+2*u,d-u,w,"timeline-legend-slash2"));i.appendChild(SvgCreator.AddLine(l,d,l+2*u,d,w,"timeline-legend-slash3"));i.appendChild(SvgCreator.AddText(l+3*u,d+u,MyLangMap.GetTextByToken("text-timeline-legend-Time-Break"),h.replace("middle","start"),"legend-text"));var t=1000;var q=60*t;var k=60*q;var f=24*k;var z=365.25*f;var x=this._TimeUnit;var n="";var y=Math.floor(x/z);x-=y*z;var e=Math.floor(x/f);x-=e*f;var j=Math.floor(x/k);x-=j*k;var p=Math.floor(x/q);x-=p*q;var s=Math.floor(x/t);x-=s*t;if(y>0){n=MyLangMap.GetTextByToken("text-timeline-legend-years-and-days").replace("{years}",y).replace("{days}",e)}else{if(e>0){n=MyLangMap.GetTextByToken("text-timeline-legend-days-and-hours").replace("{hours}",j).replace("{days}",e)}else{n=MyLangMap.GetTextByToken("text-timeline-legend-hours-minutes").replace("{hours}",j).replace("{minutes}",p)}}i.appendChild(SvgCreator.AddText((l+m)/2,o+20,n,h+" font-style:italic","legend-text"));return i};TimelineLayout.prototype._FormatTime=function(a){var d=a.getHours();var e=a.getMinutes();var f=a.getSeconds();var b=d<=12?d:d%12;if(d==0&&e==0&&f==0){return""}var c="";c+=b+":";if(e<10){c+="0"}c+=e;if(f>0){c+=":";if(f<10){c+="0"}c+=f}if(d>=12){c+=" "+MyLangMap.GetTextByToken("text-timeline-legend-PM")}else{c+=" "+MyLangMap.GetTextByToken("text-timeline-legend-AM")}return c};TimelineLayout.prototype._FormatDate=function(a){var e=Math.abs(a.getFullYear());var c=" ";if(a.getFullYear()<0){c=" "+MyLangMap.GetTextByToken("text-timeline-legend-BCE")}if(a.getFullYear()<-1000&&(a.getMonth()==0&&a.getDate()==1)){return e.toLocaleString()+" "+MyLangMap.GetTextByToken("text-timeline-legend-BCE")}if($("#timeline-use-day").is(":checked")){return a.toDateString()+c}if($("#timeline-use-month").is(":checked")){try{var d=new Date(a.getTime());d.setDate(2);return d.toLocaleDateString(window.navigator.language,{month:"long"})+" "+e+c}catch(b){}}if(c==" "){c=" "+MyLangMap.GetTextByToken("text-timeline-legend-CE")}return e+c};TimelineLayout.prototype.GetLayoutConfig=function(){var a=new Object();a.TimelineDates=this.TimelineDates;return a};function AttributionArea(a){this.DefaultText="";this.DefaultFontSize=a;this.DefaultFontColor="#000000";this.DefaultFont="Roboto";this.FillColor=new ColorableBox("none","Textables","Fill");this.Stroke="none";this.StrokeWidth=0;this.RoundedCornerRadius=0;this.TextPadding=0;this.TextAlignment="start";this.AllowEditting=false;this.ForceTextOverride=true;this.Rotation=0;this.StoryboardPartType=StoryboardPartTypeEnum.StoryboardAttributionArea};function BasicTextLayoutDescription(){this.DefaultText=MyLangMap.GetTextByToken("text-click-to-edit-description");this.DefaultFontSize="12";this.DefaultFontColor="#000000";this.DefaultFont=MyBrowserProperties.Public_GetDefaultFont();this.FillColor=new ColorableBox("rgb(255, 255, 255)","Textables","Fill");this.Stroke="#757575";this.StrokeWidth=2;this.RoundedCornerRadius=2;this.TextPadding=5;this.TextAlignment="middle";this.AllowEditting=true;this.ForceTextOverride=false;this.Rotation=0;this.StoryboardPartType=StoryboardPartTypeEnum.StoryboardCellDescription};function BasicTextLayoutTitle(a){this.DefaultText=MyLangMap.GetTextByToken("text-click-to-edit-title");this.DefaultFontSize="18";this.DefaultFontColor="#000000";this.DefaultFont=MyBrowserProperties.Public_GetDefaultFont();this.FillColor=new ColorableBox("rgb(255, 255, 255)","Textables","Fill");this.Stroke="#757575";this.StrokeWidth=2;this.RoundedCornerRadius=2;this.TextPadding=5;this.TextAlignment="middle";this.Rotation=0;this.AllowEditting=true;this.ForceTextOverride=false;this.StoryboardPartType=StoryboardPartTypeEnum.StoryboardCellTitle;if(a!=null){this.DefaultText=a}};function ColorableBox(a,b,c){this.Color=a;this.ColorScheme=b;this.ColorTitle=c};function TChartTitle(a){this.DefaultText=MyLangMap.GetTextByToken("text-click-to-edit-title");this.DefaultFontSize=a;this.DefaultFontColor="#FFFFFF";this.DefaultFont=MyBrowserProperties.Public_GetDefaultFont();this.FillColor=new ColorableBox("rgb(0, 0, 0)","Textables","Fill");this.Stroke="black";this.StrokeWidth=6;this.RoundedCornerRadius=2;this.TextPadding=5;this.TextAlignment="middle";this.AllowEditting=true;this.ForceTextOverride=false;this.Rotation=0;this.StoryboardPartType=StoryboardPartTypeEnum.StoryboardAreaTitle};function Pointers(){this.CellContainer;this.CoreSvg;this.Watermark;this.SvgContainer;this.Tabs;this.BottomControls;this.HelpTopicArea;this.CoreSVG_SvgTop;this.Dialog_ChangeLayout;this.Dialog_SpiderCellCount;this.Dialog_CycleCellCount;this.Dialog_TimelineCellCount;this.Dialog_StoryboardType;this.Dialog_PurchasePopForMoreLayouts;this.Dialog_PurchasePopForMoreLayoutsOnCopy;this.Dialog_PurchasePopForMoreStoryboardLayouts;this.Dialog_PurchaseForUploads;this.Dialog_CropImage;this.Dialog_PoseImage;this.Dialog_SmartScene;this.Dialog_UploadImage;this.Dialog_Help;this.Dialog_Policies;this.Dialog_AdvancedButtons;this.Controls_UpdateColor;this.Controls_TextableControls;this.Controls_TextableControls_TextArea;this.Controls_TextableControls_ColorSelector;this.Controls_TextableControls_FontSelector;this.Controls_ShapeControls;this.Controls_MultiShapeControls;this.StagingGround;this.ResetAllPointers=function(){this.CellContainer=$("#CellDefinition");this.CoreSvg=$("#CoreSvg");this.SvgContainer=$("#svgContainer");this.BottomControls=$("#bottom-toolbar");this.Tabs=$("#WorkingArea div.clipart-library-tabs");this.Watermark=$("#watermark");this.HelpTopicArea=$("#HelpTopicArea");this.Dialog_ChangeLayout=$("#ChangeLayoutDialog");this.Dialog_SpiderCellCount=$("#ChangeCellCountSpider");this.Dialog_CycleCellCount=$("#ChangeCellCountCycle");this.Dialog_TimelineCellCount=$("#ChangeCellCountTimeline");this.Dialog_StoryboardType=$("#StoryboardTypeDialog");this.Dialog_PurchasePopForMoreLayouts=$("#PurchasePopForLayoutOptions");this.Dialog_PurchasePopForMoreLayoutsOnCopy=$("#PurchasePopForLayoutOptionsOnCopy");this.Dialog_PurchasePopForMoreStoryboardLayouts=$("#PurchasePopForStoryboardLayoutOptions");this.Dialog_CropImage=$("#CropArea");this.Dialog_MultiTextable=$("#MultiTextableModal");this.Dialog_PoseImage=$("#PoseArea");this.Dialog_SmartScene=$("#Smart-Scene-Modal");this.Dialog_UploadImage=$("#UploadArea");this.Dialog_PurchaseForUploads=$("#PurchaseForUploads");this.Dialog_Help=$("#HelpArea");this.Dialog_CellSize=$("#StoryboardCellSizeDialog");this.Dialog_Policies=$("#PoliciesDialog");this.Dialog_AdvancedButtons=$("#AdvancedButtonsDialog");this.CoreSVG_SvgTop=$("#SvgTop");this.Controls_UpdateColor=$("#ColorUpdaterBox");this.Controls_TextableControls=$("#textableControls");this.Controls_TextableControls_TextArea=$("#textableText");this.Controls_TextableControls_ColorSelector=$("#FontColorSelector");this.Controls_TextableControls_FontSelector=$("#FontSelector");this.Controls_TextableControls_TextAlignmentSelectors=$("#textableControls .MenuAlignText");this.Controls_AllShapeControls=$("#allControlsBox");this.Controls_ShapeControls=$("#controlsBox");this.Controls_MultiShapeControls=$("#MultiSelectControlsBox");this.StagingGround=$("#StagingGround")};this.GetSvgTop=function(){if(this.CoreSVG_SvgTop==null||this.CoreSVG_SvgTop.length==0){this.CoreSVG_SvgTop=$("#SvgTop");if(this.CoreSVG_SvgTop==null||this.CoreSVG_SvgTop.length==0){var a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("id","SvgTop");this.CoreSvg.append(a);this.CoreSVG_SvgTop=$("#SvgTop")}}return this.CoreSVG_SvgTop};this.ResetAllPointers()};function SbtMathLibrary(){this.DegreesFromRadians=function(a){return a*(180/Math.PI)};this.ProjectAtoB=function(c,e){var f=e.x*e.x+e.y*e.y;var d=(c.x*e.x+c.y*e.y)/f;return{x:d*e.x,y:d*e.y}};this.ProjectAtoBScale=function(c,e){var f=e.x*e.x+e.y*e.y;var d=(c.x*e.x+c.y*e.y)/f;return d};this.CosAngleBetweenVector=function(a,c){var b=Math.sqrt(a.x*a.x+a.y*a.y);var d=Math.sqrt(c.x*c.x+c.y*c.y);return(a.x*c.x+a.y*c.y)/(a.norm*c.norm)};this.CalculateAngle=function(d,e,l,m,n,o){var a=2;var j=d-n;var f=e-o;var h=Math.sqrt((j*j)+(f*f));var p=Math.asin(f/h);var b=this.DegreesFromRadians(p);var k=d-l;var g=e-m;var i=Math.sqrt((k*k)+(g*g));var q=Math.asin(g/i);var c=this.DegreesFromRadians(q);a=b-c;if(l<d){a=a*-1}return a};this.ScaleAndCenter=function(d,f,e,i,k){var a=GetGlobalById(d).getBBox();var j=(f-i)/a.width;var l=(e-k)/a.height;var h=Math.min(j,l);var b=(f-((a.width)*h))/2;b-=(a.x*h);var c=(e-((a.height)*h))/2;c-=(a.y*h);var g=new Object();g.CenterX=b;g.CenterY=c;g.Scale=h;return g};this.RotatePoint=function(d,a,e){var h=Math.sin(a);var b=Math.cos(a);var f={x:e.x-d.x,y:e.y-d.y};var g={x:f.x*b-f.y*h+d.x,y:f.x*h+f.y*b+d.y};return g}};function StoryboardContainerLibrary(){this.Private_TitleGroup="TitleGroup";this.Private_DescriptionGroup="DescriptionGroup";this.Private_AttributionGroup="ImageAttributionGroup";this.Private_StoryboardTitlesGroup="StoryboardTitlesGroup";this.Private_StoryboardLayoutLinesGroup="StoryboardLayoutLinesGroup";this.Private_LayoutType="Sbt-Layout-Type";this.Rows=1;this.Cols=3;this.MaxCols=6;this.MaxRows=4;this.CoreSvgLeft;this.CoreSvgTop;this.CoreSvgRight;this.CoreSvgBottom;this.SvgContainerPositionTop;this.SvgContainerPositionLeft;this.SvgContainerOffsetTop;this.SvgContainerOffsetLeft;this.GlobalCellCropRatio={};this.IsFreeLayoutConfiguration=function(c,a){try{if(a!=3){return false}if(c>2){return false}if(StoryboardContainer.GetLayoutType()!=StoryboardLayoutType.StoryboardGrid){return false}return true}catch(b){LogErrorMessage("SvgManip.IsFreeLayoutConfiguration",b)}};this.IsPaperTypeLayout=function(){var a=StoryboardContainer.GetLayoutType();if(a==StoryboardLayoutType.PortraitPaper||a==StoryboardLayoutType.LandscapePaper||a==StoryboardLayoutType.PortraitLegal||a==StoryboardLayoutType.LandscapeLegal||a==StoryboardLayoutType.PortraitTabloid||a==StoryboardLayoutType.LandscapeLedger||a==StoryboardLayoutType.FreeSize){return true}return false};this.GetLayoutType=function(){var a=MyPointers.CoreSvg.attr(this.Private_LayoutType);if(a==null){return StoryboardLayoutType.StoryboardGrid}return a};this.SetLayoutType=function(){MyPointers.CoreSvg.attr(this.Private_LayoutType,CellConfiguration.LayoutType)};this.Initialize=function(){this.JiggleSvgSize();this.SetCoreSvgDimensions()};this.RemoveUpgradeCtas=function(){$(".Upgrade-Bar").remove();StoryboardContainer.JiggleSvgSize()};this.JiggleSvgSize=function(){var d=5;var h=MyPointers.Tabs.width();var b=$(window);var g=b.height()-(MyPointers.Tabs.outerHeight()+MyPointers.BottomControls.outerHeight());var a=GetGlobalById("CoreSvg").getBoundingClientRect();var f=(a.width-2)+(2*d);var e=(a.height-2)+(2*d);if(f<h&&e<g){MyPointers.SvgContainer.css("overflow","")}else{MyPointers.SvgContainer.css("overflow","auto")}var c=MyPointers.Tabs.height();MyPointers.SvgContainer.css("width",h+"px");MyPointers.SvgContainer.css("width","100%");MyPointers.SvgContainer.css("height",g+"px");MyPointers.SvgContainer.css("margin-top",c+"px");MyPointers.CoreSvg.css("margin","5px");if(e<g){MyPointers.CoreSvg.css("margin",((g-StoryboardContainer.Private_GetScrollBarWidth()-e)/2)+"px 5px")}};this.UpdateBackgroundColors=function(){MyPointers.CoreSvg.css("border","1px solid #808080;");MyPointers.CoreSvg.css("background-color","#ffffff;");MyPointers.CoreSvg.css("margin","5px");MyPointers.CoreSvg.css("border-radius","6px");if(this.GetLayoutType()==StoryboardLayoutType.FreeSize){MyPointers.CoreSvg.css("background-color","#E0E1DC");MyPointers.CoreSvg.css("border","0");MyPointers.CoreSvg.css("border-radius","0")}};this.RemoveFilters=function(){if(MyBrowserProperties.IsSafari5){$("filter").remove()}$("inkscape\\:perspective").remove();$("inkscape\\:path-effect").remove();$("rdf\\:rdf").remove();$("metadata").remove();var a=$("[inkscape\\:xlink\\:href]");a.removeAttr("inkscape:xlink:href")};this.UpdateGradientIds=function(d){var a=new Array();RecursivelyFindGradientChildrenIds(d,a);for(var b=0;b<a.length;b++){var e=a[b];var c=e;if(c.indexOf("_ix_")>0){c=c.substring(0,c.indexOf("_ix_"))}c=c+"_ix_"+new Date().getTime()+"_"+b;RecursivelyUpdateChildrenIds(d,e,c)}};this.GetShapeStatesForCell=function(d,a){var h=new Object();h[StoryboardPartTypeEnum.StoryboardCell]=new Array();h[StoryboardPartTypeEnum.StoryboardCellTitle]=new Array();h[StoryboardPartTypeEnum.StoryboardCellDescription]=new Array();var c=this.GetAllLayoutParts(CellConfiguration);var g=MyShapesState.Public_GetAllMovableShapeStates(false);ShapesState.Public_ZSortShapeStates(g);for(var b=0;b<g.length;b++){var f=g[b];var e=this._GetLayoutPartForShape(c,f);if(e!=null){if(e.StoryboardPartType==StoryboardPartTypeEnum.StoryboardAreaTitle){continue}if(e.StoryboardPartType==StoryboardPartTypeEnum.StoryboardAttributionArea){continue}if(e.Col==a&&e.Row==d){h[e.StoryboardPartType].push(f)}}}return h};this.Public_ChangeCellOrder=function(f){var d=this.GetAllLayoutParts(CellConfiguration);var k=MyShapesState.Public_GetAllMovableShapeStates(false);for(var b=0;b<k.length;b++){var h=k[b];var g=this._GetLayoutPartForShape(d,h);if(g!=null){if(g.StoryboardPartType==StoryboardPartTypeEnum.StoryboardAreaTitle){continue}for(var c=0;c<f.length;c++){var a=f[c];if(a.oldCol==g.Col&&a.oldRow==g.Row){var e=CellConfiguration.GetCellPartPosition(g.StoryboardPartType,a.newRow,a.newCol);h.Public_ChangeShapeLocation(g,e);break}}}}};this.ChangeCellConfiguration_MoveShapes=function(e,c){var b=this.GetAllLayoutParts(e);var h=MyShapesState.Public_GetAllMovableShapeStates(false);for(var a=0;a<h.length;a++){var g=h[a];var f=this._GetLayoutPartForShape(b,g);if(f!=null){var d=c.GetCellPartPosition(f.StoryboardPartType,f.Row,f.Col);g.Public_ChangeShapeLocation(f,d)}}};this.ChangeCellConfiguration_ScaleShapes=function(e,c,f){var b=this.GetAllLayoutParts(e);var j=MyShapesState.Public_GetAllMovableShapeStates(false);for(var a=0;a<j.length;a++){var h=j[a];var g=this._GetLayoutPartForShape(b,h);if(g!=null){var d=c.GetCellPartPosition(g.StoryboardPartType,g.Row,g.Col);h.Public_HandleCellExpansion(f,g,d)}else{h.Public_HandleCellExpansion(f,null,null)}}};this._GetLayoutPartForShape=function(f,h){try{var a=h.Public_GetImaginaryOuterBox();var g={x:(a.Left+a.Right)/2,y:(a.Top+a.Bottom)/2};for(var d=0;d<f.length;d++){var b=f[d];if(g.x>=b.X&&g.x<(b.X+b.Width)){if(g.y>=b.Y&&g.y<(b.Y+b.Height)){return b}}}}catch(c){LogErrorMessage("StoryboardContainerLibrary._GetLayoutPartForShape",c)}return null};this.CleanupAndVerifyLoadedSvg=function(){var a=$("#"+MyIdGenerator.GenerateCellId(0,0));if(a.length==0){this.Private_UpdateOldCellIds();this.Private_MoveAllArtUp()}};this.CalculateRowsAndCols=function(){this.Rows=1;this.Cols=1;for(var b=1;b<100;b++){var a=$("#"+MyIdGenerator.GenerateCellId(0,b));if(a.length>0){this.Cols=b+1}else{break}}for(var c=1;c<100;c++){var a=$("#"+MyIdGenerator.GenerateCellId(c,0));if(a.length>0){this.Rows=c+1}else{break}}while(this.Rows>StoryboardContainer.MaxRows){AddExtraLayoutCells(true,false)}while(this.Cols>StoryboardContainer.MaxCols){AddExtraLayoutCells(false,true)}};this.SetCoreSvgDimensions=function(){var a=GetGlobalById("CoreSvg").getBoundingClientRect();var e=(a.width-2);var d=(a.height-2);this.CoreSvgLeft=a.left;this.CoreSvgTop=a.top;if(this.CoreSvgLeft<0||e>MyPointers.SvgContainer.width()){this.CoreSvgLeft=5}if(this.CoreSvgTop<0||d>MyPointers.SvgContainer.height()){this.CoreSvgTop=MyPointers.Tabs.height()+5}this.CoreSvgRight=e+this.CoreSvgLeft;this.CoreSvgBottom=d+this.CoreSvgTop;var c=MyPointers.SvgContainer.position();this.SvgContainerPositionTop=c.top;this.SvgContainerPositionLeft=c.left;var b=MyPointers.SvgContainer.offset();this.SvgContainerOffsetTop=b.top;this.SvgContainerOffsetLeft=b.left};this.getCellInformation=function(h,j){h=((h>0)?h:0);j=((j>0)?j:0);var d=CellConfiguration.CellWidth-(CellConfiguration.BackGroundOffsetX*2);var c=CellConfiguration.CellHeight-(CellConfiguration.BackGroundOffsetY*2);var b=$("[id^=cell_]");var f,g;for(var e=0;e<b.length;e++){var a=$(b[e]);cellX=parseFloat(a.attr("x"));cellY=parseFloat(a.attr("y"));cellWidth=parseFloat(a.attr("width"));cellHeight=parseFloat(a.attr("height"));if(h>=cellX&&h<=(cellWidth+cellX)){if(j>=cellY&&j<=(cellHeight+cellY)){f=cellX;g=cellY}}}if(f==null){return null}return{cellX:f,cellY:g,cellWidth:cellWidth,cellHeight:cellHeight,desiredWidth:d,desiredHeight:c}};this.DetermineBackDropCords=function(k,l,n,a,f){if(a==null){return null}var h=k.Public_GetImaginaryOuterBox();var b=h.Bottom-h.Top;var c=h.Right-h.Left;var j;var m;var o;if(k.Angle!=0||f){j=Math.min(a.desiredWidth/c,a.desiredHeight/b);m=j*k.ScaleX;o=j*k.ScaleY}else{m=a.desiredWidth/c*k.ScaleX;o=a.desiredHeight/b*k.ScaleY}var g=k.IsSpringable()&&k.SpringableState.CanResizeVertical()&&k.SpringableState.CanResizeHorizontal();if(!g){k.SetScale(m,o);h=k.Public_GetImaginaryOuterBox()}var d,e;if(f){d=a.cellX+a.cellWidth/2-(h.Left+h.Right)/2;e=a.cellY+a.cellHeight/2-(h.Top+h.Bottom)/2}else{d=a.cellX-h.Left;e=a.cellY-h.Top}moveAndScale=new MoveAndScale();moveAndScale.MoveToX=k.X+d;moveAndScale.MoveToY=k.Y+e;if(!g){k.MoveTo(moveAndScale.MoveToX,moveAndScale.MoveToY)}moveAndScale.ScaleX=m;moveAndScale.ScaleY=o;return moveAndScale};this.DetermineBackDropCordsForSpringObject=function(f,a,d){if(a==null){return null}var e=f.Public_GetImaginaryOuterBox();var b,c;if(d){b=a.cellX+a.cellWidth/2-(e.Left+e.Right)/2;c=a.cellY+a.cellHeight/2-(e.Top+e.Bottom)/2}else{b=a.cellX-e.Left;c=a.cellY-e.Top}f.X+=b;f.Y+=c};this.CreateRowsAndCells=function(b,a){this.Private_RemoveOutOfBoundsContent(b,a);this.Private_RemoveOldCellsAndRows(b,a);this.Private_AddRowsAndCells(b,a);this.Rows=b;this.Cols=a;this.Private_RefreshStoryboardContainer();UndoManager.clear()};this.Private_ClearCells=function(){MyPointers.CellContainer.children("rect").remove();$("#"+this.Private_TitleGroup).remove();$("#"+this.Private_DescriptionGroup).remove();this.ClearStoryboardTitlesAndLines()};this.Public_ResetLayout=function(){this.Private_ClearCells();this.Private_AddRowsAndCells(this.Rows,this.Cols);this.Private_RefreshStoryboardContainer()};this.ChangeCellCellLayout=function(){this.Public_ResetLayout();this.Private_RemoveOutOfBoundsContent(this.Rows,this.Cols)};this.ExpandCells=function(a,b){this.Private_ClearCells();this.Private_AddRowsAndCells(this.Rows,this.Cols);if(b!==false){this.Private_RefreshStoryboardContainer()}};this.Private_RefreshStoryboardContainer=function(a){if(CellPickerHelper.Props!=void 0&&CellPickerHelper.Props.CoreSVGRegion.state){return}this.Private_MoveWatermarkText(this.Rows,this.Cols);this.Private_UpdateStoryboardFrame();if(a!==false){this.Private_DrawLayoutLines(this.Rows,this.Cols)}this.JiggleSvgSize();this.SetCoreSvgDimensions()};this.Private_DrawLayoutLines=function(c,b){var a=this.Private_GetAreaGroup(this.Private_StoryboardLayoutLinesGroup);a.append(CellConfiguration.GetLayoutLines(c,b))};this.Private_MoveWatermarkText=function(){var a=CellConfiguration.GetWatermarkTop(this.Rows);MyPointers.Watermark.attr("y",a)};this.Private_UpdateStoryboardFrame=function(){var a=CellConfiguration.GetStoryboardSize(this.Rows,this.Cols);MyPointers.CoreSvg.attr("height",a.Height);MyPointers.CoreSvg.attr("width",a.Width)};this.UpdateImageAttributions=function(){var c="";var d=MyShapesState.Public_GetImageAttributions();for(var e in d){if(d.hasOwnProperty(e)){c+=d[e].Title+" ("+d[e].ImageUrl+") - "+d[e].Author+" - "+MyLangMap.GetTextByToken("Text-Image-Attributions-License")+" "+d[e].License+"\r\n"}}var a=this.Private_GetAreaGroup(this.Private_AttributionGroup);a.children().remove();if(c.length>0){if(UseSummerNote&&SbtSummerNoteHelper!=null){SbtSummerNoteHelper.ResetToDefaults()}c=MyLangMap.GetTextByToken("Text-Image-Attributions-Section")+"\r\n"+c;var b=new AttributionArea(8);this.Private_AddTextable(MyIdGenerator.GenerateAttibutionAreaId(),this.Rows,this.Cols,b,a,c);if(UseSummerNote&&SbtSummerNoteHelper!=null){SbtSummerNoteHelper.ResetToDefaults()}}this.Private_RefreshStoryboardContainer(false)};this.GetAllLayoutParts=function(e){var b=[];for(var d=0;d<this.Rows;d++){for(var a=0;a<this.Cols;a++){var c=e.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCell,d,a);c.StoryboardPartType=StoryboardPartTypeEnum.StoryboardCell;c.Row=d;c.Col=a;b.push(c);if(e.HasTitle){c=e.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCellTitle,d,a);c.StoryboardPartType=StoryboardPartTypeEnum.StoryboardCellTitle;c.Row=d;c.Col=a;b.push(c)}if(e.HasDescription){c=e.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCellDescription,d,a);c.StoryboardPartType=StoryboardPartTypeEnum.StoryboardCellDescription;c.Row=d;c.Col=a;b.push(c)}c=e.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardAreaTitle,d,a);if(c==null){continue}c.StoryboardPartType=StoryboardPartTypeEnum.StoryboardAreaTitle;c.Row=d;c.Col=a;b.push(c)}}return b};this.Private_AddRowsAndCells=function(f,d){if(UseSummerNote&&SbtSummerNoteHelper!=null){SbtSummerNoteHelper.ResetToDefaults()}GlobalCellCropRatio={};for(var e=0;e<f;e++){for(var a=0;a<d;a++){var b=$("#"+MyIdGenerator.GenerateCellId(e,a));GlobalCellCropRatio[MyIdGenerator.GenerateCellId(e,a)]={A1:0,A2:1,A3:0,B1:0,B2:1,B3:0};if(b.length==0){this.Private_CreateCell(e,a)}this.Private_AddTextable(MyIdGenerator.GenerateStoryboardTitleId(e,a),e,a,CellConfiguration.GetStoryboardAreaTitleLayout(e,a),this.Private_GetAreaGroup(this.Private_StoryboardTitlesGroup))}}this.Private_AddTextable(MyIdGenerator.GenerateStoryboardTitleId(-1,-1),-1,-1,CellConfiguration.GetStoryboardAreaTitleLayout(-1,-1),this.Private_GetAreaGroup(this.Private_StoryboardTitlesGroup))};this.Private_RemoveOldCellsAndRows=function(d,b){for(var c=this.Rows-1;c>=d;c--){for(var a=0;a<this.Cols;a++){this.Private_RemoveCellAndTitleBlocks(c,a)}}for(var c=0;c<d;c++){for(var a=this.Cols-1;a>=b;a--){this.Private_RemoveCellAndTitleBlocks(c,a)}}this.ClearStoryboardTitlesAndLines()};this.ClearStoryboardTitlesAndLines=function(){this.Private_GetAreaGroup(this.Private_StoryboardLayoutLinesGroup).remove();this.Private_GetAreaGroup(this.Private_StoryboardTitlesGroup).remove()};this.Private_RemoveCellAndTitleBlocks=function(d,b){var a=$("#"+MyIdGenerator.GenerateCellId(d,b));var e=$("#"+MyIdGenerator.GenerateTitleCellId(d,b));var c=$("#"+MyIdGenerator.GenerateDescriptionCellId(d,b));if(a.length>0){a.remove()}if(e.length>0){e.remove()}if(c.length>0){c.remove()}};this.Public_FindOutOfBoundContent=function(g,b){var f=CellConfiguration.GetStoryboardContentBounds(g,b);var k=[];var j=MyShapesState.Public_GetAllMovableShapeStates(false);for(var d=0;d<j.length;d++){var h=j[d];if(h===null){continue}if(Math.floor(h.Y)>=Math.floor(f.Height)||Math.floor(h.X)>=Math.floor(f.Width)){k.push(h.Id)}if(h.Y<0){try{var a=h.GetBBox();if(h.Y+a.height<0){k.push(h.Id)}}catch(c){LogErrorMessage("StoryboardContainerLibrary.Public_FindOutOfBoundContent.NegativeY",c)}}}return k};this.Private_RemoveOutOfBoundsContent=function(b,a){ClearActiveState();var d=this.Public_FindOutOfBoundContent(b,a);for(i=0;i<d.length;i++){var c=d[i];MyShapesState.Public_RemoveShapeStateById(c);$("#"+c).remove()}};this.Private_CreateCell=function(c,b){var a=CellConfiguration.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCell,c,b);var d=SvgCreator.AddRect(a.X,a.Y,a.Width,a.Height,CellConfiguration.Stroke,CellConfiguration.Fill,CellConfiguration.StrokeDashArray,CellConfiguration.Opacity);d.setAttributeNS(null,"stroke-width",CellConfiguration.StrokeWidth);d.setAttributeNS(null,"rx",CellConfiguration.Rx);d.setAttributeNS(null,"ry",CellConfiguration.Ry);d.setAttributeNS(null,"id",MyIdGenerator.GenerateCellId(c,b));MyPointers.CellContainer.append(d);if(CellConfiguration.HasTitle){this.Private_AddTextable(MyIdGenerator.GenerateTitleCellId(c,b),c,b,CellConfiguration.TitleLayout,this.Private_GetAreaGroup(this.Private_TitleGroup),CellConfiguration.GetCellTitleOverrideText(c,b))}if(CellConfiguration.HasDescription){this.Private_AddTextable(MyIdGenerator.GenerateDescriptionCellId(c,b),c,b,CellConfiguration.DescriptionLayout,this.Private_GetAreaGroup(this.Private_DescriptionGroup))}};this.Private_MoveAllArtUp=function(){var c=MyShapesState.Public_GetAllMovableShapeStates(false);for(var a=0;a<c.length;a++){var b=c[a];if(b===null){continue}b.Y-=10;b.UpdateDrawing()}};this.Private_UpdateOldCellIds=function(){var g=CellConfiguration.Row1PaddingTop+CellConfiguration.CellPaddingTop;var h=CellConfiguration.FullRowHeight()+CellConfiguration.CellPaddingTop;var a=$("#CellDefinition").children()[0];var b=$("#CellDefinition").children()[1];var c=$("#CellDefinition").children()[2];var d=$("#Cell4");var e=$("#Cell5");var f=$("#Cell6");a.setAttributeNS(null,"id",MyIdGenerator.GenerateCellId(0,0));b.setAttributeNS(null,"id",MyIdGenerator.GenerateCellId(0,1));c.setAttributeNS(null,"id",MyIdGenerator.GenerateCellId(0,2));a.setAttributeNS(null,"y",g);b.setAttributeNS(null,"y",g);c.setAttributeNS(null,"y",g);if(d.length>0){d.attr("id",MyIdGenerator.GenerateCellId(1,0));d.attr("y",h)}if(e.length>0){e.attr("id",MyIdGenerator.GenerateCellId(1,1));e.attr("y",h)}if(f.length>0){f.attr("id",MyIdGenerator.GenerateCellId(1,2));f.attr("y",h)}};this.Private_AddTextable=function(b,j,c,t,a,g){if(t==null){return}var h=CellConfiguration.GetCellPartPosition(t.StoryboardPartType,j,c);if(h==null){return}var m=b;var r=m+SvgPartsEnum.Scale;var o=m+SvgPartsEnum.Natural;var p=t.FillColor.ColorScheme+"_"+m+"_outer";var s=m+"_text";var l=SvgCreator.CreateSvgGroup(m);var q=SvgCreator.CreateSvgGroup(r);var n=SvgCreator.CreateSvgGroup(o);var f=SvgCreator.AddRect(0,0,h.Width,h.Height,t.Stroke,t.FillColor.Color,null,CellConfiguration.Opacity,p);f.setAttributeNS(null,"stroke-width",t.StrokeWidth);f.setAttributeNS(null,"rx",t.RoundedCornerRadius);f.setAttributeNS(null,"ry",t.RoundedCornerRadius);var u=t.TextPadding;var v=SvgCreator.AddRect(u,u,h.Width-(2*u),h.Height-(2*u),null,"none",null,CellConfiguration.Opacity,s);var d=SvgCreator.CreateMetadata();d.appendChild(SvgCreator.CreateTextableMetadata(s));d.appendChild(SvgCreator.CreateColorableMetadata(t.FillColor.Color,t.FillColor.Color,t.FillColor.ColorScheme,t.FillColor.ColorTitle));l.appendChild(d);l.appendChild(q);q.appendChild(n);n.appendChild(f);n.appendChild(v);a.append(l);var e=MyShapesState.Public_GetShapeStateById(m);var k=new SvgState(m);k.TextState.D[0].Text=g||t.DefaultText;k.TextState.D[0].DefaultText=t.DefaultText;k.TextState.D[0].Font=t.DefaultFont;k.TextState.D[0].FontSize=t.DefaultFontSize;k.TextState.D[0].FontColor=t.DefaultFontColor;k.TextState.D[0].TextAlignment=t.TextAlignment||"middle";k.Angle=t.Rotation||0;k.TextState.D[0].Html="";k.TextState.D[0].VerticalAlignment="middle";if(UseQuill||UseSummerNote||UseInlineEditor){if(k.TextState.D[0].Text.indexOf("\n")>=0){k.TextState.Public_ConvertToQuill()}else{k.TextState.Public_GenerateQuillForOneLiner(k.TextState.D[0].Text,k.TextState.D[0].FontSize,k.TextState.D[0].TextAlignment,k.TextState.D[0].Font,k.TextState.D[0].FontColor)}}k.Movable=false;if(e!=null){if(e.TextState.D[0].Text==k.TextState.D[0].DefaultText||t.ForceTextOverride){e.TextState.D[0].Text=k.TextState.D[0].Text}k.TextState.D[0].Html=e.TextState.D[0].Html;k.TextState.D[0].VerticalAlignment=e.TextState.D[0].VerticalAlignment;if(b.indexOf("attribution")<=0){k.TextState.CopyFontStyles(e.TextState.D[0]);k.ColorableState.Public_Copy(e.ColorableState)}}MyShapesState.Public_SetShapeState(m,k);k.MoveTo(h.X,h.Y);k.UpdateDrawing();if(t.AllowEditting){$(l).attr("class","activeShape");$(l).off("mousedown").on("mousedown",ShapeSelected);$(l).off("mouseup").on("mouseup",HandleMouseExit)}else{$(l).css("cursor","default")}};this.Private_GetAreaGroup=function(b){var a=$("#"+b);if(a.length==0){a=SvgCreator.CreateSvgGroup(b);MyPointers.CellContainer.append(a);a=$("#"+b)}return a};this.Private_GetScrollBarWidth=function(){var a=$("<div>").css({visibility:"hidden",width:100,overflow:"scroll"}).appendTo("body"),b=$("<div>").css({width:"100%"}).appendTo(a).outerWidth();a.remove();return 100-b};this._LogoGroupArea="logo-area";this.ClearLogos=function(){$("#"+this._LogoGroupArea).remove()};this.AppendLogoAllCells=function(){StoryboardContainer.ClearLogos();for(var b=0;b<StoryboardContainer.Rows;b++){for(var a=0;a<StoryboardContainer.Cols;a++){StoryboardContainer.AppendLogo(b,a)}}};this.AppendLogo=function(h,c){var b=CellConfiguration.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCell,h,c);var a="logo-"+h+"-"+c;var j='<svg version="1.1"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="400px" height="71px" viewBox="0 0 400 71" enable-background="new 0 0 400 71" filter="" style="display: inline-block;"><rect x="23.5" y="14" fill="#FFFFFF" width="42.3" height="42"></rect><path fill="#808285" d="M22.7,12.8v44.3h44.4V12.8H22.7z M28.8,39.3v-3.7c-2-0.1-3.6-1.8-3.6-3.8 V19.6c0-2.1,1.7-3.8,3.8-3.8h20.1c2.1,0,3.8,1.7,3.8,3.8v12.2c0,2.1-1.7,3.8-3.8,3.8H32.8L28.8,39.3z M64.5,49.6 c0,1.6-1.2,2.8-2.7,2.9v2.9l-3-2.9H46.2c-1.6,0-2.9-1.3-2.9-2.9v-9.4c0-1.6,1.3-2.9,2.9-2.9h15.5c1.6,0,2.9,1.3,2.9,2.9L64.5,49.6 L64.5,49.6z"></path><rect x="4.6" y="12.8" fill="#808285" width="14.3" height="44.3"></rect><rect x="70.8" y="12.8" fill="#808285" width="14.8" height="44.3"></rect><path fill="#323233" d="M85.6,3.9H4.6v5.6h81.1V3.9z"></path><path fill="#323233" d="M85.6,60.5H4.6v5.6h81.1V60.5z"></path><path fill="#323233" d="M101.4,49.3c1.3,0.9,3.8,1.6,5.7,1.6c4.2,0,6.8-2.7,6.8-6.8 c0-3.7-2.2-6-5.3-8.4c-3.2-2.2-7.6-6-7.6-11.2c0-6.1,4.2-10.6,10.6-10.6c2.5,0,4.7,0.8,5.6,1.5l-1.1,3.9c-1-0.7-2.7-1.4-4.8-1.4 c-4,0-5.9,3-5.9,5.7c0,4,2.1,5.5,5.9,8.3c4.8,3.4,7,7.1,7,11.6c0,6.9-4.8,11.3-11.3,11.3c-2.8,0-5.6-0.9-6.8-1.7L101.4,49.3 L101.4,49.3z"></path><path fill="#323233" d="M128.9,19v6.7h5.6v3.5h-5.6v17.2c0,3.8,1.3,4.8,3,4.8 c0.8,0,1.4-0.1,1.9-0.2l0.2,3.5c-0.8,0.3-1.9,0.5-3.4,0.5c-1.9,0-3.5-0.5-4.5-1.7c-1.2-1.3-1.7-3.3-1.7-7.3V29.2h-3.5v-3.5h3.5v-4.9 L128.9,19z"></path><path fill="#323233" d="M155.8,40.2c0,11.2-5.1,14.9-9.6,14.9c-5.2,0-9.4-4.7-9.4-14.9 c0-10.5,4.7-14.9,9.7-14.9C151.6,25.3,155.8,30.1,155.8,40.2z M141.4,40.2c0,4.8,0.8,11.3,5,11.3c3.9,0,4.8-6.7,4.8-11.3 c0-4.4-0.8-11.2-4.9-11.2C142.1,28.9,141.4,35.7,141.4,40.2z"></path><path fill="#323233" d="M160.9,33.2c0-2.4-0.2-5.3-0.2-7.5h4.1l0.2,4.6h0.1c1-2.7,3.4-5,6.1-5 c0.4,0,0.7,0,1,0.1V30c-0.3,0-0.6,0-1,0c-2.9,0-5.1,2.7-5.6,6c-0.1,0.8-0.2,1.7-0.2,2.6v16h-4.6L160.9,33.2L160.9,33.2z"></path><path fill="#323233" d="M179.6,25.7l3.9,16.6c0.5,2.3,0.8,4.1,1.2,6h0.1c0.3-1.7,0.8-3.8,1.2-5.9 l3.5-16.6h4.5l-4.7,18.6c-1.8,7.2-3.8,14.2-7.2,18.6c-2,2.6-4.2,3.9-5.2,4.4l-1.7-3.9c1.4-0.8,2.8-2,4.1-3.6 c1.2-1.5,2.1-3.5,2.6-4.9c0.2-0.7,0.4-1,0.4-1.4c0-0.4-0.1-0.7-0.2-1.1l-7.3-26.6L179.6,25.7L179.6,25.7z"></path><path fill="#323233" d="M197.9,13.3h4.5v15.9h0.1c1.5-2.9,3.6-3.9,6.2-3.9c4.5,0,7.9,5.1,7.9,14.6 c0,10.4-4.3,15.2-8.8,15.2c-3,0-4.6-1.8-5.7-4.2h-0.2l-0.3,3.8h-3.9c0.1-1.7,0.2-4.9,0.2-6.9V13.3z M202.5,44.5 c0,0.7,0.1,1.3,0.2,1.8c1.1,4.2,3,5,4.4,5c3.7,0,5-5,5-11.2c0-5.8-1.4-10.9-5.1-10.9c-2.1,0-3.9,2.6-4.3,5.1c-0.1,0.7-0.1,1.3-0.1,2 V44.5z"></path><path fill="#323233" d="M239.6,40.2c0,11.2-5.1,14.9-9.6,14.9c-5.2,0-9.4-4.7-9.4-14.9 c0-10.5,4.7-14.9,9.7-14.9C235.5,25.3,239.6,30.1,239.6,40.2z M225.2,40.2c0,4.8,0.8,11.3,5,11.3c3.9,0,4.8-6.7,4.8-11.3 c0-4.4-0.8-11.2-4.9-11.2C226,28.9,225.2,35.7,225.2,40.2L225.2,40.2z"></path><path fill="#323233" d="M260,48c0,2.2,0.1,4.7,0.3,6.6h-4.1l-0.3-3h-0.2c-1.3,2.2-3.3,3.5-5.8,3.5 c-3.8,0-6.8-3.2-6.8-8.2c0-7.3,5.8-10.4,12.3-10.5v-0.9c0-3.9-1-6.5-4.6-6.5c-1.8,0-3.4,0.5-4.8,1.5l-1-3.2c1.2-0.9,3.9-1.9,6.7-1.9 c5.8,0,8.2,3.8,8.2,10.2L260,48L260,48z M255.5,39.6c-2.4,0-7.9,0.5-7.9,6.7c0,3.8,1.9,5.1,3.5,5.1c2,0,3.7-1.5,4.2-4.4 c0.1-0.5,0.2-1.1,0.2-1.7L255.5,39.6L255.5,39.6z"></path><path fill="#323233" d="M266.5,33.2c0-2.4-0.2-5.3-0.2-7.5h4.1l0.2,4.6h0.1c1-2.7,3.4-5,6.1-5 c0.4,0,0.7,0,1,0.1V30c-0.3,0-0.6,0-1,0c-2.9,0-5.1,2.7-5.6,6c-0.1,0.8-0.2,1.7-0.2,2.6v16h-4.6V33.2z"></path><path fill="#323233" d="M297.9,13.3v34.4c0,2,0.2,5.3,0.2,6.9h-3.9l-0.3-3.6h-0.2 c-1,2-3,4.1-6.1,4.1c-4.8,0-8.4-5.2-8.4-14.8c0-10.2,4.2-15,8.7-15c2.1,0,4.2,1,5.3,3.4h0.1V13.3L297.9,13.3L297.9,13.3z M293.4,36.8c0-0.6,0-1.3-0.1-1.9c-0.3-3-2.1-5.6-4.3-5.6c-3.8,0-5.1,5.3-5.1,11c0,6.1,1.6,11,4.9,11c1.4,0,3.4-0.8,4.4-5 c0.1-0.5,0.2-1.2,0.2-1.9L293.4,36.8L293.4,36.8z"></path><path fill="#808285" d="M309,21.6h-7.1v-7.2H324v7.2h-7.2v33H309L309,21.6L309,21.6z"></path><path fill="#808285" d="M327.1,13.3h7.8v15.2h0.1c0.7-1,1.6-1.8,2.5-2.4c1.1-0.7,2.5-1.1,3.9-1.1 c5.4,0,7.5,4.5,7.5,11.9v17.7h-7.8V36.9c0-2.9-0.5-5.4-2.9-5.4c-1.3,0-2.5,0.8-3.1,2.7c-0.1,0.5-0.3,1.5-0.3,2.2v18.1h-7.8 L327.1,13.3L327.1,13.3z"></path><path fill="#808285" d="M374.3,47.9c0,2.3,0.1,4.7,0.4,6.7h-7l-0.4-2.9h-0.2 c-1.6,2.2-3.9,3.3-6.5,3.3c-4.4,0-7.7-3.7-7.7-8.8c0-7.7,6.8-10.8,13.4-10.9v-0.7c0-2.3-1.3-4-4.1-4c-2.3,0-4.2,0.7-6,1.7l-1.4-5.3 c1.7-0.9,5-2.2,9.1-2.2c8.9,0,10.3,6.2,10.3,12.2L374.3,47.9L374.3,47.9z M366.6,40.4c-2.6,0.1-6.2,1-6.2,5c0,2.9,1.6,3.9,2.8,3.9 c1.3,0,2.7-0.8,3.2-2.5c0.1-0.4,0.2-0.8,0.2-1.4V40.4z"></path><path fill="#808285" d="M388.4,17.8v7.6h5.7V31h-5.7v13.3c0,3.4,1.4,4.2,2.9,4.2 c0.8,0,1.4-0.1,2.1-0.2l0.1,6.1c-1.1,0.3-2.7,0.5-4.8,0.5c-2.3,0-4.2-0.5-5.7-1.8c-1.6-1.6-2.5-3.8-2.5-8.4V31h-3.5v-5.6h3.5v-5.1 L388.4,17.8L388.4,17.8z"></path></svg>';var d="sbt-logo-translate-"+a;var f="sbt-logo-scale-"+a;g_logoGroup=SvgCreator.CreateSvgGroup(d);g_logoTranslate=SvgCreator.CreateSvgGroup(f);$(g_logoGroup).append(g_logoTranslate);$(g_logoTranslate).append(j);var m=$("#"+this._LogoGroupArea);if(m.length==0){m=SvgCreator.CreateSvgGroup(this._LogoGroupArea);MyPointers.CoreSVG_SvgTop.append(m)}m.append(g_logoGroup);var l=Math.max(b.Height,b.Width)/3111;var e=71*l;var g=400*l;var r=(b.X+b.Width)-(g+10);var s=(b.Y+b.Height)-(e+10);document.getElementById(d).setAttributeNS(null,"transform","translate("+r+", "+s+")");document.getElementById(f).setAttributeNS(null,"transform","scale("+l+","+l+")");var n=b.X+15;var o=b.Y+b.Height-15;var q="sbt-url-"+h+"-"+c;var p=SvgCreator.CreateSvgGroup(q);var k=SvgCreator.AddText(n,o,"www.storyboardthat.com","font-family:'Francois One'; fill: rgb(0, 0, 0); font-size:10pt;",q+"-text");$(p).append(k);m.append(p)}};function SvgCreatorLibrary(a){this.NameSpace_Svg="http://www.w3.org/2000/svg";this.NameSpace_Xlink="http://www.w3.org/1999/xlink";this.AddCircle=function(h,i,e,g,c,d,b){var f=document.createElementNS(this.NameSpace_Svg,"circle");f.setAttributeNS(null,"cx",h);f.setAttributeNS(null,"cy",i);f.setAttributeNS(null,"r",e);f.setAttributeNS(null,"fill",c);f.setAttributeNS(null,"stroke",g);f.setAttribute("id",d);f.setAttribute("class",b);return f};this.UpdateCircle=function(b,c,d){b.attr("cx",c);b.attr("cy",d)};this.UpdateCircleDom=function(b,c,d){b.setAttributeNS(null,"cx",c);b.setAttributeNS(null,"cy",d)};this.AddCircle=function(h,i,e,g,c,d,b){var f=document.createElementNS(this.NameSpace_Svg,"circle");f.setAttributeNS(null,"cx",h);f.setAttributeNS(null,"cy",i);f.setAttributeNS(null,"r",e);f.setAttributeNS(null,"fill",c);f.setAttributeNS(null,"stroke",g);f.setAttribute("id",d);f.setAttribute("class",b);return f};this.UpdateCircle=function(b,c,d){b.attr("cx",c);b.attr("cy",d)};this.AddEllipse=function(k,l,f,g,i,c,j,e,d,b){var h=document.createElementNS(this.NameSpace_Svg,"ellipse");h.setAttributeNS(null,"cx",k);h.setAttributeNS(null,"cy",l);h.setAttributeNS(null,"rx",f);h.setAttributeNS(null,"ry",g);h.setAttributeNS(null,"fill",c);h.setAttributeNS(null,"stroke",i);h.setAttributeNS(null,"stroke-dasharray",j);h.setAttributeNS(null,"opacity",e);h.setAttribute("id",d);h.setAttribute("class",b);return h};this.UpdateEllipse=function(b,e,f,c,d){b.attr("cx",e);b.attr("cy",f);b.attr("rx",c);b.attr("ry",d)};this.AddRect=function(j,k,i,c,g,b,h,e,d){j=isNaN(j)?10:j;k=isNaN(k)?10:k;i=isNaN(i)?20:i;c=isNaN(c)?20:c;var f=document.createElementNS(this.NameSpace_Svg,"rect");f.setAttributeNS(null,"x",j);f.setAttributeNS(null,"y",k);f.setAttributeNS(null,"width",i);f.setAttributeNS(null,"height",c);f.setAttributeNS(null,"fill",b);if(g!=null){f.setAttributeNS(null,"stroke",g)}if(h!=null){f.setAttributeNS(null,"stroke-dasharray",h)}if(e!=null){f.setAttributeNS(null,"opacity",e)}f.setAttributeNS(null,"id",d);return f};this.UpdateRectangle=function(c,e,f,d,b){c.attr("x",e);c.attr("y",f);c.attr("width",d);c.attr("height",b)};this.UpdateRectangleDom=function(c,e,f,d,b){c.setAttributeNS(null,"x",e);c.setAttributeNS(null,"y",f);c.setAttributeNS(null,"width",d);c.setAttributeNS(null,"height",b)};this.AddLine=function(e,g,f,h,d,b){var c=document.createElementNS(this.NameSpace_Svg,"line");c.setAttributeNS(null,"x1",e);c.setAttributeNS(null,"y1",g);c.setAttributeNS(null,"x2",f);c.setAttributeNS(null,"y2",h);c.setAttributeNS(null,"style",d);c.setAttributeNS(null,"id",b);return c};this.UpdateLine=function(b,c,e,d,f){b.attr("x1",c);b.attr("x2",d);b.attr("y1",e);b.attr("y2",f)};this.UpdateLineDom=function(b,c,e,d,f){b.setAttributeNS(null,"x1",c);b.setAttributeNS(null,"x2",d);b.setAttributeNS(null,"y1",e);b.setAttributeNS(null,"y2",f)};this.AddPolygon=function(g,k,c,l,m,f,e,b){var j=document.createElementNS(this.NameSpace_Svg,"polygon");var d;var h="";for(d=0;d<g.length;d++){h=h+" "+g[d].x+","+g[d].y}j.setAttributeNS(null,"points",h);j.setAttributeNS(null,"fill",c);if(k!=null){j.setAttributeNS(null,"stroke",k)}if(l!=null){j.setAttributeNS(null,"stroke-dasharray",l)}if(m!=null){j.setAttributeNS(null,"stroke-width",m)}if(f!=null){j.setAttributeNS(null,"opacity",f)}j.setAttributeNS(null,"id",e);if(b!=null){j.setAttribute("class",b)}return j};this.UpdatePolygon=function(e,c){var b;var d="";for(b=0;b<c.length;b++){d=d+" "+c[b].x+","+c[b].y}e.attr("points",d)};this.AddEllipsisArc=function(i,k,e,b,f,l,g){var h="0";var m="1";var c=["M",k.X,k.Y,"A",i.X,i.Y,0,h,m,e.X,e.Y].join(" ");b=b||"black";f=f||"none";l=l||"3";var j=document.createElementNS(this.NameSpace_Svg,"path");j.setAttributeNS(null,"d",c);j.setAttributeNS(null,"fill",f);j.setAttributeNS(null,"stroke",b);j.setAttributeNS(null,"stroke-width",l);j.setAttributeNS(null,"id",g);return j};this.AddCubicBezier=function(p,n,i,m,b,j,q,k){var l="0";var r="1";var c=p.X+n.X;var f=p.Y+n.Y;var e=i.X+m.X;var g=i.Y+m.Y;var h=["M",p.X,p.Y,"C",c,f,e,g,i.X,i.Y].join(" ");b=b||"black";j=j||"none";q=q||"3";var o=document.createElementNS(this.NameSpace_Svg,"path");o.setAttributeNS(null,"d",h);o.setAttributeNS(null,"fill",j);o.setAttributeNS(null,"stroke",b);o.setAttributeNS(null,"stroke-width",q);o.setAttributeNS(null,"id",k);return o};this.AddTriangle=function(c,g,b){var e=[];c.foreach(function(h){e.Add(h.ToString())});var d=e.join(" ");var f=document.createElementNS(this.NameSpace_Svg,"polygon");f.setAttributeNS(null,"points",d);f.setAttributeNS(null,"style",g);f.setAttributeNS(null,"id",b);return f};this.CreateBlankSvg=function(e,b,c){var d=document.createElementNS(this.NameSpace_Svg,"svg");d.setAttribute("width",e);d.setAttribute("height",b);if(c){d.setAttribute("id",c)}return d};this.CreateSvgGroup=function(c){var b=document.createElementNS(this.NameSpace_Svg,"g");b.setAttributeNS(null,"id",c);return b};this.CreateDefs=function(c){var b=document.createElementNS(this.NameSpace_Svg,"defs");b.setAttributeNS(null,"id",c);return b};this.CreateClipPath=function(c){var b=document.createElementNS(this.NameSpace_Svg,"clipPath");b.setAttributeNS(null,"id",c);return b};this.CreateUse=function(b,c){var d=document.createElementNS(this.NameSpace_Svg,"use");d.setAttributeNS(null,"id",b);d.setAttributeNS(this.NameSpace_Xlink,"xlink:href","#"+c);return d};this.CreateTextableMetadata=function(c){var b=document.createElement("textable");b.setAttribute("textarea",c);return b};this.CreateColorableMetadata=function(d,e,c,f){var b=document.createElement("Colorable");b.setAttribute("ReplaceColor",d);b.setAttribute("SecretColor",e);b.setAttribute("region",c);b.setAttribute("SpecialTitle",f);return b};this.CreateMetadata=function(){return document.createElement("SBTData")};this.AddText=function(g,h,f,e,c){var d=document.createElementNS(this.NameSpace_Svg,"text");d.setAttributeNS(null,"x",g);d.setAttributeNS(null,"y",h);d.setAttributeNS(null,"style",e);d.setAttributeNS(null,"class","DisableSelection");d.setAttributeNS(null,"unselectable","on");var b=document.createTextNode(f);d.appendChild(b);return d};this.GetSvgSize=function(d){var f=new Object();try{var b=$("#"+d);f.Width=b.attr("width").ExtractNumber();f.Height=b.attr("height").ExtractNumber();var g=b[0].getAttribute("viewBox");if(g==null){g=b[0].getAttribute("viewbox")}}catch(c){LogErrorMessage("SvgCreatorLibrary.GetSvgSize",c)}try{f.ViewBox=new Object();if(g!=null){g=g.replace(","," ").replace("  "," ");g=g.split(" ");f.ViewBox.MinX=g[0].ExtractNumber();f.ViewBox.MinY=g[1].ExtractNumber();f.ViewBox.Width=g[2].ExtractNumber();f.ViewBox.Height=g[3].ExtractNumber()}}catch(c){LogErrorMessage("SvgCreatorLibrary.GetSvgSize2 viewbox: "+g,c)}return f};this.UpdateSvgSize=function(c,d){if(d.Width<5||d.Height<5||d.ViewBox.Height<5||d.ViewBox.Width<5){return}var b=$("#"+c);b.attr("width",d.Width+"px");b.attr("height",d.Height+"px");if(d.ViewBox!=null){b[0].setAttributeNS(null,"viewBox",d.ViewBox.MinX+" "+d.ViewBox.MinY+" "+d.ViewBox.Width+" "+d.ViewBox.Height)}};this.UpdateSvgSize_WithDeltas=function(g,c,b){try{var h=this.GetSvgSize(g);if(c!=0){var i=h.Width+c;if(i>5){h.Width=i}}if(b!=0){var f=h.Height+b;if(f>5){h.Height=f}}if(h.ViewBox!=null){if((h.ViewBox.Width+c)>5){h.ViewBox.Width=h.ViewBox.Width+c}if((h.ViewBox.Height+b)>5){h.ViewBox.Height=h.ViewBox.Height+b}}this.UpdateSvgSize(g,h)}catch(d){LogErrorMessage("SvgCreatorLibrary.UpdateSvgSize_WithDeltas",d)}};this.WriteTransform=function(c,g){try{var d=GetGlobalById(c);this._SetDefaultTransformValues(g,"Translate",[0,0]);this._SetDefaultTransformValues(g,"Rotate",[0,0,0]);this._SetDefaultTransformValues(g,"Scale",[1,1]);var f="translate("+g.Translate[0]+", "+g.Translate[1]+") ";f+="rotate("+g.Rotate[0]+", "+g.Rotate[1]+", "+g.Rotate[2]+") ";f+="scale("+g.Scale[0]+", "+g.Scale[1]+") ";d.setAttributeNS(null,"transform",f)}catch(b){}};this._SetDefaultTransformValues=function(f,d,b){try{if(f[d]==null){f[d]=[]}if(f[d].length==0){f[d].push(b[0])}if(f[d].length==1){f[d].push(b[1])}if(f[d].length==2&&b.length==3){f[d].push(b[2])}}catch(c){}};this.GetTransform=function(c){try{var d=GetGlobalById(c);var f=d.getAttribute("transform");f=(f==null||f=="")?"translate(0,0) rotate(0,0,0), scale(1,1)":f;var g=new Object();g.Translate=this._ExtractTransformValues(f,"translate",[0,0]);g.Rotate=this._ExtractTransformValues(f,"rotate",[0,0,0]);g.Scale=this._ExtractTransformValues(f,"scale",[1,1]);if(isNaN(g.Translate[0])){}return g}catch(b){}};this._ExtractTransformValues=function(h,g,b){try{var f=h.indexOf(g);if(f<0){return b}var j=h.substring(f+g.length,h.indexOf(")",f));j=SplitParenthesisNumeric(j);if(j.length<b.length){for(var d=j.length;d<b.length;d++){j.push(b[d])}}return j}catch(c){}return b}};var StoryboardCreatorLibrary=function(){var a=new Object();a.ParseAndUpdateIds=function(b,g,d){if(d==null||d==""){return[]}var h=d.split(",");var f=[];for(var c=0;c<h.length;c++){var j=h[c].trim();var e=g+j;FindAndUpdateId(b,j,e);f.push(e)}return f};return a}();var DrawMenuMask=false;var EPS_ANGLE=4;var EnableBold=false;var SvgManipSelectedTextableIndex=0;$(function(){try{initProperties()}catch(a){LogErrorMessage("document.Ready. initProperties failed",a)}if(MyBrowserProperties==null||MyBrowserProperties.SupportsSvg()==false){window.location.href="/storyboardcreator/upgradebrowser";return}SbtBlockUI();PopulateEvents();ClipartTab_ModuleRef.load();$(".subcategory-ul").tabdrop({text:MyLangMap.GetTextByToken("Text-More")});SvgSearch.Load();StoryboardContainer.Initialize();ValidateUILayout();setTimeout(function(){if(svgContainerPath==null||svgContainerPath==""){SbtUnblockUI()}TabRoller.RefreshRollers_PostResize()},1000);if(UseQuill){InitQuill();try{if(quill==null){LogErrorMessage("document.Ready. Init Quill -  quill is null")}}catch(a){LogErrorMessage(".Ready.Init Quill, quill is null with error",a)}}SbtInlineEditorHelper.InitSummerNoteIfNeeded();Date.prototype.toJSON=(function(){return this.getTime()})});var MouseDown=false;var SearchResultsDiv="";var NewShapeIsBackdrop=false;var warnOnExit=false;var saveAndContinue=false;var UndoManager;var LogUndo=false;var telemetry_ItemAdded=0;var skipNextDrag=false;var inputAdapter=(UseNewTouch===true)?new HammerInputAdapter():new TouchyInputAdapter();var MyPointers,MyBrowserProperties,SvgCreator,StoryboardContainer,SbtMath,MainControls,MyMultiSelectState,MyShapeMetaData,MyColors,MyColorWheels,MyShapesState,MyTitlesState,MyMoveShapeAction,MyCroppedImage,MyPosableControlsBox,MySmartSceneDialog,MyResizeActions,MyRotateAction,MySvgForCategories,MyGlobalSwapLibrary,MyCharacterSwapLibrary,MyUserPermissions,MyCharacterPosistionLibrary,CellConfiguration,MyIdGenerator,MyLayoutFactory,MathUtils,MyGroupAction;function initProperties(){SpecialSignOut=null;if(typeof a==="undefined"){var a=0}MyIdGenerator=new IdGenerator();MyBrowserProperties=new BrowserProperties();MyBrowserProperties.SupportsCdn();CellConfiguration=new StoryboardGridLayout();MyPointers=new Pointers();MyUserPermissions=new UserPermissions(InitialUserPermissions,a);SvgCreator=new SvgCreatorLibrary();StoryboardContainer=new StoryboardContainerLibrary();SbtMath=new SbtMathLibrary();MainControls=new MainControlsBox();MyMultiSelectState=new MultiSelectState();MyShapeMetaData=new ShapeMetaData();MyColors=new SbtColors();MyColorWheels=new ColorWheels();MyShapesState=new ShapesState();MyTitlesState=new ShapesState();MyMoveShapeAction=new MoveShapeAction();MyGroupAction=new GroupAction();MyResizeActions=new ResizeImageAction();MyRotateAction=new RotateImageAction();window.setTimeout(function(){MyGlobalSwapLibrary=new GlobalSwapLibrary()},1);MyCharacterSwapLibrary=new CharacterSwapLibrary(null);MySvgForCategories=new Object();MyCharacterPosistionLibrary=new CharacterPosistionLibrary();MyLayoutFactory=new LayoutFactory();MathUtils=new MathUtilsLibrary();MainWindowControls.Init()}"use strict";function ValidateUILayout(){if(!MyBrowserProperties.IsMobile){if(!$("body").hasClass("compact-nav")){$("body").addClass("compact-nav");StoryboardContainer.Initialize()}}else{if(!$("body").hasClass("mobile-nav")){$("body").addClass("mobile-nav");StoryboardContainer.Initialize()}}}function PopulateEvents(){MyBrowserProperties.DetermineBrowserInfo();$(window).resize(HandleWindowResize);window.onbeforeunload=closeEditorWarning;GetAndPopulateShateState(PopulateEvents_PostLoad)}function PopulateEvents_PostLoad(){ConfigureDialogs();UndoManager=new UndoManager();UndoManager.setCallback(function(){if(UndoManager.hasUndo()){$("#undo-btn").prop("disabled",false)}else{$("#undo-btn").prop("disabled",true)}if(UndoManager.hasRedo()){$("#redo-btn").prop("disabled",false)}else{$("#redo-btn").prop("disabled",true)}});SetEventHandlersOnCoreSvg();SetEventHandlersOnSvgContainer();SetEventHandlersOnSvgControlBox();$(document).keydown(HandleKeyDown);StoryboardContainer.Initialize();if(MyBrowserProperties.IsMobile){inputAdapter.useDelegation(true)}MyPointers.Dialog_PoseImage.on("hidden.bs.modal",HandlePoseDialogClose);MyPointers.Dialog_SmartScene.on("hidden.bs.modal",HandleSmartSceneDialogClose);ResetSaveWarning();SaveHelper.MarkAsChanged(false);if(StoryboardSetup.EnableAutoSave){setInterval(SaveHelper.AutoSave,10*60*1000)}setInterval(SaveHelper.LocalSave,60*1000)}function PreventSelection(){$("body").on("selectstart",function(a){if(!$(a.target).is("input, textarea")){return false}})}function ConfigureDialogs(){try{PopulateUploadDialog()}catch(a){LogErrorMessage("SvgManip.ConfigureDialogs",a)}}function SetEventHandlersOnCoreSvg(){try{MyPointers.CoreSvg.mousedown(HandleCoreSvgClick);MyPointers.CoreSvg.mousemove($.throttle(50,SvgMouseMove));MyPointers.CoreSvg.mouseup(HandleMouseExit);MyPointers.CoreSvg.mouseleave(HandleMouseLeaveSvg);MyPointers.SvgContainer.mousedown(HandleSvgContainerClick)}catch(a){LogErrorMessage("SvgManip.SetEventHandlersOnCoreSvg",a)}}function SetEventHandlersOnSvgContainer(){try{MyPointers.SvgContainer.droppable({drop:HandleDrop});MyPointers.SvgContainer.mouseup(HandleMouseExit);MyPointers.SvgContainer.mouseleave(HandleMouseLeaveDiv);MyPointers.SvgContainer.scroll($.throttle(50,OnScrollSvgContainer))}catch(a){LogErrorMessage("SvgManip.SetEventHandlersOnSvgContainer",a)}}function ObjectDrop(b){try{b.preventDefault()}catch(a){LogErrorMessage("SvgManip.dragEndEvent",a)}}function HandleDrop(c,j){try{c.stopPropagation();var b=j.draggable.children().eq(0).children().eq(0).attr("id");var d=$("#"+b).children().length;if(d<1){return}ClearActiveState();warnOnExit=true;StoryboardContainer.SetCoreSvgDimensions();var a=GetGlobalById("CoreSvg").getBoundingClientRect();var h=(a.width-2);var g=(a.height-2);var k=PageXtoStoryboardX(c.pageX);var l=PageYtoStoryboardY(c.pageY);if((k<0||k>h)&&(l<0||l>g)){return}k=Math.min(Math.max(k,0),h-25);l=Math.min(Math.max(l,0),g-50);var f=$("#"+b).clone();try{if(typeof AdminHelper!="undefined"){AdminHelper.ListIds(b)}}catch(c){LogErrorMessage("File.Method",c)}StoryboardContainer.UpdateGradientIds(f);if(j.draggable.hasClass("SceneItem")){NewShapeIsBackdrop=true}AddSvg.AddSvgToStoryboard(f,k,l,true,j.draggable.hasClass("SceneItem"))}catch(c){LogErrorMessage("SvgManip.HandleDrop",c)}}function LogDebugTime(f,b,d){var c="";for(var a=0;a<f;a++){c+="\t"}c+=b+" "+(performance.now()-d);console.log(c)}function ConfigureTouchEvents(){}function formatListText(a){var d=/\s/;var c=/[\r\n]/;var h=a.getSelection();var k=a.val();var b,j=false,g;if(h.length===0){for(b=h.start-2;b<h.start;b++){if(k.substr(b,3)==="\n"+BULLET_STRING+"\n"){a.setSelection(b,b+3).replaceSelectedText("").focus();j=true}}if(!j){var b=h.start-1,m=h.start-1,l=h.start;while(b>=0){if(c.test(k[b])){m=b+1;break}b=b-1}if(b===-1){m=0}b=h.start;while(b<=k.length){if(c.test(k[b])){l=b;break}b=b+1}if(b===k.length+1){l=k.length}a.setSelection(m,l);var f=a.getSelection();if(f.text.startsWith(BULLET_STRING)){a.replaceSelectedText(f.text.substr(1,f.text.length-1)).setSelection(h.start-1).focus()}else{a.surroundSelectedText(BULLET_STRING,EMPTY_STRING).setSelection(h.start+1).focus()}}}else{var b=h.start-1,m=h.start-1,l=h.end;while(b>=0){if(c.test(k[b])){m=b+1;break}b=b-1}if(b===-1){m=0}b=h.end;while(b<=k.length){if(c.test(k[b])){l=b;break}b=b+1}if(b===k.length+1){l=k.length}a.setSelection(m,l);var f=a.getSelection();if(f.text.startsWith(BULLET_STRING)){g="\n"+f.text.replace(new RegExp("\n"+BULLET_STRING,"g"),"\n");g=g.substr(2,g.length-1);a.replaceSelectedText(g).setSelection(f.start,f.start+g.length).focus()}else{g=f.text.replace(/\r\n/g,"\n").replace(/\n/g,"\n"+BULLET_STRING);a.replaceSelectedText(BULLET_STRING+g+"").setSelection(f.start,f.start+g.length+1).focus()}}}function SetEventHandlersOnSvgControlBox(){try{MyPointers.Controls_TextableControls_TextArea.keyup(SetTextableText);MyPointers.Controls_TextableControls_TextArea.bind("cut paste",function(){setTimeout(function(){SetTextableText()},100)});textableTextArea=GetGlobalById("textableText");if(textableTextArea!==null){textableTextArea.oninput=SetTextableText}$("#sizeSelector").change(UpdateFontSize);MyPointers.Controls_TextableControls_TextAlignmentSelectors.click(function(b){b.stopPropagation();var c="middle";if(this.className.split(" ").indexOf("start")>-1){c="start"}else{if(this.className.split(" ").indexOf("middle")>-1){c="middle"}else{if(this.className.split(" ").indexOf("end")>-1){c="end"}}}UpdateTextAlignment(c)});$("#textableControlsTable td.MenuAddList").click(function(b){formatListText($("#textableText"));SetTextableText()});InitializeFontSelector();$("#flipVerticalButton").click(FlipVertical);$("#flipHorizontalButton").click(FlipHorizontal);$("#flipHorizontalButton2").click(FlipHorizontal);$("#rotateLeftButton").click(RotateLeft);$("#rotateRightButton").click(RotateRight);$("#bringForwardButton").click(BringShapeForward);$("#bringForwardButton2").click(BringShapeForward);$("#bringToFrontButton").click(BringShapeToFront);$("#sendBackwardsButton").click(SendShapeBackwards);$("#sendBackwardsButton2").click(SendShapeBackwards);$("#sendToBackButton").click(SendShapeToBack);$("#lockButton").click(LockSelected);$("#unlockButton").click(UnlockSelected);$("#copyShapeButton").click(CopyHelper.CopyShape);$("#copyShapeButton2").click(CopyHelper.CopyShape);$("#stretchToFillButton").click(StretchToFill);$("#stretchToFillProportionalButton").click(StretchToFill_Proportional);$("#UnGroupObject").click(MyGroupAction.UnGroup);$("#CropInnerMenuStandard").click({CropType:CropTypeEnum.Standard},CropShapeChange);$("#CropInnerMenuAdvanced").click({CropType:CropTypeEnum.Advanced},CropShapeChange);$("#CropInnerMenuCircle").click({CropType:CropTypeEnum.Circle},CropShapeChange);$("#cropShapeButton").click({CropType:CropTypeEnum.Standard},CropShape);$("#cropShapeButton2").click({CropType:CropTypeEnum.Standard},CropShape);$("#multiTextableMenuButton").click(MultiTextableShape);$("#deleteShapeButton").click(DeleteShape);$("#deleteShapeButton2").click(DeleteShape);$("#poseShapeButton, #poseShapeButton2").click(PoseShape);$("#editItemOptionsButton").click(SmartImageOptions);$("#editSceneButton").click(SmartSceneShape);$("#artpen-out-button-single-select").click(ArtpenShape);$("#poseSpeaking").click(InstaPoseClosure(InstaPoseEnum.Speaking));$("#poseSad").click(InstaPoseClosure(InstaPoseEnum.Sad));$("#poseAngry").click(InstaPoseClosure(InstaPoseEnum.Angry));$("#poseWalking").click(InstaPoseClosure(InstaPoseEnum.Walking));$("#poseSitting").click(InstaPoseClosure(InstaPoseEnum.Sit));$("#multiFlipVerticalButton").click(FlipVertical);$("#multiFlipHorizontalButton").click(FlipHorizontal);$("#multiRotateLeftButton").click(RotateLeft);$("#multiRotateRightButton").click(RotateRight);$("#multiCopyShapeButton").click(CopyHelper.CopyShape);$("#multiDeleteShapeButton").click(DeleteShape);$("#multi-select-align-left").click(AlignHelper.AlignLeft);$("#multi-select-align-right").click(AlignHelper.AlignRight);$("#multi-select-align-center").click(AlignHelper.AlignCenter);$("#multi-select-align-horizontal-dist").click(AlignHelper.HorizontalDistribution);$("#multi-select-align-top").click(AlignHelper.AlignTop);$("#multi-select-align-middle").click(AlignHelper.AlignMiddle);$("#multi-select-align-bottom").click(AlignHelper.AlignBottom);$("#multi-select-align-vertical-dist").click(AlignHelper.VerticalDistribution);$("#GroupObject").click(MyGroupAction.MakeGroup);$("#multiSelectControlsBoxTable .colorfilterrow td.MenuFilter img, #controlsBoxTable .colorfilterrow td.MenuFilter img").click(function(b){FilterColorMode((this.className==="color")?EMPTY_STRING:"url(#"+this.className+")")});AddSpanishKeyboard();$("#showSpanishKeyboard").click(function(){$("#spanish-keypad").toggle()})}catch(a){LogErrorMessage("SvgManip.SetEventHandlersOnSvgControlBox",a)}}function ShowUploadDialog(){try{ClearActiveState();CheckForUploadAccessPreRefresh(true)}catch(a){LogErrorMessage("SvgManip.ShowUploadDialog",a)}}function PopulateUploadDialog(){try{var c=MyLangMap.GetTextByToken("button-upload-multiple-files");if(MyBrowserProperties.IsSafari5){c=MyLangMap.GetTextByToken("button-upload-single-file");var b=$("#SafariUploadWarning");b.show()}$("#fine-uploader").fineUploader({request:{endpoint:CreatorUrls.SaveEndPoint,customHeaders:{Accept:"application/json"},},cors:{expected:true,},validation:{allowedExtensions:["jpeg","jpg","gif","png","bmp","wmf","svg"],sizeLimit:1024*1024*3},text:{uploadButton:c},}).on("complete",function(d,g,f,h){if(h.success==true){UglyUploadCallback(h.svg)}else{alert(h.errorMessage)}})}catch(a){LogErrorMessage("SvgManip.PopulateUploadDialog",a)}}function CheckForUploadAccessPreRefresh(b){try{if(MyUserPermissions.EnableUploads){MyPointers.Dialog_UploadImage.modal();return}MyUserPermissions.Public_RefreshPermissions(false,function(){CheckForUploadAccessPostRefresh(b)})}catch(a){LogErrorMessage("SvgManip.CheckForUploadAccessPreRefresh",a)}}function CheckForUploadAccessPostRefresh(b){try{if(MyUserPermissions.EnableUploads){MyPointers.Dialog_UploadImage.modal();return}if(MyUserPermissions.IsLoggedOn==false){if(b){HandleLoginCloseFunction=function(){CheckForUploadAccessPreRefresh(false)};showLogonDialog();return}}MyPointers.Dialog_PurchaseForUploads.modal()}catch(a){LogErrorMessage("SvgManip.CheckForUploadAccessPostRefresh",a)}}function _LoadFromUrl(){if(ExtraSetup.LoadFrom==null){return}$.ajaxAuth({caller:"svgManip._LoadFromUrl",type:"GET",timeout:60*1000,url:SbtApiServer+"/storyboardmetadata/"+ExtraSetup.LoadFrom.UserName+"/"+ExtraSetup.LoadFrom.UrlTitle.decodeHTML()+"/"+ExtraSetup.LoadFrom.Revision,cache:false,userKey:IsUserLoggedOn,}).done(GetAndPopulateShateState_Success).fail(function(b,d,a){var c={userName:ExtraSetup.LoadFrom.UserName,url_title:ExtraSetup.LoadFrom.UrlTitle,revision:ExtraSetup.LoadFrom.Revision};$.ajax({caller:"svgManip._LoadFromUrl (fallback)",type:"POST",timeout:60*1000,url:"/api_storyboardcreator/getstoryboardmetadata",data:c,cache:false}).done(function(f){GetAndPopulateShateState_Success(f);LogErrorMessage("(Self-Heal) svgManip._LoadFromUrl was able to fallback to www")}).fail(GetAndPopulateShateState_Failure)})}function GetAndPopulateShateState(b){var a=new LocalDbHelper();a.CheckUser(IsUserLoggedOn,function(d,f){var h=(navigator.userAgent.match(/iPad/i)!=null);var g=ExtraSetup.LoadFrom==null?"":ExtraSetup.LoadFrom.UrlTitle;if(!h&&d&&f===g){var c=function(k,l){try{a.Delete(k)}catch(j){LogErrorMessage("Failed to delete local save, ignoring",j)}_LoadFromUrl();l()};swalQueue({title:MyLangMap.GetTextByToken("warning-found-unsaved-version-title"),text:MyLangMap.GetTextByToken("warning-found-unsaved-version-text"),type:"warning",confirmButtonText:MyLangMap.GetTextByToken("warning-restore-button"),cancelButtonClass:"btn-danger",cancelButtonText:MyLangMap.GetTextByToken("warning-discard-button"),showCancelButton:true,},function(j){if(j){a.Load(IsUserLoggedOn,function(m){try{var l=JSON.parse(m);l.svg=l.Svg;l.ShapeStateJson=l.ShapeStates;l.LayoutConfig=l.LayoutConfig;GetAndPopulateShateState_LocalDb(l);b()}catch(k){LogErrorMessage("Failed to load local save, discarding",k);swalQueue({title:MyLangMap.GetTextByToken("warning-restore-unsaved-version-failed-title"),text:LangMap.GetText("warning-restore-unsaved-version-failed-text"),type:"warning",confirmButtonText:LangMap.GetText("warning-restore-unsaved-version-failed-okbutton"),});c(IsUserLoggedOn,b)}})}else{c(IsUserLoggedOn,b)}StoryboardContainer.JiggleSvgSize()});return}else{_LoadFromUrl();b();StoryboardContainer.JiggleSvgSize()}})}function GetAndPopulateShateState_Failure(c,f,b){var g=GetQueryStringParameterByName("try")||1;if((f==="timeout")&&(g<5)){g=Number(g)+1;var h=window.location.origin+window.location.pathname+"?try="+g;window.location=h}else{try{var d=MyLangMap.GetTextLineBreaksByToken((f==="timeout")?"Error-Load-Time-Out":"Error-Load-Error");swalQueue({title:"Loading Failed",text:d,type:"error",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button"),additionalInfoTitle:"Technical Info",additionalInfoText:LastErrorMessage()},function(){window.location="/my-account"})}catch(a){alert("Loading failed; please check your internet connection");LogErrorMessage("GetAndPopulateShateState_Failure - Fallback failure alert",a)}}return}function GetAndPopulateShateState_Success(a){GetAndPopulateShateState_Core(a,function(){$.ajax({caller:"svgManip.GetAndPopulateShateState",type:"GET",timeout:120*1000,url:CreatorUrls.LoadSaved+"?sanitizeSvg=true&url="+svgContainerPath,contentType:"application/json",dataType:"json",cache:false}).done(LoadCoreSvg).fail(GetAndPopulateShateState_Core_Failure)})}function GetAndPopulateShateState_LocalDb(a){GetAndPopulateShateState_Core(a,function(){LoadCoreSvg(a)})}function GetAndPopulateShateState_Core(b,a){try{ExtraSetup.ShapeStateJson=b.ShapeStateJson;ExtraSetup.LayoutConfig=JSON.parse(b.LayoutConfig);if(b.CharacterSwapLibrary==null||b.CharacterSwapLibrary==""){ExtraSetup.CharacterSwapLibrary=null}else{ExtraSetup.CharacterSwapLibrary=JSON.parse(b.CharacterSwapLibrary)}if(b.SvgPath){ExtraSetup.SvgPath=b.SvgPath}MyShapesState.Public_LoadShapeStatesFromJson(b.ShapeStateJson);MyCharacterSwapLibrary=new CharacterSwapLibrary(ExtraSetup.CharacterSwapLibrary);a()}catch(c){LogErrorMessage("SvgManip.GetAndPopulateShateState_Core",c);HandleLoadFailure(false);swalQueue({title:"Load Failed",text:b.ErrorMessage,type:"error",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")})}}function GetAndPopulateShateState_Core_Failure(b,c,a){HandleLoadFailure(true)}function PopulateShapeStateFromLoad(b){try{if(svgContainerPath==null||svgContainerPath==""){return}if(shapeStateJson.length==0||shapeStateJson==null){LogErrorMessage("SvgManip.PopulateShapeStateFromLoad: Completely empty shapeState")}else{MyShapesState.Public_LoadShapeStatesFromJson(shapeStateJson)}$.ajax({caller:"svgManip.PopulateShapeStateFromLoad",type:"GET",timeout:120*1000,url:CreatorUrls.LoadSaved+"?sanitizeSvg=true&url="+svgContainerPath,contentType:"application/json",dataType:"json",cache:false}).done(LoadCoreSvg).fail(LoadCoreSvgFail)}catch(a){LogErrorMessage("SvgManip.PopulateShapeStateFromLoad",a)}b()}function HandleLoadFailure(b){try{MyShapesState.Private_ClearUnusedShapes();$("#save-choices-btn").click(function(c){SaveHelper.SaveStoryboard(false,true,false);return false});$("#UrlTitle").val("");$("#EditUserName").val("");if(StoryboardSetup!=null){StoryboardSetup.EnableAutoSave=false}}catch(a){}SbtUnblockUI();if(b){swalQueue({title:"",text:MyLangMap.GetTextLineBreaksByToken("warning-load-failed"),type:"error",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")})}return}function LoadCoreSvgFail(f,g,d){if((f.status==200||f.status=="200")&&f.responseText!=""){return}try{var a=(g||"")+" / "+(d||"");var c={message:" ("+a+") ExtraSetup : "+ExtraSetup.LoadFrom.UserName+" "+ExtraSetup.LoadFrom.UrlTitle+"\n"+f.getAllResponseHeaders(),callstack:""};LogErrorMessage("LoadCoreSvgFail ("+f.status+") - Try + "+tryNumber,c)}catch(b){LogErrorMessage("LoadCoreSvgFail - Failure logging failed! ",b)}HandleLoadFailure(true)}function LoadCoreSvg(b,u,n){try{if(b.svg.length==0){try{var d={message:" (data is empty) ExtraSetup : "+ExtraSetup.LoadFrom.UserName+" "+ExtraSetup.LoadFrom.UrlTitle+"\n"+((n!=null)?n.getAllResponseHeaders():""),callstack:""};LogErrorMessage("LoadCoreSvg ("+b.status+") - Try + "+w,d)}catch(c){LogErrorMessage("LoadCoreSvg - Failure logging failed! ",c)}MyShapesState.Private_ClearUnusedShapes();SbtUnblockUI();var w=GetQueryStringParameterByName("try")||1;if(w<5){w=Number(w)+1;var x=window.location.origin+window.location.pathname+"?try="+w;window.location=x;return}HandleLoadFailure(true);return}b.svg=b.svg.replace(/y="Infinity"/gi,'y="50"');MyPointers.CoreSvg.remove();MyPointers.SvgContainer.append(InjectSvgFilters(b.svg));MyPointers.ResetAllPointers();SetEventHandlersOnCoreSvg();var j=$("#c_title_R0C0").length>0;var h=$("#c_descr_R0C0").length>0;var p=StoryboardContainer.GetLayoutType();if(p==StoryboardLayoutType.Frayer){$("#addcell-btn").prop("disabled",true)}if(p==StoryboardLayoutType.Movie){SwapSceneCategory(true)}if(StoryboardContainer.IsPaperTypeLayout()){ShowBothSceneCategories()}if(p==StoryboardLayoutType.Timeline){$("#addcell-btn").html('<i class="icon isbt-addcell"></i> '+MyLangMap.GetTextByToken("button-timeline-dates"));var o=new Object();o.TimelineDates=[];if(ExtraSetup.LayoutConfig==null||ExtraSetup.LayoutConfig.TimelineDates==null){StoryboardContainer.CalculateRowsAndCols();for(var k=0;k<StoryboardContainer.Cols;k++){o.TimelineDates.push(new Date(2000,k,1))}LogErrorMessage("Timeline lost dates");swalQueue({title:"",text:MyLangMap.GetTextLineBreaksByToken("warning-timeline-lost-dates"),type:"error",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")})}else{for(var k=0;k<ExtraSetup.LayoutConfig.TimelineDates.length;k++){o.TimelineDates.push(new Date(ExtraSetup.LayoutConfig.TimelineDates[k]))}}ExtraSetup.LayoutConfig=o;TimelineDateManager.PreparePopup(o.TimelineDates)}CellConfiguration=MyLayoutFactory.GetLayout(p,j,h,1,ExtraSetup.LayoutConfig);if(b.GlobalCellCropRatio!==void 0){StoryboardContainer.GlobalCellCropRatio=JSON.parse(b.GlobalCellCropRatio)}var q=AddSvg.CurrentShapeIndex;var v=[];var t=MyShapesState.Public_GetAllShapeStates();for(var k=0;k<t.length;k++){var s=t[k];try{var l=s.Id;if(l.indexOf(SvgPartsEnum.ShapeId)>=0){var r=l.replace(SvgPartsEnum.ShapeId,"");q=Math.max(q,r)}var m=$("#"+l);if(m.length==0){v.push(l);continue}m.off("mousedown").on("mousedown",ShapeSelected);m.off("mouseup").on("mouseup",HandleMouseExit);s=new SvgState(l);s.PopulateFromJson(MyShapesState.Public_GetShapeStateById(l));try{s.UpdateDrawing(true)}catch(c){LogErrorMessage("SvgManip.LoadCoreSvg - element failed to redraw, removing",c);v.push(l);continue}MyShapesState.Public_SetShapeState(l,s)}catch(c){LogErrorMessage("SvgManip.LoadCoreSvg",c)}}for(var k=0;k<v.length;k++){MyShapesState.Public_RemoveShapeStateById(v[k])}v=[];StoryboardContainer.CleanupAndVerifyLoadedSvg();var g=$("#cell_R0C0");if(g!=null&&g.length>0){var a=g.attr("width");var f=a/CellConfiguration.CellWidth;CellConfiguration.ExpandCells(f);StoryboardContainer.CalculateRowsAndCols();StoryboardContainer.ExpandCells(f);if($("#dataTable").attr("previousValue")){$("#cell-size-slider").slider("setValue",f);$("#cell-size-slider").data("previousValue",f)}}FindOrphans();AddSvg.CurrentShapeIndex=q+1;StoryboardContainer.UpdateBackgroundColors();StoryboardContainer.UpdateImageAttributions();StoryboardContainer.JiggleSvgSize();CheckForLayoutAccessOnStoryboardCopy(StoryboardContainer.Rows,StoryboardContainer.Cols,true);MyPointers.Watermark.text(WatermarkCopy);MyPointers.Watermark.css("font-family","roboto");setTimeout(UpdateTextSpace,500);setTimeout(ClearActiveState,500);if(UseInlineEditor){SbtInlineEditorHelper.InitSummerNoteIfNeeded()}if(UseSummerNote){SbtSummerNoteHelper.InitSummerNoteIfNeeded()}$('foreignObject > div[edited="false"]').each(function(){var y=$(this);y.html(SbtInlineEditorHelper.GetDefaultTextForEditNode(y))});CheckForSvgLoadIssues();SbtUnblockUI()}catch(c){LogErrorMessage("SvgManip.LoadCoreSvg",c);SbtUnblockUI()}}function CheckForSvgLoadIssues(){try{CheckForSvgLoadIssues_InvalidViewBox()}catch(a){LogErrorMessage("CheckForSvgLoadIssues",a)}}function CheckForSvgLoadIssues_InvalidViewBox(){try{var d=document.getElementById("CoreSvg").getAttributeNS(null,"viewBox");if(d==null||d==""){return}var c=$("#CoreSvg");var a="0 0 "+c.attr("width")+" "+c.attr("height");if(d!=a){LogErrorMessage("(self-heal) CheckForSvgLoadIssues: INVALID VIEWBOX!  Expected "+a+" but was "+d+", fixing...",null);document.getElementById("CoreSvg").setAttribute("viewBox",a)}}catch(b){LogErrorMessage("CheckForSvgLoadIssue_InvalidViewBox",b)}}function RegexIndexOf(a,c,d){var b=a.substring(d||0).search(c);return(b>=0)?(b+(d||0)):b}function InjectSvgFilters(a){var f=a.indexOf("<svg")+1;var c=a.indexOf(">",f)+1;var d=RegexIndexOf(a,/>([\s])*<defs/,f)+1;var b=-1;if(d===c){b=RegexIndexOf(a,/<\/defs>([\s])*<g\s/,d)+7;return[a.slice(0,c),SVGFilterDeclaration,a.slice(b)].join("")}return[a.slice(0,c),SVGFilterDeclaration,a.slice(c)].join("")}function UpdateTextSpace(){var b=MyShapesState.Public_GetAllShapeStates();for(var a=0;a<b.length;a++){b[a].UpdateDrawing(true)}}function OnScrollSvgContainer(){try{UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.OnScrollSvgContainer",a)}}function HandleWindowResize(a){try{TabRoller.RefreshRollers_PostResize();StoryboardContainer.JiggleSvgSize();StoryboardContainer.SetCoreSvgDimensions();CellPickerHelper.UpdateIfNeeded();UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.HandleWindowResize",a)}}function closeEditorWarning(a){try{if(warnOnExit==true){return"Did you mean to leave? If you do you will lose your storyboard!  You might want to hit save."}}catch(a){LogErrorMessage("SvgManip.closeEditorWarning",a)}}function HandleKeyDown(b){try{if(b.ctrlKey||b.metaKey){switch(b.keyCode){case 65:selectAllShapes();b.stopPropagation();b.preventDefault();return;case 90:if(b.metaKey&&b.shiftKey){Redo()}else{Undo()}b.stopPropagation();b.preventDefault();return;case 89:Redo();b.stopPropagation();b.preventDefault();return;case 75:SaveStoryboard(false,true);b.stopPropagation();b.preventDefault();return}if(!$(b.target).is("input, textarea")){if(b.which===65){return false}}}if(MyShapesState.Property_SelectedCount()==0){return}if($("#textableText").is(":focus")||$(b.target).is(".ql-editor")||$(b.target).is(".note-editable")){return}if(UnmovableShapeSelected()){return}var a=false;switch(b.keyCode){case 46:DeleteShape();return;case 37:if(b.shiftKey){QuickRotate(-10)}else{QuickShapeMove(-5,0)}a=true;break;case 38:if(b.shiftKey){QuickShapeScale(1.1)}else{QuickShapeMove(0,-5)}a=true;break;case 39:if(b.shiftKey){QuickRotate(10)}else{QuickShapeMove(5,0)}a=true;break;case 40:if(b.shiftKey){QuickShapeScale(0.9)}else{QuickShapeMove(0,5)}a=true;break}if(a){UpdateActiveDrawing();b.stopPropagation();b.preventDefault()}}catch(b){LogErrorMessage("SvgManip.HandleKeyDown",b)}}function HandleCoreSvgClick(a){try{ClearActiveState();MyMultiSelectState.Public_StartMultiSelect(a);MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.MultiSelecting);a.stopPropagation()}catch(a){LogErrorMessage("SvgManip.HandleCoreSvgClick",a)}}function HandleSvgContainerClick(a){try{ClearActiveState();MyMultiSelectState.Public_StartMultiSelect(a);MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.MultiSelecting);a.stopPropagation()}catch(a){LogErrorMessage("SvgManip.HandleSvgContainerClick",a)}}function HandleMouseLeaveSvg(){}function HandleMouseLeaveDiv(){HandleMouseExit()}function HandleMouseLeave(a){}function HandleMouseExit(){try{var a=MyShapesState.Property_GetCurrentShapeAction()}catch(b){LogErrorMessage("SvgManip.HandleMouseExit.a",b)}if(a==ShapeActionEnum.MultiSelecting){MyMultiSelectState.Public_CompleteSelection();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected)}try{var c=MyShapesState.Public_GetFirstSelectedShapeState();if(c==null){LogUndo=false}if(c==null){MainControls.HideControlsBox(true)}}catch(b){LogErrorMessage("SvgManip.HandleMouseExit.b",b)}try{if(LogUndo){LogUndo=false;if(a==ShapeActionEnum.Rotating){HandleMouseStopRotating()}if(a==ShapeActionEnum.Move&&MyMoveShapeAction.UndoMoveX!=null&&MyMoveShapeAction.UndoMoveY!=null){HandleShapeStopMove()}if(a==ShapeActionEnum.Resize&&MyResizeActions!=null){HandleShapeStopResizing()}}MouseDown=false;ClearShapeEvents()}catch(b){LogErrorMessage("SvgManip.HandleMouseExit.c",b)}}function StartDrag(a,b){try{ClearActiveState()}catch(a){LogErrorMessage("SvgManip.StartDrag",a)}}function SvgMouseMove(c){try{var d=false;var f=c.pageX;var g=c.pageY;var b=MyShapesState.Property_GetCurrentShapeAction();if(StoryboardContainer.CoreSvgLeft<0){StoryboardContainer.SetCoreSvgDimensions()}if(MyShapesState.Property_SelectedCount()==0){if(b==ShapeActionEnum.MultiSelecting){MyMultiSelectState.Public_DrawSelectionArea(c)}return}if(f<StoryboardContainer.CoreSvgLeft||f>StoryboardContainer.CoreSvgRight||g<StoryboardContainer.CoreSvgTop||g>StoryboardContainer.CoreSvgBottom){HandleMouseExit();return}var a=c.buttons===undefined?c.which===1:c.buttons===1;if(!a){HandleMouseExit();return}if(b==ShapeActionEnum.Nothing){return}else{if(b==ShapeActionEnum.Selected||b==ShapeActionEnum.SelectedControlsHidden){if(MouseDown){MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Move)}}else{if(b==ShapeActionEnum.Move){HandleShapeMove(c);d=true}else{if(b==ShapeActionEnum.Resize){ResizeShape(c);d=true}else{if(b==ShapeActionEnum.Rotating){RotateShape(c);d=true}}}}}if(d){c.stopPropagation();HideControlsMenu(false);return}}catch(c){LogErrorMessage("SvgManip.SvgMouseMove",c)}}function SetSvgManipSelectedTextableIndexFromEvent(a){try{var b=SvgManipSelectedTextableIndex;if(a==null){SvgManipSelectedTextableIndex=0}var c=a.target.id||"";if(c.indexOf("_text")===-1){c=$(a.target).parents("foreignObject").attr("id")}if(c!=null&&c.indexOf("_text")>-1){SvgManipSelectedTextableIndex=parseInt(c.split("_text")[1].replace("_wrap",""));if(isNaN(SvgManipSelectedTextableIndex)){SvgManipSelectedTextableIndex=0}}else{if(a.currentTarget.className.baseVal==="activeShape"&&MyShapesState.Public_GetFirstSelectedShape().attr("id")===a.currentTarget.id){return}SvgManipSelectedTextableIndex=0}}catch(d){SvgManipSelectedTextableIndex=0}return b!==SvgManipSelectedTextableIndex}function IsSummerNoteEditorHit(a){try{if($(a.target).parents("div.note-editor").length>0){return true}}catch(b){}return false}function ShapeSelected(a){try{if(CheckForActiveDialogs()){return}a.stopPropagation();var d=$(this);var c=false;if(a.ctrlKey||a.shiftKey){c=true}if(MyShapesState.Public_ShapeSelected(d)){if(MyShapesState.Property_SelectedCount()>1){c=true}}if(c){MultipleShapeSelected(a,d)}else{if(UseInlineEditor){var f=MyShapesState.Public_GetShapeStateByShape(d).IsTextable();if(f){var b=false;if(SetSvgManipSelectedTextableIndexFromEvent(a)){SbtInlineEditorHelper.StartEditNode($("#"+MyShapesState.Public_GetShapeStateByShape(d).Id+"_text"+SvgManipSelectedTextableIndex));b=true}}else{SbtInlineEditorHelper.EndEditNode()}}SingleShapeSelected(d,b)}MouseDown=true;MyMoveShapeAction.Public_UpdateMouseMoveOffsets(a.pageX,a.pageY);DrawControlsMenu();UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.ShapeSelected",a)}}function MultipleShapeSelected(c,d){try{var a=MyShapesState.Public_ShapeSelected(d);var b=false;if(c.ctrlKey||c.shiftKey){b=true}if(a===true&&b===false){MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.SelectedControlsHidden);HideControlsMenu(false);return}if(a){MyShapesState.Public_UnselectShape(d);var f=MyShapesState.Public_GetShapeStateByShape(d);f.UpdateDrawing()}else{MyShapesState.Public_SelectShape(d);var f=MyShapesState.Public_GetShapeStateByShape(d)}MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected)}catch(c){LogErrorMessage("SvgManip.MultipleShapeSelected",c)}}function SingleShapeSelected(l,h){try{var a=ShapeActionEnum.Selected;var c=MyShapesState.Property_GetCurrentShapeAction();var g=false;var k=true;var d=MyShapesState.Property_SelectedCount();if(MyShapesState.Property_SelectedCount()>0){var b=MyShapesState.Public_GetFirstSelectedShape();if(b.attr("id")==l.attr("id")){if(h!=true){k=false;if(!MainControls.ToggleControlsBox(false)){a=ShapeActionEnum.SelectedControlsHidden}}}else{MainControls.DrawMainControlsBox()}}if(k){ClearActiveState()}MyShapesState.Public_UpdateSingleShapeAndAction(l,a);MyShapesState.Public_GetFirstSelectedShapeState().SetActive(true)}catch(f){LogErrorMessage("SvgManip.SingleShapeSelected",f);try{var j="SvgManip.SingleShapeSelected: ";if(l==null||l.length==0){j+="selected shape is null"}else{j+="selected shape id: "+l.attr("id")}LogErrorMessage(j)}catch(f){}try{LogErrorMessage("SvgManip.SingleShapeSelected: count of selected shapes: "+MyShapesState.Property_SelectedCount());LogErrorMessage("SvgManip.SingleShapeSelected: initial count of selected shapes: "+d)}catch(f){}}}function ClearShapeEvents(){try{if(MyShapesState.Property_GetCurrentShapeAction()!=ShapeActionEnum.SelectedControlsHidden){MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected)}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.ClearShapeEvents",a)}}function ClearActiveState(){try{$("[id$=selection_box]").remove();$("[id$=selection_box_rect_wrap]").remove();MyMoveShapeAction.Public_ClearAction();MyShapesState.Public_ClearAllSelectedShapes();try{if(UseInlineEditor){SbtInlineEditorHelper.EndEditNode()}}catch(a){LogErrorMessage("SvgMain.ClearActiveState.EndEditNode",a)}HideControlsMenu(false)}catch(a){LogErrorMessage("SvgManip.ClearActiveState",a)}}function UpdateActiveDrawing(){try{var c=MyShapesState.Public_GetAllSelectedShapeStates();if(c.length==0){return}for(var b=0;b<c.length;b++){if((c[b]!=null)&&(typeof(c[b])!="undefined")){c[b].UpdateDrawing()}}DrawControlsMenu()}catch(a){LogErrorMessage("SvgManip.UpdateActiveDrawing",a)}}function HandleMultiSelectDrag(a){}function HideControlsMenu(b){try{MainControls.HideControlsBox(b)}catch(a){LogErrorMessage("SvgManip.HideControlsMenu",a)}}function ShowHelpDialog(){try{ClearActiveState();MyPointers.Dialog_Help.modal();if($("#append-help-here").children().length==0){$("#append-help-here").load("/modal_help/storyboardcreatormodal")}}catch(a){LogErrorMessage("SvgManip.ShowHelpDialog",a)}}function ToggleFullScreen(){if((document.fullScreenElement&&document.fullScreenElement!==null)||(!document.mozFullScreen&&!document.webkitIsFullScreen)){if(document.documentElement.requestFullScreen){document.documentElement.requestFullScreen()}else{if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen()}else{if(document.documentElement.webkitRequestFullScreen){document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}}}$("#fullscreen-span").hide();$("#normalview-span").show()}else{if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}}$("#fullscreen-span").show();$("#normalview-span").hide()}}function ChangeStoryboardTypeDialog(){try{ClearActiveState();$("#disable-cell-options").removeClass("DisableDiv");$("#display-cell-layout-text").css("display","none");if(CellConfiguration.AllowTitlesAndDescriptions==false){$("#disable-cell-options").addClass("DisableDiv");$("#display-cell-layout-text").css("display","block")}try{var b=CellConfiguration.CellWidth;var a=CellConfiguration.CellHeight;$("#main-layout-free-style-width").val(b);$("#free-size-modal-free-style-width").val(b);$("#main-layout-free-style-height").val(a);$("#free-size-modal-free-style-height").val(a)}catch(d){LogErrorMessage("SvgManip.ChangeStoryboardTypeDialog.FreeSize",d)}MyPointers.Dialog_StoryboardType.modal()}catch(c){LogErrorMessage("SvgManip.ChangeStoryboardTypeDialog",c)}}function CloseBasicDialog(a){try{$("#"+a).modal("hide")}catch(b){LogErrorMessage("SvgManip.CloseBasicDialog",b)}}function CloseChangeStoryboardTypeDialog(){try{MyPointers.Dialog_StoryboardType.modal("hide");if($("#FreeSizeDialog").length>0){$("#FreeSizeDialog").modal("hide")}}catch(a){LogErrorMessage("SvgManip.CloseChangeStoryboardTypeDialog",a)}}function ChangeLayoutDialog(){try{ClearActiveState();if(StoryboardContainer.GetLayoutType()==StoryboardLayoutType.Spider){MyPointers.Dialog_SpiderCellCount.modal()}else{if(StoryboardContainer.GetLayoutType()==StoryboardLayoutType.Cycle){MyPointers.Dialog_CycleCellCount.modal()}else{if(StoryboardContainer.GetLayoutType()==StoryboardLayoutType.Timeline){TimelineDateManager.PreparePopup(CellConfiguration.TimelineDates);MyPointers.Dialog_TimelineCellCount.modal()}else{PrepareChangeLayoutDialog();MyPointers.Dialog_ChangeLayout.modal()}}}}catch(a){LogErrorMessage("SvgManip.ChangeLayoutDialog",a)}}function DrawControlsMenu(){try{var a=MyShapesState.Property_GetCurrentShapeAction();if(a==ShapeActionEnum.Move||a==ShapeActionEnum.Resize||a==ShapeActionEnum.Rotating||a==ShapeActionEnum.SelectedControlsHidden){return}var c=MyShapesState.Public_GetFirstSelectedShapeState();if(c==null||c.virtualSelected){return}if(DrawMenuMask&&GetGlobalById("controlsBox").style.display!="none"){return}else{if(!DrawMenuMask){DrawMenuMask=true;setTimeout(function(){DrawMenuMask=false},500)}}MainControls.DrawMainControlsBox()}catch(b){LogErrorMessage("SvgManip.DrawControlsMenu",b);ClearActiveState()}}function CheckForActiveDialogs(){try{var b="isOpen";if(MyPointers.Dialog_ChangeLayout.hasClass("in")){return true}if(MyPointers.Dialog_CropImage.hasClass("in")){return true}if(MyPointers.Dialog_PoseImage.hasClass("in")){return true}if(MyPointers.Dialog_Help.hasClass("in")){return true}if(MyPointers.Dialog_PurchasePopForMoreLayouts.hasClass("in")){return true}if(MyPointers.Dialog_PurchasePopForMoreLayoutsOnCopy.hasClass("in")){return true}if(MyPointers.Dialog_PurchasePopForMoreStoryboardLayouts.hasClass("in")){return true}if(MyPointers.Dialog_PurchaseForUploads.hasClass("in")){return true}if(MyPointers.Dialog_UploadImage.hasClass("in")){return true}if(MyPointers.Dialog_CellSize.hasClass("in")){return true}if(MyPointers.Dialog_SpiderCellCount.hasClass("in")){return true}if(MyPointers.Dialog_CycleCellCount.hasClass("in")){return true}if(MyPointers.Dialog_TimelineCellCount.hasClass("in")){return true}if(MyPointers.Dialog_Policies.hasClass("in")){return true}if(MyPointers.Dialog_AdvancedButtons.hasClass("in")){return true}return false}catch(a){LogErrorMessage("SvgManip.CheckForActiveDialogs",a)}}function PageXtoStoryboardX(a){return a-StoryboardContainer.CoreSvgLeft+MyPointers.SvgContainer.scrollLeft()}function StoryboardXtoPageX(a){return a-MyPointers.SvgContainer.scrollLeft()+StoryboardContainer.CoreSvgLeft}function PageYtoStoryboardY(a){return a-StoryboardContainer.CoreSvgTop+MyPointers.SvgContainer.scrollTop()}function StoryboardYtoPageY(a){return a-MyPointers.SvgContainer.scrollTop()+StoryboardContainer.CoreSvgTop}function StretchToFill(){StretchHelper(StoryboardContainer.DetermineBackDropCords,false,false)}function StretchToFill_Proportional(){StretchHelper(StoryboardContainer.DetermineBackDropCords,false,true)}function StretchHelper(s,p,g){try{var r=MyShapesState.Public_GetFirstSelectedShapeState();var a=MyShapesState.Public_GetFirstSelectedShape();var q=a.attr("id");var m=a.prev();var n=m.attr("id");var l={X:r.X,Y:r.Y,ScaleX:r.ScaleX,ScaleY:r.ScaleY};var j=n;if(p){a.detach();$("#CellDefinition").after(a);j="CellDefinition"}var b=r.Public_GetImaginaryOuterBox();var d={x:(b.Left+b.Right)/2,y:(b.Top+b.Bottom)/2};var c=StoryboardContainer.getCellInformation(d.x,d.y);var h=s(r,d.x,d.y,c,g);if(h==null){return}if(r.IsSpringable()&&r.SpringableState.CanResizeVertical()&&r.SpringableState.CanResizeHorizontal()){var t=new Array();var o=new Array();t.push({Id:r.Id,Transforms:r.SpringableState.GetSpringStateTransforms(),SvgSize:SvgCreator.GetSvgSize(r.Id+SvgPartsEnum.SvgImage),MoveX:l.X,MoveY:l.Y,UseClipping:r.UseClipping,ClipHeight:r.ClipHeight,ClipWidth:r.ClipWidth,IsSpringable:true});MyResizeActions.Private_ScaleAndMoveSpringable(r,h.ScaleX,h.ScaleY);StoryboardContainer.DetermineBackDropCordsForSpringObject(r,c,g);o.push({Id:r.Id,Transforms:r.SpringableState.GetSpringStateTransforms(),SvgSize:SvgCreator.GetSvgSize(r.Id+SvgPartsEnum.SvgImage),UseClipping:r.UseClipping,ClipHeight:r.ClipHeight,ClipWidth:r.ClipWidth,MoveX:r.X,MoveY:r.Y,IsSpringable:true});UndoManager.register(undefined,UndoShapeResizeWithMove,t,"",undefined,UndoShapeResizeWithMove,o,"")}else{var k={X:r.X,Y:r.Y,ScaleX:r.ScaleX,ScaleY:r.ScaleY};UndoManager.register(undefined,UndoStretchToFill,[q,n,l],"",undefined,UndoStretchToFill,[q,j,k],"")}UpdateActiveDrawing()}catch(f){LogErrorMessage("SvgManip.StretchToFill",f)}}function UndoStretchToFill(d,c,b){try{var g=$("#"+d).detach();$("#"+c).after(g);var f=MyShapesState.Public_GetShapeStateById(d);f.SetScale(b.ScaleX,b.ScaleY);f.MoveTo(b.X,b.Y);MyShapesState.Public_SelectShape(g);UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoStretchToFill",a)}}function StretchToFillShape(d,f,g){try{var a=StoryboardContainer.getCellInformation(f,g);var c=StoryboardContainer.DetermineBackDropCords(d,f,g,a,false);if(c==null){return}SendShapeToBack();UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.StretchToFillShape",b)}}function SetInitialShapeCords(d,a,j,k,f,g){try{var h=a.width;var c=a.height;if(!NewShapeIsBackdrop){j-=(h*f/2);k-=(c*f/2)}g.MoveTo(j,k)}catch(b){LogErrorMessage("SvgManip.SetInitialShapeCords",b)}}function SetInitialShapeIds(c,b){try{c.children().first().children().first().children().first().attr("id",b+SvgPartsEnum.SvgImage);c.children().first().children().first().attr("id",b+SvgPartsEnum.Natural);c.children().first().attr("id",b+SvgPartsEnum.Scale)}catch(a){LogErrorMessage("SvgManip.SetInitialShapeIds",a)}}function SetInitalShapeScale(d,l,a){try{var g=CellConfiguration.DefaultDropWidth;var f=CellConfiguration.DefaultDropHeight;var m=a.width;var c=a.height;var h=(g)/m;var j=(f)/c;var k=Math.min(h,j);k=Math.min(k,1);l.SetScale(k,k);return k}catch(b){LogErrorMessage("SvgManip.SetInitalShapeScale",b)}}function SetInitialShapeOffset(d,h){try{var c=d.attr("id");var a=GetGlobalById(c).getBBox();var f=a.x;var g=a.y;h.SetNaturalOffset(f,g)}catch(b){LogErrorMessage("SvgManip.SetInitialShapeOffset",b)}}function StartRotate(c){try{var b=c.currentTarget.id;var d=$("#"+b).parent().parent().attr("id");var a=MyShapesState.Public_GetShapeStateById(d);MyRotateAction.ResetRotateImageAction(a,c);LogUndo=true;MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Rotating)}catch(c){LogErrorMessage("SvgManip.StartRotate",c)}c.stopPropagation()}function RotateShape(a){try{var c=MyRotateAction.CalculateRotationAngle(a);var d=MyShapesState.Public_GetAllSelectedShapeStates();for(var b=0;b<d.length;b++){d[b].RotateShape(c)}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.RotateShape",a)}}function HandleMouseStopRotating(){try{var a=MyRotateAction.Public_TotalAngleRotation();var f=MyShapesState.Public_GetAllSelectedShapeStates();var h=new Array();var d=new Array();for(var c=0;c<f.length;c++){var g=f[c];h.push({Id:g.Id,Angle:a*-1});d.push({Id:g.Id,Angle:a})}UndoManager.register(undefined,UndoShapeRotate,h,"",undefined,UndoShapeRotate,d,"");UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.HandleMouseStopRotating",b)}}function StopRotate(a){}function StartResize(c){try{LogUndo=true;var d=this.id.toLowerCase();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Resize);var a=$("#"+d).parent().parent();var b=MyShapesState.Public_GetShapeStateByShape(a);MyResizeActions.Public_StartResize(b,d);c.stopPropagation()}catch(c){LogErrorMessage("SvgManip.StartResize",c)}}function ResizeShape(a){try{MyResizeActions.Public_ResizeShapes(a)}catch(a){LogErrorMessage("SvgManip.ResizeShape",a)}}function HandleShapeStopResizing(){try{MyResizeActions.Public_StopResizing()}catch(a){LogErrorMessage("SvgManip.HandleShapeStopResizing",a)}}function StopResize(){}function UnmovableShapeSelected(){var a=MyShapesState.Public_GetAllSelectedShapeStates();if(a.length==1){if(a[0].Movable==false){return true}}return false}function HandleShapeMove(a){try{var f=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(UnmovableShapeSelected()){return}if(MyMoveShapeAction.UndoMoveX==null){LogUndo=true;MyMoveShapeAction.Public_UpdateUndos(MyMoveShapeAction.MouseMoveOffsetX,MyMoveShapeAction.MouseMoveOffsetY)}var c=a.pageX-MyMoveShapeAction.MouseMoveOffsetX;var d=a.pageY-MyMoveShapeAction.MouseMoveOffsetY;MyMoveShapeAction.Public_UpdateMouseMoveOffsets(a.pageX,a.pageY);for(var b=0;b<f.length;b++){f[b].MoveDistance(c,d)}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.HandleShapeMove",a)}}function HandleShapeStopMove(){try{var a=MyMoveShapeAction.MouseMoveOffsetX-MyMoveShapeAction.UndoMoveX;var b=MyMoveShapeAction.MouseMoveOffsetY-MyMoveShapeAction.UndoMoveY;MyMoveShapeAction.Public_UpdateUndos(null,null);if(a!=0||b!=0){var g=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);var h=new Array();var f=new Array();for(var d=0;d<g.length;d++){h.push({Id:g[d].Id,X:(a*-1),Y:(b*-1)});f.push({Id:g[d].Id,X:a,Y:b})}UndoManager.register(undefined,UndoShapeMoveArray,h,"",undefined,UndoShapeMoveArray,f,"")}}catch(c){LogErrorMessage("SvgManip.HandleShapeStopMove",c)}}var slider_is_initialized=false;function ShowChangeCellSize(){try{CloseModal(MyPointers.Dialog_AdvancedButtons);MyPointers.Dialog_CellSize.modal();MyPointers.Dialog_CellSize.one("shown.bs.modal",function(){if(!slider_is_initialized){AddSlider();slider_is_initialized=true}})}catch(a){LogErrorMessage("SvgManip.ShowChangeCellSize",a)}}function ExpandCells(f,g,d){ClearActiveState();if(cellSlider){$("#cell-size-slider").data("previousValue",g);var c=$("#cell-size-slider").slider("setValue",g)}var a=(f*CellConfiguration.CellWidth)/CellConfiguration.UnscaledCellWidth;var b=MyLayoutFactory.GetLayout(StoryboardContainer.GetLayoutType(),CellConfiguration.HasTitle,CellConfiguration.HasDescription,a,CellConfiguration.GetLayoutConfig());StoryboardContainer.ChangeCellConfiguration_ScaleShapes(CellConfiguration,b,f);CellConfiguration.ExpandCells(f);StoryboardContainer.ExpandCells(f,d);StoryboardContainer.UpdateImageAttributions();if(HasGridLines()){AddGridLines()}}var cellSlider=null;function AddSlider(){$("#cell-size-slider").data("previousValue",1);cellSlider=$("#cell-size-slider").slider({value:1,formater:function(a){return parseInt(a*100)+"%"}});$("#cell-size-slider").on("slide",HandleCellSizeSlide);$("#cell-size-slider").on("slideStop",HandleCellSizeSlide)}function HandleCellSizeSlide(f,c){var b=$("#cell-size-slider").slider("getValue");var d=$(this).data("previousValue");var a=b/d;var g=d/b;if(g==1){return}ExpandCells(a,b);UndoManager.register(undefined,ExpandCells,[g,d],undefined,"",ExpandCells,[a,b])}function SmartImageOptions(b){try{var a=MyShapesState.Public_GetFirstSelectedShapeState();HideControlsMenu();MyPosableControlsBox=new PosableControlsBox(a,PosableTypeEnum.SmartItem)}catch(b){LogErrorMessage("SvgManip.SmartImageOptions",b)}}function PoseShape(b){try{var a=MyShapesState.Public_GetFirstSelectedShapeState();HideControlsMenu();MyPosableControlsBox=new PosableControlsBox(a,PosableTypeEnum.Character)}catch(b){LogErrorMessage("SvgManip.PoseShape",b)}}function InstaPoseClosure(a){return function(){var b=MyShapesState.Public_GetFirstSelectedShapeState();var f=b.Position;var g=b.Public_GetPoseGroupList();var h=b.Public_GetPreviousPoseList();var d=b.Public_GetPose(a);var c=b.Public_GetSafePoseArray(d);b.Public_BulkUpdatePoseGroups(c);b.Public_SetPreviousPoseList(d);UndoManager.register(undefined,UndoPose,[b.Id,g,h,f],"",undefined,UndoPose,[b.Id,b.Public_GetPoseGroupList(),b.Public_GetPreviousPoseList(),f],"")}}function HandlePoseDialogClose(b){var a=MyShapesState.Public_GetFirstSelectedShapeState();var h=MyPosableControlsBox.Public_UndoInfo;var d=a.Position;var c=a.Public_GetPoseGroupList();var f=a.Public_GetPreviousPoseList();var g=a.Id;if(MyPosableControlsBox.Public_IsCancel==false){UndoManager.register(undefined,UndoPose,[g,h.UndoActivePoseList,h.UndoPreviousPoseList,h.UndoPosition],"",undefined,UndoPose,[g,c,f,d],"")}else{UndoPose(g,h.UndoActivePoseList,h.UndoPreviousPoseList,h.UndoPosition)}}function CancelPose(a){MyPosableControlsBox.Public_IsCancel=true;MyPointers.Dialog_PoseImage.modal("hide")}function UndoPose(c,a,f,d){try{var g=MyShapesState.Public_GetShapeStateById(c);g.ChangeCharacterPosition(d);g.Public_SetPreviousPoseList(f);g.Public_BulkUpdatePoseGroups(g.Public_GetSafePoseArray(f));g.Public_BulkUpdatePoseGroups(g.Public_GetSafePoseArray(a))}catch(b){LogErrorMessage("SvgManip.UndoTextAlignment",b)}}function SmartSceneShape(b){try{var a=MyShapesState.Public_GetFirstSelectedShapeState();HideControlsMenu();MySmartSceneDialog=new SmartSceneDialog(a)}catch(b){LogErrorMessage("SvgManip.SmartSceneShape",b)}}function HandleSmartSceneDialogClose(b){DrawControlsMenu();var a=MyShapesState.Public_GetFirstSelectedShapeState();var d=a.SmartSceneState.GetSelectedSceneOptions();var c=null;if(a.Property_IsColorable()){c=a.ColorableState.Public_GetColorStyles()}var f=a.Id;if(MySmartSceneDialog.CancelButtonPressed==false){UndoManager.register(undefined,UndoSmartScene,[f,MySmartSceneDialog.UndoInfo_Colors,MySmartSceneDialog.UndoInfo_SelectedSceneOptions],"",undefined,UndoSmartScene,[f,c,d],"")}else{UndoSmartScene(f,MySmartSceneDialog.UndoInfo_Colors,MySmartSceneDialog.UndoInfo_SelectedSceneOptions)}}function CancelSmartScene(a){MySmartSceneDialog.CancelButtonPressed=true;MyPointers.Dialog_SmartScene.modal("hide")}function UndoSmartScene(c,a,d){try{var f=MyShapesState.Public_GetShapeStateById(c);if(a!=null){f.ColorableState.Public_CopyColorStyles(a)}f.SmartSceneState.SetSelectedSceneOptions(d)}catch(b){LogErrorMessage("SvgManip.UndoSmartScene",b)}}function ChangeCropBoxTitle(a){switch(a){case CropTypeEnum.Standard:$("#CropBoxTitle").html("Standard Crop");break;case CropTypeEnum.Advanced:$("#CropBoxTitle").html("Advanced Crop");break;case CropTypeEnum.Circle:$("#CropBoxTitle").html("Circular Crop");break}}function GroupActiveCellObject(a){var b=StoryboardContainer.GetAllLayoutParts(CellConfiguration);var f=StoryboardContainer._GetLayoutPartForShape(b,a);var d=StoryboardContainer.GetShapeStatesForCell(f.Row,f.Col);var c=d[StoryboardPartTypeEnum.StoryboardCell];if(c.length>1){c=MyGroupAction.MakeGroupFromSelectedObjects(c,true)}else{if(c.length>0){c=c[0]}else{return}}return c}function CropShapeChange(b){var a=MyShapesState.Public_GetFirstSelectedShapeState();ChangeCropBoxTitle(b.data.CropType);CropHelper.ChangeCropMode(a,b.data.CropType)}function CropShape(c){try{var a=MyShapesState.Public_GetFirstSelectedShapeState();HideControlsMenu(true);if(MyBrowserProperties.IsMobile){inputAdapter.useDelegation(false)}var b=c&&c.data?c.data.CropType:a.CropType;ChangeCropBoxTitle(b);CropHelper.ShowCropDialog(a,b)}catch(c){LogErrorMessage("SvgManip.CropShape",c)}}function MultiTextableShape(b){try{var a=MyShapesState.Public_GetFirstSelectedShapeState();HideControlsMenu(true);if(MyBrowserProperties.IsMobile){inputAdapter.useDelegation(false)}MultiTextableHelper.ShowMultipleDialog(a)}catch(b){LogErrorMessage("SvgManip.MultiTextableShape",b)}}function RemoveCrop(){try{if(MyBrowserProperties.IsMobile){inputAdapter.useDelegation(true)}MyCroppedImage.RemoveCrop()}catch(a){LogErrorMessage("SvgManip.RemoveCrop",a)}}function CancelCrop(){try{if(MyBrowserProperties.IsMobile){inputAdapter.useDelegation(true)}MyCroppedImage.CancelCrop()}catch(a){LogErrorMessage("SvgManip.CancelCrop",a)}}function HandleCropSelection(){try{if(MyBrowserProperties.IsMobile){inputAdapter.useDelegation(true)}MyCroppedImage.UpdateCrop()}catch(a){LogErrorMessage("SvgManip.HandleCropSelection",a)}}function selectAllShapes(){var a=$("#SvgTop");while(1){a=a.prev();if(a.attr("id")==undefined){break}if(a.attr("id").substring(0,3)=="sbt"){MyShapesState.Public_SelectShape(a)}}UpdateActiveDrawing()}function FindTopMostSVG_in_SelectedGroup(a){var b=$("#SvgTop");while(1){b=b.prev();if(b.attr("id")==undefined||b.attr("id")=="SvgTop"){return null}if(b.attr("id").substring(0,3)=="sbt"){for(i=0;i<a.length;i++){if(a[i].Id==b.attr("id")){return a[i].Id}}}}}function BringShapeForward(){try{var a=MyShapesState.Public_GetFirstSelectedShape();var c=a.next();var d=c.attr("id");var f=a.attr("id");if(d=="SvgTop"){return}a.detach();c.after(a);UndoManager.register(undefined,UndoShapeIndexBefore,[f,d],"",undefined,UndoShapeIndexAfter,[f,d],"")}catch(b){LogErrorMessage("SvgManip.BringShapeForward",b)}}function BringShapeToFront(){try{var a=MyShapesState.Public_GetFirstSelectedShape();var c=a.next();var d=c.attr("id");var f=a.attr("id");a.detach();MyPointers.GetSvgTop().before(a);UndoManager.register(undefined,UndoShapeIndexBefore,[f,d],"",undefined,UndoShapeIndexBefore,[f,"SvgTop"],"")}catch(b){LogErrorMessage("SvgManip.BringShapeToFront",b)}}function SendShapeBackwards(){try{var a=MyShapesState.Public_GetFirstSelectedShape();var c=a.prev();var d=c.attr("id");var f=a.attr("id");if(c.attr("id")=="CellDefinition"){return}a.detach();c.before(a);UndoManager.register(undefined,UndoShapeIndexAfter,[f,d],"",undefined,UndoShapeIndexBefore,[f,d],"")}catch(b){LogErrorMessage("SvgManip.SendShapeBackwards",b)}}function SendShapeToBack(){try{var a=MyShapesState.Public_GetFirstSelectedShape();var c=a.prev();var d=c.attr("id");var f=a.attr("id");a.detach();$("#CellDefinition").after(a);UndoManager.register(undefined,UndoShapeIndexAfter,[f,d],"",undefined,UndoShapeIndexAfter,[f,"CellDefinition"],"")}catch(b){LogErrorMessage("SvgManip.SendShapeToBack",b)}}function DeleteShape(){try{if(MyShapesState.Property_SelectedCount==0){return}var l=MyShapesState.Public_GetAllSelectedMovableShapeStates(false);var m=new Array();var k=new Array();for(var f=0;f<l.length;f++){var b=l[f];var g=b.Id;var a=$("#"+g);var h=a.next();var j=h.attr("id");m.push({Detached:a,NextShapeId:j,Id:g,ShapeState:MyShapesState.Public_GetShapeStateById(g)});k.push({Id:g});MyShapesState.Public_RemoveShapeStateById(g);var c=$("#"+g).detach()}UndoManager.register(undefined,UndoDeleteShape,m,"",undefined,UndoShapeAdd,k,"");MyShapesState.Public_ClearAllSelectedShapes();HideControlsMenu(true);StoryboardContainer.UpdateImageAttributions()}catch(d){LogErrorMessage("SvgManip.DeleteShape",d)}}function DeleteAll(a){try{if(confirm(MyLangMap.GetTextByToken("warning-clear-all"))==false){return}var c=MyShapesState.Public_GetAllShapeStates();for(shapeId in MyShapesState.Private_ShapeStates){var b=MyShapesState.Public_GetShapeStateById(shapeId);if(b==null){continue}$("#"+b.Id).remove();MyShapesState.Public_RemoveShapeStateById(shapeId)}MyShapesState.Public_ResetShapeStates();MyShapesState.Public_ClearAllSelectedShapes();StoryboardContainer.Public_ResetLayout();UndoManager.clear();ClearActiveState()}catch(a){LogErrorMessage("SvgManip.DeleteAll",a)}}function RotateLeft(){try{QuickRotate(-90)}catch(a){LogErrorMessage("SvgManip.RotateLeft",a)}}function RotateRight(){try{QuickRotate(90)}catch(a){LogErrorMessage("SvgManip.RotateRight",a)}}function QuickRotate(a){try{var h=new Array();var d=new Array();var f=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(f.length===0){return}for(var c=0;c<f.length;c++){var g=f[c];g.RotateShape(a);h.push({Id:g.Id,Angle:a*-1});d.push({Id:g.Id,Angle:a})}UndoManager.register(undefined,UndoShapeRotate,h,"",undefined,UndoShapeRotate,d,"");UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.QuickRotate",b)}}function FlipVertical(){try{var f=new Array();var c=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(c.length===0){return}for(var b=0;b<c.length;b++){var d=c[b];d.FlipShapeVertical();f.push({Id:d.Id})}UpdateActiveDrawing();UndoManager.register(undefined,UndoFlipVertical,f,"",undefined,UndoFlipVertical,f,"")}catch(a){LogErrorMessage("SvgManip.FlipVertical",a)}}function FlipHorizontal(){try{var f=new Array();var c=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(c.length===0){return}for(var b=0;b<c.length;b++){var d=c[b];d.FlipShapeHorizontal();f.push({Id:d.Id})}UpdateActiveDrawing();UndoManager.register(undefined,UndoFlipHorizontal,f,"",undefined,UndoFlipHorizontal,f,"")}catch(a){LogErrorMessage("SvgManip.FlipHorizontal",a)}}function FilterColorMode(c){try{if(c=="url(#)"){return}var h=new Array();var d=new Array();var f=MyShapesState.Public_GetAllSelectedMovableShapeStates(false);if(f.length===0){return}for(var b=0;b<f.length;b++){var g=f[b];h.push({Id:g.Id,Mode:g.FilterColorMode});g.FilterColorMode=c;d.push({Id:g.Id,Mode:g.FilterColorMode})}UpdateActiveDrawing();UndoManager.register(undefined,UndoFilterColorMode,h,"",undefined,UndoFilterColorMode,d,"")}catch(a){LogErrorMessage("SvgManip.FilterColorMode",a)}}function UndoFilterColorMode(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=arguments[b].Mode;var f=MyShapesState.Public_GetShapeStateById(c);f.FilterColorMode=d;MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoFilterColorMode",a)}}function LockSelected(){SetLockState(true)}function UnlockSelected(){SetLockState(false)}function SetLockState(c){try{var h=new Array();var d=new Array();var f=MyShapesState.Public_GetAllSelectedShapeStates();if(f.length===0){return}for(var b=0;b<f.length;b++){var g=f[b];h.push({Id:g.Id,Mode:g.IsLocked});g.SetLockState(c);d.push({Id:g.Id,Mode:g.IsLocked})}UpdateActiveDrawing();UndoManager.register(undefined,UndoSetLockState,h,"",undefined,UndoSetLockState,d,"")}catch(a){LogErrorMessage("SvgManip.SetLockState",a)}}function UndoSetLockState(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=arguments[b].Mode;var f=MyShapesState.Public_GetShapeStateById(c);f.SetLockState(d);MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoSetLockState",a)}}function QuickShapeScale(k){try{var l=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);var m=new Array();var j=new Array();if(l.length==0){return}for(var c=0;c<l.length;c++){var a=l[c];var g=a.ScaleX;var h=a.ScaleY;a.ChangeScale(k);var d=a.ScaleX;var f=a.ScaleY;m.push({Id:a.Id,ScaleX:g,ScaleY:h});j.push({Id:a.Id,ScaleX:d,ScaleY:f})}UndoManager.register(undefined,UndoShapeResize,m,"",undefined,UndoShapeResize,j,"");UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.QuickShapeScale",b)}}function QuickShapeMove(g,h){try{var f=new Array();var c=new Array();var d=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(d.length==0){return}for(var b=0;b<d.length;b++){d[b].MoveDistance(g,h);f.push({Id:d[b].Id,X:(g*-1),Y:(h*-1)});c.push({Id:d[b].Id,X:g,Y:h})}UndoManager.register(undefined,UndoShapeMoveArray,f,"",undefined,UndoShapeMoveArray,c,"");UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.QuickShapeMove",a)}}function InitializeFontSelector(){}function FontSelectionChange(f){try{var d=MyShapesState.Public_GetFirstSelectedShapeState();if(d==null){return}var c=d.GetFontFace();SetFontSelection(f,d.Id);$("#textableText").focus();var b=d.GetFontFace();UndoManager.register(undefined,UndoFontFaceChange,[d.Id,c],"",undefined,UndoFontFaceChange,[d.Id,b],"");UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.FontSelectionChange",a)}}function SetFontSelection(b,d){try{var c=MyShapesState.Public_GetShapeStateById(d);if(c==null){return}c.SetFontFace(b);c.UpdateDrawing()}catch(a){LogErrorMessage("SvgManip.SetFontSelection",a)}}function UpdateFontColor(a){try{var d=MyShapesState.Public_GetFirstSelectedShapeState();if(d==null){return}var c=d.GetSavedFontColor();if(c==a.toHexString()){return}UndoManager.register(undefined,UndoFontColor,[d.Id,c],"",undefined,UndoFontColor,[d.Id,a.toHexString()],"");d.SetFontColor(a.toHexString(),false);d.UpdateDrawing()}catch(b){LogErrorMessage("SvgManip.UpdateFontColor",b)}}function PreviewUpdateFontColor(a){try{var c=MyShapesState.Public_GetFirstSelectedShapeState();if(c==null){return}c.SetFontColor(a.toHexString(),true);c.UpdateDrawing()}catch(b){LogErrorMessage("SvgManip.PreviewUpdateFontColor",b)}}function UpdateFontColorHidden(a){try{var b=MyShapesState.Public_GetFirstSelectedShapeState();if(b==null){return}b.ResetFontColor();b.UpdateDrawing()}catch(a){LogErrorMessage("SvgManip.UpdateFontColorHidden",a)}}function UpdateFontSize(a){try{var d=MyShapesState.Public_GetFirstSelectedShapeState();if(d==null){return}a.stopPropagation();var b=$("#sizeSelector").val();var c=d.GetFontSize();if(c==b){return}UndoManager.register(undefined,UndoFontSize,[d.Id,c],"",undefined,UndoFontSize,[d.Id,b],"");d.SetFontSize(b);UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UpdateFontSize",a)}}function UpdateTextAlignment(a){try{var f=MyShapesState.Public_GetFirstSelectedShapeState();if(f==null){return}var c=a;var d=f.GetTextAlignment();if(d==c){return}UndoManager.register(undefined,UndoTextAlignment,[f.Id,d],"",undefined,UndoTextAlignment,[f.Id,c],"");f.SetTextAlignment(c);MyPointers.Controls_TextableControls_TextAlignmentSelectors.removeClass("active");MyPointers.Controls_TextableControls_TextAlignmentSelectors.filter("."+c).addClass("active");UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.UpdateTextAlignment",b)}}function SetTextableText_Quill(f,g,h,j,k){try{var n=MyShapesState.Public_GetFirstSelectedShapeState();if(n==null){return}var l=quill.getContents().ops;if(SbtLib.DeepCompareEquality(n.TextState.Public_GetQuillDeltas(),l)==false){var m=n.TextState.Public_GetQuillDeltas();n.TextState.Public_SetQuillDeltas(l);UndoManager.register(undefined,UndoTextChangeQuill,[n.Id,m],"",undefined,UndoTextChangeQuill,[n.Id,l],"");UpdateActiveDrawing();n.SetText(quill.getText());quill.history.clear();SbtQuillHelper.HandleWhiteText()}}catch(k){LogErrorMessage("SvgManip.SetTextableText",k)}}function SetTextableText(a){try{var d=MyShapesState.Public_GetFirstSelectedShapeState();if(d==null){return}if(a!=null){a.stopPropagation()}var b=$("#textableText").val();var c=d.GetText();if(c!=b){d.SetText(b);UndoManager.register(undefined,UndoTextChange,[d.Id,c],"",undefined,UndoTextChange,[d.Id,b],"");UpdateActiveDrawing()}}catch(a){LogErrorMessage("SvgManip.SetTextableText",a)}}function Undo(a){try{if(CheckForActiveDialogs()){return}UndoManager.undo()}catch(a){LogErrorMessage("SvgManip.Undo",a)}}function Redo(a){try{UndoManager.redo()}catch(a){LogErrorMessage("SvgManip.Redo",a)}}function HandleShapeSelected(d){try{if(CheckForActiveDialogs()){return}var a=ShapeActionEnum.Selected;d.attr("id");if(MyShapesState.Property_SelectedCount()>0){var b=MyShapesState.Public_GetFirstSelectedShape();if(b.attr("id")==$(this).attr("id")){return}}ClearActiveState();MyShapesState.Public_UpdateSingleShapeAndAction($target,a);MyShapesState.Public_GetFirstSelectedShapeState();UpdateActiveDrawing();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Nothing)}catch(c){LogErrorMessage("SvgManip.HandleShapeSelected",c)}}var _RotateStarted=false;function HandleRotate(f,c,d){try{if(CheckForActiveDialogs()){return}if(MyShapesState.Property_SelectedCount()==0){return}var g=MyShapesState.Public_GetFirstSelectedShapeState();switch(f){case MovePhaseEnum.Start:_RotateStarted=true;HideControlsMenu();MyRotateAction.ResetRotateImageAction(g,{pageX:c,pageY:d});LogUndo=true;g.UpdateDrawing();break;case MovePhaseEnum.Move:if(!_RotateStarted){return}var a=MyRotateAction.CalculateRotationAngle({pageX:c,pageY:d});g.RotateShape(a);g.UpdateDrawing();break;case MovePhaseEnum.End:if(!_RotateStarted){return}_RotateStarted=false;HandleMouseStopRotating();DrawControlsMenu();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Nothing);break}}catch(b){LogErrorMessage("SvgManip.HandleRotate",b)}}var _MoveStarted=false;function HandleMove(d,a,b){try{if(CheckForActiveDialogs()){return}if(MyShapesState.Property_SelectedCount()==0){return}if(skipNextDrag){skipNextDrag=false;return}var f=MyShapesState.Public_GetFirstSelectedShapeState();switch(d){case MovePhaseEnum.Start:_MoveStarted=true;HideControlsMenu();MyMoveShapeAction.Public_ClearAction();LogUndo=true;MyMoveShapeAction.Public_UpdateUndos(0,0);MyMoveShapeAction.Public_UpdateMouseMoveOffsets(a,b);f.MoveDistance(a,b);f.UpdateDrawing();break;case MovePhaseEnum.Move:if(!_MoveStarted){return}MyMoveShapeAction.Public_UpdateMouseMoveOffsets(a+MyMoveShapeAction.MouseMoveOffsetX,b+MyMoveShapeAction.MouseMoveOffsetY);f.MoveDistance(a,b);f.UpdateDrawing();break;case MovePhaseEnum.End:if(!_MoveStarted){return}_MoveStarted=false;HandleShapeStopMove();DrawControlsMenu();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Nothing);break}}catch(c){LogErrorMessage("SvgManip.HandleDrag",c)}}var _ScaleStarted=false;function HandleScale(d,h,j,a,b,f){try{if(CheckForActiveDialogs()){return}if(MyShapesState.Property_SelectedCount()==0){return}var g=MyShapesState.Public_GetFirstSelectedShapeState();switch(d){case MovePhaseEnum.Start:_ScaleStarted=true;HideControlsMenu();MyResizeActions.Public_StartResize(g,g.Id);break;case MovePhaseEnum.Move:if(!_ScaleStarted){return}MyResizeActions.ResizeViaPinch(h,j,a,b,f);break;case MovePhaseEnum.End:if(!_ScaleStarted){return}_ScaleStarted=false;HandleShapeStopResizing();DrawControlsMenu();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Nothing);break}}catch(c){LogErrorMessage("SvgManip.HandlePinch",c)}}function ColorableHelper_GetRegionFromId(b){try{var c=b.replace("ColorSelector_","");var c=c.replace("div_","");c=c.substring(0,c.indexOf("_"));return c}catch(a){LogErrorMessage("SvgManip.ColorableHelper_GetRegionFromId",a)}}function UndoColorChange(c,d,a){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);var f=MyShapesState.Public_GetShapeStateById(c);MyShapesState.Public_SelectShape($("#"+c));f.Public_SetColorForRegion(d,a,false,true,false);f.UpdateDrawing()}catch(b){LogErrorMessage("SvgManip.UndoColorChange",b)}}function UpdateColorRegionFromColorPicker(a){try{var c=ColorableHelper_GetRegionFromId(this.id);var d=a.toRgbString();var f=MyShapesState.Public_GetFirstSelectedShapeState();if(f!=null){f.Public_SetColorForRegion(c,d,false,false,true)}}catch(b){LogErrorMessage("SvgManip.UpdateColorRegionFromColorPicker",b)}}function UpdateColorRegionFromColorPickerPreview(a){try{var c=ColorableHelper_GetRegionFromId(this.id);var d=a.toRgbString();var f=MyShapesState.Public_GetFirstSelectedShapeState();if(f!=null){f.Public_SetColorForRegion(c,d,true,false,false)}}catch(b){LogErrorMessage("SvgManip.UpdateColorRegionFromColorPickerPreview",b)}}function UpdateColorRegionFromColorPickerHide(a){try{var c=MyShapesState.Public_GetFirstSelectedShapeState();var b=ColorableHelper_GetRegionFromId(this.id);if(c!=null){c.Public_SetColorForRegion(b,c.Public_GetColorForRegion(b),true,false,false)}}catch(a){LogErrorMessage("SvgManip.UpdateColorRegionFromColorPickerHide",a)}}function UpdateColorRegion(a){try{var f=MyShapesState.Public_GetFirstSelectedShapeState();var d=$("#"+a.target.id);var c=d.css("background-color");var b=ColorableHelper_GetRegionFromId(a.target.id);f.Public_SetColorForRegion(b,c,false,true,true)}catch(a){LogErrorMessage("SvgManip.UpdateColorRegion",a)}}function WhiteOutShape(){BlankOutShape("rgb(255, 255, 255)","#fff",WhiteOutShape)}function BlackOutShape(){BlankOutShape("rgb(0, 0, 0)","#000",BlackOutShape)}function getcolorValues(a){if(a===""){return}if(a.toLowerCase()==="transparent"){return[0,0,0,0]}if(a[0]==="#"){if(a.length<7){a="#"+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]+(a.length>4?a[4]+a[4]:"")}return[parseInt(a.substr(1,2),16),parseInt(a.substr(3,2),16),parseInt(a.substr(5,2),16),a.length>7?parseInt(a.substr(7,2),16)/255:1]}if(a.indexOf("rgb")===-1){var c=document.body.appendChild(document.createElement("fictum"));var b="rgb(1, 2, 3)";c.style.color=b;if(c.style.color!==b){return}c.style.color=a;if(c.style.color===b||c.style.color===""){return}a=getComputedStyle(c).color;document.body.removeChild(c)}if(a.indexOf("rgb")===0){if(a.indexOf("rgba")===-1){a+=",1"}return a.match(/[\.\d]+/g).map(function(d){return +d})}}function colorValues(a){var c=getcolorValues(a);var b=0;if(c!=undefined){b=Math.round((c[0]*0.2126+c[1]*0.7152+c[2]*0.0722))}return Math.round(Math.sqrt(b/255)*255)}function ApplyArtPen(m){var d=colorValues("#000000"),f=colorValues("#ffffff");var l=["path","polygon","rect","ellipse","circle","line"];for(var c=0;c<l.length;c++){var b=m.getElementsByTagName(l[c]);for(var a=0;a<b.length;a++){if(b[a].getAttributeNS(null,"fill")==null||b[a].getAttributeNS(null,"fill")=="none"||b[a].getAttributeNS(null,"fill").substr(0,3)=="url"){continue}if(b[a].getAttributeNS(null,"stroke")==null){continue}var h=b[a].getAttributeNS(null,"stroke-width");var g=b[a].getAttributeNS(null,"stroke");b[a].setAttributeNS(null,"stroke-width",4);b[a].setAttributeNS(null,"stroke","rgb(12,12,12)");var n=colorValues(b[a].getAttributeNS(null,"fill"));var k=b[a].getAttributeNS(null,"fill");k=((k==null||k=="")?"#000":k);b[a].setAttributeNS(null,"old_fill",k);b[a].setAttributeNS(null,"fill","rgb("+n+","+n+","+n+")");b[a].setAttributeNS(null,"old_strokewidth",h);b[a].setAttributeNS(null,"old_stroke",g)}}}function ArtpenShape(){try{MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);var h=MyShapesState.Public_GetAllSelectedShapeStates();if(h.length==0){return}var m=[];for(var k=0;k<h.length;k++){var a=h[k];var j=GetGlobalById(a.Id);var g=a.Public_GetColorRegions();var l=[];if(g!=null){for(var d=0;d<g.length;d++){if(g[d]==""){continue}l.push({Region:g[d],Color:a.Public_GetColorForRegion(g[d])});var b=a.Public_GetColorForRegion(g[d]);var n=colorValues(b);a.Public_SetColorForRegion(g[d],"rgb("+n+","+n+","+n+")",false,false,false)}}var f=a.FilterColorMode;a.FilterColorMode="url(#grayscale)";ApplyArtPen(document.getElementById(a.Id+SvgPartsEnum.Natural));m.push({id:a.Id,undoColors:l,preFilterColorMode:f})}UndoManager.register(undefined,UndoBlankOut,[m],"",undefined,ArtpenShape,[null,m],"");DrawControlsMenu();UpdateActiveDrawing()}catch(c){LogErrorMessage("SvgManip.ArtpenShape",c)}}function BlankOutShape(h,c,f){try{MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);var j=MyShapesState.Public_GetAllSelectedShapeStates();if(j.length==0){return}var n=[];for(var l=0;l<j.length;l++){var a=j[l];var g=a.Public_GetColorRegions();var m=[];if(g!=null){for(var d=0;d<g.length;d++){if(g[d]==""){continue}m.push({Region:g[d],Color:a.Public_GetColorForRegion(g[d])});a.Public_SetColorForRegion(g[d],h,false,false,false)}}var k=$("#"+a.Id+SvgPartsEnum.Scale);FadeToBlankOut(k,c);n.push({id:a.Id,undoColors:m})}UndoManager.register(undefined,UndoBlankOut,[n],"",undefined,f,[null,n],"");DrawControlsMenu()}catch(b){LogErrorMessage("SvgManip.BlankOutShape",b)}}function FadeToBlankOut(h,c){try{var g=false;if(h.attr("fill")=="#FFFFFC"||h.attr("fill")=="none"){g=true}if(h.is("g")||h.is("svg")||h.is("defs")){g=true}if(g==false){var d=h.attr("fill");d=((d==null||d=="")?"#000":d);if(h.attr("opacity")!=null){var f=h.attr("opacity");h.attr("old_opacity",f);h.attr("opacity",1)}h.attr("old_fill",d);h.attr("fill",c)}for(var b=0;b<h.children().length;b++){FadeToBlankOut($(h.children()[b]),c)}}catch(a){LogErrorMessage("SvgManip.FadeToBlankOut",a)}}function UndoBlankOut(g){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var f=0;f<g.length;f++){var c=MyShapesState.Public_GetShapeStateById(g[f].id);MyShapesState.Public_SelectShape($("#"+g[f].id));var d=$("#"+g[f].id);UndoFadeToBlankOutHelper(d);for(var b=0;b<g[f].undoColors.length;b++){c.Public_SetColorForRegion(g[f].undoColors[b].Region,g[f].undoColors[b].Color,false,false,false)}if(g[f].preFilterColorMode!=null&&g[f].preFilterColorMode!="undefined"){c.FilterColorMode=g[f].preFilterColorMode}c.UpdateDrawing()}DrawControlsMenu()}catch(a){LogErrorMessage("SvgManip.UndoFadeToWhiteOut",a)}}function UndoFadeToBlankOutHelper(c){try{if(c.attr("old_fill")!=null&&c.attr("old_fill")!=""){c.attr("fill",c.attr("old_fill"));c.attr("old_fill","")}if(c.attr("old_opacity")!=null&&c.attr("old_opacity")!=""){c.attr("opacity",c.attr("old_opacity"));c.attr("old_opacity","")}if(c.attr("old_stroke")!=null&&c.attr("old_stroke")!=""){c.attr("stroke",c.attr("old_stroke"));c.attr("old_stroke","")}if(c.attr("old_strokewidth")!=null&&c.attr("old_strokewidth")!=""){c.attr("stroke-width",c.attr("old_strokewidth"));c.attr("old_strokewidth","")}for(var b=0;b<c.children().length;b++){UndoFadeToBlankOutHelper($(c.children()[b]))}}catch(a){LogErrorMessage("SvgManip.UndoFadeToBlankOutHelper",a)}}function UndoDeleteShape(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);var h=true;for(var g=0;g<arguments.length+1;g++){if(h===false){break}h=false;for(var d=0;d<arguments.length;d++){var f=arguments[d].Id;var k=arguments[d].ShapeState;var a=arguments[d].NextShapeId;var b=arguments[d].Detached;if(b.parent().length===0){$("#"+a).before(b);if(b.parent().length>0){MyShapesState.Public_SetShapeState(f,k);MyShapesState.Public_SelectShape($("#"+f))}else{h=true}}}}StoryboardContainer.UpdateImageAttributions();UpdateActiveDrawing()}catch(c){LogErrorMessage("SvgManip.UndoDeleteShape",c)}}function UndoShapeAdd(){try{MyShapesState.Public_ClearAllSelectedShapes();for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;if(arguments[b].content){if(arguments[b].content.cell_title_id){var d=MyShapesState.Public_GetShapeStateById(arguments[b].content.cell_title_id);d.TextState.CopyFontStyles(arguments[b].content.cell_title_txt.Public_GetFontStyles());d.ColorableState.Public_CopyColorStyles(arguments[b].content.cell_title_color.Public_GetColorStyles());d.UpdateDrawing()}if(arguments[b].content.cell_description_id){var d=MyShapesState.Public_GetShapeStateById(arguments[b].content.cell_description_id);d.TextState.CopyFontStyles(arguments[b].content.cell_description_txt.Public_GetFontStyles());d.ColorableState.Public_CopyColorStyles(arguments[b].content.cell_description_color.Public_GetColorStyles());d.UpdateDrawing()}}else{$("#"+c).detach();MyShapesState.Public_RemoveShapeStateById(c)}}HideControlsMenu(true);StoryboardContainer.UpdateImageAttributions()}catch(a){LogErrorMessage("SvgManip.UndoShapeAdd",a)}}function UndoShapeIndexBefore(c,b){try{var d=$("#"+c).detach();$("#"+b).before(d)}catch(a){LogErrorMessage("SvgManip.UndoShapeIndexBefore",a)}}function UndoShapeIndexAfter(c,b){try{var d=$("#"+c).detach();$("#"+b).after(d)}catch(a){LogErrorMessage("SvgManip.UndoShapeIndexAfter",a)}}function UndoTextChange(b,d){try{var c=MyShapesState.Public_GetShapeStateById(b);c.SetText(d);$("#textableText").val(d);c.UpdateDrawing()}catch(a){LogErrorMessage("SvgManip.UndoTextChange",a)}}function UndoTextChangeQuill(c,a){try{var d=MyShapesState.Public_GetShapeStateById(c);if(d==null){LogErrorMessage("SvgManip.UndoTextChangeQuill - ShapeState is Null - ID: "+c);return}d.TextState.Public_SetQuillDeltas(a);quill.setContents(a);if(quill.getLength()==1){SbtQuillHelper.ResetToDefaults()}d.UpdateDrawing();d.SetText(quill.getText())}catch(b){LogErrorMessage("SvgManip.UndoTextChangeQuill",b)}}function UndoFontFaceChange(c,b){try{var d=MyShapesState.Public_GetShapeStateById(c);SetFontSelection(b,c);d.UpdateDrawing();UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoFontFaceChange",a)}}function UndoFontColor(c,a){try{var d=MyShapesState.Public_GetShapeStateById(c);d.SetFontColor(a);MyPointers.Controls_TextableControls_ColorSelector.spectrum("set",a);d.UpdateDrawing()}catch(b){LogErrorMessage("SvgManip.UndoFontColor",b)}}function UndoFontSize(b,d){try{var c=MyShapesState.Public_GetShapeStateById(b);c.SetFontSize(d);$("#sizeSelector").val(d);c.UpdateDrawing()}catch(a){LogErrorMessage("SvgManip.UndoFontSize",a)}}function UndoTextAlignment(b,d){try{var c=MyShapesState.Public_GetShapeStateById(b);c.SetTextAlignment(d);MyPointers.Controls_TextableControls_TextAlignmentSelectors.removeClass("active");MyPointers.Controls_TextableControls_TextAlignmentSelectors.filter("."+d).addClass("active");c.UpdateDrawing()}catch(a){LogErrorMessage("SvgManip.UndoTextAlignment",a)}}function UndoFlipVertical(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=MyShapesState.Public_GetShapeStateById(c);d.FlipShapeVertical();MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoFlipVertical",a)}}function UndoFlipHorizontal(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=MyShapesState.Public_GetShapeStateById(c);d.FlipShapeHorizontal();MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoFlipHorizontal",a)}}function UndoShapeRotate(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var c=0;c<arguments.length;c++){var d=arguments[c].Id;var a=arguments[c].Angle;var f=MyShapesState.Public_GetShapeStateById(d);f.RotateShape(a);MyShapesState.Public_SelectShape($("#"+d))}UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.UndoShapeRotate",b)}}function UndoShapeMoveArray(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var f=arguments[b].X;var g=arguments[b].Y;var d=MyShapesState.Public_GetShapeStateById(c);d.MoveDistance(f,g);MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoShapeMoveArray",a)}}function UndoShapeResize(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=arguments[b].ScaleX;var f=arguments[b].ScaleY;var g=MyShapesState.Public_GetShapeStateById(c);g.SetScale(d,f);MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoShapeResize",a)}}function UndoShapeResizeWithMove(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=MyShapesState.Public_GetShapeStateById(c);if(arguments[b].IsSpringable){if(arguments[b].UseClipping){d.ClipHeight=arguments[b].ClipHeight;d.ClipWidth=arguments[b].ClipWidth}MyResizeActions.UndoSpringableResize(arguments[b])}else{d.SetScale(arguments[b].ScaleX,arguments[b].ScaleY)}d.MoveTo(arguments[b].MoveX,arguments[b].MoveY);MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoShapeResizeWithMove",a)}}function UndoCrop(j,l,c,d,b,a,f,g,m,n){try{var k=MyShapesState.Public_GetShapeStateById(j);k.UseClipping=l;k.ClipX=c;k.ClipY=d;k.ClipWidth=b;k.ClipHeight=a;k.CropType=g;k.CropPolygonPointJson=JSON.stringify(f);k.CropPolygonPoint=JSON.parse(k.CropPolygonPointJson);k.X=m;k.Y=n;k.UpdateCropping();k.UpdateDrawing()}catch(h){LogErrorMessage("SvgManip.UndoCrop",h)}}var _SaveWarningNextHandler;var _SaveWarningTimeOut;function ResetSaveWarning(){if(_SaveWarningTimeOut!=null){clearTimeout(_SaveWarningTimeOut)}_SaveWarningTimeOut=setInterval(ShowSaveWarning,15*60*1000);_SaveWarningNextHandler=SaveWarning15Minutes}function ShowSaveWarning(){if(_SaveWarningNextHandler!=null){_SaveWarningNextHandler()}}function SaveWarning15Minutes(){try{var b=MyLangMap.GetTextByToken("warning-please-save-15");if(StoryboardSetup.EnableAutoSave==false){b+="\r\n\r\n"+MyLangMap.GetTextByToken("warning-please-save-auto-save")}swalQueue({title:MyLangMap.GetTextByToken("warning-please-save"),text:b,type:"info",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")});_SaveWarningNextHandler=SaveWarning30Minutes}catch(a){LogErrorMessage("SvgManip.SaveWarning15Minutes",a)}}function SaveWarning30Minutes(){try{var b=MyLangMap.GetTextByToken("warning-please-save-30");if(StoryboardSetup.EnableAutoSave==false){b+="\r\n\r\n"+MyLangMap.GetTextByToken("warning-please-save-auto-save")}swalQueue({title:MyLangMap.GetTextByToken("warning-please-save"),text:b,type:"warning",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")});_SaveWarningNextHandler=SaveWarning45Minutes}catch(a){LogErrorMessage("SvgManip.SaveWarning30Minutes",a)}}function SaveWarning45Minutes(){try{var b=MyLangMap.GetTextByToken("warning-please-save-45");if(StoryboardSetup.EnableAutoSave==false){b+="\r\n\r\n"+MyLangMap.GetTextByToken("warning-please-save-auto-save")}swalQueue({title:MyLangMap.GetTextByToken("warning-please-save"),text:b,type:"error",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")});_SaveWarningNextHandler=null}catch(a){LogErrorMessage("SvgManip.SaveWarning45Minutes",a)}}function FindOrphans(){try{var a=MyPointers.CoreSvg.children();var d=0;for(var f=0;f<a.length;f++){try{var c=a[f];var g=c.getAttribute("id");if(g==null||g.indexOf(SvgPartsEnum.ShapeId)<0){continue}if(MyShapesState.Public_GetShapeStateById(g)==undefined){var h=$("#"+g);h.off("mousedown").on("mousedown",ShapeSelected);h.off("mouseup").on("mouseup",HandleMouseExit);var j=new SvgState(g);j.Public_RecreateFromOrphan();MyShapesState.Public_SetShapeState(g,j);d++}}catch(b){DebugLine("Find Orphans [item]: "+b)}}if(d>0){LogOrphans(d);swalQueue({title:"Issues Found",text:MyLangMap.GetTextLineBreaksByToken("warning-load-failed-orphans"),type:"error",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")});LogErrorMessage("SvgManip.FindOrphans",{message:d,stack:""})}}catch(b){LogErrorMessage("SvgManip.Orphans",b)}}function GetStoryboardSize(){try{var g=MyShapesState.Public_GetAllShapeStates().length;if(g<30){return}if(g>30){var f=GetGlobalById("CoreSvg");var d=(new XMLSerializer()).serializeToString(f);var c=d.length;if(c>3750000){var b=MyLangMap.GetTextLineBreaksByToken("warning-storyboard-too-big");b=b.replace("{totalShapes}",g);b=b.replace("{totalSize}",c);swalQueue({title:"",text:b,type:"warning",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")})}}}catch(a){LogErrorMessage("GetStoryboardSize",a)}}function ShowAdvancedButtons(){var b=CellConfiguration.HasTitle;var a=CellConfiguration.HasDescription;$("#title-caps-btn").prop("disabled",!b);$("#title-emphasis-btn").prop("disabled",!b);$("#advanced-title-text-size").prop("disabled",!b);$("#description-emphasis-btn").prop("disabled",!a);$("#advanced-description-text-size").prop("disabled",!a);MyPointers.Dialog_AdvancedButtons.modal()}var GridLinesGroup="Grid-Lines-Container";function ToggleGridLines(){CloseModal(MyPointers.Dialog_AdvancedButtons);if(HasGridLines()){$("#gridlines-btn").toggleClass("btn-default").toggleClass("btn-danger");RemoveGridLines()}else{$("#gridlines-btn").toggleClass("btn-default").toggleClass("btn-danger");AddGridLines()}}function HasGridLines(){return $("#"+GridLinesGroup).length>0}function AddGridLines(){var g=SvgCreator.CreateSvgGroup(GridLinesGroup);RemoveGridLines();var c="Gray";var d="gainsboro";var l=10;for(var m=0;m<StoryboardContainer.Rows;m++){for(var b=0;b<StoryboardContainer.Cols;b++){var a=CellConfiguration.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCell,m,b);var f=a.Height/l;var h=a.Width/l;for(var j=1;j<l;j++){var k="grid_"+m+"_"+b+"_";var o=a.X+(j*h);var p=a.Y+(j*f);var n=(j==5?1.5:0.5);g.append(SvgCreator.AddLine(o,a.Y,o,a.Y+a.Height,"stroke:"+c+"; stroke-width:"+n+";",k+"_a"));g.append(SvgCreator.AddLine(o,a.Y,o,a.Y+a.Height,"stroke:"+d+" ; stroke-dasharray: 5,5; stroke-width:"+n+";",k+"_a"));g.append(SvgCreator.AddLine(a.X,p,a.X+a.Width,p,"stroke:"+c+" ; stroke-width:"+n+";",k+"_c"));g.append(SvgCreator.AddLine(a.X,p,a.X+a.Width,p,"stroke:"+d+" ; stroke-dasharray: 5,5; stroke-width:"+n+";",k+"_c"))}}}MyPointers.CoreSVG_SvgTop.append(g)}function RemoveGridLines(){$("#"+GridLinesGroup).remove()}function AddKeypadSymbol(b){if(UseQuill){SbtQuillHelper.JamText(b)}else{if(UseSummerNote){SbtSummerNoteHelper.JamText(b)}else{if(UseInlineEditor){SbtInlineEditorHelper.JamText(b)}else{var a=$("#textableText");$.keypad.insertValue(a,b);SetTextableText();a.focus()}}}}function Silhoutte(a){var b=$("#"+a);FadeToSilhoutte(b)}function FadeToSilhoutte(c){var b=false;if(c.attr("fill")=="white"||c.attr("fill")=="#FFF"||c.attr("fill")=="#FFFFFF"||c.attr("fill")=="#FFFFFC"){b=true}if(c.attr("fill")=="none"){b=true}if(b==false){if(c.attr("fill")=="white"){c.attr("stroke","black")}c.attr("fill","black")}for(var a=0;a<c.children().length;a++){FadeToSilhoutte($(c.children()[a]))}}function AddExtraLayoutCells(b,a){if(b){if(StoryboardContainer.MaxRows==10){swalQueue({title:"",text:MyLangMap.GetTextLineBreaksByToken("warning-limit-rows"),type:"info",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")});return}StoryboardContainer.MaxRows++}if(a){if(StoryboardContainer.MaxCols==10){swalQueue({title:"",text:MyLangMap.GetTextLineBreaksByToken("warning-limit-cols"),type:"info",confirmButtonText:MyLangMap.GetTextByToken("warning-ok-button")});return}StoryboardContainer.MaxCols++}UpdateChangeCellCountSelector()}function UpdateChangeCellCountSelector(){var c=$("#LayoutButtonHolder");var g=parseInt(MyPointers.Dialog_ChangeLayout.attr("rows"));var f=parseInt(MyPointers.Dialog_ChangeLayout.attr("cols"));StoryboardContainer.MaxRows=Math.max(StoryboardContainer.MaxRows,StoryboardContainer.Rows);StoryboardContainer.MaxCols=Math.max(StoryboardContainer.MaxCols,StoryboardContainer.Cols);c.css("width",(StoryboardContainer.MaxCols*60)+"px");c.children().remove();for(var d=1;d<=StoryboardContainer.MaxRows;d++){for(var a=1;a<=StoryboardContainer.MaxCols;a++){var b="ChangeLayoutButton ";if(d<=StoryboardContainer.Rows&&a<=StoryboardContainer.Cols){b+="used "}if(d<=g&&a<=f){b+=" added"}c.append("<a id='changelayoutcell_"+d+""+a+"' class='"+b+"' onclick='ConfigureStoryboardCells("+d+","+a+")'>"+a+" x "+d+"</a> ")}c.append("<br>")}}function PrepareChangeLayoutDialog(){try{UpdateChangeCellCountSelector();$("#change-cell-count-too-many").hide();$("#change-cell-lose-content").hide();var b,c;MyPointers.Dialog_ChangeLayout.find("a.ChangeLayoutButton").removeClass("used added");for(b=0;b<StoryboardContainer.Rows;b++){for(c=0;c<StoryboardContainer.Cols;c++){$("#changelayoutcell_"+(b+1)+(c+1)).addClass("used added")}}MyPointers.Dialog_ChangeLayout.attr("rows",StoryboardContainer.Rows.toString()).attr("cols",StoryboardContainer.Cols.toString())}catch(a){LogErrorMessage("SvgManip.PrepareChangeLayoutDialog",a)}}function ConfigureStoryboardCells(g,a){try{var d,f;MyPointers.Dialog_ChangeLayout.attr("rows",g.toString()).attr("cols",a.toString());MyPointers.Dialog_ChangeLayout.find("a.ChangeLayoutButton").removeClass("added");for(d=0;d<g;d++){for(f=0;f<a;f++){$("#changelayoutcell_"+(d+1)+(f+1)).addClass("added")}}var b=MyPointers.Dialog_ChangeLayout.find("a.ChangeLayoutButton.used:not(.added)").length;$("#change-cell-count-too-many-message").text(b+" ");$("#change-cell-lose-content").hide();if(b>0){$("#change-cell-lose-content").show()}$("#change-cell-count-too-many").hide();if(g*a>24){$("#change-cell-count-too-many").show()}}catch(c){LogErrorMessage("SvgManip.ConfigureStoryboardCells",c)}}function CancelChangeLayout(){MyPointers.Dialog_ChangeLayout.modal("hide")}function ConfirmChangeLayout(){try{var c=parseInt(MyPointers.Dialog_ChangeLayout.attr("rows"));var a=parseInt(MyPointers.Dialog_ChangeLayout.attr("cols"));MyPointers.Dialog_ChangeLayout.modal("hide");if((c===StoryboardContainer.Rows)&&(a===StoryboardContainer.Cols)){return}CheckForLayoutAccessPreRefresh(c,a,true)}catch(b){LogErrorMessage("SvgManip.ConfirmChangeLayout",b)}}function ChangeLayoutPostAccessCheck(c,a){try{if((c<StoryboardContainer.Rows||a<StoryboardContainer.Cols)&&StoryboardContainer.Public_FindOutOfBoundContent(c,a).length>0){if(confirm(MyLangMap.GetTextByToken("warning-shrinking-storyboard"))==false){return}}StoryboardContainer.CreateRowsAndCells(c,a);StoryboardContainer.UpdateImageAttributions();if(HasGridLines()){AddGridLines()}}catch(b){LogErrorMessage("SvgManip.ChangeLayoutPostAccessCheck",b)}}function CheckForLayoutAccessPreRefresh(d,a,c){try{if(StoryboardContainer.IsFreeLayoutConfiguration(d,a)){ChangeLayoutPostAccessCheck(d,a);return}if(MyUserPermissions.EnableAllCellOptions){ChangeLayoutPostAccessCheck(d,a);return}MyUserPermissions.Public_RefreshPermissions(false,function(){CheckForLayoutAccessPostRefresh(d,a,c)})}catch(b){LogErrorMessage("SvgManip.CheckForLayoutAccessOnLayoutChange",b)}}function CheckForLayoutAccessPostRefresh(d,a,c){try{if(MyUserPermissions.EnableAllCellOptions){ChangeLayoutPostAccessCheck(d,a);return}if(MyUserPermissions.IsLoggedOn==false){if(c){HandleLoginCloseFunction=function(){CheckForLayoutAccessPreRefresh(d,a,false)};showLogonDialog();return}}MyPointers.Dialog_PurchasePopForMoreLayouts.modal()}catch(b){LogErrorMessage("SvgManip.CheckForUploadAccessPostRefresh",b)}}function CheckForLayoutAccessOnStoryboardCopy(d,a,c){try{if(StoryboardContainer.IsFreeLayoutConfiguration(d,a)){return}if(MyUserPermissions.EnableAllCellOptions){return}MyUserPermissions.Public_RefreshPermissions(false,function(){CheckForLayoutAccessOnCopyPostRefresh(d,a,c)})}catch(b){LogErrorMessage("SvgManip.CheckForLayoutAccessOnStoryboardCopy",b)}}function CheckForLayoutAccessOnCopyPostRefresh(d,a,c){try{if(MyUserPermissions.EnableAllCellOptions){ChangeLayoutPostAccessCheck(d,a);return}if(MyUserPermissions.IsLoggedOn==false){if(c){HandleLoginCloseFunction=function(){CheckForLayoutAccessOnStoryboardCopy(d,a,false)};showLogonDialog();return}}MyPointers.Dialog_PurchasePopForMoreLayoutsOnCopy.modal()}catch(b){LogErrorMessage("SvgManip.CheckForLayoutAccessOnCopyPostRefresh",b)}}function TurnOnWorksheets(a){swalQueue({title:"Make a worksheet?",text:"Worksheets is a new concept we are testing... it is a little buggy, but really awesome!  Please send us feedback at beta@storyboardthat.com :).",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"Make a Worksheet!",cancelButtonText:"No Thanks!",closeOnConfirm:true},function(b){if(b===false){return}ChangeCellLayoutType(a,false,false)})}function ChangeCellLayoutType(d,c,b,f){try{if(d==null){d=StoryboardContainer.GetLayoutType()}if(d==StoryboardLayoutType.StoryboardGrid||MyUserPermissions.EnableAllCellOptions){ChangeCellLayoutTypePostCheck(d,c,b,f);return}CheckForChangeCellLayoutTypePreRefresh(d,c,b,true,f)}catch(a){LogErrorMessage("SvgManip.ChangeCellLayoutType",a)}}function CheckForChangeCellLayoutTypePreRefresh(d,c,b,g,f){try{MyUserPermissions.Public_RefreshPermissions(false,function(){CheckForChangeCellLayoutTypePostRefresh(d,c,b,g,f)})}catch(a){LogErrorMessage("SvgManip.CheckForChangeCellLayoutTypePreRefresh",a)}}function CheckForChangeCellLayoutTypePostRefresh(d,c,b,g,f){try{if(MyUserPermissions.EnableAllCellOptions){ChangeCellLayoutTypePostCheck(d,c,b,f);return}if(MyUserPermissions.IsLoggedOn==false){if(g){HandleLoginCloseFunction=function(){CheckForChangeCellLayoutTypePreRefresh(d,c,b,false,f)};showLogonDialog();return}}MyPointers.Dialog_PurchasePopForMoreStoryboardLayouts.modal()}catch(a){LogErrorMessage("SvgManip.CheckForUploadAccessPostRefresh",a)}}function ChangeCellLayoutTypePostCheck(f,b,a,g){StoryboardContainer.SetCoreSvgDimensions();if(g===undefined){g=null}var d=CellConfiguration.HasTitle;var c=CellConfiguration.HasDescription;var j=StoryboardContainer.GetLayoutType();f=f||j;b=(b!=null)?b:d;a=(a!=null)?a:c;var k=CellConfiguration.GetScale();if(VerifyChangeCellLayout(f,j)==false){return}if(f==StoryboardLayoutType.Frayer&&(CellConfiguration.LayoutType==StoryboardLayoutType.Spider||CellConfiguration.LayoutType==StoryboardLayoutType.Cycle)){var l=MyLayoutFactory.GetLayout(StoryboardLayoutType.StoryboardGrid,b,a,k,g);SwapCellConfigurations(l);if(VerifyChangeCellLayout(f)==false){return}}$("#addcell-btn").html('<span style="background:none" aria-hidden="true" class="icon isbt-addcell"></span> '+MyLangMap.GetTextByToken("button-add-cells"));$("#addcell-btn").prop("disabled",false);if(f==StoryboardLayoutType.Frayer){ChangeLayoutToFrayerPreSetup()}if(f==StoryboardLayoutType.Timeline){k=ChangeLayoutToTimelinePreSetup(k);g=new Object();g.TimelineDates=TimelineDateManager.GetSelectedDates(StoryboardContainer.Cols)}if(f==StoryboardLayoutType.Spider||f==StoryboardLayoutType.Cycle){k=ChangeLayoutToSpiderPreSetup(k)}var h=MyLayoutFactory.GetLayout(f,b,a,k,g);SwapCellConfigurations(h);if(HasGridLines()){AddGridLines()}CloseChangeStoryboardTypeDialog();if(f==StoryboardLayoutType.Timeline&&j!=StoryboardLayoutType.Timeline){ChangeLayoutDialog()}if(f==StoryboardLayoutType.Movie&&j!=StoryboardLayoutType.Movie){SwapSceneCategory(true)}if(j==StoryboardLayoutType.Movie&&f!=StoryboardLayoutType.Movie){SwapSceneCategory(false)}if(StoryboardContainer.IsPaperTypeLayout()){ShowBothSceneCategories();if(MyShapesState.Public_GetAllShapeStates().length==0){ChangeLayoutPostAccessCheck(1,1)}}UndoManager.register(undefined,ChangeCellLayoutType,[j,d,c],undefined,"",ChangeCellLayoutType,[f,b,a])}function FreeSizeLayoutRequest(f,b,d){try{f=Math.max(75,f);b=Math.max(75,b);var c=new Object();c.CellHeight=Number(b);c.CellWidth=Number(f);c.StrokeWidth=Number(d);ChangeCellLayoutType(StoryboardLayoutType.FreeSize,null,null,c)}catch(a){LogErrorMessage("SvgManip.FreeSizeLayoutRequest",e)}}function FreeStyleFromForm(c){try{var d=$("#"+c+"free-style-width").val();var b=$("#"+c+"free-style-height").val();FreeSizeLayoutRequest(d,b,0)}catch(a){LogErrorMessage("SvgManip.FreeStyleFromForm",e)}}function SwapCellConfigurations(a){StoryboardContainer.ChangeCellConfiguration_MoveShapes(CellConfiguration,a);CellConfiguration=a;StoryboardContainer.ChangeCellCellLayout();StoryboardContainer.SetLayoutType();StoryboardContainer.UpdateImageAttributions()}function ChangeLayoutToFrayerPreSetup(){StoryboardContainer.CreateRowsAndCells(2,2);$("#addcell-btn").prop("disabled",true)}function ChangeLayoutToTimelinePreSetup(a){a=ChangeLayoutFlattenAndShrink(a);$("#addcell-btn").html('<i class="icon isbt-addcell"></i> '+MyLangMap.GetTextByToken("button-timeline-dates"));return a}function ChangeLayoutToSpiderPreSetup(a){return ChangeLayoutFlattenAndShrink(a)}function SwapSceneCategory(f){var c=$("#parent-category-14");var d=$("#parent-category-a-14");var a=$("#parent-category-96");var b=$("#parent-category-a-96");if(f){b.trigger("click");c.hide();a.show()}else{d.trigger("click");c.show();a.hide()}}function ShowBothSceneCategories(){var b=$("#parent-category-14");var a=$("#parent-category-96");if($("#parent-category-a-96").text().indexOf("16")<0){$("#parent-category-a-96").text("16x9 - "+$("#parent-category-96").text())}b.show();a.show()}function ChangeLayoutFlattenAndShrink(f){if(f==1){f=316/372;ExpandCells(f,f,false)}if(StoryboardContainer.Rows>1){var c=StoryboardContainer.Cols;var g=Math.min(10,StoryboardContainer.Rows*StoryboardContainer.Cols);StoryboardContainer.CreateRowsAndCells(StoryboardContainer.Rows,g);var b=[];for(var d=1;d<StoryboardContainer.Rows;d++){for(var a=0;a<c;a++){b.push({oldCol:a,oldRow:d,newCol:(d*c)+a,newRow:0})}}MoveCellHelper.RearrangeCells(b);StoryboardContainer.CreateRowsAndCells(1,g)}if(StoryboardContainer.Cols<3){StoryboardContainer.CreateRowsAndCells(1,3)}return f}function VerifyChangeCellLayout(a,b){if(a==StoryboardLayoutType.Frayer){if(StoryboardContainer.Public_FindOutOfBoundContent(2,2).length>0){return confirm("Changing to a Frayer Model will make your storyboard 2x2.\r\n\r\nYou will lose all content outside of the window.  Are you sure you want to change layout type?")}}if(a==StoryboardLayoutType.Spider){if(StoryboardContainer.Rows*StoryboardContainer.Cols>10){return confirm("Changing to a Spider Map will remove cells in excess of 10.  Are you sure you want to do this?")}}if(a==StoryboardLayoutType.Cycle){if(StoryboardContainer.Rows*StoryboardContainer.Cols>10){return confirm("Changing to a Cycle will remove cells in excess of 10.  Are you sure you want to do this?")}}if(a==StoryboardLayoutType.Timeline){if(StoryboardContainer.Rows*StoryboardContainer.Cols>10){return confirm("Changing to a Timeline remove cells in excess of 10.  Are you sure you want to do this?")}}if(b==StoryboardLayoutType.Movie&&a!=b){return confirm("Changing from a 16x9 layout may cause items to be out of the cell.  Are you sure you want to do this?")}return true}function ChangeCellCountForSpider(a,b){if(a<StoryboardContainer.Cols){if(confirm("Reducing the amount of cells in a Spider Map may result in losing content.  There is no undo.\r\nAre you sure you want to remove cells?")==false){return}}var c=MyLayoutFactory.GetLayout(StoryboardLayoutType.StoryboardGrid,CellConfiguration.HasTitle,CellConfiguration.HasDescription,CellConfiguration.GetScale(),null);SwapCellConfigurations(c);StoryboardContainer.CreateRowsAndCells(1,a);var c=MyLayoutFactory.GetLayout(StoryboardLayoutType.Spider,CellConfiguration.HasTitle,CellConfiguration.HasDescription,CellConfiguration.GetScale(),null);SwapCellConfigurations(c);CloseBasicDialog("ChangeCellCountSpider")}function ChangeCellCountForCycle(a){if(a<StoryboardContainer.Cols){if(confirm("Reducing the amount of cells in a Cycle Map may result in losing content.  There is no undo.\r\nAre you sure you want to remove cells?")==false){return}}var b=MyLayoutFactory.GetLayout(StoryboardLayoutType.StoryboardGrid,CellConfiguration.HasTitle,CellConfiguration.HasDescription,CellConfiguration.GetScale(),null);SwapCellConfigurations(b);StoryboardContainer.CreateRowsAndCells(1,a);var b=MyLayoutFactory.GetLayout(StoryboardLayoutType.Cycle,CellConfiguration.HasTitle,CellConfiguration.HasDescription,CellConfiguration.GetScale(),null);SwapCellConfigurations(b);CloseBasicDialog("ChangeCellCountCycle")}function ChangeDatesForTimeline(){if(TimelineDateManager.Cols<StoryboardContainer.Cols){if(confirm("Reducing the amount of cells in a Timeline may result in losing content.  There is no undo.\r\nAre you sure you want to remove cells?")==false){return}}StoryboardContainer.Cols=TimelineDateManager.Cols;var a=new Object();a.TimelineDates=a.TimelineDates=TimelineDateManager.GetSelectedDates(StoryboardContainer.Cols);var b=MyLayoutFactory.GetLayout(StoryboardLayoutType.Timeline,CellConfiguration.HasTitle,CellConfiguration.HasDescription,CellConfiguration.GetScale(),a);SwapCellConfigurations(b);CloseBasicDialog("ChangeCellCountTimeline")}function HideKeyboard(){$("#textableText").toggle();$("#expandKeyboard").toggle();$("#collapseKeyboard").toggle()}function CloseModal(b){try{if(b.hasClass("in")){b.modal("toggle")}}catch(a){LogErrorMessage("SvgManip.CloseModal",a)}}function ClearSelections(){try{if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else{if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}}else{if(document.selection){document.selection.empty()}}}catch(a){LogErrorMessage("SvgManip.ClearSelections",a)}}function ShowDimensions(){var c=$("#storyboard-container-outer-div");var h=MyPointers.Tabs.width();var g=window.innerHeight-(MyPointers.Tabs.outerHeight()+MyPointers.BottomControls.outerHeight());var a=GetGlobalById("CoreSvg").getBoundingClientRect();var f=(a.width-2);var d=(a.height-2);var b="Window width: "+h+"\r\n";b+="Window height: "+g+"\r\n";b+="\r\n";b+="Wrapper Width: "+c.width()+"\r\n";b+="Wrapper Height: "+c.height()+"\r\n";b+="\r\n";b+="svgContainer width: "+MyPointers.SvgContainer.width()+"\r\n";b+="svgContainer height: "+MyPointers.SvgContainer.height()+"\r\n";b+="\r\n";b+="svg Width: "+f+"\r\n";b+="svg Height: "+d+"\r\n";b+="\r\n";b+="svg Margin: "+MyPointers.CoreSvg.css("margin")+"\r\n";b+="svg Overflow: "+MyPointers.CoreSvg.css("overflow")+"\r\n";alert(b)}function LoadFreeSizeDialog(){CloseBasicDialog("StoryboardTypeDialog");$("#FreeSizeDialog").modal()};function IdGenerator(){this.GenerateDescriptionCellId=function(b,a){return"c_descr_R"+b+"C"+a};this.GenerateTitleCellId=function(b,a){return"c_title_R"+b+"C"+a};this.GenerateCellId=function(b,a){return"cell_R"+b+"C"+a};this.GenerateStoryboardTitleId=function(b,a){return"c_storyboardTitle_"+b+"_"+a};this.GenerateAttibutionAreaId=function(){return"c_attribution_area"};this.GenerateCellOverlayId=function(c,a,b){return"cell-overlay-r"+c+"c"+a+"p"+b}};window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction;window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;function LocalDbHelper(){if(!(this instanceof LocalDbHelper)){return new LocalDbHelper()}var c=function(d){window.indexedDB=void 0;ga("send","event","Storyboard Creator","No LocalDB Support",navigator.userAgent);DebugLine("LocalDB disabled");LogErrorMessage("(self-heal) LocalDbHelper disabled");c=function(){}};var b=function(d,l,i,g){var h=function(o){var e=d(o);if(e==null){i()}else{e.onsuccess=function(p){l(p)};e.onfailure=function(p){i(p)};e.onerror=function(p){g(p)}}};if(!window.indexedDB){c();i();return}try{var k="StoryboardDB";var n=2;var j=window.indexedDB.open(k,n);if(j==null){c();throw true}var m=this;j.onsuccess=function(o){var e=j.result;if(!e.objectStoreNames.contains("Storyboard")){e.createObjectStore("Storyboard",{keyPath:"userId"})}h(e)};j.onupgradeneeded=function(o){var e=o.target.result;if(!e.objectStoreNames.contains("Storyboard")){e.createObjectStore("Storyboard",{keyPath:"userId"})}};j.onerror=function(e){i();if(j.error&&j.error.name==="InvalidStateError"){e.preventDefault()}};j.onblocked=function(e){i()}}catch(f){if(window.indexedDb){LogErrorMessage("Failed to init local db",f);c()}i()}};var a=function(d,g,f,e){b(d,g,f,e)};this.clearDatabase=function(f){f=f||function(){};try{a(function(e){return e.deleteObjectStore("Storyboard")},function(e){f(true)},function(e){f(false)},function(e){f(false)})}catch(d){LogErrorMessage("LocalDbHelper.clearDatabase",d);f(false)}};this.Save=function(i,h,d,g){g=g||function(){};try{a(function(e){return e.transaction(["Storyboard"],"readwrite").objectStore("Storyboard").put({userId:i,storyboard_name:h,content:d})},function(e){g(true)},function(e){g(false)},function(e){g(false)})}catch(f){LogErrorMessage("LocalDbHelper.Save",f);g(false)}};this.CheckUser=function(g,f){f=f||function(){};try{a(function(e){return e.transaction(["Storyboard"]).objectStore("Storyboard").get(g)},function(e){if(e.target.result===void 0){f(false,null)}else{f(true,e.target.result.storyboard_name)}},function(e){f(false,null)},function(e){f(false,null)})}catch(d){LogErrorMessage("LocalDbHelper.CheckUser",d);f(false,null)}};this.Load=function(g,f){f=f||function(){};try{a(function(e){return e.transaction(["Storyboard"]).objectStore("Storyboard").get(g)},function(e){(e.target.result===void 0)?f(null):f(e.target.result.content)},function(e){f(null)},function(e){f(null)})}catch(d){LogErrorMessage("LocalDbHelper.Load",d);f(null)}};this.Delete=function(g,f){f=f||function(){};try{a(function(e){e.transaction(["Storyboard"],"readwrite").objectStore("Storyboard")["delete"](g)},function(e){f(true)},function(e){f(false)},function(e){f(false)})}catch(d){LogErrorMessage("LocalDbHelper.Delete",d);f(false)}}};var CropHelper=function(){var e=new Object();var q=new Object();q.CropType=CropTypeEnum.Standard;q.CroppedImageCopyId="CroppedImageCopy";q.OriginalShapeId="";q.CropLeft=0;q.CropTop=0;q.CropHeight=0;q.CropWidth=0;q.CropRatio=1;q.CropViewScale;q.ClipScale;q.ImageWidth=0;q.ImageHeight=0;q.CropAction="";q.ResizePageX=0;q.ResizePageY=0;q.CropResizeDirection="";q.CircleSizeRatio=1;q.move_delta={x:0,y:0};q.rotate_center={x:0,y:0};q.rotate_alpha=0;q.scale={x:1,y:1};q.CellPosition={};q.CropPolygonPoint=[{x:0,x:0},{x:150,y:0},{x:150,y:100},{x:0,y:100}];q.CropPolygonPointSelectedID="";q.EllipseCX=75;q.EllipseCY=50;q.EllipseRX=75;q.EllipseRY=50;function w(){q.EllipseRX=q.CropWidth/2;q.EllipseRY=q.CropHeight/2;q.EllipseCX=q.CropLeft+q.EllipseRX;q.EllipseCY=q.CropTop+q.EllipseRY}function n(y){return function(z){CropHelper.PrepareShapePostModal(y)}}function r(y){StoryboardContainer.UpdateGradientIds(y);y.attr("id",q.CroppedImageCopyId);y.attr("class","");y.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").remove();y.find("[id$='"+SvgPartsEnum.CropGroup+"']").removeAttr("clip-path").attr("id",q.CroppedImageCopyId+SvgPartsEnum.CropGroup);var z=y.find("[id$='"+SvgPartsEnum.Scale+"']").attr("id",q.CroppedImageCopyId+SvgPartsEnum.Scale);y.find("[id$='"+SvgPartsEnum.Natural+"']").attr("id",q.CroppedImageCopyId+SvgPartsEnum.Natural)}function h(y){var B=y.UseClipping;y.UseClipping=false;var A=y.Public_GetImaginaryOuterBox();y.UseClipping=B;var z=e.GetMoveVectorForRotatedObject(y);return{W:A.Right-A.Left,H:A.Bottom-A.Top,X:A.Left-z.x,Y:A.Top-z.y}}e.PrepareShapePostModal=function(z){var E=$("#CropAreaSvg");var D=$("#"+z.Id).clone();StoryboardContainer.UpdateGradientIds(D);q.CropAction="";q.OriginalShapeId=z.Id;r(D);E.children().remove();var F=h(z);var N=StoryboardContainer.GetAllLayoutParts(CellConfiguration);q.CellPosition=StoryboardContainer._GetLayoutPartForShape(N,z);var U=q.CellPosition?StoryboardContainer.GetShapeStatesForCell(q.CellPosition.Row,q.CellPosition.Col):null;var A=z.Public_GetImaginaryOuterBox();var C=GetGlobalById(z.Id).getBBox();q.FlipHorizontal=z.FlipHorizontal;q.FlipVertical=z.FlipVertical;q.move_delta={x:z.X,y:z.Y};q.rotate_center={x:C.width/2,y:C.height/2};q.rotate_alpha=z.Angle;q.scale={x:z.ScaleX,y:z.ScaleY};if(U){for(var M=0;M<U[StoryboardPartTypeEnum.StoryboardCell].length;M++){var y=U[StoryboardPartTypeEnum.StoryboardCell][M];if(y.Id!=z.Id){var V=$("#"+y.Id).clone();V.attr("opacity","0.4");E.append(V)}}}E.append(D);var O=GetGlobalById(q.CroppedImageCopyId+SvgPartsEnum.Scale).getBBox();q.ImageWidth=O.width;q.ImageHeight=O.height;q.CropViewScale=1;q.CropLeft=0;q.CropTop=0;q.CropWidth=O.width;q.CropHeight=O.height;q.CropRatio=q.CropHeight/q.CropWidth;q.CropPolygonPoint=[{x:0,y:0},{x:0,y:O.height},{x:O.width,y:O.height},{x:O.width,y:0}];q.EllipseRX=q.CropWidth/2;q.EllipseRY=q.CropHeight/2;q.EllipseCX=q.CropLeft+q.EllipseRX;q.EllipseCY=q.CropTop+q.EllipseRY;if(z.UseClipping&&z.CropType==q.CropType){switch(z.CropType){case CropTypeEnum.Circle:case CropTypeEnum.Standard:q.CropLeft=z.ClipX;q.CropTop=z.ClipY;q.CropWidth=z.ClipWidth;q.CropHeight=z.ClipHeight;if(z.CropType==CropTypeEnum.Circle){w()}break;case CropTypeEnum.Advanced:if(z.CropPolygonPoint){for(M=0;M<z.CropPolygonPoint.length;M++){q.CropPolygonPoint[M]={x:z.CropPolygonPoint[M].x,y:z.CropPolygonPoint[M].y}}}break}}var K=F.X-10;var L=F.Y-10;var J=F.W+20;var G=F.H+20;document.getElementById("CropAreaSvg").setAttribute("viewBox",K+" "+L+" "+J+" "+G);var I=Math.round($(window).width()*8/10);var H=Math.round($(window).height()*8/10)-65;var P=I>H?H:I;var R=P,Q=P;if(q.CropType==CropTypeEnum.Standard){if(J<G){R=P*J/G}else{Q=P*G/J}}$("#CropArea").css("text-align","center");$("#CropModalDialog").css("display","inline-block");$("#CropModalDialog").css("width","auto");$("#CropModalDialog").css("min-width",550);var W=20;E.attr("width",R-W);E.attr("height",Q-W);var T=E.attr("width")/J;var S=E.attr("height")/G;E.mousemove(j());E.mouseleave(u());E.mouseup(u());E.mousedown(s());E.css("cursor","hand");q.CropViewScale=T<S?T:S;q.CircleSizeRatio=z.ScaleX<z.ScaleY?1/z.ScaleX:1/z.ScaleY;q.CircleSizeRatio/=q.CropViewScale;b()};function b(){var y=$("#croppedImageCopy_ClipArea");if(y!==null||y.length>0){y.detach()}y=SvgCreator.CreateSvgGroup("croppedImageCopy_ClipArea");$("#"+q.CroppedImageCopyId+SvgPartsEnum.Scale).append(y);switch(q.CropType){case CropTypeEnum.Standard:y.appendChild(SvgCreator.AddRect(q.CropLeft,q.CropTop,q.CropWidth,q.CropHeight,"black","red","4,4",".25","CropAreaBox"));break;case CropTypeEnum.Advanced:y.appendChild(SvgCreator.AddPolygon(q.CropPolygonPoint,"black","red","4,4","1",".25","CropAreaBoxAdvanced",null));break;case CropTypeEnum.Circle:y.appendChild(SvgCreator.AddEllipse(q.EllipseCX,q.EllipseCY,q.EllipseRX,q.EllipseRY,"black","red","4,4",".25","CropAreaEllipse"));y.appendChild(SvgCreator.AddRect(q.CropLeft,q.CropTop,q.CropWidth,q.CropHeight,"black","red","4,4",".25","CropAreaBox"));break}if(MyBrowserProperties.IsMobile){c(y,15)}else{c(y,5)}}function f(A,y){var z="";switch(A){case ResizeEnum.NE:y+=45;y%=360;break;case ResizeEnum.SW:y+=225;y%=360;break;case ResizeEnum.SE:y+=135;y%=360;break;case ResizeEnum.NW:y+=315;y%=360;break;case ResizeEnum.W:y+=270;y%=360;break;case ResizeEnum.N:y%=360;break;case ResizeEnum.S:y+=180;y%=360;break;case ResizeEnum.E:y+=90;y%=360;break}if(Math.abs(y-90)<EPS_ANGLE||Math.abs(y-270)<EPS_ANGLE){return"H"}if(Math.abs(y)<EPS_ANGLE||Math.abs(y-180)<EPS_ANGLE){return"V"}z="NE";if(y>=90&&y<180){z="NW"}else{if(y>=180&&y<270){z="NE"}else{if(y>=270){z="NW"}}}return z}function c(C,z){var z=z*q.CircleSizeRatio;var I="#AAA393";var B="#6285C7";if(q.CropType==CropTypeEnum.Standard||q.CropType==CropTypeEnum.Circle){var E=q.CropLeft;var H=q.CropWidth+q.CropLeft;var J=q.CropTop;var A=q.CropHeight+q.CropTop;C.appendChild(SvgCreator.AddCircle(E,J,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_NW,"Resize".concat(f(ResizeEnum.NW,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(H,J,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_NE,"Resize".concat(f(ResizeEnum.NE,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(E,A,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_SW,"Resize".concat(f(ResizeEnum.SW,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(H,A,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_SE,"Resize".concat(f(ResizeEnum.SE,q.rotate_alpha))));var y=B;B=I;I=y;var F=(E+H)/2;var G=(J+A)/2;C.appendChild(SvgCreator.AddCircle(F,J,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_N,"Resize".concat(f(ResizeEnum.N,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(F,A,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_S,"Resize".concat(f(ResizeEnum.S,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(E,G,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_W,"Resize".concat(f(ResizeEnum.W,q.rotate_alpha))));C.appendChild(SvgCreator.AddCircle(H,G,z,I,B,q.CroppedImageCopyId+SvgPartsEnum.Selector_E,"Resize".concat(f(ResizeEnum.E,q.rotate_alpha))));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_N,t(ResizeEnum.N));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_S,t(ResizeEnum.S));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_E,t(ResizeEnum.E));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_W,t(ResizeEnum.W));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_NE,t(ResizeEnum.NE));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_NW,t(ResizeEnum.NW));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_SE,t(ResizeEnum.SE));o(q.CroppedImageCopyId+SvgPartsEnum.Selector_SW,t(ResizeEnum.SW));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_N,l(ResizeEnum.N));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_S,l(ResizeEnum.S));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_E,l(ResizeEnum.E));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_W,l(ResizeEnum.W));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_NE,l(ResizeEnum.NE));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_NW,l(ResizeEnum.NW));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_SE,l(ResizeEnum.SE));p(q.CroppedImageCopyId+SvgPartsEnum.Selector_SW,l(ResizeEnum.SW));p("CropAreaBox",k())}if(q.CropType==CropTypeEnum.Advanced){var D;for(D=0;D<q.CropPolygonPoint.length;D++){C.appendChild(SvgCreator.AddCircle(q.CropPolygonPoint[D].x,q.CropPolygonPoint[D].y,z,I,B,q.CroppedImageCopyId+"_advan_circle"+D,"MoveObject"));o(q.CroppedImageCopyId+"_advan_circle"+D,t(ResizeEnum.NSEW,D));p(q.CroppedImageCopyId+"_advan_circle"+D,l(ResizeEnum.NSEW,D))}p("CropAreaBoxAdvanced",k())}}function o(y,z){$("#"+y).mousedown(z)}function p(y,z){inputAdapter.EnableMove($("#"+y),z)}function x(){if(q.CropType==CropTypeEnum.Standard||q.CropType==CropTypeEnum.Circle){var z=$("#CropAreaBox");var J=$("#"+q.CroppedImageCopyId+SvgPartsEnum.Selector_NW);var I=$("#"+q.CroppedImageCopyId+SvgPartsEnum.Selector_NE);var N=$("#"+q.CroppedImageCopyId+SvgPartsEnum.Selector_SW);var M=$("#"+q.CroppedImageCopyId+SvgPartsEnum.Selector_SE);var H=$("#"+q.CroppedImageCopyId+"_n_circle ");var L=$("#"+q.CroppedImageCopyId+"_s_circle ");var P=$("#"+q.CroppedImageCopyId+"_w_circle ");var D=$("#"+q.CroppedImageCopyId+"_e_circle ");var E=q.CropLeft;var K=q.CropWidth+q.CropLeft;var O=q.CropTop;var y=q.CropHeight+q.CropTop;var F=(E+K)/2;var G=(O+y)/2;SvgCreator.UpdateRectangle(z,q.CropLeft,q.CropTop,q.CropWidth,q.CropHeight);SvgCreator.UpdateCircle(J,E,O);SvgCreator.UpdateCircle(I,K,O);SvgCreator.UpdateCircle(N,E,y);SvgCreator.UpdateCircle(M,K,y);SvgCreator.UpdateCircle(H,F,O);SvgCreator.UpdateCircle(L,F,y);SvgCreator.UpdateCircle(P,E,G);SvgCreator.UpdateCircle(D,K,G);if(q.CropType==CropTypeEnum.Circle){var B=$("#CropAreaEllipse");q.EllipseRX=q.CropWidth/2;q.EllipseRY=q.CropHeight/2;q.EllipseCX=q.CropLeft+q.EllipseRX;q.EllipseCY=q.CropTop+q.EllipseRY;SvgCreator.UpdateEllipse(B,q.EllipseCX,q.EllipseCY,q.EllipseRX,q.EllipseRY)}}if(q.CropType==CropTypeEnum.Advanced){var A=$("#CropAreaBoxAdvanced");SvgCreator.UpdatePolygon(A,q.CropPolygonPoint);for(i=0;i<q.CropPolygonPoint.length;i++){var C=$("#"+q.CroppedImageCopyId+"_advan_circle"+i);SvgCreator.UpdateCircle(C,q.CropPolygonPoint[i].x,q.CropPolygonPoint[i].y)}}}function v(z,A){if(q.CropType==CropTypeEnum.Standard||q.CropType==CropTypeEnum.Circle){switch(q.CropResizeDirection){case ResizeEnum.W:case ResizeEnum.NW:case ResizeEnum.SW:q.CropLeft+=z;q.CropWidth-=z;break;case ResizeEnum.E:case ResizeEnum.NE:case ResizeEnum.SE:q.CropWidth+=z;break}switch(q.CropResizeDirection){case ResizeEnum.N:case ResizeEnum.NW:case ResizeEnum.NE:q.CropTop+=A;q.CropHeight-=A;break;case ResizeEnum.S:case ResizeEnum.SW:case ResizeEnum.SE:q.CropHeight+=A;break}if(q.CropType==CropTypeEnum.Circle){q.EllipseRX=q.CropWidth/2;q.EllipseRY=q.CropHeight/2;q.EllipseCX=q.CropLeft+q.EllipseRX;q.EllipseCY=q.CropTop+q.EllipseRY}}if(q.CropType==CropTypeEnum.Advanced){if(q.CropPolygonPoint.length>=4){var y=(q.CropPolygonPointSelectedID+2)%4;a=q.CropPolygonPointSelectedID;if(Math.abs(q.CropPolygonPoint[a].x-q.CropPolygonPoint[y].x+z)+Math.abs(q.CropPolygonPoint[a].y-q.CropPolygonPoint[y].y+A)<30){return}}q.CropPolygonPoint[q.CropPolygonPointSelectedID].x+=z;q.CropPolygonPoint[q.CropPolygonPointSelectedID].y+=A}x()}function m(y,z){var A;switch(q.CropType){case CropTypeEnum.Standard:case CropTypeEnum.Circle:q.CropTop+=z;q.CropLeft+=y;if(q.CropType==CropTypeEnum.Standard){}if(q.CropType==CropTypeEnum.Circle){q.EllipseRX=q.CropWidth/2;q.EllipseRY=q.CropHeight/2;q.EllipseCX=q.CropLeft+q.EllipseRX;q.EllipseCY=q.CropTop+q.EllipseRY}break;case CropTypeEnum.Advanced:var D=9999;var E=9999;var B=0;var C=0;for(A=0;A<q.CropPolygonPoint.length;A++){D=Math.min(D,q.CropPolygonPoint[A].x);E=Math.min(E,q.CropPolygonPoint[A].y);B=Math.max(B,q.CropPolygonPoint[A].x);C=Math.max(C,q.CropPolygonPoint[A].y)}for(A=0;A<q.CropPolygonPoint.length;A++){q.CropPolygonPoint[A].x+=y;q.CropPolygonPoint[A].y+=z}break}x()}function l(z,y){return function(C,A,B){if(C!==MovePhaseEnum.Move){return}q.CropResizeDirection=z;q.CropPolygonPointSelectedID=y;if(q.CropResizeDirection==null||q.CropResizeDirection==undefined){return}v(A,B)}}function k(y){return function(B,z,A){if(B!==MovePhaseEnum.Move){return}m(z,A)}}function t(z,y){return function(A){var B={x:A.pageX/q.CropViewScale,y:A.pageY/q.CropViewScale};var C=d(B);q.CropAction="Resize";q.ResizePageX=C.x;q.ResizePageY=C.y;q.CropResizeDirection=z;q.CropPolygonPointSelectedID=y;A.stopPropagation()}}function s(){return function(y){q.CropAction="Move";var z={x:y.pageX/q.CropViewScale,y:y.pageY/q.CropViewScale};var A=d(z);q.ResizePageX=A.x;q.ResizePageY=A.y;y.stopPropagation()}}function j(){return function(y){if(q.CropAction==""){return}var z={x:y.pageX/q.CropViewScale,y:y.pageY/q.CropViewScale};var A=d(z);deltaX=A.x-q.ResizePageX;deltaY=A.y-q.ResizePageY;if(q.FlipHorizontal===true){deltaX*=-1}if(q.FlipVertical===true){deltaY*=-1}q.ResizePageX=A.x;q.ResizePageY=A.y;if(q.CropAction=="Resize"){v(deltaX,deltaY)}else{if(q.CropAction=="Move"){m(deltaX,deltaY)}}}}function u(){return function(){q.CropAction=""}}function g(){var y=MyShapesState.Public_GetFirstSelectedShapeState();if(y===null){y=MyShapesState.Public_GetShapeStateById(q.OriginalShapeId)}return y}e.ChangeCropMode=function(y,z){q.CropType=z;this.PrepareShapePostModal(y)};e.ShowCropDialog=function(y,A){MyPointers.Dialog_CropImage.one("shown.bs.modal",n(y));q.CropType=A;var z=$("#CropAreaSvg");z.children().remove();MyPointers.Dialog_CropImage.modal()};e.RemoveCrop=function(){var y=g();var z=y.X;var A=y.Y;e.UpdateRotatedObjectPosition(y,false);y.UseClipping=false;y.UpdateDrawing();MyPointers.Dialog_CropImage.modal("hide");UndoManager.register(undefined,UndoCrop,[y.Id,true,y.ClipX,y.ClipY,y.ClipWidth,y.ClipHeight,JSON.parse(JSON.stringify(y.CropPolygonPoint)),y.CropType,z,A],"",undefined,UndoCrop,[y.Id,y.UseClipping,y.ClipX,y.ClipY,y.ClipWidth,y.ClipHeight,JSON.parse(JSON.stringify(y.CropPolygonPoint)),y.CropType,y.X,y.Y],"")};e.CancelCrop=function(){MyPointers.Dialog_CropImage.modal("hide");var y=g();y.UpdateDrawing()};function d(z){var y={x:z.x-q.move_delta.x,y:z.y-q.move_delta.y};y={x:y.x-q.rotate_center.x,y:y.y-q.rotate_center.y};y={x:y.x*Math.cos(-q.rotate_alpha*Math.PI/180)-y.y*Math.sin(-q.rotate_alpha*Math.PI/180),y:y.x*Math.sin(-q.rotate_alpha*Math.PI/180)+y.y*Math.cos(-q.rotate_alpha*Math.PI/180)};y={x:y.x+q.rotate_center.x,y:y.y+q.rotate_center.y};y={x:y.x/q.scale.x,y:y.y/q.scale.y};return y}e.GetMoveVectorForRotatedObject=function(y){var D=y.GetPivotPoint(true);var E=y.GetPivotPoint();var z=y.Angle*Math.PI/180;var A=SbtMath.RotatePoint(D,z,E);var B=SbtMath.RotatePoint(A,-z,D);return{x:B.x-D.x,y:B.y-D.y}};e.UpdateRotatedObjectPosition=function(y,A){var z=e.GetMoveVectorForRotatedObject(y);if(A){y.X+=z.x;y.Y+=z.y}else{y.X-=z.x;y.Y-=z.y}};e.UpdateCrop=function(){if(MyBrowserProperties.IsMobile){inputAdapter.useDelegation(true)}var y=g();var H=y.UseClipping;var G=y.CropType;var F=JSON.parse(JSON.stringify(y.CropPolygonPoint));var D=y.ClipX;var E=y.ClipY;var C=y.ClipWidth;var B=y.ClipHeight;var I=y.X;var J=y.Y;e.UpdateRotatedObjectPosition(y,false);y.UseClipping=true;y.CropType=q.CropType;var A;var z=y.GetBBox(false);switch(q.CropType){case CropTypeEnum.Standard:y.ClipX=Math.max(0,q.CropLeft);y.ClipY=Math.max(0,q.CropTop);y.ClipWidth=q.CropLeft+q.CropWidth>q.ImageWidth?q.ImageWidth-q.CropLeft:q.CropWidth;y.ClipHeight=q.CropTop+q.CropHeight>q.ImageHeight?q.ImageHeight-q.CropTop:q.CropHeight;break;case CropTypeEnum.Circle:y.ClipX=q.CropLeft;y.ClipY=q.CropTop;y.ClipWidth=q.CropWidth;y.ClipHeight=q.CropHeight;break;case CropTypeEnum.Advanced:y.ClipX=z.width;y.ClipY=z.height;y.ClipWidth=0;y.ClipHeight=0;for(A=0;A<q.CropPolygonPoint.length;A++){y.CropPolygonPoint[A].x=q.CropPolygonPoint[A].x;y.CropPolygonPoint[A].y=q.CropPolygonPoint[A].y}y.Public_update_ClipRegionByAdvancedCrop();break}y.CropPolygonPointJson=JSON.stringify(y.CropPolygonPoint);if(y.ClipWidth<10){y.ClipWidth=10}if(y.ClipHeight<10){y.ClipHeight=10}e.UpdateRotatedObjectPosition(y,true);UpdateActiveDrawing();UpdateActiveDrawing();MyPointers.Dialog_CropImage.modal("hide");UndoManager.register(undefined,UndoCrop,[y.Id,H,D,E,C,B,F,G,I,J],"",undefined,UndoCrop,[y.Id,y.UseClipping,y.ClipX,y.ClipY,y.ClipWidth,y.ClipHeight,JSON.parse(JSON.stringify(y.CropPolygonPoint)),y.CropType,y.X,y.Y],"")};return e}();$(window).resize(function(){if($("#CropArea").is(":visible")){var b=MyShapesState.Public_GetFirstSelectedShapeState();CropHelper.PrepareShapePostModal(b)}});var OpacitySliderOldValue=null;var OpacityHelper=function(){var d=new Object();d.initControls=function(){var e=$("#opacity-slider").slider({value:1,formater:function(f){return parseInt(f)+"%"}});$("#opacity-slider").on("slide",a);$("#opacity-slider").on("slideStart",b);$("#opacity-slider").on("slideStop",c);$("#opacity-slider").data("previousValue",1)};function b(){OpacitySliderOldValue=$("#opacity-slider").data("previousValue");a()}function a(){var e=MyShapesState.Public_GetFirstSelectedShapeState();var f=$("#opacity-slider").slider("getValue");OpacityHelper.setOpacity(e,f);return f}function c(){var e=MyShapesState.Public_GetFirstSelectedShapeState();var f=a();UndoManager.register(undefined,OpacityHelper.setOpacity,[e,OpacitySliderOldValue],undefined,"",OpacityHelper.setOpacity,[e,f])}d.setOpacity=function(e,f){e.opacity=f/100;UpdateActiveDrawing()};d.setSliderValue=function(e){if($("#opacity-slider").length>0){$("#opacity-slider").slider("setValue",e);$("#opacity-slider").data("previousValue",e)}};return d}();var MultiTextableHelper=function(){var b=new Object();var e=new Object();e.MultiTextImageCopyId="MultiTextableImageCopy";e.OriginalShape;b.Props=e;var a=null;function c(f){e.OriginalShape=f;var p=$("#multiTextableSvg");var g=$("#"+f.Id).clone();StoryboardContainer.UpdateGradientIds(g);g.attr("id",e.MultiTextImageCopyId);g.attr("class","");g.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").remove();g.find("[id^='"+e.OriginalShape.Id+"_text']").remove();g.find("[id$='"+SvgPartsEnum.CropGroup+"']").removeAttr("clip-path").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.CropGroup);var q=g.find("[id$='"+SvgPartsEnum.Scale+"']").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.Scale);g.find("[id$='"+SvgPartsEnum.Natural+"']").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.Natural);p.children().remove();p.append(g);var h=GetGlobalById(e.MultiTextImageCopyId).getBBox();p.attr("width",h.width+24);p.attr("height",h.height+24);if(!a){a=new SvgState(e.MultiTextImageCopyId)}var m=f.TextState.D[f.TextState.CurrentId]._QuillDeltas;a.Id=e.MultiTextImageCopyId;a.NaturalOffsetX=f.NaturalOffsetX;a.NaturalOffsetY=f.NaturalOffsetY;a.X=12;a.Y=12;a.CopyShapeState(f);if(m==null){a.TextState.D[a.TextState.CurrentId]._QuillDeltas=null}a.virtualSelected=true;MyShapesState.Public_SetShapeState(a.Id,a);MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Public_SelectShape($("#"+e.MultiTextImageCopyId));HideControlsMenu();var o="",l;for(l=0;l<a.TextState.D.length;l++){var n=l+1;o+="<li>                    <a id='multitextable_textarea"+l+"' class='multitextable_textareacls' selid='"+l+"'>                        <span class='sprite-sbt sprite-sbt-Bring-Forward'>                        </span>                        <img height='16' width='16' src='/content/menu/blank.gif'>                        Text Area "+n+"                    </a>        </li>"}GetGlobalById("MultiTextable-menu-select-id").innerHTML=o;$(".multitextable_textareacls").click(function(){var u=this.getAttribute("selid")*1+1;var s;$("#MultiTextable-header-title").html("Text Area "+u);for(s=0;s<a.TextState.D.length;s++){var t=e.MultiTextImageCopyId+"_TextBoxArea"+s;if(u-1==s){$("#"+t).attr("style","stroke: black; stroke-width: 5; ")}else{var v="Pink";switch(s){case 0:v="Red";break;case 1:v="Green";break;case 2:v="Blue";break;case 3:v="Orangle";break;case 4:v="Yellow";break;case 4:v="Lavendar";break}$("#"+t).attr("style","stroke-dasharray:5,5; stroke: "+v+"; stroke-width: 3; ")}}a.TextState.CurrentId=this.getAttribute("selid");MainControls.TextControls.PrepTextControls(MyPointers.Controls_TextableControls,a)});var k=(parseInt(a.TextState.CurrentId)+1);$("#textableControls").removeClass("ControlsBox");var r=$("#textableControls").detach();$("#MultiTextable-content").append(r);for(l=0;l<a.TextState.D.length;l++){g.find("#"+e.OriginalShape.Id+"_TextBoxArea"+l).attr("id",e.MultiTextImageCopyId+"_TextBoxArea"+l)}a.UpdateDrawing(true);g.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").hide();MainControls.TextControls.PrepTextControls(MyPointers.Controls_TextableControls,a);$("#MultiTextableModal").on("hidden.bs.modal",function(){MyShapesState.Public_RemoveShapeStateById(e.MultiTextImageCopyId)});$(".multitextable_textareacls").first().click()}function d(f){return function(g){c(f)}}b.ShowMultipleDialog=function(f){MyPointers.Dialog_MultiTextable.one("shown.bs.modal",d(f));var g=$("#multiTextableSvg");g.children().remove();MyPointers.Dialog_MultiTextable.modal()};b.Cancel=function(){MyPointers.Dialog_MultiTextable.modal("hide")};b.Update=function(){e.OriginalShape.CopyTextState(a.TextState);e.OriginalShape.UpdateDrawing(true);MyPointers.Dialog_MultiTextable.modal("hide")};return b}();(function(a){function b(e){this.ok=false;if(e.charAt(0)=="#"){e=e.substr(1,6)}e=e.replace(/ /g,"");e=e.toLowerCase();var k={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var g in k){if(e==g){e=k[g]}}var d=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(i){return[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(i){return[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(i){return[parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)]}}];for(var f=0;f<d.length;f++){var j=d[f].re;var h=d[f].process;var c=j.exec(e);if(c){channels=h(c);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var m=this.r.toString(16);var l=this.g.toString(16);var i=this.b.toString(16);if(m.length==1){m="0"+m}if(l.length==1){l="0"+l}if(i.length==1){i="0"+i}return"#"+m+l+i};this.getHelpXML=function(){var o=new Array();for(var p=0;p<d.length;p++){var m=d[p].example;for(var q=0;q<m.length;q++){o[o.length]=m[q]}}for(var u in k){o[o.length]=u}var v=document.createElement("ul");v.setAttribute("id","rgbcolor-examples");for(var p=0;p<o.length;p++){try{var s=document.createElement("li");var r=new b(o[p]);var n=document.createElement("div");n.style.cssText="margin: 3px; border: 1px solid black; background:"+r.toHex()+"; color:"+r.toHex();n.appendChild(document.createTextNode("test"));var t=document.createTextNode(" "+o[p]+" -> "+r.toRGB()+" -> "+r.toHex());s.appendChild(n);s.appendChild(t);v.appendChild(s)}catch(l){}}return v}}if(typeof define!=="undefined"&&define.amd){define(function(){return b})}else{if(typeof module!=="undefined"&&module.exports){module.exports=b}}a.RGBColor=b}(typeof window!=="undefined"?window:this));(function(b,a){if(typeof define!=="undefined"&&define.amd){define("canvgModule",["rgbcolor","stackblur"],a)}else{if(typeof module!=="undefined"&&module.exports){module.exports=a(require("rgbcolor"),require("stackblur"))}}b.canvg=a(b.RGBColor,b.stackBlur)}(typeof window!=="undefined"?window:this,function(m,n){var c=function(y,u,t){if(y==null&&u==null&&t==null){var x=document.querySelectorAll("svg");for(var r=0;r<x.length;r++){var w=x[r];var o=document.createElement("canvas");o.width=w.clientWidth;o.height=w.clientHeight;w.parentNode.insertBefore(o,w);w.parentNode.removeChild(w);var q=document.createElement("div");q.appendChild(w);c(o,q.innerHTML)}return}if(typeof y=="string"){y=document.getElementById(y)}if(y.svg!=null){y.svg.stop()}var v=b(t||{});if(!(y.childNodes.length==1&&y.childNodes[0].nodeName=="OBJECT")){y.svg=v}var p=y.getContext("2d");if(typeof u.documentElement!="undefined"){v.loadXmlDoc(p,u)}else{if(u.substr(0,1)=="<"){v.loadXml(p,u)}else{v.load(p,u)}}};var h;if(typeof Element.prototype.matches!="undefined"){h=function(o,p){return o.matches(p)}}else{if(typeof Element.prototype.webkitMatchesSelector!="undefined"){h=function(o,p){return o.webkitMatchesSelector(p)}}else{if(typeof Element.prototype.mozMatchesSelector!="undefined"){h=function(o,p){return o.mozMatchesSelector(p)}}else{if(typeof Element.prototype.msMatchesSelector!="undefined"){h=function(o,p){return o.msMatchesSelector(p)}}else{if(typeof Element.prototype.oMatchesSelector!="undefined"){h=function(o,p){return o.oMatchesSelector(p)}}else{if(typeof jQuery==="function"||typeof Zepto==="function"){h=function(o,p){return $(o).is(p)}}if(typeof h==="undefined"){h=Sizzle.matchesSelector}}}}}}var a=/(\[[^\]]+\])/g;var g=/(#[^\s\+>~\.\[:]+)/g;var d=/(\.[^\s\+>~\.\[:]+)/g;var l=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi;var k=/(:[\w-]+\([^\)]*\))/gi;var j=/(:[^\s\+>~\.\[:]+)/g;var e=/([^\s\+>~\.\[:]+)/g;function f(p){var q=[0,0,0];var o=function(s,t){var r=p.match(s);if(r==null){return}q[t]+=r.length;p=p.replace(s," ")};p=p.replace(/:not\(([^\)]*)\)/g,"     $1 ");p=p.replace(/{[\s\S]*/gm," ");o(a,1);o(g,0);o(d,1);o(l,2);o(k,1);o(j,1);p=p.replace(/[\*\s\+>~]/g," ");p=p.replace(/[#\.]/g," ");o(e,2);return q.join("")}function b(o){var p={opts:o};p.FRAMERATE=30;p.MAX_VIRTUAL_PIXELS=30000;p.log=function(r){};if(p.opts.log==true&&typeof console!="undefined"){p.log=function(r){console.log(r)}}p.init=function(r){var s=0;p.UniqueId=function(){s++;return"canvg"+s};p.Definitions={};p.Styles={};p.StylesSpecificity={};p.Animations=[];p.Images=[];p.ctx=r;p.ViewPort=new (function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[]};this.SetCurrent=function(u,t){this.viewPorts.push({width:u,height:t})};this.RemoveCurrent=function(){this.viewPorts.pop()};this.Current=function(){return this.viewPorts[this.viewPorts.length-1]};this.width=function(){return this.Current().width};this.height=function(){return this.Current().height};this.ComputeSize=function(t){if(t!=null&&typeof t=="number"){return t}if(t=="x"){return this.width()}if(t=="y"){return this.height()}return Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}})};p.init();p.ImagesLoaded=function(){for(var r=0;r<p.Images.length;r++){if(!p.Images[r].loaded){return false}}return true};p.trim=function(r){return r.replace(/^\s+|\s+$/g,"")};p.compressSpaces=function(r){return r.replace(/[\s\r\t\n]+/gm," ")};p.ajax=function(s){var r;if(window.XMLHttpRequest){r=new XMLHttpRequest()}else{r=new ActiveXObject("Microsoft.XMLHTTP")}if(r){r.open("GET",s,false);r.send(null);return r.responseText}return null};p.parseXml=function(u){if(typeof Windows!="undefined"&&typeof Windows.Data!="undefined"&&typeof Windows.Data.Xml!="undefined"){var v=new Windows.Data.Xml.Dom.XmlDocument();var t=new Windows.Data.Xml.Dom.XmlLoadSettings();t.prohibitDtd=false;v.loadXml(u,t);return v}else{if(window.DOMParser){try{var s=new DOMParser();return s.parseFromString(u,"image/svg+xml")}catch(r){s=new DOMParser();return s.parseFromString(u,"text/xml")}}else{u=u.replace(/<!DOCTYPE svg[^>]*>/,"");var v=new ActiveXObject("Microsoft.XMLDOM");v.async="false";v.loadXML(u);return v}}};p.Property=function(r,s){this.name=r;this.value=s};p.Property.prototype.getValue=function(){return this.value};p.Property.prototype.hasValue=function(){return(this.value!=null&&this.value!=="")};p.Property.prototype.numValue=function(){if(!this.hasValue()){return 0}var r=parseFloat(this.value);if((this.value+"").match(/%$/)){r=r/100}return r};p.Property.prototype.valueOrDefault=function(r){if(this.hasValue()){return this.value}return r};p.Property.prototype.numValueOrDefault=function(r){if(this.hasValue()){return this.numValue()}return r};p.Property.prototype.addOpacity=function(t){var s=this.value;if(t.value!=null&&t.value!=""&&typeof this.value=="string"){var r=new m(this.value);if(r.ok){s="rgba("+r.r+", "+r.g+", "+r.b+", "+t.numValue()+")"}}return new p.Property(this.name,s)};p.Property.prototype.getDefinition=function(){var r=this.value.match(/#([^\)'"]+)/);if(r){r=r[1]}if(!r){r=this.value}return p.Definitions[r]};p.Property.prototype.isUrlDefinition=function(){return this.value.indexOf("url(")==0};p.Property.prototype.getFillStyleDefinition=function(s,t){var r=this.getDefinition();if(r!=null&&r.createGradient){return r.createGradient(p.ctx,s,t)}if(r!=null&&r.createPattern){if(r.getHrefAttribute().hasValue()){var u=r.attribute("patternTransform");r=r.getHrefAttribute().getDefinition();if(u.hasValue()){r.attribute("patternTransform",true).value=u.value}}return r.createPattern(p.ctx,s)}return null};p.Property.prototype.getDPI=function(r){return 96};p.Property.prototype.getEM=function(t){var r=12;var s=new p.Property("fontSize",p.Font.Parse(p.ctx.font).fontSize);if(s.hasValue()){r=s.toPixels(t)}return r};p.Property.prototype.getUnits=function(){var r=this.value+"";return r.replace(/[0-9\.\-]/g,"")};p.Property.prototype.toPixels=function(v,t){if(!this.hasValue()){return 0}var u=this.value+"";if(u.match(/em$/)){return this.numValue()*this.getEM(v)}if(u.match(/ex$/)){return this.numValue()*this.getEM(v)/2}if(u.match(/px$/)){return this.numValue()}if(u.match(/pt$/)){return this.numValue()*this.getDPI(v)*(1/72)}if(u.match(/pc$/)){return this.numValue()*15}if(u.match(/cm$/)){return this.numValue()*this.getDPI(v)/2.54}if(u.match(/mm$/)){return this.numValue()*this.getDPI(v)/25.4}if(u.match(/in$/)){return this.numValue()*this.getDPI(v)}if(u.match(/%$/)){return this.numValue()*p.ViewPort.ComputeSize(v)}var r=this.numValue();if(t&&r<1){return r*p.ViewPort.ComputeSize(v)}return r};p.Property.prototype.toMilliseconds=function(){if(!this.hasValue()){return 0}var r=this.value+"";if(r.match(/s$/)){return this.numValue()*1000}if(r.match(/ms$/)){return this.numValue()}return this.numValue()};p.Property.prototype.toRadians=function(){if(!this.hasValue()){return 0}var r=this.value+"";if(r.match(/deg$/)){return this.numValue()*(Math.PI/180)}if(r.match(/grad$/)){return this.numValue()*(Math.PI/200)}if(r.match(/rad$/)){return this.numValue()}return this.numValue()*(Math.PI/180)};var q={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};p.Property.prototype.toTextBaseline=function(){if(!this.hasValue()){return null}return q[this.value]};p.Font=new (function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(v,w,x,u,t,y){var s=y!=null?this.Parse(y):this.CreateFont("","","","","",p.ctx.font);return{fontFamily:t||s.fontFamily,fontSize:u||s.fontSize,fontStyle:v||s.fontStyle,fontWeight:x||s.fontWeight,fontVariant:w||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var r=this;this.Parse=function(x){var u={};var t=p.trim(p.compressSpaces(x||"")).split(" ");var y={fontSize:false,fontStyle:false,fontWeight:false,fontVariant:false};var v="";for(var w=0;w<t.length;w++){if(!y.fontStyle&&r.Styles.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontStyle=t[w]}y.fontStyle=true}else{if(!y.fontVariant&&r.Variants.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontVariant=t[w]}y.fontStyle=y.fontVariant=true}else{if(!y.fontWeight&&r.Weights.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontWeight=t[w]}y.fontStyle=y.fontVariant=y.fontWeight=true}else{if(!y.fontSize){if(t[w]!="inherit"){u.fontSize=t[w].split("/")[0]}y.fontStyle=y.fontVariant=y.fontWeight=y.fontSize=true}else{if(t[w]!="inherit"){v+=t[w]}}}}}}if(v!=""){u.fontFamily=v}return u}});p.ToNumberArray=function(u){var r=p.trim(p.compressSpaces((u||"").replace(/,/g," "))).split(" ");for(var t=0;t<r.length;t++){r[t]=parseFloat(r[t])}return r};p.Point=function(r,s){this.x=r;this.y=s};p.Point.prototype.angleTo=function(r){return Math.atan2(r.y-this.y,r.x-this.x)};p.Point.prototype.applyTransform=function(r){var s=this.x*r[0]+this.y*r[2]+r[4];var t=this.x*r[1]+this.y*r[3]+r[5];this.x=s;this.y=t};p.CreatePoint=function(t){var r=p.ToNumberArray(t);return new p.Point(r[0],r[1])};p.CreatePath=function(v){var r=p.ToNumberArray(v);var u=[];for(var t=0;t<r.length;t+=2){u.push(new p.Point(r[t],r[t+1]))}return u};p.BoundingBox=function(r,t,s,u){this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=function(v,w){if(v!=null){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=v;this.x2=v}if(v<this.x1){this.x1=v}if(v>this.x2){this.x2=v}}if(w!=null){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=w;this.y2=w}if(w<this.y1){this.y1=w}if(w>this.y2){this.y2=w}}};this.addX=function(v){this.addPoint(v,null)};this.addY=function(v){this.addPoint(null,v)};this.addBoundingBox=function(v){this.addPoint(v.x1,v.y1);this.addPoint(v.x2,v.y2)};this.addQuadraticCurve=function(z,A,B,C,D,E){var v=z+2/3*(B-z);var w=A+2/3*(C-A);var x=v+1/3*(D-z);var y=w+1/3*(E-A);this.addBezierCurve(z,A,v,x,w,y,D,E)};this.addBezierCurve=function(B,C,E,F,H,I,K,L){var A=[B,C],D=[E,F],G=[H,I],J=[K,L];this.addPoint(A[0],A[1]);this.addPoint(J[0],J[1]);for(i=0;i<=1;i++){var z=function(P){return Math.pow(1-P,3)*A[i]+3*Math.pow(1-P,2)*P*D[i]+3*(1-P)*Math.pow(P,2)*G[i]+Math.pow(P,3)*J[i]};var w=6*A[i]-12*D[i]+6*G[i];var v=-3*A[i]+9*D[i]-9*G[i]+3*J[i];var y=3*D[i]-3*A[i];if(v==0){if(w==0){continue}var M=-y/w;if(0<M&&M<1){if(i==0){this.addX(z(M))}if(i==1){this.addY(z(M))}}continue}var x=Math.pow(w,2)-4*y*v;if(x<0){continue}var N=(-w+Math.sqrt(x))/(2*v);if(0<N&&N<1){if(i==0){this.addX(z(N))}if(i==1){this.addY(z(N))}}var O=(-w-Math.sqrt(x))/(2*v);if(0<O&&O<1){if(i==0){this.addX(z(O))}if(i==1){this.addY(z(O))}}}};this.isPointInBox=function(v,w){return(this.x1<=v&&v<=this.x2&&this.y1<=w&&w<=this.y2)};this.addPoint(r,t);this.addPoint(s,u)};p.Transform=function(A){var w=this;this.Type={};this.Type.translate=function(v){this.p=p.CreatePoint(v);this.apply=function(s){s.translate(this.p.x||0,this.p.y||0)};this.unapply=function(s){s.translate(-1*this.p.x||0,-1*this.p.y||0)};this.applyToPoint=function(s){s.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}};this.Type.rotate=function(B){var v=p.ToNumberArray(B);this.angle=new p.Property("angle",v[0]);this.cx=v[1]||0;this.cy=v[2]||0;this.apply=function(s){s.translate(this.cx,this.cy);s.rotate(this.angle.toRadians());s.translate(-this.cx,-this.cy)};this.unapply=function(s){s.translate(this.cx,this.cy);s.rotate(-1*this.angle.toRadians());s.translate(-this.cx,-this.cy)};this.applyToPoint=function(C){var s=this.angle.toRadians();C.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);C.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]);C.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}};this.Type.scale=function(v){this.p=p.CreatePoint(v);this.apply=function(s){s.scale(this.p.x||1,this.p.y||this.p.x||1)};this.unapply=function(s){s.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)};this.applyToPoint=function(s){s.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}};this.Type.matrix=function(v){this.m=p.ToNumberArray(v);this.apply=function(s){s.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])};this.unapply=function(D){var s=this.m[0];var B=this.m[2];var C=this.m[4];var E=this.m[1];var G=this.m[3];var H=this.m[5];var I=0;var J=0;var K=1;var F=1/(s*(G*K-H*J)-B*(E*K-H*I)+C*(E*J-G*I));D.transform(F*(G*K-H*J),F*(H*I-E*K),F*(C*J-B*K),F*(s*K-C*I),F*(B*H-C*G),F*(C*E-s*H))};this.applyToPoint=function(s){s.applyTransform(this.m)}};this.Type.SkewBase=function(v){this.base=w.Type.matrix;this.base(v);this.angle=new p.Property("angle",v)};this.Type.SkewBase.prototype=new this.Type.matrix;this.Type.skewX=function(v){this.base=w.Type.SkewBase;this.base(v);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(v){this.base=w.Type.SkewBase;this.base(v);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(s){for(var v=0;v<this.transforms.length;v++){this.transforms[v].apply(s)}};this.unapply=function(s){for(var v=this.transforms.length-1;v>=0;v--){this.transforms[v].unapply(s)}};this.applyToPoint=function(v){for(var s=0;s<this.transforms.length;s++){this.transforms[s].applyToPoint(v)}};var r=p.trim(p.compressSpaces(A)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var t=0;t<r.length;t++){var z=p.trim(r[t].split("(")[0]);var u=r[t].split("(")[1].replace(")","");var y=this.Type[z];if(typeof y!="undefined"){var x=new y(u);x.type=z;this.transforms.push(x)}}};p.AspectRatio=function(t,s,G,v,w,u,y,z,A,B){s=p.compressSpaces(s);s=s.replace(/^defer\s/,"");var r=s.split(" ")[0]||"xMidYMid";var x=s.split(" ")[1]||"meet";var E=G/v;var F=w/u;var D=Math.min(E,F);var C=Math.max(E,F);if(x=="meet"){v*=D;u*=D}if(x=="slice"){v*=C;u*=C}A=new p.Property("refX",A);B=new p.Property("refY",B);if(A.hasValue()&&B.hasValue()){t.translate(-D*A.toPixels("x"),-D*B.toPixels("y"))}else{if(r.match(/^xMid/)&&((x=="meet"&&D==F)||(x=="slice"&&C==F))){t.translate(G/2-v/2,0)}if(r.match(/YMid$/)&&((x=="meet"&&D==E)||(x=="slice"&&C==E))){t.translate(0,w/2-u/2)}if(r.match(/^xMax/)&&((x=="meet"&&D==F)||(x=="slice"&&C==F))){t.translate(G-v,0)}if(r.match(/YMax$/)&&((x=="meet"&&D==E)||(x=="slice"&&C==E))){t.translate(0,w-u)}}if(r=="none"){t.scale(E,F)}else{if(x=="meet"){t.scale(D,D)}else{if(x=="slice"){t.scale(C,C)}}}t.translate(y==null?0:-y,z==null?0:-z)};p.Element={};p.EmptyProperty=new p.Property("EMPTY","");p.Element.ElementBase=function(w){this.attributes={};this.styles={};this.stylesSpecificity={};this.children=[];this.attribute=function(F,E){var D=this.attributes[F];if(D!=null){return D}if(E==true){D=new p.Property(F,"");this.attributes[F]=D}return D||p.EmptyProperty};this.getHrefAttribute=function(){for(var D in this.attributes){if(D=="href"||D.match(/:href$/)){return this.attributes[D]}}return p.EmptyProperty};this.style=function(F,E,J){var I=this.styles[F];if(I!=null){return I}var D=this.attribute(F);if(D!=null&&D.hasValue()){this.styles[F]=D;return D}if(J!=true){var G=this.parent;if(G!=null){var H=G.style(F);if(H!=null&&H.hasValue()){return H}}}if(E==true){I=new p.Property(F,"");this.styles[F]=I}return I||p.EmptyProperty};this.render=function(D){if(this.style("display").value=="none"){return}if(this.style("visibility").value=="hidden"){return}D.save();if(this.style("mask").hasValue()){var F=this.style("mask").getDefinition();if(F!=null){F.apply(D,this)}}else{if(this.style("filter").hasValue()){var E=this.style("filter").getDefinition();if(E!=null){E.apply(D,this)}}else{this.setContext(D);this.renderChildren(D);this.clearContext(D)}}D.restore()};this.setContext=function(D){};this.clearContext=function(D){};this.renderChildren=function(D){for(var E=0;E<this.children.length;E++){this.children[E].render(D)}};this.addChild=function(E,F){var D=E;if(F){D=p.CreateElement(E)}D.parent=this;if(D.type!="title"){this.children.push(D)}};this.addStylesFromStyleDefinition=function(){for(var F in p.Styles){if(F[0]!="@"&&h(w,F)){var H=p.Styles[F];var G=p.StylesSpecificity[F];if(H!=null){for(var E in H){var D=this.stylesSpecificity[E];if(typeof D=="undefined"){D="000"}if(G>D){this.styles[E]=H[E];this.stylesSpecificity[E]=G}}}}}};var r=new RegExp("^[A-Z-]+$");var y=function(D){if(r.test(D)){return D.toLowerCase()}return D};if(w!=null&&w.nodeType==1){for(var u=0;u<w.attributes.length;u++){var s=w.attributes[u];var x=y(s.nodeName);this.attributes[x]=new p.Property(x,s.value)}this.addStylesFromStyleDefinition();if(this.attribute("style").hasValue()){var A=this.attribute("style").value.split(";");for(var u=0;u<A.length;u++){if(p.trim(A[u])!=""){var z=A[u].split(":");var v=p.trim(z[0]);var C=p.trim(z[1]);this.styles[v]=new p.Property(v,C)}}}if(this.attribute("id").hasValue()){if(p.Definitions[this.attribute("id").value]==null){p.Definitions[this.attribute("id").value]=this}}for(var u=0;u<w.childNodes.length;u++){var t=w.childNodes[u];if(t.nodeType==1){this.addChild(t,true)}if(this.captureTextNodes&&(t.nodeType==3||t.nodeType==4)){var B=t.value||t.text||t.textContent||"";if(p.compressSpaces(B)!=""){this.addChild(new p.Element.tspan(t),false)}}}}};p.Element.RenderedElementBase=function(r){this.base=p.Element.ElementBase;this.base(r);this.setContext=function(t){if(this.style("fill").isUrlDefinition()){var v=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));if(v!=null){t.fillStyle=v}}else{if(this.style("fill").hasValue()){var u=this.style("fill");if(u.value=="currentColor"){u.value=this.style("color").value}if(u.value!="inherit"){t.fillStyle=(u.value=="none"?"rgba(0,0,0,0)":u.value)}}}if(this.style("fill-opacity").hasValue()){var u=new p.Property("fill",t.fillStyle);u=u.addOpacity(this.style("fill-opacity"));t.fillStyle=u.value}if(this.style("stroke").isUrlDefinition()){var v=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));if(v!=null){t.strokeStyle=v}}else{if(this.style("stroke").hasValue()){var z=this.style("stroke");if(z.value=="currentColor"){z.value=this.style("color").value}if(z.value!="inherit"){t.strokeStyle=(z.value=="none"?"rgba(0,0,0,0)":z.value)}}}if(this.style("stroke-opacity").hasValue()){var z=new p.Property("stroke",t.strokeStyle);z=z.addOpacity(this.style("stroke-opacity"));t.strokeStyle=z.value}if(this.style("stroke-width").hasValue()){var x=this.style("stroke-width").toPixels();t.lineWidth=x==0?0.001:x}if(this.style("stroke-linecap").hasValue()){t.lineCap=this.style("stroke-linecap").value}if(this.style("stroke-linejoin").hasValue()){t.lineJoin=this.style("stroke-linejoin").value}if(this.style("stroke-miterlimit").hasValue()){t.miterLimit=this.style("stroke-miterlimit").value}if(this.style("stroke-dasharray").hasValue()&&this.style("stroke-dasharray").value!="none"){var w=p.ToNumberArray(this.style("stroke-dasharray").value);if(typeof t.setLineDash!="undefined"){t.setLineDash(w)}else{if(typeof t.webkitLineDash!="undefined"){t.webkitLineDash=w}else{if(typeof t.mozDash!="undefined"&&!(w.length==1&&w[0]==0)){t.mozDash=w}}}var y=this.style("stroke-dashoffset").numValueOrDefault(1);if(typeof t.lineDashOffset!="undefined"){t.lineDashOffset=y}else{if(typeof t.webkitLineDashOffset!="undefined"){t.webkitLineDashOffset=y}else{if(typeof t.mozDashOffset!="undefined"){t.mozDashOffset=y}}}}if(typeof t.font!="undefined"){t.font=p.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()}if(this.style("transform",false,true).hasValue()){var A=new p.Transform(this.style("transform",false,true).value);A.apply(t)}if(this.style("clip-path",false,true).hasValue()){var s=this.style("clip-path",false,true).getDefinition();if(s!=null){s.apply(t)}}if(this.style("opacity").hasValue()){t.globalAlpha=this.style("opacity").numValue()}}};p.Element.RenderedElementBase.prototype=new p.Element.ElementBase;p.Element.PathElementBase=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.path=function(s){if(s!=null){s.beginPath()}return new p.BoundingBox()};this.renderChildren=function(s){this.path(s);p.Mouse.checkPath(this,s);if(s.fillStyle!=""){if(this.style("fill-rule").valueOrDefault("inherit")!="inherit"){s.fill(this.style("fill-rule").value)}else{s.fill()}}if(s.strokeStyle!=""){s.stroke()}var v=this.getMarkers();if(v!=null){if(this.style("marker-start").isUrlDefinition()){var u=this.style("marker-start").getDefinition();u.render(s,v[0][0],v[0][1])}if(this.style("marker-mid").isUrlDefinition()){var u=this.style("marker-mid").getDefinition();for(var t=1;t<v.length-1;t++){u.render(s,v[t][0],v[t][1])}}if(this.style("marker-end").isUrlDefinition()){var u=this.style("marker-end").getDefinition();u.render(s,v[v.length-1][0],v[v.length-1][1])}}};this.getBoundingBox=function(){return this.path()};this.getMarkers=function(){return null}};p.Element.PathElementBase.prototype=new p.Element.RenderedElementBase;p.Element.svg=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.baseClearContext=this.clearContext;this.clearContext=function(s){this.baseClearContext(s);p.ViewPort.RemoveCurrent()};this.baseSetContext=this.setContext;this.setContext=function(s){s.strokeStyle="rgba(0,0,0,0)";s.lineCap="butt";s.lineJoin="miter";s.miterLimit=4;if(typeof s.font!="undefined"&&typeof window.getComputedStyle!="undefined"){s.font=window.getComputedStyle(s.canvas).getPropertyValue("font")}this.baseSetContext(s);if(!this.attribute("x").hasValue()){this.attribute("x",true).value=0}if(!this.attribute("y").hasValue()){this.attribute("y",true).value=0}s.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var z=p.ViewPort.width();var t=p.ViewPort.height();if(!this.attribute("width").hasValue()){this.attribute("width",true).value="100%"}if(!this.attribute("height").hasValue()){this.attribute("height",true).value="100%"}if(typeof this.root=="undefined"){z=this.attribute("width").toPixels("x");t=this.attribute("height").toPixels("y");var A=0;var B=0;if(this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()){A=-this.attribute("refX").toPixels("x");B=-this.attribute("refY").toPixels("y")}if(this.attribute("overflow").valueOrDefault("hidden")!="visible"){s.beginPath();s.moveTo(A,B);s.lineTo(z,B);s.lineTo(z,t);s.lineTo(A,t);s.closePath();s.clip()}}p.ViewPort.SetCurrent(z,t);if(this.attribute("viewBox").hasValue()){var w=p.ToNumberArray(this.attribute("viewBox").value);var u=w[0];var v=w[1];z=w[2];t=w[3];p.AspectRatio(s,this.attribute("preserveAspectRatio").value,p.ViewPort.width(),z,p.ViewPort.height(),t,u,v,this.attribute("refX").value,this.attribute("refY").value);p.ViewPort.RemoveCurrent();p.ViewPort.SetCurrent(w[2],w[3])}}};p.Element.svg.prototype=new p.Element.RenderedElementBase;p.Element.rect=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var z=this.attribute("x").toPixels("x");var A=this.attribute("y").toPixels("y");var w=this.attribute("width").toPixels("x");var t=this.attribute("height").toPixels("y");var u=this.attribute("rx").toPixels("x");var v=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()){v=u}if(this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()){u=v}u=Math.min(u,w/2);v=Math.min(v,t/2);if(s!=null){s.beginPath();s.moveTo(z+u,A);s.lineTo(z+w-u,A);s.quadraticCurveTo(z+w,A,z+w,A+v);s.lineTo(z+w,A+t-v);s.quadraticCurveTo(z+w,A+t,z+w-u,A+t);s.lineTo(z+u,A+t);s.quadraticCurveTo(z,A+t,z,A+t-v);s.lineTo(z,A+v);s.quadraticCurveTo(z,A,z+u,A);s.closePath()}return new p.BoundingBox(z,A,z+w,A+t)}};p.Element.rect.prototype=new p.Element.PathElementBase;p.Element.circle=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var t=this.attribute("cx").toPixels("x");var u=this.attribute("cy").toPixels("y");var v=this.attribute("r").toPixels();if(s!=null){s.beginPath();s.arc(t,u,v,0,Math.PI*2,true);s.closePath()}return new p.BoundingBox(t-v,u-v,t+v,u+v)}};p.Element.circle.prototype=new p.Element.PathElementBase;p.Element.ellipse=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var v=4*((Math.sqrt(2)-1)/3);var w=this.attribute("rx").toPixels("x");var x=this.attribute("ry").toPixels("y");var t=this.attribute("cx").toPixels("x");var u=this.attribute("cy").toPixels("y");if(s!=null){s.beginPath();s.moveTo(t,u-x);s.bezierCurveTo(t+(v*w),u-x,t+w,u-(v*x),t+w,u);s.bezierCurveTo(t+w,u+(v*x),t+(v*w),u+x,t,u+x);s.bezierCurveTo(t-(v*w),u+x,t-w,u+(v*x),t-w,u);s.bezierCurveTo(t-w,u-(v*x),t-(v*w),u-x,t,u-x);s.closePath()}return new p.BoundingBox(t-w,u-x,t+w,u+x)}};p.Element.ellipse.prototype=new p.Element.PathElementBase;p.Element.line=function(r){this.base=p.Element.PathElementBase;this.base(r);this.getPoints=function(){return[new p.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new p.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]};this.path=function(s){var t=this.getPoints();if(s!=null){s.beginPath();s.moveTo(t[0].x,t[0].y);s.lineTo(t[1].x,t[1].y)}return new p.BoundingBox(t[0].x,t[0].y,t[1].x,t[1].y)};this.getMarkers=function(){var t=this.getPoints();var s=t[0].angleTo(t[1]);return[[t[0],s],[t[1],s]]}};p.Element.line.prototype=new p.Element.PathElementBase;p.Element.polyline=function(r){this.base=p.Element.PathElementBase;this.base(r);this.points=p.CreatePath(this.attribute("points").value);this.path=function(t){var s=new p.BoundingBox(this.points[0].x,this.points[0].y);if(t!=null){t.beginPath();t.moveTo(this.points[0].x,this.points[0].y)}for(var u=1;u<this.points.length;u++){s.addPoint(this.points[u].x,this.points[u].y);if(t!=null){t.lineTo(this.points[u].x,this.points[u].y)}}return s};this.getMarkers=function(){var t=[];for(var s=0;s<this.points.length-1;s++){t.push([this.points[s],this.points[s].angleTo(this.points[s+1])])}if(t.length>0){t.push([this.points[this.points.length-1],t[t.length-1][1]])}return t}};p.Element.polyline.prototype=new p.Element.PathElementBase;p.Element.polygon=function(r){this.base=p.Element.polyline;this.base(r);this.basePath=this.path;this.path=function(t){var s=this.basePath(t);if(t!=null){t.lineTo(this.points[0].x,this.points[0].y);t.closePath()}return s}};p.Element.polygon.prototype=new p.Element.polyline;p.Element.path=function(t){this.base=p.Element.PathElementBase;this.base(t);var r=this.attribute("d").value;r=r.replace(/,/gm," ");for(var s=0;s<2;s++){r=r.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2")}r=r.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");r=r.replace(/([0-9])([+\-])/gm,"$1 $2");for(var s=0;s<2;s++){r=r.replace(/(\.[0-9]*)(\.)/gm,"$1 $2")}r=r.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");r=p.compressSpaces(r);r=p.trim(r);this.PathParser=new (function(u){this.tokens=u.split(" ");this.reset=function(){this.i=-1;this.command="";this.previousCommand="";this.start=new p.Point(0,0);this.control=new p.Point(0,0);this.current=new p.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){if(this.isEnd()){return true}return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null};this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break}return false};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var v=new p.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(v)};this.getAsControlPoint=function(){var v=this.getPoint();this.control=v;return v};this.getAsCurrentPoint=function(){var v=this.getPoint();this.current=v;return v};this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"&&this.previousCommand.toLowerCase()!="q"&&this.previousCommand.toLowerCase()!="t"){return this.current}var v=new p.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return v};this.makeAbsolute=function(v){if(this.isRelativeCommand()){v.x+=this.current.x;v.y+=this.current.y}return v};this.addMarker=function(w,v,x){if(x!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(x)}this.addMarkerAngle(w,v==null?null:v.angleTo(w))};this.addMarkerAngle=function(w,v){this.points.push(w);this.angles.push(v)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var v=0;v<this.angles.length;v++){if(this.angles[v]==null){for(var w=v+1;w<this.angles.length;w++){if(this.angles[w]!=null){this.angles[v]=this.angles[w];break}}}}return this.angles}})(r);this.path=function(G){var R=this.PathParser;R.reset();var A=new p.BoundingBox();if(G!=null){G.beginPath()}while(!R.isEnd()){R.nextCommand();switch(R.command){case"M":case"m":var P=R.getAsCurrentPoint();R.addMarker(P);A.addPoint(P.x,P.y);if(G!=null){G.moveTo(P.x,P.y)}R.start=R.current;while(!R.isCommandOrEnd()){var P=R.getAsCurrentPoint();R.addMarker(P,R.start);A.addPoint(P.x,P.y);if(G!=null){G.lineTo(P.x,P.y)}}break;case"L":case"l":while(!R.isCommandOrEnd()){var B=R.current;var P=R.getAsCurrentPoint();R.addMarker(P,B);A.addPoint(P.x,P.y);if(G!=null){G.lineTo(P.x,P.y)}}break;case"H":case"h":while(!R.isCommandOrEnd()){var O=new p.Point((R.isRelativeCommand()?R.current.x:0)+R.getScalar(),R.current.y);R.addMarker(O,R.current);R.current=O;A.addPoint(R.current.x,R.current.y);if(G!=null){G.lineTo(R.current.x,R.current.y)}}break;case"V":case"v":while(!R.isCommandOrEnd()){var O=new p.Point(R.current.x,(R.isRelativeCommand()?R.current.y:0)+R.getScalar());R.addMarker(O,R.current);R.current=O;A.addPoint(R.current.x,R.current.y);if(G!=null){G.lineTo(R.current.x,R.current.y)}}break;case"C":case"c":while(!R.isCommandOrEnd()){var H=R.current;var Q=R.getPoint();var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,Q);A.addBezierCurve(H.x,H.y,Q.x,Q.y,D.x,D.y,E.x,E.y);if(G!=null){G.bezierCurveTo(Q.x,Q.y,D.x,D.y,E.x,E.y)}}break;case"S":case"s":while(!R.isCommandOrEnd()){var H=R.current;var Q=R.getReflectedControlPoint();var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,Q);A.addBezierCurve(H.x,H.y,Q.x,Q.y,D.x,D.y,E.x,E.y);if(G!=null){G.bezierCurveTo(Q.x,Q.y,D.x,D.y,E.x,E.y)}}break;case"Q":case"q":while(!R.isCommandOrEnd()){var H=R.current;var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,D);A.addQuadraticCurve(H.x,H.y,D.x,D.y,E.x,E.y);if(G!=null){G.quadraticCurveTo(D.x,D.y,E.x,E.y)}}break;case"T":case"t":while(!R.isCommandOrEnd()){var H=R.current;var D=R.getReflectedControlPoint();R.control=D;var E=R.getAsCurrentPoint();R.addMarker(E,D,D);A.addQuadraticCurve(H.x,H.y,D.x,D.y,E.x,E.y);if(G!=null){G.quadraticCurveTo(D.x,D.y,E.x,E.y)}}break;case"A":case"a":while(!R.isCommandOrEnd()){var H=R.current;var T=R.getScalar();var U=R.getScalar();var ab=R.getScalar()*(Math.PI/180);var M=R.getScalar();var W=R.getScalar();var E=R.getAsCurrentPoint();var I=new p.Point(Math.cos(ab)*(H.x-E.x)/2+Math.sin(ab)*(H.y-E.y)/2,-Math.sin(ab)*(H.x-E.x)/2+Math.cos(ab)*(H.y-E.y)/2);var L=Math.pow(I.x,2)/Math.pow(T,2)+Math.pow(I.y,2)/Math.pow(U,2);if(L>1){T*=Math.sqrt(L);U*=Math.sqrt(L)}var V=(M==W?-1:1)*Math.sqrt(((Math.pow(T,2)*Math.pow(U,2))-(Math.pow(T,2)*Math.pow(I.y,2))-(Math.pow(U,2)*Math.pow(I.x,2)))/(Math.pow(T,2)*Math.pow(I.y,2)+Math.pow(U,2)*Math.pow(I.x,2)));if(isNaN(V)){V=0}var F=new p.Point(V*T*I.y/U,V*-U*I.x/T);var C=new p.Point((H.x+E.x)/2+Math.cos(ab)*F.x-Math.sin(ab)*F.y,(H.y+E.y)/2+Math.sin(ab)*F.x+Math.cos(ab)*F.y);var N=function(u){return Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2))};var S=function(ac,ad){return(ac[0]*ad[0]+ac[1]*ad[1])/(N(ac)*N(ad))};var w=function(ac,ad){return(ac[0]*ad[1]<ac[1]*ad[0]?-1:1)*Math.acos(S(ac,ad))};var x=w([1,0],[(I.x-F.x)/T,(I.y-F.y)/U]);var Z=[(I.x-F.x)/T,(I.y-F.y)/U];var aa=[(-I.x-F.x)/T,(-I.y-F.y)/U];var y=w(Z,aa);if(S(Z,aa)<=-1){y=Math.PI}if(S(Z,aa)>=1){y=0}var J=1-W?1:-1;var z=x+J*(y/2);var K=new p.Point(C.x+T*Math.cos(z),C.y+U*Math.sin(z));R.addMarkerAngle(K,z-J*Math.PI/2);R.addMarkerAngle(E,z-J*Math.PI);A.addPoint(E.x,E.y);if(G!=null){var S=T>U?T:U;var X=T>U?1:T/U;var Y=T>U?U/T:1;G.translate(C.x,C.y);G.rotate(ab);G.scale(X,Y);G.arc(0,0,S,x,x+y,1-W);G.scale(1/X,1/Y);G.rotate(-ab);G.translate(-C.x,-C.y)}}break;case"Z":case"z":if(G!=null){G.closePath()}R.current=R.start}}return A};this.getMarkers=function(){var x=this.PathParser.getMarkerPoints();var u=this.PathParser.getMarkerAngles();var w=[];for(var v=0;v<x.length;v++){w.push([x[v],u[v]])}return w}};p.Element.path.prototype=new p.Element.PathElementBase;p.Element.pattern=function(r){this.base=p.Element.ElementBase;this.base(r);this.createPattern=function(u,v){var B=this.attribute("width").toPixels("x",true);var w=this.attribute("height").toPixels("y",true);var A=new p.Element.svg();A.attributes.viewBox=new p.Property("viewBox",this.attribute("viewBox").value);A.attributes.width=new p.Property("width",B+"px");A.attributes.height=new p.Property("height",w+"px");A.attributes.transform=new p.Property("transform",this.attribute("patternTransform").value);A.children=this.children;var s=document.createElement("canvas");s.width=B;s.height=w;var t=s.getContext("2d");if(this.attribute("x").hasValue()&&this.attribute("y").hasValue()){t.translate(this.attribute("x").toPixels("x",true),this.attribute("y").toPixels("y",true))}for(var C=-1;C<=1;C++){for(var D=-1;D<=1;D++){t.save();A.attributes.x=new p.Property("x",C*s.width);A.attributes.y=new p.Property("y",D*s.height);A.render(t);t.restore()}}var z=u.createPattern(s,"repeat");return z}};p.Element.pattern.prototype=new p.Element.ElementBase;p.Element.marker=function(r){this.base=p.Element.ElementBase;this.base(r);this.baseRender=this.render;this.render=function(t,u,s){t.translate(u.x,u.y);if(this.attribute("orient").valueOrDefault("auto")=="auto"){t.rotate(s)}if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){t.scale(t.lineWidth,t.lineWidth)}t.save();var v=new p.Element.svg();v.attributes.viewBox=new p.Property("viewBox",this.attribute("viewBox").value);v.attributes.refX=new p.Property("refX",this.attribute("refX").value);v.attributes.refY=new p.Property("refY",this.attribute("refY").value);v.attributes.width=new p.Property("width",this.attribute("markerWidth").value);v.attributes.height=new p.Property("height",this.attribute("markerHeight").value);v.attributes.fill=new p.Property("fill",this.attribute("fill").valueOrDefault("black"));v.attributes.stroke=new p.Property("stroke",this.attribute("stroke").valueOrDefault("none"));v.children=this.children;v.render(t);t.restore();if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){t.scale(1/t.lineWidth,1/t.lineWidth)}if(this.attribute("orient").valueOrDefault("auto")=="auto"){t.rotate(-s)}t.translate(-u.x,-u.y)}};p.Element.marker.prototype=new p.Element.ElementBase;p.Element.defs=function(r){this.base=p.Element.ElementBase;this.base(r);this.render=function(s){}};p.Element.defs.prototype=new p.Element.ElementBase;p.Element.GradientBase=function(t){this.base=p.Element.ElementBase;this.base(t);this.stops=[];for(var s=0;s<this.children.length;s++){var r=this.children[s];if(r.type=="stop"){this.stops.push(r)}}this.getGradient=function(){};this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")};this.attributesToInherit=["gradientUnits"];this.inheritStopContainer=function(w){for(var v=0;v<this.attributesToInherit.length;v++){var u=this.attributesToInherit[v];if(!this.attribute(u).hasValue()&&w.attribute(u).hasValue()){this.attribute(u,true).value=w.attribute(u).value}}};this.createGradient=function(w,x,B){var E=this;if(this.getHrefAttribute().hasValue()){E=this.getHrefAttribute().getDefinition();this.inheritStopContainer(E)}var u=function(H){if(B.hasValue()){var I=new p.Property("color",H);return I.addOpacity(B).value}return H};var y=this.getGradient(w,x);if(y==null){return u(E.stops[E.stops.length-1].color)}for(var A=0;A<E.stops.length;A++){y.addColorStop(E.stops[A].offset,u(E.stops[A].color))}if(this.attribute("gradientTransform").hasValue()){var D=p.ViewPort.viewPorts[0];var C=new p.Element.rect();C.attributes.x=new p.Property("x",-p.MAX_VIRTUAL_PIXELS/3);C.attributes.y=new p.Property("y",-p.MAX_VIRTUAL_PIXELS/3);C.attributes.width=new p.Property("width",p.MAX_VIRTUAL_PIXELS);C.attributes.height=new p.Property("height",p.MAX_VIRTUAL_PIXELS);var z=new p.Element.g();z.attributes.transform=new p.Property("transform",this.attribute("gradientTransform").value);z.children=[C];var G=new p.Element.svg();G.attributes.x=new p.Property("x",0);G.attributes.y=new p.Property("y",0);G.attributes.width=new p.Property("width",D.width);G.attributes.height=new p.Property("height",D.height);G.children=[z];var v=document.createElement("canvas");v.width=D.width;v.height=D.height;var F=v.getContext("2d");F.fillStyle=y;G.render(F);return F.createPattern(v,"no-repeat")}return y}};p.Element.GradientBase.prototype=new p.Element.ElementBase;p.Element.linearGradient=function(r){this.base=p.Element.GradientBase;this.base(r);this.attributesToInherit.push("x1");this.attributesToInherit.push("y1");this.attributesToInherit.push("x2");this.attributesToInherit.push("y2");this.getGradient=function(t,u){var s=this.gradientUnits()=="objectBoundingBox"?u.getBoundingBox():null;if(!this.attribute("x1").hasValue()&&!this.attribute("y1").hasValue()&&!this.attribute("x2").hasValue()&&!this.attribute("y2").hasValue()){this.attribute("x1",true).value=0;this.attribute("y1",true).value=0;this.attribute("x2",true).value=1;this.attribute("y2",true).value=0}var v=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"));var x=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"));var w=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"));var y=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y"));if(v==w&&x==y){return null}return t.createLinearGradient(v,x,w,y)}};p.Element.linearGradient.prototype=new p.Element.GradientBase;p.Element.radialGradient=function(r){this.base=p.Element.GradientBase;this.base(r);this.attributesToInherit.push("cx");this.attributesToInherit.push("cy");this.attributesToInherit.push("r");this.attributesToInherit.push("fx");this.attributesToInherit.push("fy");this.getGradient=function(t,w){var s=w.getBoundingBox();if(!this.attribute("cx").hasValue()){this.attribute("cx",true).value="50%"}if(!this.attribute("cy").hasValue()){this.attribute("cy",true).value="50%"}if(!this.attribute("r").hasValue()){this.attribute("r",true).value="50%"}var u=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"));var v=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"));var x=u;var y=v;if(this.attribute("fx").hasValue()){x=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x"))}if(this.attribute("fy").hasValue()){y=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"))}var z=(this.gradientUnits()=="objectBoundingBox"?(s.width()+s.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels());return t.createRadialGradient(x,y,0,u,v,z)}};p.Element.radialGradient.prototype=new p.Element.GradientBase;p.Element.stop=function(r){this.base=p.Element.ElementBase;this.base(r);this.offset=this.attribute("offset").numValue();if(this.offset<0){this.offset=0}if(this.offset>1){this.offset=1}var s=this.style("stop-color",true);if(s.value===""){s.value="#000"}if(this.style("stop-opacity").hasValue()){s=s.addOpacity(this.style("stop-opacity"))}this.color=s.value};p.Element.stop.prototype=new p.Element.ElementBase;p.Element.AnimateBase=function(r){this.base=p.Element.ElementBase;this.base(r);p.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var t=this.attribute("attributeType").value;var s=this.attribute("attributeName").value;if(t=="CSS"){return this.parent.style(s,true)}return this.parent.attribute(s,true)};this.initialValue=null;this.initialUnits="";this.removed=false;this.calcValue=function(){return""};this.update=function(s){if(this.initialValue==null){this.initialValue=this.getProperty().value;this.initialUnits=this.getProperty().getUnits()}if(this.duration>this.maxDuration){if(this.attribute("repeatCount").value=="indefinite"||this.attribute("repeatDur").value=="indefinite"){this.duration=0}else{if(this.attribute("fill").valueOrDefault("remove")=="freeze"&&!this.frozen){this.frozen=true;this.parent.animationFrozen=true;this.parent.animationFrozenValue=this.getProperty().value}else{if(this.attribute("fill").valueOrDefault("remove")=="remove"&&!this.removed){this.removed=true;this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue;return true}}}return false}this.duration=this.duration+s;var v=false;if(this.begin<this.duration){var t=this.calcValue();if(this.attribute("type").hasValue()){var u=this.attribute("type").value;t=u+"("+t+")"}this.getProperty().value=t;v=true}return v};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");if(this.values.hasValue()){this.values.value=this.values.value.split(";")}this.progress=function(){var u={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var t=u.progress*(this.values.value.length-1);var s=Math.floor(t),v=Math.ceil(t);u.from=new p.Property("from",parseFloat(this.values.value[s]));u.to=new p.Property("to",parseFloat(this.values.value[v]));u.progress=(t-s)/(v-s)}else{u.from=this.from;u.to=this.to}return u}};p.Element.AnimateBase.prototype=new p.Element.ElementBase;p.Element.animate=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var t=this.progress();var s=t.from.numValue()+(t.to.numValue()-t.from.numValue())*t.progress;return s+this.initialUnits}};p.Element.animate.prototype=new p.Element.AnimateBase;p.Element.animateColor=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var v=this.progress();var t=new m(v.from.value);var x=new m(v.to.value);if(t.ok&&x.ok){var w=t.r+(x.r-t.r)*v.progress;var u=t.g+(x.g-t.g)*v.progress;var s=t.b+(x.b-t.b)*v.progress;return"rgb("+parseInt(w,10)+","+parseInt(u,10)+","+parseInt(s,10)+")"}return this.attribute("from").value}};p.Element.animateColor.prototype=new p.Element.AnimateBase;p.Element.animateTransform=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var v=this.progress();var s=p.ToNumberArray(v.from.value);var w=p.ToNumberArray(v.to.value);var u="";for(var t=0;t<s.length;t++){u+=s[t]+(w[t]-s[t])*v.progress+" "}return u}};p.Element.animateTransform.prototype=new p.Element.animate;p.Element.font=function(t){this.base=p.Element.ElementBase;this.base(t);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isRTL=false;this.isArabic=false;this.fontFace=null;this.missingGlyph=null;this.glyphs=[];for(var s=0;s<this.children.length;s++){var r=this.children[s];if(r.type=="font-face"){this.fontFace=r;if(r.style("font-family").hasValue()){p.Definitions[r.style("font-family").value]=this}}else{if(r.type=="missing-glyph"){this.missingGlyph=r}else{if(r.type=="glyph"){if(r.arabicForm!=""){this.isRTL=true;this.isArabic=true;if(typeof this.glyphs[r.unicode]=="undefined"){this.glyphs[r.unicode]=[]}this.glyphs[r.unicode][r.arabicForm]=r}else{this.glyphs[r.unicode]=r}}}}}};p.Element.font.prototype=new p.Element.ElementBase;p.Element.fontface=function(r){this.base=p.Element.ElementBase;this.base(r);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;this.unitsPerEm=this.attribute("units-per-em").numValue()};p.Element.fontface.prototype=new p.Element.ElementBase;p.Element.missingglyph=function(r){this.base=p.Element.path;this.base(r);this.horizAdvX=0};p.Element.missingglyph.prototype=new p.Element.path;p.Element.glyph=function(r){this.base=p.Element.path;this.base(r);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value};p.Element.glyph.prototype=new p.Element.path;p.Element.text=function(r){this.captureTextNodes=true;this.base=p.Element.RenderedElementBase;this.base(r);this.baseSetContext=this.setContext;this.setContext=function(s){this.baseSetContext(s);var t=this.style("dominant-baseline").toTextBaseline();if(t==null){t=this.style("alignment-baseline").toTextBaseline()}if(t!=null){s.textBaseline=t}};this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x");var u=this.attribute("y").toPixels("y");var s=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);return new p.BoundingBox(t,u-s,t+Math.floor(s*2/3)*this.children[0].getText().length,u)};this.renderChildren=function(s){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");if(this.attribute("dx").hasValue()){this.x+=this.attribute("dx").toPixels("x")}if(this.attribute("dy").hasValue()){this.y+=this.attribute("dy").toPixels("y")}this.x+=this.getAnchorDelta(s,this,0);for(var t=0;t<this.children.length;t++){this.renderChild(s,this,this,t)}};this.getAnchorDelta=function(t,v,w){var x=this.style("text-anchor").valueOrDefault("start");if(x!="start"){var y=0;for(var u=w;u<v.children.length;u++){var s=v.children[u];if(u>w&&s.attribute("x").hasValue()){break}y+=s.measureTextRecursive(t)}return -1*(x=="end"?y:y/2)}return 0};this.renderChild=function(t,w,v,u){var s=v.children[u];if(s.attribute("x").hasValue()){s.x=s.attribute("x").toPixels("x")+w.getAnchorDelta(t,v,u);if(s.attribute("dx").hasValue()){s.x+=s.attribute("dx").toPixels("x")}}else{if(s.attribute("dx").hasValue()){w.x+=s.attribute("dx").toPixels("x")}s.x=w.x}w.x=s.x+s.measureText(t);if(s.attribute("y").hasValue()){s.y=s.attribute("y").toPixels("y");if(s.attribute("dy").hasValue()){s.y+=s.attribute("dy").toPixels("y")}}else{if(s.attribute("dy").hasValue()){w.y+=s.attribute("dy").toPixels("y")}s.y=w.y}w.y=s.y;s.render(t);for(var u=0;u<s.children.length;u++){w.renderChild(t,w,s,u)}}};p.Element.text.prototype=new p.Element.RenderedElementBase;p.Element.TextElementBase=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.getGlyph=function(u,x,w){var t=x[w];var v=null;if(u.isArabic){var s="isolated";if((w==0||x[w-1]==" ")&&w<x.length-2&&x[w+1]!=" "){s="terminal"}if(w>0&&x[w-1]!=" "&&w<x.length-2&&x[w+1]!=" "){s="medial"}if(w>0&&x[w-1]!=" "&&(w==x.length-1||x[w+1]==" ")){s="initial"}if(typeof u.glyphs[t]!="undefined"){v=u.glyphs[t][s];if(v==null&&u.glyphs[t].type=="glyph"){v=u.glyphs[t]}}}else{v=u.glyphs[t]}if(v==null){v=u.missingGlyph}return v};this.renderChildren=function(s){var t=this.parent.style("font-family").getDefinition();if(t!=null){var v=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);var w=this.parent.style("font-style").valueOrDefault(p.Font.Parse(p.ctx.font).fontStyle);var B=this.getText();if(t.isRTL){B=B.split("").reverse().join("")}var u=p.ToNumberArray(this.parent.attribute("dx").value);for(var y=0;y<B.length;y++){var x=this.getGlyph(t,B,y);var A=v/t.fontFace.unitsPerEm;s.translate(this.x,this.y);s.scale(A,-A);var z=s.lineWidth;s.lineWidth=s.lineWidth*t.fontFace.unitsPerEm/v;if(w=="italic"){s.transform(1,0,0.4,1,0,0)}x.render(s);if(w=="italic"){s.transform(1,0,-0.4,1,0,0)}s.lineWidth=z;s.scale(1/A,-1/A);s.translate(-this.x,-this.y);this.x+=v*(x.horizAdvX||t.horizAdvX)/t.fontFace.unitsPerEm;if(typeof u[y]!="undefined"&&!isNaN(u[y])){this.x+=u[y]}}return}if(s.fillStyle!=""){s.fillText(p.compressSpaces(this.getText()),this.x,this.y)}if(s.strokeStyle!=""){s.strokeText(p.compressSpaces(this.getText()),this.x,this.y)}};this.getText=function(){};this.measureTextRecursive=function(s){var u=this.measureText(s);for(var t=0;t<this.children.length;t++){u+=this.children[t].measureTextRecursive(s)}return u};this.measureText=function(s){var t=this.parent.style("font-family").getDefinition();if(t!=null){var v=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);var y=0;var z=this.getText();if(t.isRTL){z=z.split("").reverse().join("")}var u=p.ToNumberArray(this.parent.attribute("dx").value);for(var x=0;x<z.length;x++){var w=this.getGlyph(t,z,x);y+=(w.horizAdvX||t.horizAdvX)*v/t.fontFace.unitsPerEm;if(typeof u[x]!="undefined"&&!isNaN(u[x])){y+=u[x]}}return y}var A=p.compressSpaces(this.getText());if(!s.measureText){return A.length*10}s.save();this.setContext(s);var B=s.measureText(A).width;s.restore();return B}};p.Element.TextElementBase.prototype=new p.Element.RenderedElementBase;p.Element.tspan=function(r){this.captureTextNodes=true;this.base=p.Element.TextElementBase;this.base(r);this.text=p.compressSpaces(r.value||r.text||r.textContent||"");this.getText=function(){if(this.children.length>0){return""}return this.text}};p.Element.tspan.prototype=new p.Element.TextElementBase;p.Element.tref=function(r){this.base=p.Element.TextElementBase;this.base(r);this.getText=function(){var s=this.getHrefAttribute().getDefinition();if(s!=null){return s.children[0].getText()}}};p.Element.tref.prototype=new p.Element.TextElementBase;p.Element.a=function(s){this.base=p.Element.TextElementBase;this.base(s);this.hasText=s.childNodes.length>0;for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType!=3){this.hasText=false}}this.text=this.hasText?s.childNodes[0].value:"";this.getText=function(){return this.text};this.baseRenderChildren=this.renderChildren;this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var u=new p.Property("fontSize",p.Font.Parse(p.ctx.font).fontSize);p.Mouse.checkBoundingBox(this,new p.BoundingBox(this.x,this.y-u.toPixels("y"),this.x+this.measureText(t),this.y))}else{if(this.children.length>0){var v=new p.Element.g();v.children=this.children;v.parent=this;v.render(t)}}};this.onclick=function(){window.open(this.getHrefAttribute().value)};this.onmousemove=function(){p.ctx.canvas.style.cursor="pointer"}};p.Element.a.prototype=new p.Element.TextElementBase;p.Element.image=function(t){this.base=p.Element.RenderedElementBase;this.base(t);var r=this.getHrefAttribute().value;if(r==""){return}var s=r.match(/\.svg$/);p.Images.push(this);this.loaded=false;if(!s){this.img=document.createElement("img");if(p.opts.useCORS==true){this.img.crossOrigin="Anonymous"}var u=this;this.img.onload=function(){u.loaded=true};this.img.onerror=function(){p.log('ERROR: image "'+r+'" not found');u.loaded=true};this.img.src=r}else{this.img=p.ajax(r);this.loaded=true}this.renderChildren=function(v){var A=this.attribute("x").toPixels("x");var B=this.attribute("y").toPixels("y");var z=this.attribute("width").toPixels("x");var w=this.attribute("height").toPixels("y");if(z==0||w==0){return}v.save();if(s){v.drawSvg(this.img,A,B,z,w)}else{v.translate(A,B);p.AspectRatio(v,this.attribute("preserveAspectRatio").value,z,this.img.width,w,this.img.height,0,0);v.drawImage(this.img,0,0)}v.restore()};this.getBoundingBox=function(){var z=this.attribute("x").toPixels("x");var A=this.attribute("y").toPixels("y");var w=this.attribute("width").toPixels("x");var v=this.attribute("height").toPixels("y");return new p.BoundingBox(z,A,z+w,A+v)}};p.Element.image.prototype=new p.Element.RenderedElementBase;p.Element.g=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.getBoundingBox=function(){var s=new p.BoundingBox();for(var t=0;t<this.children.length;t++){s.addBoundingBox(this.children[t].getBoundingBox())}return s}};p.Element.g.prototype=new p.Element.RenderedElementBase;p.Element.symbol=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.render=function(s){}};p.Element.symbol.prototype=new p.Element.RenderedElementBase;p.Element.style=function(H){this.base=p.Element.ElementBase;this.base(H);var r="";for(var D=0;D<H.childNodes.length;D++){r+=H.childNodes[D].data}r=r.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");r=p.compressSpaces(r);var w=r.split("}");for(var D=0;D<w.length;D++){if(p.trim(w[D])!=""){var v=w[D].split("{");var u=v[0].split(",");var x=v[1].split(";");for(var E=0;E<u.length;E++){var t=p.trim(u[E]);if(t!=""){var J=p.Styles[t]||{};for(var F=0;F<x.length;F++){var I=x[F].indexOf(":");var G=x[F].substr(0,I);var P=x[F].substr(I+1,x[F].length-I);if(G!=null&&P!=null){J[p.trim(G)]=new p.Property(p.trim(G),p.trim(P))}}p.Styles[t]=J;p.StylesSpecificity[t]=f(t);if(t=="@font-face"){var B=J["font-family"].value.replace(/"/g,"");var L=J.src.value.split(",");for(var K=0;K<L.length;K++){if(L[K].indexOf('format("svg")')>0){var O=L[K].indexOf("url");var N=L[K].indexOf(")",O);var M=L[K].substr(O+5,N-O-6);var y=p.parseXml(p.ajax(M));var C=y.getElementsByTagName("font");for(var z=0;z<C.length;z++){var A=p.CreateElement(C[z]);p.Definitions[B]=A}}}}}}}}};p.Element.style.prototype=new p.Element.ElementBase;p.Element.use=function(s){this.base=p.Element.RenderedElementBase;this.base(s);this.baseSetContext=this.setContext;this.setContext=function(t){this.baseSetContext(t);if(this.attribute("x").hasValue()){t.translate(this.attribute("x").toPixels("x"),0)}if(this.attribute("y").hasValue()){t.translate(0,this.attribute("y").toPixels("y"))}};var r=this.getHrefAttribute().getDefinition();this.path=function(t){if(r!=null){r.path(t)}};this.getBoundingBox=function(){if(r!=null){return r.getBoundingBox()}};this.renderChildren=function(t){if(r!=null){var v=r;if(r.type=="symbol"){v=new p.Element.svg();v.type="svg";v.attributes.viewBox=new p.Property("viewBox",r.attribute("viewBox").value);v.attributes.preserveAspectRatio=new p.Property("preserveAspectRatio",r.attribute("preserveAspectRatio").value);v.attributes.overflow=new p.Property("overflow",r.attribute("overflow").value);v.children=r.children}if(v.type=="svg"){if(this.attribute("width").hasValue()){v.attributes.width=new p.Property("width",this.attribute("width").value)}if(this.attribute("height").hasValue()){v.attributes.height=new p.Property("height",this.attribute("height").value)}}var u=v.parent;v.parent=null;v.render(t);v.parent=u}}};p.Element.use.prototype=new p.Element.RenderedElementBase;p.Element.mask=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(v,w){var F=this.attribute("x").toPixels("x");var G=this.attribute("y").toPixels("y");var E=this.attribute("width").toPixels("x");var z=this.attribute("height").toPixels("y");if(E==0&&z==0){var s=new p.BoundingBox();for(var A=0;A<this.children.length;A++){s.addBoundingBox(this.children[A].getBoundingBox())}var F=Math.floor(s.x1);var G=Math.floor(s.y1);var E=Math.floor(s.width());var z=Math.floor(s.height())}var B=w.attribute("mask").value;w.attribute("mask").value="";var u=document.createElement("canvas");u.width=F+E;u.height=G+z;var C=u.getContext("2d");this.renderChildren(C);var t=document.createElement("canvas");t.width=F+E;t.height=G+z;var D=t.getContext("2d");w.render(D);D.globalCompositeOperation="destination-in";D.fillStyle=C.createPattern(u,"no-repeat");D.fillRect(0,0,F+E,G+z);v.fillStyle=D.createPattern(t,"no-repeat");v.fillRect(0,0,F+E,G+z);w.attribute("mask").value=B};this.render=function(s){}};p.Element.mask.prototype=new p.Element.ElementBase;p.Element.clipPath=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(t){var v=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var w=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){};v.call(t);for(var u=0;u<this.children.length;u++){var s=this.children[u];if(typeof s.path!="undefined"){var x=null;if(s.style("transform",false,true).hasValue()){x=new p.Transform(s.style("transform",false,true).value);x.apply(t)}s.path(t);CanvasRenderingContext2D.prototype.closePath=w;if(x){x.unapply(t)}}}w.call(t);t.clip();CanvasRenderingContext2D.prototype.beginPath=v;CanvasRenderingContext2D.prototype.closePath=w};this.render=function(s){}};p.Element.clipPath.prototype=new p.Element.ElementBase;p.Element.filter=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(u,w){var s=w.getBoundingBox();var G=Math.floor(s.x1);var H=Math.floor(s.y1);var F=Math.floor(s.width());var A=Math.floor(s.height());var z=w.style("filter").value;w.style("filter").value="";var C=0,D=0;for(var B=0;B<this.children.length;B++){var v=this.children[B].extraFilterDistance||0;C=Math.max(C,v);D=Math.max(D,v)}var t=document.createElement("canvas");t.width=F+2*C;t.height=A+2*D;var E=t.getContext("2d");E.translate(-G+C,-H+D);w.render(E);for(var B=0;B<this.children.length;B++){if(typeof this.children[B].apply=="function"){this.children[B].apply(E,0,0,F+2*C,A+2*D)}}u.drawImage(t,0,0,F+2*C,A+2*D,G-C,H-D,F+2*C,A+2*D);w.style("filter",true).value=z};this.render=function(s){}};p.Element.filter.prototype=new p.Element.ElementBase;p.Element.feMorphology=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(s,v,w,u,t){}};p.Element.feMorphology.prototype=new p.Element.ElementBase;p.Element.feComposite=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(s,v,w,u,t){}};p.Element.feComposite.prototype=new p.Element.ElementBase;p.Element.feColorMatrix=function(y){this.base=p.Element.ElementBase;this.base(y);var x=p.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var z=x[0];x=[0.213+0.787*z,0.715-0.715*z,0.072-0.072*z,0,0,0.213-0.213*z,0.715+0.285*z,0.072-0.072*z,0,0,0.213-0.213*z,0.715-0.715*z,0.072+0.9280000000000001*z,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var r=x[0]*Math.PI/180;var t=function(s,A,B){return s+Math.cos(r)*A+Math.sin(r)*B};x=[t(0.213,0.787,-0.213),t(0.715,-0.715,-0.715),t(0.072,-0.072,0.9280000000000001),0,0,t(0.213,-0.213,0.143),t(0.715,0.285,0.14),t(0.072,-0.072,-0.283),0,0,t(0.213,-0.213,-0.787),t(0.715,-0.715,0.715),t(0.072,0.9280000000000001,0.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0,1];break}function u(A,D,E,C,s,B){return A[E*C*4+D*4+B]}function v(A,E,F,D,s,B,C){A[F*D*4+E*4+B]=C}function w(s,B){var A=x[s];return A*(A<0?B-255:B)}this.apply=function(B,H,I,G,D){var F=B.getImageData(0,0,G,D);for(var I=0;I<D;I++){for(var H=0;H<G;H++){var E=u(F.data,H,I,G,D,0);var C=u(F.data,H,I,G,D,1);var A=u(F.data,H,I,G,D,2);var s=u(F.data,H,I,G,D,3);v(F.data,H,I,G,D,0,w(0,E)+w(1,C)+w(2,A)+w(3,s)+w(4,1));v(F.data,H,I,G,D,1,w(5,E)+w(6,C)+w(7,A)+w(8,s)+w(9,1));v(F.data,H,I,G,D,2,w(10,E)+w(11,C)+w(12,A)+w(13,s)+w(14,1));v(F.data,H,I,G,D,3,w(15,E)+w(16,C)+w(17,A)+w(18,s)+w(19,1))}}B.clearRect(0,0,G,D);B.putImageData(F,0,0)}};p.Element.feColorMatrix.prototype=new p.Element.ElementBase;p.Element.feGaussianBlur=function(r){this.base=p.Element.ElementBase;this.base(r);this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.extraFilterDistance=this.blurRadius;this.apply=function(s,v,w,u,t){if(typeof n.canvasRGBA=="undefined"){p.log("ERROR: StackBlur.js must be included for blur to work");return}s.canvas.id=p.UniqueId();s.canvas.style.display="none";document.body.appendChild(s.canvas);n.canvasRGBA(s.canvas.id,v,w,u,t,this.blurRadius);document.body.removeChild(s.canvas)}};p.Element.feGaussianBlur.prototype=new p.Element.ElementBase;p.Element.title=function(r){};p.Element.title.prototype=new p.Element.ElementBase;p.Element.desc=function(r){};p.Element.desc.prototype=new p.Element.ElementBase;p.Element.MISSING=function(r){p.log("ERROR: Element '"+r.nodeName+"' not yet implemented.")};p.Element.MISSING.prototype=new p.Element.ElementBase;p.CreateElement=function(t){var r=t.nodeName.replace(/^[^:]+:/,"");r=r.replace(/\-/g,"");var s=null;if(typeof p.Element[r]!="undefined"){s=new p.Element[r](t)}else{s=new p.Element.MISSING(t)}s.type=t.nodeName;return s};p.load=function(r,s){p.loadXml(r,p.ajax(s))};p.loadXml=function(r,s){p.loadXmlDoc(r,p.parseXml(s))};p.loadXmlDoc=function(r,s){p.init(r);var w=function(z){var y=r.canvas;while(y){z.x-=y.offsetLeft;z.y-=y.offsetTop;y=y.offsetParent}if(window.scrollX){z.x+=window.scrollX}if(window.scrollY){z.y+=window.scrollY}return z};if(p.opts.ignoreMouse!=true){r.canvas.onclick=function(y){var z=w(new p.Point(y!=null?y.clientX:event.clientX,y!=null?y.clientY:event.clientY));p.Mouse.onclick(z.x,z.y)};r.canvas.onmousemove=function(y){var z=w(new p.Point(y!=null?y.clientX:event.clientX,y!=null?y.clientY:event.clientY));p.Mouse.onmousemove(z.x,z.y)}}var u=p.CreateElement(s.documentElement);u.root=true;u.addStylesFromStyleDefinition();var v=true;var t=function(){p.ViewPort.Clear();if(r.canvas.parentNode){p.ViewPort.SetCurrent(r.canvas.parentNode.clientWidth,r.canvas.parentNode.clientHeight)}if(p.opts.ignoreDimensions!=true){if(u.style("width").hasValue()){r.canvas.width=u.style("width").toPixels("x");r.canvas.style.width=r.canvas.width+"px"}if(u.style("height").hasValue()){r.canvas.height=u.style("height").toPixels("y");r.canvas.style.height=r.canvas.height+"px"}}var z=r.canvas.clientWidth||r.canvas.width;var y=r.canvas.clientHeight||r.canvas.height;if(p.opts.ignoreDimensions==true&&u.style("width").hasValue()&&u.style("height").hasValue()){z=u.style("width").toPixels("x");y=u.style("height").toPixels("y")}p.ViewPort.SetCurrent(z,y);if(p.opts.offsetX!=null){u.attribute("x",true).value=p.opts.offsetX}if(p.opts.offsetY!=null){u.attribute("y",true).value=p.opts.offsetY}if(p.opts.scaleWidth!=null||p.opts.scaleHeight!=null){var B=null,C=null,A=p.ToNumberArray(u.attribute("viewBox").value);if(p.opts.scaleWidth!=null){if(u.attribute("width").hasValue()){B=u.attribute("width").toPixels("x")/p.opts.scaleWidth}else{if(!isNaN(A[2])){B=A[2]/p.opts.scaleWidth}}}if(p.opts.scaleHeight!=null){if(u.attribute("height").hasValue()){C=u.attribute("height").toPixels("y")/p.opts.scaleHeight}else{if(!isNaN(A[3])){C=A[3]/p.opts.scaleHeight}}}if(B==null){B=C}if(C==null){C=B}u.attribute("width",true).value=p.opts.scaleWidth;u.attribute("height",true).value=p.opts.scaleHeight;u.style("transform",true,true).value+=" scale("+(1/B)+","+(1/C)+")"}if(p.opts.ignoreClear!=true){r.clearRect(0,0,z,y)}u.render(r);if(v){v=false;if(typeof p.opts.renderCallback=="function"){p.opts.renderCallback(s)}}};var x=true;if(p.ImagesLoaded()){x=false;t()}p.intervalID=setInterval(function(){var z=false;if(x&&p.ImagesLoaded()){x=false;z=true}if(p.opts.ignoreMouse!=true){z=z|p.Mouse.hasEvents()}if(p.opts.ignoreAnimation!=true){for(var y=0;y<p.Animations.length;y++){z=z|p.Animations[y].update(1000/p.FRAMERATE)}}if(typeof p.opts.forceRedraw=="function"){if(p.opts.forceRedraw()==true){z=true}}if(z){t();p.Mouse.runEvents()}},1000/p.FRAMERATE)};p.stop=function(){if(p.intervalID){clearInterval(p.intervalID)}};p.Mouse=new (function(){this.events=[];this.hasEvents=function(){return this.events.length!=0};this.onclick=function(r,s){this.events.push({type:"onclick",x:r,y:s,run:function(t){if(t.onclick){t.onclick()}}})};this.onmousemove=function(r,s){this.events.push({type:"onmousemove",x:r,y:s,run:function(t){if(t.onmousemove){t.onmousemove()}}})};this.eventElements=[];this.checkPath=function(t,r){for(var u=0;u<this.events.length;u++){var s=this.events[u];if(r.isPointInPath&&r.isPointInPath(s.x,s.y)){this.eventElements[u]=t}}};this.checkBoundingBox=function(t,r){for(var u=0;u<this.events.length;u++){var s=this.events[u];if(r.isPointInBox(s.x,s.y)){this.eventElements[u]=t}}};this.runEvents=function(){p.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++){var r=this.events[t];var s=this.eventElements[t];while(s){r.run(s);s=s.parent}}this.events=[];this.eventElements=[]}});return p}if(typeof CanvasRenderingContext2D!="undefined"){CanvasRenderingContext2D.prototype.drawSvg=function(w,r,t,q,p,u){var o={ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,offsetX:r,offsetY:t,scaleWidth:q,scaleHeight:p};for(var v in u){if(u.hasOwnProperty(v)){o[v]=u[v]}}c(this.canvas,w,o)}}return c}));(function(b){var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function d(m){var n=m.data;var o=m.width*m.height*4;for(var l=0;l<o;l+=4){var k=n[l+3]/255;n[l]*=k;n[l+1]*=k;n[l+2]*=k}}function j(m){var n=m.data;var o=m.width*m.height*4;for(var l=0;l<o;l+=4){var k=n[l+3];if(k!=0){k=255/k;n[l]*=k;n[l+1]*=k;n[l+2]*=k}}}function i(p,m,r,k){var q=document.getElementById(p);var s=q.naturalWidth;var o=q.naturalHeight;var l=document.getElementById(m);l.style.width=s+"px";l.style.height=o+"px";l.width=s;l.height=o;var n=l.getContext("2d");n.clearRect(0,0,s,o);n.drawImage(q,0,0);if(isNaN(r)||r<1){return}if(k){h(m,0,0,s,o,r)}else{g(m,0,0,s,o,r)}}function h(D,Z,aa,ac,A,P){if(isNaN(P)||P<1){return}P|=0;var r=document.getElementById(D);var s=r.getContext("2d");var E;try{try{E=s.getImageData(Z,aa,ac,A)}catch(u){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");E=s.getImageData(Z,aa,ac,A)}catch(u){alert("Cannot access local image");throw new Error("unable to access local image data: "+u);return}}}catch(u){alert("Cannot access image");throw new Error("unable to access image data: "+u)}d(E);var K=E.data;var ae,af,C,G,ah,ag,ai,O,z,q,m,N,w,o,l,M,v,n,k,L,J,I,H,R;var t=P+P+1;var ab=ac<<2;var ad=ac-1;var B=A-1;var Q=P+1;var Y=Q*(Q+1)/2;var X=new a();var T=X;for(C=1;C<t;C++){T=T.next=new a();if(C==Q){var U=T}}T.next=X;var V=null;var W=null;ai=ag=0;var F=c[P];var S=e[P];for(af=0;af<A;af++){M=v=n=k=O=z=q=m=0;N=Q*(L=K[ag]);w=Q*(J=K[ag+1]);o=Q*(I=K[ag+2]);l=Q*(H=K[ag+3]);O+=Y*L;z+=Y*J;q+=Y*I;m+=Y*H;T=X;for(C=0;C<Q;C++){T.r=L;T.g=J;T.b=I;T.a=H;T=T.next}for(C=1;C<Q;C++){G=ag+((ad<C?ad:C)<<2);O+=(T.r=(L=K[G]))*(R=Q-C);z+=(T.g=(J=K[G+1]))*R;q+=(T.b=(I=K[G+2]))*R;m+=(T.a=(H=K[G+3]))*R;M+=L;v+=J;n+=I;k+=H;T=T.next}V=X;W=U;for(ae=0;ae<ac;ae++){K[ag]=(O*F)>>S;K[ag+1]=(z*F)>>S;K[ag+2]=(q*F)>>S;K[ag+3]=(m*F)>>S;O-=N;z-=w;q-=o;m-=l;N-=V.r;w-=V.g;o-=V.b;l-=V.a;G=(ai+((G=ae+P+1)<ad?G:ad))<<2;M+=(V.r=K[G]);v+=(V.g=K[G+1]);n+=(V.b=K[G+2]);k+=(V.a=K[G+3]);O+=M;z+=v;q+=n;m+=k;V=V.next;N+=(L=W.r);w+=(J=W.g);o+=(I=W.b);l+=(H=W.a);M-=L;v-=J;n-=I;k-=H;W=W.next;ag+=4}ai+=ac}for(ae=0;ae<ac;ae++){v=n=k=M=z=q=m=O=0;ag=ae<<2;N=Q*(L=K[ag]);w=Q*(J=K[ag+1]);o=Q*(I=K[ag+2]);l=Q*(H=K[ag+3]);O+=Y*L;z+=Y*J;q+=Y*I;m+=Y*H;T=X;for(C=0;C<Q;C++){T.r=L;T.g=J;T.b=I;T.a=H;T=T.next}ah=ac;for(C=1;C<=P;C++){ag=(ah+ae)<<2;O+=(T.r=(L=K[ag]))*(R=Q-C);z+=(T.g=(J=K[ag+1]))*R;q+=(T.b=(I=K[ag+2]))*R;m+=(T.a=(H=K[ag+3]))*R;M+=L;v+=J;n+=I;k+=H;T=T.next;if(C<B){ah+=ac}}ag=ae;V=X;W=U;for(af=0;af<A;af++){G=ag<<2;K[G]=(O*F)>>S;K[G+1]=(z*F)>>S;K[G+2]=(q*F)>>S;K[G+3]=(m*F)>>S;O-=N;z-=w;q-=o;m-=l;N-=V.r;w-=V.g;o-=V.b;l-=V.a;G=(ae+(((G=af+Q)<B?G:B)*ac))<<2;O+=(M+=(V.r=K[G]));z+=(v+=(V.g=K[G+1]));q+=(n+=(V.b=K[G+2]));m+=(k+=(V.a=K[G+3]));V=V.next;N+=(L=W.r);w+=(J=W.g);o+=(I=W.b);l+=(H=W.a);M-=L;v-=J;n-=I;k-=H;W=W.next;ag+=ac}}j(E);s.putImageData(E,Z,aa)}function g(A,V,W,Y,v,L){if(isNaN(L)||L<1){return}L|=0;var n=document.getElementById(A);var o=n.getContext("2d");var B;try{try{B=o.getImageData(V,W,Y,v)}catch(r){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");B=o.getImageData(V,W,Y,v)}catch(r){alert("Cannot access local image");throw new Error("unable to access local image data: "+r);return}}}catch(r){alert("Cannot access image");throw new Error("unable to access image data: "+r)}var G=B.data;var aa,ab,z,D,ad,ac,ae,K,u,m,J,t,l,I,s,k,H,F,E,N;var q=L+L+1;var X=Y<<2;var Z=Y-1;var w=v-1;var M=L+1;var U=M*(M+1)/2;var T=new a();var P=T;for(z=1;z<q;z++){P=P.next=new a();if(z==M){var Q=P}}P.next=T;var R=null;var S=null;ae=ac=0;var C=c[L];var O=e[L];for(ab=0;ab<v;ab++){I=s=k=K=u=m=0;J=M*(H=G[ac]);t=M*(F=G[ac+1]);l=M*(E=G[ac+2]);K+=U*H;u+=U*F;m+=U*E;P=T;for(z=0;z<M;z++){P.r=H;P.g=F;P.b=E;P=P.next}for(z=1;z<M;z++){D=ac+((Z<z?Z:z)<<2);K+=(P.r=(H=G[D]))*(N=M-z);u+=(P.g=(F=G[D+1]))*N;m+=(P.b=(E=G[D+2]))*N;I+=H;s+=F;k+=E;P=P.next}R=T;S=Q;for(aa=0;aa<Y;aa++){G[ac]=(K*C)>>O;G[ac+1]=(u*C)>>O;G[ac+2]=(m*C)>>O;K-=J;u-=t;m-=l;J-=R.r;t-=R.g;l-=R.b;D=(ae+((D=aa+L+1)<Z?D:Z))<<2;I+=(R.r=G[D]);s+=(R.g=G[D+1]);k+=(R.b=G[D+2]);K+=I;u+=s;m+=k;R=R.next;J+=(H=S.r);t+=(F=S.g);l+=(E=S.b);I-=H;s-=F;k-=E;S=S.next;ac+=4}ae+=Y}for(aa=0;aa<Y;aa++){s=k=I=u=m=K=0;ac=aa<<2;J=M*(H=G[ac]);t=M*(F=G[ac+1]);l=M*(E=G[ac+2]);K+=U*H;u+=U*F;m+=U*E;P=T;for(z=0;z<M;z++){P.r=H;P.g=F;P.b=E;P=P.next}ad=Y;for(z=1;z<=L;z++){ac=(ad+aa)<<2;K+=(P.r=(H=G[ac]))*(N=M-z);u+=(P.g=(F=G[ac+1]))*N;m+=(P.b=(E=G[ac+2]))*N;I+=H;s+=F;k+=E;P=P.next;if(z<w){ad+=Y}}ac=aa;R=T;S=Q;for(ab=0;ab<v;ab++){D=ac<<2;G[D]=(K*C)>>O;G[D+1]=(u*C)>>O;G[D+2]=(m*C)>>O;K-=J;u-=t;m-=l;J-=R.r;t-=R.g;l-=R.b;D=(aa+(((D=ab+M)<w?D:w)*Y))<<2;K+=(I+=(R.r=G[D]));u+=(s+=(R.g=G[D+1]));m+=(k+=(R.b=G[D+2]));R=R.next;J+=(H=S.r);t+=(F=S.g);l+=(E=S.b);I-=H;s-=F;k-=E;S=S.next;ac+=Y}}o.putImageData(B,V,W)}function a(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}var f={image:i,canvasRGBA:h,canvasRGB:g};if(typeof define!=="undefined"&&define.amd){define(function(){return f})}else{if(typeof module!=="undefined"&&module.exports){module.exports=f}}b.stackBlur=f}(typeof window!=="undefined"?window:this));function GroupAction(){var a=1;this.MakeGroup=function(b){var c=ShapesState.Public_ZSortShapeStates(MyShapesState.Public_GetAllSelectedShapeStates());if(c.length<=1){return}MyGroupAction.MakeGroupFromSelectedObjects(c)};this.MakeGroupFromSelectedObjects=function(r,o){var v=new Array();var p=new Array();var e=new Array();var h;var u=null;var l=null;var c=null;var q=null;var j=FindTopMostSVG_in_SelectedGroup(r);var k=$("#"+j).next();var b=false;for(h=0;h<r.length;h++){var d=r[h].Public_GetImaginaryOuterBox();if(h==0||u>d.Top){u=d.Top}if(h==0||l>d.Left){l=d.Left}if(h==0||q<d.Right){q=d.Right}if(h==0||c<d.Bottom){c=d.Bottom}b=b||r[h].UseClipping}var x=q-l;var w=c-u;var s=SvgCreator.CreateBlankSvg(x,w);s.setAttribute("viewBox",0+" "+0+" "+x+" "+w);var f=SvgCreator.CreateSvgGroup("natural"+a);f.appendChild(s);var t=$(s);for(var h=0;h<r.length;h++){r[h].nextShapeId=$("#"+r[h].Id).next().attr("id")}AttachChildrenShapesToParent(r,t,l,u);var m=AddSvg.AddSvgToStoryboard(f,0,0,true);k.before(m);var n=MyShapesState.Public_GetShapeStateByShape(m);n.X=l;n.Y=u;n.ScaleX=1;n.ScaleY=1;n.NaturalOffsetX=0;n.NaturalOffsetY=0;n.UseClipping=b;n.ClipX=0;n.ClipY=0;n.ClipWidth=x;n.ClipHeight=w;n.isGroupObject=true;for(h=0;h<r.length;h++){n.groupShapeStates.push(r[h])}MyShapesState.Public_ClearAllSelectedShapes();HideControlsMenu();MyShapesState.Public_SelectShape(m);UpdateActiveDrawing();UndoManager.register(undefined,DisassembleShapes,[{childShapeStates:r,parentShapeState:n,parentShape:m}],"",undefined,AssembleShapes,[{childShapeStates:r,parentShapeState:n,parentShape:m,LastSVGId:j}],"");return n};this.ApplyParentStateToChild=function(f,e){var b=f.Private_GetSelectionBoxArea(0);var c={x:e.CenterX,y:e.CenterY};var d={x:f.X*e.Sx,y:f.Y*e.Sy};d={x:d.x+b.CenterX*e.Sx-c.x,y:d.y+b.CenterY*e.Sy-c.y};d={x:d.x*Math.cos(e.Angle*Math.PI/180)-d.y*Math.sin(e.Angle*Math.PI/180),y:d.x*Math.sin(e.Angle*Math.PI/180)+d.y*Math.cos(e.Angle*Math.PI/180)};d={x:d.x-b.CenterX*e.Sx+c.x,y:d.y-b.CenterY*e.Sy+c.y};f.X=d.x+e.fX;f.Y=d.y+e.fY};this.ApplyParentClippingToChild=function(e,l,d){if(!l.UseClipping){return}if(l.CropType!=CropTypeEnum.Advanced){return}var b=e.Private_GetSelectionBoxArea(0);var c={x:b.CenterX,y:b.CenterY};e.CropPolygonPoint=[];var h=null,k=null,g=null,j=null;for(i=0;i<l.CropPolygonPoint.length;i++){var f={x:l.CropPolygonPoint[i].x,y:l.CropPolygonPoint[i].y};f=l.ConvertCoordinateToStage(f,d,true);f=e.ConvertCoordinateToOrigin(f,c,true);e.CropPolygonPoint.push(f)}e.UseClipping=l.UseClipping;e.CropType=l.CropType;e.Public_update_ClipRegionByAdvancedCrop()};this.MinimizeAdvancedCropRegion=function(n){if(!n.UseClipping||n.CropType!=CropTypeEnum.Advanced){return false}var d=new ConvexHullGrahamScan();var f;var m=n.Private_GetElement(SvgPartsEnum.Scale);var l=m.getBBox();var k={Left:l.x,Right:l.x+l.width,Top:l.y,Bottom:l.y+l.height};if(checkPolygonInnerPoint({x:k.Left,y:k.Top},n.CropPolygonPoint)){d.addPoint(k.Left,k.Top)}if(checkPolygonInnerPoint({x:k.Left,y:k.Bottom},n.CropPolygonPoint)){d.addPoint(k.Left,k.Bottom)}if(checkPolygonInnerPoint({x:k.Right,y:k.Top},n.CropPolygonPoint)){d.addPoint(k.Right,k.Top)}if(checkPolygonInnerPoint({x:k.Right,y:k.Bottom},n.CropPolygonPoint)){d.addPoint(k.Right,k.Bottom)}for(f=0;f<n.CropPolygonPoint.length;f++){var b=n.CropPolygonPoint[f];var c=n.CropPolygonPoint[(f+1)%n.CropPolygonPoint.length];var g=new Array();g[0]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Left,k.Top,k.Left,k.Bottom);g[1]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Left,k.Bottom,k.Right,k.Bottom);g[2]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Right,k.Bottom,k.Right,k.Top);g[3]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Right,k.Top,k.Left,k.Top);if(checkRectangleInnerPoint(b,k)){d.addPoint(b.x,b.y)}for(var h=0;h<4;h++){if(g[h].intersect){d.addPoint(g[h].x,g[h].y)}}}var e=d.getHull();if(e.length>=3){n.CropPolygonPoint=new Array();for(f=0;f<e.length;f++){n.CropPolygonPoint.push({x:e[f].x,y:e[f].y})}n.Public_update_ClipRegionByAdvancedCrop();n.CropPolygonPointJson=JSON.stringify(n.CropPolygonPoint);return true}else{n.CropType=CropTypeEnum.Standard;n.ClipWidth=0;n.ClipHeight=0;n.X=-1000;return false}};this.UnGroup=function(d,o){if(!o||o==undefined){o=MyShapesState.Public_GetFirstSelectedShapeState()}if(!o.isGroupObject){return}o.FlipHorizontal=false;o.FlipVertical=false;var k=o.getCropParam();o.Public_convert_RectangleToAdvanced();var g=$("#"+o.Id).next().attr("id");var b=o.Private_GetSelectionBoxArea(0);var q=[],m=[];var h={CenterX:b.CenterX,CenterY:b.CenterY,fX:o.X,fY:o.Y,Sx:o.ScaleX,Sy:o.ScaleY,flipH:o.FlipHorizontal,flipV:o.FlipVertical,Angle:o.Angle,FilterColorMode:o.FilterColorMode};var c={x:b.CenterX,y:b.CenterY};var f;DetachChildrenShapesFromParent(o,true);MyShapesState.Public_ClearAllSelectedShapes();HideControlsMenu();for(f=0;f<o.groupShapeStates.length;f++){var p=o.groupShapeStates[f].getCropParam();MyGroupAction.ApplyParentStateToChild(o.groupShapeStates[f],h);o.groupShapeStates[f].Angle+=h.Angle;o.groupShapeStates[f].ScaleX*=h.Sx;o.groupShapeStates[f].ScaleY*=h.Sy;o.groupShapeStates[f].opacity*=o.opacity;if(h.FilterColorMode){o.groupShapeStates[f].FilterColorMode=h.FilterColorMode}o.groupShapeStates[f].UpdateDrawing();if(o.FlipVertical){o.groupShapeStates[f].FlipVertical=!o.groupShapeStates[f].FlipVertical}if(o.FlipHorizontal){o.groupShapeStates[f].FlipHorizontal=!o.groupShapeStates[f].FlipHorizontal}MyShapesState.Public_SelectShape($("#"+o.groupShapeStates[f].Id));MyGroupAction.ApplyParentClippingToChild(o.groupShapeStates[f],o,c);MyGroupAction.MinimizeAdvancedCropRegion(o.groupShapeStates[f]);var l=o.groupShapeStates[f].getCropParam();q.push(p);m.push(l)}var j=o.getCropParam();var n=$("#"+o.Id).detach();MyShapesState.Public_RemoveShapeStateById(o.Id);UpdateActiveDrawing();UndoManager.register(undefined,AssembleWithOriginalChildren,[{childShapeStates:o.groupShapeStates,parentShapeState:o,parentShape:n,ChildParams:q,ParentParam:k,LastSVGId:g}],"",undefined,DisassembleWithOriginalChildren,[{childShapeStates:o.groupShapeStates,parentShapeState:o,parentShape:n,ChildParams:m,ParentParam:j}],"")};this.CheckGroupObject=function(){var b=MyShapesState.Public_GetFirstSelectedShapeState();return b.isGroupObject}}function DetachChildrenShapesFromParent(e,g){var b;var d=$("#"+e.Id).next();var a=$("#"+e.Id+SvgPartsEnum.SvgImage);a.children("g").each(function(){var j=this.getAttribute("id");var h=$(this).detach();h.on("mousedown",ShapeSelected);h.on("mouseup",HandleMouseExit);d.before(h)});if(!g){var c;for(c=e.groupShapeStates.length-1;c>=0;c--){var f=$("#"+e.groupShapeStates[c].Id);if($("#"+e.groupShapeStates[c].nextShapeId).length){$("#"+e.groupShapeStates[c].nextShapeId).before(f)}}}for(b=0;b<e.groupShapeStates.length;b++){MyShapesState.Public_SetShapeState(e.groupShapeStates[b].Id,e.groupShapeStates[b])}}function DisassembleShapes(){if(arguments.length<1){return}var a=arguments[0].childShapeStates;var c=arguments[0].parentShape;var d=arguments[0].parentShapeState;var f=arguments[1];var b;DetachChildrenShapesFromParent(d,f);MyShapesState.Public_ClearAllSelectedShapes();for(b=0;b<a.length;b++){var e=a[b];e.X+=d.X;e.Y+=d.Y;MyShapesState.Public_SelectShape($("#"+e.Id));e.UpdateDrawing()}$("#"+d.Id).remove();MyShapesState.Public_RemoveShapeStateById(d.Id)}function AttachChildrenShapesToParent(a,b,d,e,h){var c;for(c=0;c<a.length;c++){var g=a[c];if(!h){g.X-=d;g.Y-=e}g.UpdateDrawing();var f=$("#"+g.Id);f.find("[id$='"+SvgPartsEnum.SelectionBox+"']").remove();f.off("mousedown");f.off("mouseup");b.append(f);MyShapesState.Public_RemoveShapeStateById(g.Id)}}function AssembleShapes(){if(arguments.length<1){return}var a=arguments[0].childShapeStates;var d=arguments[0].parentShape;var e=arguments[0].parentShapeState;var c=arguments[0].LastSVGId;var f=arguments[1];$("#"+c).before(d);var b=$("#"+e.Id+SvgPartsEnum.SvgImage);AttachChildrenShapesToParent(a,b,e.X,e.Y,f);d=$("#"+e.Id);d.on("mousedown",ShapeSelected);d.on("mouseup",HandleMouseExit);MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Public_SetShapeState(e.Id,e);MyShapesState.Public_SelectShape($("#"+e.Id));e.UpdateDrawing()}function AssembleWithOriginalChildren(){if(arguments.length<1){return}var b=arguments[0].childShapeStates;var e=arguments[0].parentShape;var f=arguments[0].parentShapeState;var a=arguments[0].ChildParams;var d=arguments[0].ParentParam;var c;for(c=0;c<b.length;c++){b[c].setCropParam(a[c])}AssembleShapes(arguments[0],true);f.setCropParam(d);f.UpdateDrawing()}function DisassembleWithOriginalChildren(){if(arguments.length<1){return}var b=arguments[0].childShapeStates;var e=arguments[0].parentShape;var f=arguments[0].parentShapeState;var a=arguments[0].ChildParams;var d=arguments[0].ParentParam;var c;f.setCropParam(d);DisassembleShapes(arguments[0],true);for(c=0;c<b.length;c++){b[c].setCropParam(a[c]);b[c].UpdateDrawing()}};$.ajaxTransport("+binary",function(b,c,a){if(window.FormData&&((b.dataType&&(b.dataType=="binary"))||(b.data&&((window.ArrayBuffer&&b.data instanceof ArrayBuffer)||(window.Blob&&b.data instanceof Blob))))){return{send:function(h,e){var m=new XMLHttpRequest(),l=b.url,k=b.type,d=b.async||true,g=b.responseType||"blob",f=b.data||null;AbortedBinaryTransport=false;m.addEventListener("load",function(){var i={};i[b.dataType]=m.response;e(m.status,m.statusText,i,m.getAllResponseHeaders())});m.open(k,l,d);for(var j in h){m.setRequestHeader(j,h[j])}m.responseType=g;m.send(f)},abort:function(){try{if(AbortedBinaryTransport==false){AbortedBinaryTransport=true;a.abort("Ajax::TIMEOUT")}}catch(d){console.log(d)}}}}});var AbortedBinaryTransport=false;